/*! elabftw 1.7.5 https://www.elabftw.net */

!function(){var defs={},instantiate=function(id){for(var actual=defs[id],dependencies=actual.deps,definition=actual.defn,len=dependencies.length,instances=new Array(len),i=0;i<len;++i)instances[i]=dem(dependencies[i]);var defResult=definition.apply(null,instances);if(void 0===defResult)throw"module ["+id+"] returned undefined";actual.instance=defResult},def=function(id,dependencies,definition){if("string"!=typeof id)throw"module id must be a string";if(void 0===dependencies)throw"no dependencies for "+id;if(void 0===definition)throw"no definition function for "+id;defs[id]={deps:dependencies,defn:definition,instance:void 0}},dem=function(id){var actual=defs[id];if(void 0===actual)throw"module ["+id+"] was undefined";return void 0===actual.instance&&instantiate(id),actual.instance},req=function(ids,callback){for(var len=ids.length,instances=new Array(len),i=0;i<len;++i)instances.push(dem(ids[i]));callback.apply(null,callback)};({}).bolt={module:{api:{define:def,require:req,demand:dem}}};var define=def,defineGlobal=function(id,ref){define(id,[],function(){return ref})};defineGlobal("global!Array",Array),defineGlobal("global!Error",Error),define("ephox.katamari.api.Fun",["global!Array","global!Error"],function(Array,Error){var constant=function(value){return function(){return value}};return{noop:function(){},compose:function(fa,fb){return function(){return fa(fb.apply(null,arguments))}},constant:constant,identity:function(x){return x},tripleEquals:function(a,b){return a===b},curry:function(f){for(var args=new Array(arguments.length-1),i=1;i<arguments.length;i++)args[i-1]=arguments[i];return function(){for(var newArgs=new Array(arguments.length),j=0;j<newArgs.length;j++)newArgs[j]=arguments[j];var all=args.concat(newArgs);return f.apply(null,all)}},not:function(f){return function(){return!f.apply(null,arguments)}},die:function(msg){return function(){throw new Error(msg)}},apply:function(f){return f()},call:function(f){f()},never:constant(!1),always:constant(!0)}}),define("ephox.katamari.api.Cell",[],function(){var Cell=function(initial){var value=initial,get=function(){return value};return{get:get,set:function(v){value=v},clone:function(){return Cell(get())}}};return Cell}),define("tinymce.core.dom.NodeType",[],function(){function isNodeType(type){return function(node){return!!node&&node.nodeType==type}}function matchNodeNames(names){return names=names.toLowerCase().split(" "),function(node){var i,name;if(node&&node.nodeType)for(name=node.nodeName.toLowerCase(),i=0;i<names.length;i++)if(name===names[i])return!0;return!1}}function hasContentEditableState(value){return function(node){if(isElement(node)){if(node.contentEditable===value)return!0;if(node.getAttribute("data-mce-contenteditable")===value)return!0}return!1}}var isElement=isNodeType(1);return{isText:isNodeType(3),isElement:isElement,isComment:isNodeType(8),isBr:matchNodeNames("br"),isContentEditableTrue:hasContentEditableState("true"),isContentEditableFalse:hasContentEditableState("false"),matchNodeNames:matchNodeNames,hasPropValue:function(propName,propValue){return function(node){return isElement(node)&&node[propName]===propValue}},hasAttribute:function(attrName,attrValue){return function(node){return isElement(node)&&node.hasAttribute(attrName)}},hasAttributeValue:function(attrName,attrValue){return function(node){return isElement(node)&&node.getAttribute(attrName)===attrValue}},matchStyleValues:function(name,values){return values=values.toLowerCase().split(" "),function(node){var i;if(isElement(node))for(i=0;i<values.length;i++)if(node.ownerDocument.defaultView.getComputedStyle(node,null).getPropertyValue(name)===values[i])return!0;return!1}},isBogus:function(node){return isElement(node)&&node.hasAttribute("data-mce-bogus")}}}),define("tinymce.core.util.Promise",[],function(){function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}function Promise(fn){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],doResolve(fn,bind(resolve,this),bind(reject,this))}function handle(deferred){var me=this;null!==this._state?asap(function(){var cb=me._state?deferred.onFulfilled:deferred.onRejected;if(null!==cb){var ret;try{ret=cb(me._value)}catch(e){return void deferred.reject(e)}deferred.resolve(ret)}else(me._state?deferred.resolve:deferred.reject)(me._value)}):this._deferreds.push(deferred)}function resolve(newValue){try{if(newValue===this)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if("function"==typeof then)return void doResolve(bind(then,newValue),bind(resolve,this),bind(reject,this))}this._state=!0,this._value=newValue,finale.call(this)}catch(e){reject.call(this,e)}}function reject(newValue){this._state=!1,this._value=newValue,finale.call(this)}function finale(){for(var i=0,len=this._deferreds.length;i<len;i++)handle.call(this,this._deferreds[i]);this._deferreds=null}function Handler(onFulfilled,onRejected,resolve,reject){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.resolve=resolve,this.reject=reject}function doResolve(fn,onFulfilled,onRejected){var done=!1;try{fn(function(value){done||(done=!0,onFulfilled(value))},function(reason){done||(done=!0,onRejected(reason))})}catch(ex){if(done)return;done=!0,onRejected(ex)}}if(window.Promise)return window.Promise;var asap=Promise.immediateFn||"function"==typeof setImmediate&&setImmediate||function(fn){setTimeout(fn,1)},isArray=Array.isArray||function(value){return"[object Array]"===Object.prototype.toString.call(value)};return Promise.prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){var me=this;return new Promise(function(resolve,reject){handle.call(me,new Handler(onFulfilled,onRejected,resolve,reject))})},Promise.all=function(){var args=Array.prototype.slice.call(1===arguments.length&&isArray(arguments[0])?arguments[0]:arguments);return new Promise(function(resolve,reject){function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,function(val){res(i,val)},reject)}args[i]=val,0==--remaining&&resolve(args)}catch(ex){reject(ex)}}if(0===args.length)return resolve([]);for(var remaining=args.length,i=0;i<args.length;i++)res(i,args[i])})},Promise.resolve=function(value){return value&&"object"==typeof value&&value.constructor===Promise?value:new Promise(function(resolve){resolve(value)})},Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})},Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++)values[i].then(resolve,reject)})},Promise}),define("tinymce.core.util.Delay",["tinymce.core.util.Promise"],function(Promise){function requestAnimationFrame(callback,element){var i,requestAnimationFrameFunc=window.requestAnimationFrame,vendors=["ms","moz","webkit"];for(i=0;i<vendors.length&&!requestAnimationFrameFunc;i++)requestAnimationFrameFunc=window[vendors[i]+"RequestAnimationFrame"];requestAnimationFrameFunc||(requestAnimationFrameFunc=function(callback){window.setTimeout(callback,0)}),requestAnimationFrameFunc(callback,element)}function wrappedSetTimeout(callback,time){return"number"!=typeof time&&(time=0),setTimeout(callback,time)}function wrappedSetInterval(callback,time){return"number"!=typeof time&&(time=1),setInterval(callback,time)}function debounce(callback,time){var timer,func;return func=function(){var args=arguments;clearTimeout(timer),timer=wrappedSetTimeout(function(){callback.apply(this,args)},time)},func.stop=function(){clearTimeout(timer)},func}var requestAnimationFramePromise;return{requestAnimationFrame:function(callback,element){requestAnimationFramePromise?requestAnimationFramePromise.then(callback):requestAnimationFramePromise=new Promise(function(resolve){element||(element=document.body),requestAnimationFrame(resolve,element)}).then(callback)},setTimeout:wrappedSetTimeout,setInterval:wrappedSetInterval,setEditorTimeout:function(editor,callback,time){return wrappedSetTimeout(function(){editor.removed||callback()},time)},setEditorInterval:function(editor,callback,time){var timer;return timer=wrappedSetInterval(function(){editor.removed?clearInterval(timer):callback()},time)},debounce:debounce,throttle:debounce,clearInterval:function(id){return clearInterval(id)},clearTimeout:function(id){return clearTimeout(id)}}}),define("tinymce.core.Env",[],function(){function matchMediaQuery(query){return"matchMedia"in window&&matchMedia(query).matches}var opera,webkit,ie,ie11,ie12,gecko,mac,iDevice,android,fileApi,phone,tablet,windowsPhone,nav=navigator,userAgent=nav.userAgent;return opera=window.opera&&window.opera.buildNumber,android=/Android/.test(userAgent),ie=(ie=!(webkit=/WebKit/.test(userAgent))&&!opera&&/MSIE/gi.test(userAgent)&&/Explorer/gi.test(nav.appName))&&/MSIE (\w+)\./.exec(userAgent)[1],ie11=-1!=userAgent.indexOf("Trident/")&&(-1!=userAgent.indexOf("rv:")||-1!=nav.appName.indexOf("Netscape"))&&11,ie12=-1!=userAgent.indexOf("Edge/")&&!ie&&!ie11&&12,ie=ie||ie11||ie12,gecko=!webkit&&!ie11&&/Gecko/.test(userAgent),mac=-1!=userAgent.indexOf("Mac"),iDevice=/(iPad|iPhone)/.test(userAgent),fileApi="FormData"in window&&"FileReader"in window&&"URL"in window&&!!URL.createObjectURL,phone=matchMediaQuery("only screen and (max-device-width: 480px)")&&(android||iDevice),tablet=matchMediaQuery("only screen and (min-width: 800px)")&&(android||iDevice),windowsPhone=-1!=userAgent.indexOf("Windows Phone"),ie12&&(webkit=!1),{opera:opera,webkit:webkit,ie:ie,gecko:gecko,mac:mac,iOS:iDevice,android:android,contentEditable:!iDevice||fileApi||userAgent.match(/AppleWebKit\/(\d*)/)[1]>=534,transparentSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",caretAfter:8!=ie,range:window.getSelection&&"Range"in window,documentMode:ie&&!ie12?document.documentMode||7:10,fileApi:fileApi,ceFalse:!1===ie||ie>8,canHaveCSP:!1===ie||ie>11,desktop:!phone&&!tablet,windowsPhone:windowsPhone}}),define("tinymce.core.dom.EventUtils",["tinymce.core.util.Delay","tinymce.core.Env"],function(Delay,Env){"use strict";function addEvent(target,name,callback,capture){target.addEventListener?target.addEventListener(name,callback,capture||!1):target.attachEvent&&target.attachEvent("on"+name,callback)}function removeEvent(target,name,callback,capture){target.removeEventListener?target.removeEventListener(name,callback,capture||!1):target.detachEvent&&target.detachEvent("on"+name,callback)}function getTargetFromShadowDom(event,defaultTarget){var path,target=defaultTarget;return(path=event.path)&&path.length>0&&(target=path[0]),event.deepPath&&(path=event.deepPath())&&path.length>0&&(target=path[0]),target}function fix(originalEvent,data){var name,event=data||{};for(name in originalEvent)deprecated[name]||(event[name]=originalEvent[name]);if(event.target||(event.target=event.srcElement||document),Env.experimentalShadowDom&&(event.target=getTargetFromShadowDom(originalEvent,event.target)),originalEvent&&mouseEventRe.test(originalEvent.type)&&void 0===originalEvent.pageX&&void 0!==originalEvent.clientX){var eventDoc=event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body;event.pageX=originalEvent.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),event.pageY=originalEvent.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}return event.preventDefault=function(){event.isDefaultPrevented=returnTrue,originalEvent&&(originalEvent.preventDefault?originalEvent.preventDefault():originalEvent.returnValue=!1)},event.stopPropagation=function(){event.isPropagationStopped=returnTrue,originalEvent&&(originalEvent.stopPropagation?originalEvent.stopPropagation():originalEvent.cancelBubble=!0)},event.stopImmediatePropagation=function(){event.isImmediatePropagationStopped=returnTrue,event.stopPropagation()},!1===hasIsDefaultPrevented(event)&&(event.isDefaultPrevented=returnFalse,event.isPropagationStopped=returnFalse,event.isImmediatePropagationStopped=returnFalse),void 0===event.metaKey&&(event.metaKey=!1),event}function bindOnReady(win,callback,eventUtils){function isDocReady(){return"complete"===doc.readyState||"interactive"===doc.readyState&&doc.body}function readyHandler(){eventUtils.domLoaded||(eventUtils.domLoaded=!0,callback(event))}function waitForDomLoaded(){isDocReady()&&(removeEvent(doc,"readystatechange",waitForDomLoaded),readyHandler())}function tryScroll(){try{doc.documentElement.doScroll("left")}catch(ex){return void Delay.setTimeout(tryScroll)}readyHandler()}var doc=win.document,event={type:"ready"};eventUtils.domLoaded?callback(event):(!doc.addEventListener||Env.ie&&Env.ie<11?(addEvent(doc,"readystatechange",waitForDomLoaded),doc.documentElement.doScroll&&win.self===win.top&&tryScroll()):isDocReady()?readyHandler():addEvent(win,"DOMContentLoaded",readyHandler),addEvent(win,"load",readyHandler))}function EventUtils(){function executeHandlers(evt,id){var callbackList,i,l,callback,container=events[id];if(callbackList=container&&container[evt.type])for(i=0,l=callbackList.length;i<l;i++)if((callback=callbackList[i])&&!1===callback.func.call(callback.scope,evt)&&evt.preventDefault(),evt.isImmediatePropagationStopped())return}var count,expando,hasFocusIn,hasMouseEnterLeave,mouseEnterLeave,self=this,events={};expando=eventExpandoPrefix+(+new Date).toString(32),hasMouseEnterLeave="onmouseenter"in document.documentElement,hasFocusIn="onfocusin"in document.documentElement,mouseEnterLeave={mouseenter:"mouseover",mouseleave:"mouseout"},count=1,self.domLoaded=!1,self.events=events,self.bind=function(target,names,callback,scope){var id,callbackList,i,name,fakeName,nativeHandler,capture,win=window;if(target&&3!==target.nodeType&&8!==target.nodeType){for(target[expando]?id=target[expando]:(id=count++,target[expando]=id,events[id]={}),scope=scope||target,i=(names=names.split(" ")).length;i--;)nativeHandler=function(evt){executeHandlers(fix(evt||win.event),id)},fakeName=capture=!1,"DOMContentLoaded"===(name=names[i])&&(name="ready"),self.domLoaded&&"ready"===name&&"complete"==target.readyState?callback.call(scope,fix({type:name})):(hasMouseEnterLeave||(fakeName=mouseEnterLeave[name])&&(nativeHandler=function(evt){var current,related;if(current=evt.currentTarget,(related=evt.relatedTarget)&&current.contains)related=current.contains(related);else for(;related&&related!==current;)related=related.parentNode;related||((evt=fix(evt||win.event)).type="mouseout"===evt.type?"mouseleave":"mouseenter",evt.target=current,executeHandlers(evt,id))}),hasFocusIn||"focusin"!==name&&"focusout"!==name||(capture=!0,fakeName="focusin"===name?"focus":"blur",nativeHandler=function(evt){(evt=fix(evt||win.event)).type="focus"===evt.type?"focusin":"focusout",executeHandlers(evt,id)}),(callbackList=events[id][name])?"ready"===name&&self.domLoaded?callback({type:name}):callbackList.push({func:callback,scope:scope}):(events[id][name]=callbackList=[{func:callback,scope:scope}],callbackList.fakeName=fakeName,callbackList.capture=capture,callbackList.nativeHandler=nativeHandler,"ready"===name?bindOnReady(target,nativeHandler,self):addEvent(target,fakeName||name,nativeHandler,capture)));return target=callbackList=0,callback}},self.unbind=function(target,names,callback){var id,callbackList,i,ci,name,eventMap;if(!target||3===target.nodeType||8===target.nodeType)return self;if(id=target[expando]){if(eventMap=events[id],names){for(i=(names=names.split(" ")).length;i--;)if(name=names[i],callbackList=eventMap[name]){if(callback)for(ci=callbackList.length;ci--;)if(callbackList[ci].func===callback){var nativeHandler=callbackList.nativeHandler,fakeName=callbackList.fakeName,capture=callbackList.capture;(callbackList=callbackList.slice(0,ci).concat(callbackList.slice(ci+1))).nativeHandler=nativeHandler,callbackList.fakeName=fakeName,callbackList.capture=capture,eventMap[name]=callbackList}callback&&0!==callbackList.length||(delete eventMap[name],removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture))}}else{for(name in eventMap)removeEvent(target,(callbackList=eventMap[name]).fakeName||name,callbackList.nativeHandler,callbackList.capture);eventMap={}}for(name in eventMap)return self;delete events[id];try{delete target[expando]}catch(ex){target[expando]=null}}return self},self.fire=function(target,name,args){var id;if(!target||3===target.nodeType||8===target.nodeType)return self;(args=fix(null,args)).type=name,args.target=target;do{(id=target[expando])&&executeHandlers(args,id),target=target.parentNode||target.ownerDocument||target.defaultView||target.parentWindow}while(target&&!args.isPropagationStopped());return self},self.clean=function(target){var i,children,unbind=self.unbind;if(!target||3===target.nodeType||8===target.nodeType)return self;if(target[expando]&&unbind(target),target.getElementsByTagName||(target=target.document),target&&target.getElementsByTagName)for(unbind(target),i=(children=target.getElementsByTagName("*")).length;i--;)(target=children[i])[expando]&&unbind(target);return self},self.destroy=function(){events={}},self.cancel=function(e){return e&&(e.preventDefault(),e.stopImmediatePropagation()),!1}}var eventExpandoPrefix="mce-data-",mouseEventRe=/^(?:mouse|contextmenu)|click/,deprecated={keyLocation:1,layerX:1,layerY:1,returnValue:1,webkitMovementX:1,webkitMovementY:1,keyIdentifier:1},hasIsDefaultPrevented=function(event){return event.isDefaultPrevented===returnTrue||event.isDefaultPrevented===returnFalse},returnFalse=function(){return!1},returnTrue=function(){return!0};return(EventUtils.Event=new EventUtils).bind(window,"ready",function(){}),EventUtils}),define("tinymce.core.dom.Sizzle",[],function(){function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context),context=context||document,results=results||[],!selector||"string"!=typeof selector)return results;if(1!==(nodeType=context.nodeType)&&9!==nodeType)return[];if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m))||!elem.parentNode)return results;if(elem.id===m)return results.push(elem),results}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nid=old=expando,newContext=context,newSelector=9===nodeType&&selector,1===nodeType&&"object"!==context.nodeName.toLowerCase()){for(groups=tokenize(selector),(old=context.getAttribute("id"))?nid=old.replace(rescape,"\\$&"):context.setAttribute("id",nid),nid="[id='"+nid+"'] ",i=groups.length;i--;)groups[i]=nid+toSelector(groups[i]);newContext=rsibling.test(selector)&&testContext(context.parentNode)||context,newSelector=groups.join(",")}if(newSelector)try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{old||context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}var keys=[];return cache}function markFunction(fn){return fn[expando]=!0,fn}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function testContext(context){return context&&typeof context.getElementsByTagName!==strundefined&&context}function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements){if(outerCache=elem[expando]||(elem[expando]={}),(oldCache=outerCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if(outerCache[dir]=newCache,newCache[2]=matcher(elem,context,xml))return!0}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function multipleContexts(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,!0),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if((matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches))[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context!==document&&context);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0;matcher=elementMatchers[j++];)if(matcher(elem,context,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},strundefined="undefined",MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){for(var i=0,len=this.length;i<len;i++)if(this[i]===elem)return i;return-1},whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return!!documentElement&&"HTML"!==documentElement.nodeName},setDocument=Sizzle.setDocument=function(node){var hasCompare,doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;return doc!==document&&9===doc.nodeType&&doc.documentElement?(document=doc,docElem=doc.documentElement,documentIsHTML=!isXML(doc),parent&&parent!==function(win){try{return win.top}catch(ex){}return null}(parent)&&(parent.addEventListener?parent.addEventListener("unload",function(){setDocument()},!1):parent.attachEvent&&parent.attachEvent("onunload",function(){setDocument()})),support.attributes=!0,support.getElementsByTagName=!0,support.getElementsByClassName=rnative.test(doc.getElementsByClassName),support.getById=!0,Expr.find.ID=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}},Expr.find.TAG=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined)return context.getElementsByTagName(tag)}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],support.disconnectedMatch=!0,rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare||(1&(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},doc):document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=(void 0).call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return Sizzle(expr,document,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},(Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:!operator||(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result+" ").indexOf(check)>-1:"|="===operator&&(result===check||result.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(nodeIndex=(cache=(outerCache=parent[expando]||(parent[expando]={}))[type]||[])[0]===dirruns&&cache[1],diff=cache[0]===dirruns&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns)diff=cache[1];else for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((node[expando]||(node[expando]={}))[type]=[dirruns,diff]),node!==elem)););return(diff-=last)===first||diff%first==0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)seed[idx=indexOf.call(seed,matched[i])]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return text=text.replace(runescape,funescape),function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return(elemLang=elemLang.toLowerCase())===lang||0===elemLang.indexOf(lang+"-")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return!1===elem.disabled},disabled:function(elem){return!0===elem.disabled},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}}).pseudos.nth=Expr.pseudos.eq;for(i in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=function(type){return function(elem){return"input"===elem.nodeName.toLowerCase()&&elem.type===type}}(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=function(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}(i);return setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length));for(type in Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(match||(match=tokenize(selector)),i=match.length;i--;)(cached=matcherFromTokens(match[i]))[expando]?setMatchers.push(cached):elementMatchers.push(cached);(cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))).selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if((tokens=match[0]=match[0].slice(0)).length>2&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(!(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0]))return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),!(selector=seed.length&&toSelector(tokens)))return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=!0,Sizzle}),define("tinymce.core.util.Arr",[],function(){function each(o,cb,s){var n,l;if(!o)return 0;if(s=s||o,void 0!==o.length){for(n=0,l=o.length;n<l;n++)if(!1===cb.call(s,o[n],n,o))return 0}else for(n in o)if(o.hasOwnProperty(n)&&!1===cb.call(s,o[n],n,o))return 0;return 1}function findIndex(array,predicate,thisArg){var i,l;for(i=0,l=array.length;i<l;i++)if(predicate.call(thisArg,array[i],i,array))return i;return-1}var isArray=Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)};return{isArray:isArray,toArray:function(obj){var i,l,array=obj;if(!isArray(obj))for(array=[],i=0,l=obj.length;i<l;i++)array[i]=obj[i];return array},each:each,map:function(array,callback){var out=[];return each(array,function(item,index){out.push(callback(item,index,array))}),out},filter:function(a,f){var o=[];return each(a,function(v,index){f&&!f(v,index,a)||o.push(v)}),o},indexOf:function(a,v){var i,l;if(a)for(i=0,l=a.length;i<l;i++)if(a[i]===v)return i;return-1},reduce:function(collection,iteratee,accumulator,thisArg){var i=0;for(arguments.length<3&&(accumulator=collection[0]);i<collection.length;i++)accumulator=iteratee.call(thisArg,accumulator,collection[i],i);return accumulator},findIndex:findIndex,find:function(array,predicate,thisArg){var idx=findIndex(array,predicate,thisArg);if(-1!==idx)return array[idx]},last:function(collection){return collection[collection.length-1]}}}),define("tinymce.core.util.Tools",["tinymce.core.Env","tinymce.core.util.Arr"],function(Env,Arr){function trim(str){return null===str||void 0===str?"":(""+str).replace(whiteSpaceRegExp,"")}function is(obj,type){return type?!("array"!=type||!Arr.isArray(obj))||typeof obj==type:void 0!==obj}function walk(o,f,n,s){s=s||this,o&&(n&&(o=o[n]),Arr.each(o,function(o,i){if(!1===f.call(s,o,i,n))return!1;walk(o,f,n,s)}))}var whiteSpaceRegExp=/^\s*|\s*$/g;return{trim:trim,isArray:Arr.isArray,is:is,toArray:Arr.toArray,makeMap:function(items,delim,map){var i;for(items=items||[],delim=delim||",","string"==typeof items&&(items=items.split(delim)),map=map||{},i=items.length;i--;)map[items[i]]={};return map},each:Arr.each,map:Arr.map,grep:Arr.filter,inArray:Arr.indexOf,hasOwn:function(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)},extend:function(obj,ext){var i,l,name,value,args=arguments;for(i=1,l=args.length;i<l;i++){ext=args[i];for(name in ext)ext.hasOwnProperty(name)&&void 0!==(value=ext[name])&&(obj[name]=value)}return obj},create:function(s,p,root){var sp,ns,cn,scn,c,self=this,de=0;if(s=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(s),cn=s[3].match(/(^|\.)(\w+)$/i)[2],!(ns=self.createNS(s[3].replace(/\.\w+$/,""),root))[cn]){if("static"==s[2])return ns[cn]=p,void(this.onCreate&&this.onCreate(s[2],s[3],ns[cn]));p[cn]||(p[cn]=function(){},de=1),ns[cn]=p[cn],self.extend(ns[cn].prototype,p),s[5]&&(sp=self.resolve(s[5]).prototype,scn=s[5].match(/\.(\w+)$/i)[1],c=ns[cn],ns[cn]=de?function(){return sp[scn].apply(this,arguments)}:function(){return this.parent=sp[scn],c.apply(this,arguments)},ns[cn].prototype[cn]=ns[cn],self.each(sp,function(f,n){ns[cn].prototype[n]=sp[n]}),self.each(p,function(f,n){sp[n]?ns[cn].prototype[n]=function(){return this.parent=sp[n],f.apply(this,arguments)}:n!=cn&&(ns[cn].prototype[n]=f)})),self.each(p.static,function(f,n){ns[cn][n]=f})}},walk:walk,createNS:function(n,o){var i,v;for(o=o||window,n=n.split("."),i=0;i<n.length;i++)o[v=n[i]]||(o[v]={}),o=o[v];return o},resolve:function(n,o){var i,l;for(o=o||window,i=0,l=(n=n.split(".")).length;i<l&&(o=o[n[i]]);i++);return o},explode:function(s,d){return!s||is(s,"array")?s:Arr.map(s.split(d||","),trim)},_addCacheSuffix:function(url){var cacheSuffix=Env.cacheSuffix;return cacheSuffix&&(url+=(-1===url.indexOf("?")?"?":"&")+cacheSuffix),url}}}),define("tinymce.core.dom.DomQuery",["tinymce.core.dom.EventUtils","tinymce.core.dom.Sizzle","tinymce.core.util.Tools","tinymce.core.Env"],function(EventUtils,Sizzle,Tools,Env){function isDefined(obj){return void 0!==obj}function isString(obj){return"string"==typeof obj}function isWindow(obj){return obj&&obj==obj.window}function createFragment(html,fragDoc){var frag,node,container;for(container=(fragDoc=fragDoc||doc).createElement("div"),frag=fragDoc.createDocumentFragment(),container.innerHTML=html;node=container.firstChild;)frag.appendChild(node);return frag}function domManipulate(targetNodes,sourceItem,callback,reverse){var i;if(isString(sourceItem))sourceItem=createFragment(sourceItem,getElementDocument(targetNodes[0]));else if(sourceItem.length&&!sourceItem.nodeType){if(sourceItem=DomQuery.makeArray(sourceItem),reverse)for(i=sourceItem.length-1;i>=0;i--)domManipulate(targetNodes,sourceItem[i],callback,reverse);else for(i=0;i<sourceItem.length;i++)domManipulate(targetNodes,sourceItem[i],callback,reverse);return targetNodes}if(sourceItem.nodeType)for(i=targetNodes.length;i--;)callback.call(targetNodes[i],sourceItem);return targetNodes}function hasClass(node,className){return node&&className&&-1!==(" "+node.className+" ").indexOf(" "+className+" ")}function wrap(elements,wrapper,all){var lastParent,newWrapper;return wrapper=DomQuery(wrapper)[0],elements.each(function(){var self=this;all&&lastParent==self.parentNode?newWrapper.appendChild(self):(lastParent=self.parentNode,newWrapper=wrapper.cloneNode(!1),self.parentNode.insertBefore(newWrapper,self),newWrapper.appendChild(self))}),elements}function DomQuery(selector,context){return new DomQuery.fn.init(selector,context)}function trim(str){return null===str||str===undef?"":(""+str).replace(whiteSpaceRegExp,"")}function each(obj,callback){var length,key,i,value;if(obj)if(void 0===(length=obj.length)){for(key in obj)if(obj.hasOwnProperty(key)&&(value=obj[key],!1===callback.call(value,key,value)))break}else for(i=0;i<length&&(value=obj[i],!1!==callback.call(value,i,value));i++);return obj}function grep(array,callback){var out=[];return each(array,function(i,item){callback(item,i)&&out.push(item)}),out}function getElementDocument(element){return element?9==element.nodeType?element:element.ownerDocument:doc}function dir(el,prop,until){var matched=[],cur=el[prop];for("string"!=typeof until&&until instanceof DomQuery&&(until=until[0]);cur&&9!==cur.nodeType;){if(void 0!==until){if(cur===until)break;if("string"==typeof until&&DomQuery(cur).is(until))break}1===cur.nodeType&&matched.push(cur),cur=cur[prop]}return matched}function sibling(node,siblingName,nodeType,until){var result=[];for(until instanceof DomQuery&&(until=until[0]);node;node=node[siblingName])if(!nodeType||node.nodeType===nodeType){if(void 0!==until){if(node===until)break;if("string"==typeof until&&DomQuery(node).is(until))break}result.push(node)}return result}function firstSibling(node,siblingName,nodeType){for(node=node[siblingName];node;node=node[siblingName])if(node.nodeType==nodeType)return node;return null}function appendHooks(targetHooks,prop,hooks){each(hooks,function(name,func){targetHooks[name]=targetHooks[name]||{},targetHooks[name][prop]=func})}var undef,doc=document,push=Array.prototype.push,slice=Array.prototype.slice,rquickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,Event=EventUtils.Event,skipUniques=Tools.makeMap("children,contents,next,prev"),numericCssMap=Tools.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom"," "),booleanMap=Tools.makeMap("checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected"," "),propFix={for:"htmlFor",class:"className",readonly:"readOnly"},cssFix={float:"cssFloat"},attrHooks={},cssHooks={},whiteSpaceRegExp=/^\s*|\s*$/g;return DomQuery.fn=DomQuery.prototype={constructor:DomQuery,selector:"",context:null,length:0,init:function(selector,context){var match,node,self=this;if(!selector)return self;if(selector.nodeType)return self.context=self[0]=selector,self.length=1,self;if(context&&context.nodeType)self.context=context;else{if(context)return DomQuery(selector).attr(context);self.context=context=document}if(isString(selector)){if(self.selector=selector,!(match="<"===selector.charAt(0)&&">"===selector.charAt(selector.length-1)&&selector.length>=3?[null,selector,null]:rquickExpr.exec(selector)))return DomQuery(context).find(selector);if(match[1])for(node=createFragment(selector,getElementDocument(context)).firstChild;node;)push.call(self,node),node=node.nextSibling;else{if(!(node=getElementDocument(context).getElementById(match[2])))return self;if(node.id!==match[2])return self.find(selector);self.length=1,self[0]=node}}else this.add(selector,!1);return self},toArray:function(){return Tools.toArray(this)},add:function(items,sort){var nodes,i,self=this;if(isString(items))return self.add(DomQuery(items));if(!1!==sort)for(nodes=DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items))),self.length=nodes.length,i=0;i<nodes.length;i++)self[i]=nodes[i];else push.apply(self,DomQuery.makeArray(items));return self},attr:function(name,value){var hook,self=this;if("object"==typeof name)each(name,function(name,value){self.attr(name,value)});else{if(!isDefined(value)){if(self[0]&&1===self[0].nodeType){if((hook=attrHooks[name])&&hook.get)return hook.get(self[0],name);if(booleanMap[name])return self.prop(name)?name:undef;null===(value=self[0].getAttribute(name,2))&&(value=undef)}return value}this.each(function(){var hook;if(1===this.nodeType){if((hook=attrHooks[name])&&hook.set)return void hook.set(this,value);null===value?this.removeAttribute(name,2):this.setAttribute(name,value,2)}})}return self},removeAttr:function(name){return this.attr(name,null)},prop:function(name,value){var self=this;if("object"==typeof(name=propFix[name]||name))each(name,function(name,value){self.prop(name,value)});else{if(!isDefined(value))return self[0]&&self[0].nodeType&&name in self[0]?self[0][name]:value;this.each(function(){1==this.nodeType&&(this[name]=value)})}return self},css:function(name,value){function camel(name){return name.replace(/-(\D)/g,function(a,b){return b.toUpperCase()})}function dashed(name){return name.replace(/[A-Z]/g,function(a){return"-"+a})}var elm,hook,self=this;if("object"==typeof name)each(name,function(name,value){self.css(name,value)});else if(isDefined(value))name=camel(name),"number"!=typeof value||numericCssMap[name]||(value+="px"),self.each(function(){var style=this.style;if((hook=cssHooks[name])&&hook.set)hook.set(this,value);else{try{this.style[cssFix[name]||name]=value}catch(ex){}null!==value&&""!==value||(style.removeProperty?style.removeProperty(dashed(name)):style.removeAttribute(name))}});else{if(elm=self[0],(hook=cssHooks[name])&&hook.get)return hook.get(elm);if(elm.ownerDocument.defaultView)try{return elm.ownerDocument.defaultView.getComputedStyle(elm,null).getPropertyValue(dashed(name))}catch(ex){return undef}else if(elm.currentStyle)return elm.currentStyle[camel(name)]}return self},remove:function(){for(var node,self=this,i=this.length;i--;)node=self[i],Event.clean(node),node.parentNode&&node.parentNode.removeChild(node);return this},empty:function(){for(var node,self=this,i=this.length;i--;)for(node=self[i];node.firstChild;)node.removeChild(node.firstChild);return this},html:function(value){var i,self=this;if(isDefined(value)){i=self.length;try{for(;i--;)self[i].innerHTML=value}catch(ex){DomQuery(self[i]).empty().append(value)}return self}return self[0]?self[0].innerHTML:""},text:function(value){var i,self=this;if(isDefined(value)){for(i=self.length;i--;)"innerText"in self[i]?self[i].innerText=value:self[0].textContent=value;return self}return self[0]?self[0].innerText||self[0].textContent:""},append:function(){return domManipulate(this,arguments,function(node){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.appendChild(node)})},prepend:function(){return domManipulate(this,arguments,function(node){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.insertBefore(node,this.firstChild)},!0)},before:function(){var self=this;return self[0]&&self[0].parentNode?domManipulate(self,arguments,function(node){this.parentNode.insertBefore(node,this)}):self},after:function(){var self=this;return self[0]&&self[0].parentNode?domManipulate(self,arguments,function(node){this.parentNode.insertBefore(node,this.nextSibling)},!0):self},appendTo:function(val){return DomQuery(val).append(this),this},prependTo:function(val){return DomQuery(val).prepend(this),this},replaceWith:function(content){return this.before(content).remove()},wrap:function(content){return wrap(this,content)},wrapAll:function(content){return wrap(this,content,!0)},wrapInner:function(content){return this.each(function(){DomQuery(this).contents().wrapAll(content)}),this},unwrap:function(){return this.parent().each(function(){DomQuery(this).replaceWith(this.childNodes)})},clone:function(){var result=[];return this.each(function(){result.push(this.cloneNode(!0))}),DomQuery(result)},addClass:function(className){return this.toggleClass(className,!0)},removeClass:function(className){return this.toggleClass(className,!1)},toggleClass:function(className,state){var self=this;return"string"!=typeof className?self:(-1!==className.indexOf(" ")?each(className.split(" "),function(){self.toggleClass(this,state)}):self.each(function(index,node){var existingClassName,classState;(classState=hasClass(node,className))!==state&&(existingClassName=node.className,classState?node.className=trim((" "+existingClassName+" ").replace(" "+className+" "," ")):node.className+=existingClassName?" "+className:className)}),self)},hasClass:function(className){return hasClass(this[0],className)},each:function(callback){return each(this,callback)},on:function(name,callback){return this.each(function(){Event.bind(this,name,callback)})},off:function(name,callback){return this.each(function(){Event.unbind(this,name,callback)})},trigger:function(name){return this.each(function(){"object"==typeof name?Event.fire(this,name.type,name):Event.fire(this,name)})},show:function(){return this.css("display","")},hide:function(){return this.css("display","none")},slice:function(){return new DomQuery(slice.apply(this,arguments))},eq:function(index){return-1===index?this.slice(index):this.slice(index,+index+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},find:function(selector){var i,l,ret=[];for(i=0,l=this.length;i<l;i++)DomQuery.find(selector,this[i],ret);return DomQuery(ret)},filter:function(selector){return DomQuery("function"==typeof selector?grep(this.toArray(),function(item,i){return selector(i,item)}):DomQuery.filter(selector,this.toArray()))},closest:function(selector){var result=[];return selector instanceof DomQuery&&(selector=selector[0]),this.each(function(i,node){for(;node;){if("string"==typeof selector&&DomQuery(node).is(selector)){result.push(node);break}if(node==selector){result.push(node);break}node=node.parentNode}}),DomQuery(result)},offset:function(offset){var elm,doc,docElm,pos,x=0,y=0;return offset?this.css(offset):((elm=this[0])&&(docElm=(doc=elm.ownerDocument).documentElement,elm.getBoundingClientRect&&(x=(pos=elm.getBoundingClientRect()).left+(docElm.scrollLeft||doc.body.scrollLeft)-docElm.clientLeft,y=pos.top+(docElm.scrollTop||doc.body.scrollTop)-docElm.clientTop)),{left:x,top:y})},push:push,sort:[].sort,splice:[].splice},Tools.extend(DomQuery,{extend:Tools.extend,makeArray:function(object){return isWindow(object)||object.nodeType?[object]:Tools.toArray(object)},inArray:function(item,array){var i;if(array.indexOf)return array.indexOf(item);for(i=array.length;i--;)if(array[i]===item)return i;return-1},isArray:Tools.isArray,each:each,trim:trim,grep:grep,find:Sizzle,expr:Sizzle.selectors,unique:Sizzle.uniqueSort,text:Sizzle.getText,contains:Sizzle.contains,filter:function(expr,elems,not){var i=elems.length;for(not&&(expr=":not("+expr+")");i--;)1!=elems[i].nodeType&&elems.splice(i,1);return elems=1===elems.length?DomQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:DomQuery.find.matches(expr,elems)}}),each({parent:function(node){var parent=node.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(node){return dir(node,"parentNode")},next:function(node){return firstSibling(node,"nextSibling",1)},prev:function(node){return firstSibling(node,"previousSibling",1)},children:function(node){return sibling(node.firstChild,"nextSibling",1)},contents:function(node){return Tools.toArray(("iframe"===node.nodeName?node.contentDocument||node.contentWindow.document:node).childNodes)}},function(name,fn){DomQuery.fn[name]=function(selector){var result=[];return this.each(function(){var nodes=fn.call(result,this,selector,result);nodes&&(DomQuery.isArray(nodes)?result.push.apply(result,nodes):result.push(nodes))}),this.length>1&&(skipUniques[name]||(result=DomQuery.unique(result)),0===name.indexOf("parents")&&(result=result.reverse())),result=DomQuery(result),selector?result.filter(selector):result}}),each({parentsUntil:function(node,until){return dir(node,"parentNode",until)},nextUntil:function(node,until){return sibling(node,"nextSibling",1,until).slice(1)},prevUntil:function(node,until){return sibling(node,"previousSibling",1,until).slice(1)}},function(name,fn){DomQuery.fn[name]=function(selector,filter){var result=[];return this.each(function(){var nodes=fn.call(result,this,selector,result);nodes&&(DomQuery.isArray(nodes)?result.push.apply(result,nodes):result.push(nodes))}),this.length>1&&(result=DomQuery.unique(result),0!==name.indexOf("parents")&&"prevUntil"!==name||(result=result.reverse())),result=DomQuery(result),filter?result.filter(filter):result}}),DomQuery.fn.is=function(selector){return!!selector&&this.filter(selector).length>0},DomQuery.fn.init.prototype=DomQuery.fn,DomQuery.overrideDefaults=function(callback){function sub(selector,context){return defaults=defaults||callback(),0===arguments.length&&(selector=defaults.element),context||(context=defaults.context),new sub.fn.init(selector,context)}var defaults;return DomQuery.extend(sub,this),sub},Env.ie&&Env.ie<8&&(appendHooks(attrHooks,"get",{maxlength:function(elm){var value=elm.maxLength;return 2147483647===value?undef:value},size:function(elm){var value=elm.size;return 20===value?undef:value},class:function(elm){return elm.className},style:function(elm){var value=elm.style.cssText;return 0===value.length?undef:value}}),appendHooks(attrHooks,"set",{class:function(elm,value){elm.className=value},style:function(elm,value){elm.style.cssText=value}})),Env.ie&&Env.ie<9&&(cssFix.float="styleFloat",appendHooks(cssHooks,"set",{opacity:function(elm,value){var style=elm.style;null===value||""===value?style.removeAttribute("filter"):(style.zoom=1,style.filter="alpha(opacity="+100*value+")")}})),DomQuery.attrHooks=attrHooks,DomQuery.cssHooks=cssHooks,DomQuery}),define("tinymce.core.dom.Range",["tinymce.core.util.Tools"],function(Tools){function Range(dom){function createDocumentFragment(){return doc.createDocumentFragment()}function setStart(n,o){_setEndPoint(TRUE,n,o)}function setEnd(n,o){_setEndPoint(FALSE,n,o)}function setStartBefore(n){setStart(n.parentNode,nodeIndex(n))}function setEndAfter(n){setEnd(n.parentNode,nodeIndex(n)+1)}function cloneContents(){return _traverse(CLONE)}function _getSelectedNode(container,offset){var child;if(3==container.nodeType)return container;if(offset<0)return container;for(child=container.firstChild;child&&offset>0;)--offset,child=child.nextSibling;return child||container}function _isCollapsed(){return self[START_CONTAINER]==self[END_CONTAINER]&&self[START_OFFSET]==self[END_OFFSET]}function _compareBoundaryPoints(containerA,offsetA,containerB,offsetB){var c,offsetC,n,cmnRoot,childA,childB;if(containerA==containerB)return offsetA==offsetB?0:offsetA<offsetB?-1:1;for(c=containerB;c&&c.parentNode!=containerA;)c=c.parentNode;if(c){for(offsetC=0,n=containerA.firstChild;n!=c&&offsetC<offsetA;)offsetC++,n=n.nextSibling;return offsetA<=offsetC?-1:1}for(c=containerA;c&&c.parentNode!=containerB;)c=c.parentNode;if(c){for(offsetC=0,n=containerB.firstChild;n!=c&&offsetC<offsetB;)offsetC++,n=n.nextSibling;return offsetC<offsetB?-1:1}for(cmnRoot=dom.findCommonAncestor(containerA,containerB),childA=containerA;childA&&childA.parentNode!=cmnRoot;)childA=childA.parentNode;for(childA||(childA=cmnRoot),childB=containerB;childB&&childB.parentNode!=cmnRoot;)childB=childB.parentNode;if(childB||(childB=cmnRoot),childA==childB)return 0;for(n=cmnRoot.firstChild;n;){if(n==childA)return-1;if(n==childB)return 1;n=n.nextSibling}}function _setEndPoint(st,n,o){var ec,sc;for(st?(self[START_CONTAINER]=n,self[START_OFFSET]=o):(self[END_CONTAINER]=n,self[END_OFFSET]=o),ec=self[END_CONTAINER];ec.parentNode;)ec=ec.parentNode;for(sc=self[START_CONTAINER];sc.parentNode;)sc=sc.parentNode;sc==ec?_compareBoundaryPoints(self[START_CONTAINER],self[START_OFFSET],self[END_CONTAINER],self[END_OFFSET])>0&&self.collapse(st):self.collapse(st),self.collapsed=_isCollapsed(),self.commonAncestorContainer=dom.findCommonAncestor(self[START_CONTAINER],self[END_CONTAINER])}function _traverse(how){var c,p,depthDiff,startNode,endNode,sp,ep,endContainerDepth=0,startContainerDepth=0;if(self[START_CONTAINER]==self[END_CONTAINER])return _traverseSameContainer(how);for(p=(c=self[END_CONTAINER]).parentNode;p;c=p,p=p.parentNode){if(p==self[START_CONTAINER])return _traverseCommonStartContainer(c,how);++endContainerDepth}for(p=(c=self[START_CONTAINER]).parentNode;p;c=p,p=p.parentNode){if(p==self[END_CONTAINER])return _traverseCommonEndContainer(c,how);++startContainerDepth}for(depthDiff=startContainerDepth-endContainerDepth,startNode=self[START_CONTAINER];depthDiff>0;)startNode=startNode.parentNode,depthDiff--;for(endNode=self[END_CONTAINER];depthDiff<0;)endNode=endNode.parentNode,depthDiff++;for(sp=startNode.parentNode,ep=endNode.parentNode;sp!=ep;sp=sp.parentNode,ep=ep.parentNode)startNode=sp,endNode=ep;return _traverseCommonAncestors(startNode,endNode,how)}function _traverseSameContainer(how){var frag,s,sub,n,cnt,sibling,xferNode,start,len;if(how!=DELETE&&(frag=createDocumentFragment()),self[START_OFFSET]==self[END_OFFSET])return frag;if(3==self[START_CONTAINER].nodeType){if(s=self[START_CONTAINER].nodeValue,sub=s.substring(self[START_OFFSET],self[END_OFFSET]),how!=CLONE&&(n=self[START_CONTAINER],start=self[START_OFFSET],len=self[END_OFFSET]-self[START_OFFSET],0===start&&len>=n.nodeValue.length-1?n.parentNode.removeChild(n):n.deleteData(start,len),self.collapse(TRUE)),how==DELETE)return;return sub.length>0&&frag.appendChild(doc.createTextNode(sub)),frag}for(n=_getSelectedNode(self[START_CONTAINER],self[START_OFFSET]),cnt=self[END_OFFSET]-self[START_OFFSET];n&&cnt>0;)sibling=n.nextSibling,xferNode=_traverseFullySelected(n,how),frag&&frag.appendChild(xferNode),--cnt,n=sibling;return how!=CLONE&&self.collapse(TRUE),frag}function _traverseCommonStartContainer(endAncestor,how){var frag,n,endIdx,cnt,sibling,xferNode;if(how!=DELETE&&(frag=createDocumentFragment()),n=_traverseRightBoundary(endAncestor,how),frag&&frag.appendChild(n),endIdx=nodeIndex(endAncestor),(cnt=endIdx-self[START_OFFSET])<=0)return how!=CLONE&&(self.setEndBefore(endAncestor),self.collapse(FALSE)),frag;for(n=endAncestor.previousSibling;cnt>0;)sibling=n.previousSibling,xferNode=_traverseFullySelected(n,how),frag&&frag.insertBefore(xferNode,frag.firstChild),--cnt,n=sibling;return how!=CLONE&&(self.setEndBefore(endAncestor),self.collapse(FALSE)),frag}function _traverseCommonEndContainer(startAncestor,how){var frag,startIdx,n,cnt,sibling,xferNode;for(how!=DELETE&&(frag=createDocumentFragment()),n=_traverseLeftBoundary(startAncestor,how),frag&&frag.appendChild(n),startIdx=nodeIndex(startAncestor),++startIdx,cnt=self[END_OFFSET]-startIdx,n=startAncestor.nextSibling;n&&cnt>0;)sibling=n.nextSibling,xferNode=_traverseFullySelected(n,how),frag&&frag.appendChild(xferNode),--cnt,n=sibling;return how!=CLONE&&(self.setStartAfter(startAncestor),self.collapse(TRUE)),frag}function _traverseCommonAncestors(startAncestor,endAncestor,how){var n,frag,startOffset,cnt,sibling,nextSibling;for(how!=DELETE&&(frag=createDocumentFragment()),n=_traverseLeftBoundary(startAncestor,how),frag&&frag.appendChild(n),startOffset=nodeIndex(startAncestor),cnt=nodeIndex(endAncestor)-++startOffset,sibling=startAncestor.nextSibling;cnt>0;)nextSibling=sibling.nextSibling,n=_traverseFullySelected(sibling,how),frag&&frag.appendChild(n),sibling=nextSibling,--cnt;return n=_traverseRightBoundary(endAncestor,how),frag&&frag.appendChild(n),how!=CLONE&&(self.setStartAfter(startAncestor),self.collapse(TRUE)),frag}function _traverseRightBoundary(root,how){var parent,clonedParent,prevSibling,clonedChild,clonedGrandParent,next=_getSelectedNode(self[END_CONTAINER],self[END_OFFSET]-1),isFullySelected=next!=self[END_CONTAINER];if(next==root)return _traverseNode(next,isFullySelected,FALSE,how);for(clonedParent=_traverseNode(parent=next.parentNode,FALSE,FALSE,how);parent;){for(;next;)prevSibling=next.previousSibling,clonedChild=_traverseNode(next,isFullySelected,FALSE,how),how!=DELETE&&clonedParent.insertBefore(clonedChild,clonedParent.firstChild),isFullySelected=TRUE,next=prevSibling;if(parent==root)return clonedParent;next=parent.previousSibling,clonedGrandParent=_traverseNode(parent=parent.parentNode,FALSE,FALSE,how),how!=DELETE&&clonedGrandParent.appendChild(clonedParent),clonedParent=clonedGrandParent}}function _traverseLeftBoundary(root,how){var parent,clonedParent,nextSibling,clonedChild,clonedGrandParent,next=_getSelectedNode(self[START_CONTAINER],self[START_OFFSET]),isFullySelected=next!=self[START_CONTAINER];if(next==root)return _traverseNode(next,isFullySelected,TRUE,how);for(clonedParent=_traverseNode(parent=next.parentNode,FALSE,TRUE,how);parent;){for(;next;)nextSibling=next.nextSibling,clonedChild=_traverseNode(next,isFullySelected,TRUE,how),how!=DELETE&&clonedParent.appendChild(clonedChild),isFullySelected=TRUE,next=nextSibling;if(parent==root)return clonedParent;next=parent.nextSibling,clonedGrandParent=_traverseNode(parent=parent.parentNode,FALSE,TRUE,how),how!=DELETE&&clonedGrandParent.appendChild(clonedParent),clonedParent=clonedGrandParent}}function _traverseNode(n,isFullySelected,isLeft,how){var txtValue,newNodeValue,oldNodeValue,offset,newNode;if(isFullySelected)return _traverseFullySelected(n,how);if(3==n.nodeType){if(txtValue=n.nodeValue,isLeft?(offset=self[START_OFFSET],newNodeValue=txtValue.substring(offset),oldNodeValue=txtValue.substring(0,offset)):(offset=self[END_OFFSET],newNodeValue=txtValue.substring(0,offset),oldNodeValue=txtValue.substring(offset)),how!=CLONE&&(n.nodeValue=oldNodeValue),how==DELETE)return;return newNode=dom.clone(n,FALSE),newNode.nodeValue=newNodeValue,newNode}if(how!=DELETE)return dom.clone(n,FALSE)}function _traverseFullySelected(n,how){if(how!=DELETE)return how==CLONE?dom.clone(n,TRUE):n;n.parentNode.removeChild(n)}var self=this,doc=dom.doc,EXTRACT=0,CLONE=1,DELETE=2,TRUE=!0,FALSE=!1,START_OFFSET="startOffset",START_CONTAINER="startContainer",END_CONTAINER="endContainer",END_OFFSET="endOffset",extend=Tools.extend,nodeIndex=dom.nodeIndex;return extend(self,{startContainer:doc,startOffset:0,endContainer:doc,endOffset:0,collapsed:TRUE,commonAncestorContainer:doc,START_TO_START:0,START_TO_END:1,END_TO_END:2,END_TO_START:3,setStart:setStart,setEnd:setEnd,setStartBefore:setStartBefore,setStartAfter:function(n){setStart(n.parentNode,nodeIndex(n)+1)},setEndBefore:function(n){setEnd(n.parentNode,nodeIndex(n))},setEndAfter:setEndAfter,collapse:function(ts){ts?(self[END_CONTAINER]=self[START_CONTAINER],self[END_OFFSET]=self[START_OFFSET]):(self[START_CONTAINER]=self[END_CONTAINER],self[START_OFFSET]=self[END_OFFSET]),self.collapsed=TRUE},selectNode:function(n){setStartBefore(n),setEndAfter(n)},selectNodeContents:function(n){setStart(n,0),setEnd(n,1===n.nodeType?n.childNodes.length:n.nodeValue.length)},compareBoundaryPoints:function(h,r){var sc=self[START_CONTAINER],so=self[START_OFFSET],ec=self[END_CONTAINER],eo=self[END_OFFSET],rsc=r.startContainer,rso=r.startOffset,rec=r.endContainer,reo=r.endOffset;return 0===h?_compareBoundaryPoints(sc,so,rsc,rso):1===h?_compareBoundaryPoints(ec,eo,rsc,rso):2===h?_compareBoundaryPoints(ec,eo,rec,reo):3===h?_compareBoundaryPoints(sc,so,rec,reo):void 0},deleteContents:function(){_traverse(DELETE)},extractContents:function(){return _traverse(EXTRACT)},cloneContents:cloneContents,insertNode:function(n){var nn,o,startContainer=this[START_CONTAINER],startOffset=this[START_OFFSET];3!==startContainer.nodeType&&4!==startContainer.nodeType||!startContainer.nodeValue?(startContainer.childNodes.length>0&&(o=startContainer.childNodes[startOffset]),o?startContainer.insertBefore(n,o):3==startContainer.nodeType?dom.insertAfter(n,startContainer):startContainer.appendChild(n)):startOffset?startOffset>=startContainer.nodeValue.length?dom.insertAfter(n,startContainer):(nn=startContainer.splitText(startOffset),startContainer.parentNode.insertBefore(n,nn)):startContainer.parentNode.insertBefore(n,startContainer)},surroundContents:function(n){var f=self.extractContents();self.insertNode(n),n.appendChild(f),self.selectNode(n)},cloneRange:function(){return extend(new Range(dom),{startContainer:self[START_CONTAINER],startOffset:self[START_OFFSET],endContainer:self[END_CONTAINER],endOffset:self[END_OFFSET],collapsed:self.collapsed,commonAncestorContainer:self.commonAncestorContainer})},toStringIE:function(){return dom.create("body",null,cloneContents()).outerText}}),self}return Range.prototype.toString=function(){return this.toStringIE()},Range}),defineGlobal("global!Object",Object),define("ephox.katamari.api.Option",["ephox.katamari.api.Fun","global!Object"],function(Fun,Object){var never=Fun.never,always=Fun.always,none=function(){return NONE},NONE=function(){var eq=function(o){return o.isNone()},call=function(thunk){return thunk()},id=function(n){return n},me={fold:function(n,s){return n()},is:never,isSome:never,isNone:always,getOr:id,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},or:id,orThunk:call,map:none,ap:none,each:function(){},bind:none,flatten:none,exists:never,forall:always,filter:none,equals:eq,equals_:eq,toArray:function(){return[]},toString:Fun.constant("none()")};return Object.freeze&&Object.freeze(me),me}(),some=function(a){var constant_a=function(){return a},self=function(){return me},bind=function(f){return f(a)},me={fold:function(n,s){return s(a)},is:function(v){return a===v},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},ap:function(optfab){return optfab.fold(none,function(fab){return some(fab(a))})},each:function(f){f(a)},bind:bind,flatten:constant_a,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},equals:function(o){return o.is(a)},equals_:function(o,elementEq){return o.fold(never,function(b){return elementEq(a,b)})},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me};return{some:some,none:none,from:function(value){return null===value||void 0===value?NONE:some(value)}}}),defineGlobal("global!String",String),define("ephox.katamari.api.Arr",["ephox.katamari.api.Option","global!Array","global!Error","global!String"],function(Option,Array,Error,String){var rawIndexOf=function(){var pIndexOf=Array.prototype.indexOf;return void 0===pIndexOf?function(xs,x){return slowIndexOf(xs,x)}:function(xs,x){return pIndexOf.call(xs,x)}}(),contains=function(xs,x){return rawIndexOf(xs,x)>-1},map=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i,xs)}return r},each=function(xs,f){for(var i=0,len=xs.length;i<len;i++)f(xs[i],i,xs)},eachr=function(xs,f){for(var i=xs.length-1;i>=0;i--)f(xs[i],i,xs)},filter=function(xs,pred){for(var r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i,xs)&&r.push(x)}return r},findIndex=function(xs,pred){for(var i=0,len=xs.length;i<len;i++)if(pred(xs[i],i,xs))return Option.some(i);return Option.none()},slowIndexOf=function(xs,x){for(var i=0,len=xs.length;i<len;++i)if(xs[i]===x)return i;return-1},push=Array.prototype.push,flatten=function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!Array.prototype.isPrototypeOf(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);push.apply(r,xs[i])}return r},forall=function(xs,pred){for(var i=0,len=xs.length;i<len;++i)if(!0!==pred(xs[i],i,xs))return!1;return!0},slice=Array.prototype.slice;return{map:map,each:each,eachr:eachr,partition:function(xs,pred){for(var pass=[],fail=[],i=0,len=xs.length;i<len;i++){var x=xs[i];(pred(x,i,xs)?pass:fail).push(x)}return{pass:pass,fail:fail}},filter:filter,groupBy:function(xs,f){if(0===xs.length)return[];for(var wasType=f(xs[0]),r=[],group=[],i=0,len=xs.length;i<len;i++){var x=xs[i],type=f(x);type!==wasType&&(r.push(group),group=[]),wasType=type,group.push(x)}return 0!==group.length&&r.push(group),r},indexOf:function(xs,x){var r=rawIndexOf(xs,x);return-1===r?Option.none():Option.some(r)},foldr:function(xs,f,acc){return eachr(xs,function(x){acc=f(acc,x)}),acc},foldl:function(xs,f,acc){return each(xs,function(x){acc=f(acc,x)}),acc},find:function(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i,xs))return Option.some(x)}return Option.none()},findIndex:findIndex,flatten:flatten,bind:function(xs,f){var output=map(xs,f);return flatten(output)},forall:forall,exists:function(xs,pred){return findIndex(xs,pred).isSome()},contains:contains,equal:function(a1,a2){return a1.length===a2.length&&forall(a1,function(x,i){return x===a2[i]})},reverse:function(xs){var r=slice.call(xs,0);return r.reverse(),r},chunk:function(array,size){for(var r=[],i=0;i<array.length;i+=size){var s=array.slice(i,i+size);r.push(s)}return r},difference:function(a1,a2){return filter(a1,function(x){return!contains(a2,x)})},mapToObject:function(xs,f){for(var r={},i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i)}return r},pure:function(x){return[x]},sort:function(xs,comparator){var copy=slice.call(xs,0);return copy.sort(comparator),copy},range:function(num,f){for(var r=[],i=0;i<num;i++)r.push(f(i));return r}}}),defineGlobal("global!setTimeout",setTimeout),define("ephox.katamari.api.LazyValue",["ephox.katamari.api.Arr","ephox.katamari.api.Option","global!setTimeout"],function(Arr,Option,setTimeout){var nu=function(baseFn){var data=Option.none(),callbacks=[],get=function(nCallback){isReady()?call(nCallback):callbacks.push(nCallback)},isReady=function(){return data.isSome()},run=function(cbs){Arr.each(cbs,call)},call=function(cb){data.each(function(x){setTimeout(function(){cb(x)},0)})};return baseFn(function(x){data=Option.some(x),run(callbacks),callbacks=[]}),{get:get,map:function(f){return nu(function(nCallback){get(function(data){nCallback(f(data))})})},isReady:isReady}};return{nu:nu,pure:function(a){return nu(function(callback){callback(a)})}}}),define("ephox.katamari.async.Bounce",["global!Array","global!setTimeout"],function(Array,setTimeout){return{bounce:function(f){return function(){var args=Array.prototype.slice.call(arguments),me=this;setTimeout(function(){f.apply(me,args)},0)}}}}),define("ephox.katamari.api.Future",["ephox.katamari.api.LazyValue","ephox.katamari.async.Bounce"],function(LazyValue,Bounce){var nu=function(baseFn){var get=function(callback){baseFn(Bounce.bounce(callback))};return{map:function(fab){return nu(function(callback){get(function(a){var value=fab(a);callback(value)})})},bind:function(aFutureB){return nu(function(callback){get(function(a){aFutureB(a).get(callback)})})},anonBind:function(futureB){return nu(function(callback){get(function(a){futureB.get(callback)})})},toLazy:function(){return LazyValue.nu(get)},get:get}};return{nu:nu,pure:function(a){return nu(function(callback){callback(a)})}}}),define("ephox.katamari.async.AsyncValues",["ephox.katamari.api.Arr"],function(Arr){return{par:function(asyncValues,nu){return nu(function(callback){var r=[],count=0,cb=function(i){return function(value){r[i]=value,++count>=asyncValues.length&&callback(r)}};0===asyncValues.length?callback([]):Arr.each(asyncValues,function(asyncValue,i){asyncValue.get(cb(i))})})}}}),define("ephox.katamari.api.Futures",["ephox.katamari.api.Arr","ephox.katamari.api.Future","ephox.katamari.async.AsyncValues"],function(Arr,Future,AsyncValues){var par=function(futures){return AsyncValues.par(futures,Future.nu)};return{par:par,mapM:function(array,fn){var futures=Arr.map(array,fn);return par(futures)},compose:function(f,g){return function(a){return g(a).bind(f)}}}}),define("ephox.katamari.api.Result",["ephox.katamari.api.Fun","ephox.katamari.api.Option"],function(Fun,Option){var value=function(o){return{is:function(v){return o===v},isValue:Fun.constant(!0),isError:Fun.constant(!1),getOr:Fun.constant(o),getOrThunk:Fun.constant(o),getOrDie:Fun.constant(o),or:function(opt){return value(o)},orThunk:function(f){return value(o)},fold:function(_,onValue){return onValue(o)},map:function(f){return value(f(o))},each:function(f){f(o)},bind:function(f){return f(o)},exists:function(f){return f(o)},forall:function(f){return f(o)},toOption:function(){return Option.some(o)}}},error=function(message){return{is:Fun.constant(!1),isValue:Fun.constant(!1),isError:Fun.constant(!0),getOr:Fun.identity,getOrThunk:function(f){return f()},getOrDie:function(){return Fun.die(message)()},or:function(opt){return opt},orThunk:function(f){return f()},fold:function(onError,_){return onError(message)},map:function(f){return error(message)},each:Fun.noop,bind:function(f){return error(message)},exists:Fun.constant(!1),forall:Fun.constant(!0),toOption:Option.none}};return{value:value,error:error}}),define("tinymce.core.dom.StyleSheetLoader",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Future","ephox.katamari.api.Futures","ephox.katamari.api.Result","tinymce.core.util.Delay","tinymce.core.util.Tools"],function(Arr,Fun,Future,Futures,Result,Delay,Tools){"use strict";return function(document,settings){function appendToHead(node){document.getElementsByTagName("head")[0].appendChild(node)}function load(url,loadedCallback,errorCallback){function passed(){for(var callbacks=state.passed,i=callbacks.length;i--;)callbacks[i]();state.status=2,state.passed=[],state.failed=[]}function failed(){for(var callbacks=state.failed,i=callbacks.length;i--;)callbacks[i]();state.status=3,state.passed=[],state.failed=[]}function wait(testCallback,waitCallback){testCallback()||((new Date).getTime()-startTime<maxLoadTime?Delay.setTimeout(waitCallback):failed())}function waitForWebKitLinkLoaded(){wait(function(){for(var styleSheet,owner,styleSheets=document.styleSheets,i=styleSheets.length;i--;)if(styleSheet=styleSheets[i],(owner=styleSheet.ownerNode?styleSheet.ownerNode:styleSheet.owningElement)&&owner.id===link.id)return passed(),!0},waitForWebKitLinkLoaded)}function waitForGeckoLinkLoaded(){wait(function(){try{var cssRules=style.sheet.cssRules;return passed(),!!cssRules}catch(ex){}},waitForGeckoLinkLoaded)}var link,style,startTime,state;if(url=Tools._addCacheSuffix(url),loadedStates[url]?state=loadedStates[url]:(state={passed:[],failed:[]},loadedStates[url]=state),loadedCallback&&state.passed.push(loadedCallback),errorCallback&&state.failed.push(errorCallback),1!=state.status)if(2!=state.status)if(3!=state.status){if(state.status=1,link=document.createElement("link"),link.rel="stylesheet",link.type="text/css",link.id="u"+idCount++,link.async=!1,link.defer=!1,startTime=(new Date).getTime(),"onload"in link&&!function(){var webKitChunks=navigator.userAgent.match(/WebKit\/(\d*)/);return!!(webKitChunks&&webKitChunks[1]<536)}())link.onload=waitForWebKitLinkLoaded,link.onerror=failed;else{if(navigator.userAgent.indexOf("Firefox")>0)return style=document.createElement("style"),style.textContent='@import "'+url+'"',waitForGeckoLinkLoaded(),void appendToHead(style);waitForWebKitLinkLoaded()}appendToHead(link),link.href=url}else failed();else passed()}var maxLoadTime,idCount=0,loadedStates={};maxLoadTime=(settings=settings||{}).maxLoadTime||5e3;var loadF=function(url){return Future.nu(function(resolve){load(url,Fun.compose(resolve,Fun.constant(Result.value(url))),Fun.compose(resolve,Fun.constant(Result.error(url))))})},unbox=function(result){return result.fold(Fun.identity,Fun.identity)};return{load:load,loadAll:function(urls,success,failure){Futures.par(Arr.map(urls,loadF)).get(function(result){var parts=Arr.partition(result,function(r){return r.isValue()});parts.fail.length>0?failure(parts.fail.map(unbox)):success(parts.pass.map(unbox))})}}}}),define("tinymce.core.dom.TreeWalker",[],function(){return function(startNode,rootNode){function findSibling(node,startName,siblingName,shallow){var sibling,parent;if(node){if(!shallow&&node[startName])return node[startName];if(node!=rootNode){if(sibling=node[siblingName])return sibling;for(parent=node.parentNode;parent&&parent!=rootNode;parent=parent.parentNode)if(sibling=parent[siblingName])return sibling}}}function findPreviousNode(node,startName,siblingName,shallow){var sibling,parent,child;if(node){if(sibling=node[siblingName],rootNode&&sibling===rootNode)return;if(sibling){if(!shallow)for(child=sibling[startName];child;child=child[startName])if(!child[startName])return child;return sibling}if((parent=node.parentNode)&&parent!==rootNode)return parent}}var node=startNode;this.current=function(){return node},this.next=function(shallow){return node=findSibling(node,"firstChild","nextSibling",shallow)},this.prev=function(shallow){return node=findSibling(node,"lastChild","previousSibling",shallow)},this.prev2=function(shallow){return node=findPreviousNode(node,"lastChild","previousSibling",shallow)}}}),define("tinymce.core.html.Entities",["tinymce.core.util.Tools"],function(Tools){function nativeDecode(text){var elm;return elm=document.createElement("div"),elm.innerHTML=text,elm.textContent||elm.innerText||text}function buildEntitiesLookup(items,radix){var i,chr,entity,lookup={};if(items){for(items=items.split(","),radix=radix||10,i=0;i<items.length;i+=2)chr=String.fromCharCode(parseInt(items[i],radix)),baseEntities[chr]||(entity="&"+items[i+1]+";",lookup[chr]=entity,lookup[entity]=chr);return lookup}}var namedEntities,baseEntities,reverseEntities,makeMap=Tools.makeMap,attrsCharsRegExp=/[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,textCharsRegExp=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rawCharsRegExp=/[<>&\"\']/g,entityRegExp=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi,asciiMap={128:"",130:"",131:"",132:"",133:"",134:"",135:"",136:"",137:"",138:"",139:"",140:"",142:"",145:"",146:"",147:"",148:"",149:"",150:"",151:"",152:"",153:"",154:"",155:"",156:"",158:"",159:""};baseEntities={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;","`":"&#96;"},reverseEntities={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"},namedEntities=buildEntitiesLookup("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32);var Entities={encodeRaw:function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||chr})},encodeAllRaw:function(text){return(""+text).replace(rawCharsRegExp,function(chr){return baseEntities[chr]||chr})},encodeNumeric:function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return chr.length>1?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":baseEntities[chr]||"&#"+chr.charCodeAt(0)+";"})},encodeNamed:function(text,attr,entities){return entities=entities||namedEntities,text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||entities[chr]||chr})},getEncodeFunc:function(name,entities){return entities=buildEntitiesLookup(entities)||namedEntities,(name=makeMap(name.replace(/\+/g,","))).named&&name.numeric?function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return void 0!==baseEntities[chr]?baseEntities[chr]:void 0!==entities[chr]?entities[chr]:chr.length>1?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":"&#"+chr.charCodeAt(0)+";"})}:name.named?entities?function(text,attr){return Entities.encodeNamed(text,attr,entities)}:Entities.encodeNamed:name.numeric?Entities.encodeNumeric:Entities.encodeRaw},decode:function(text){return text.replace(entityRegExp,function(all,numeric){return numeric?(numeric="x"===numeric.charAt(0).toLowerCase()?parseInt(numeric.substr(1),16):parseInt(numeric,10))>65535?(numeric-=65536,String.fromCharCode(55296+(numeric>>10),56320+(1023&numeric))):asciiMap[numeric]||String.fromCharCode(numeric):reverseEntities[all]||namedEntities[all]||nativeDecode(all)})}};return Entities}),define("tinymce.core.html.Schema",["tinymce.core.util.Tools"],function(Tools){function split(items,delim){return(items=Tools.trim(items))?items.split(delim||" "):[]}function compileSchema(type){function add(name,attributes,children){function arrayToMap(array,obj){var i,l,map={};for(i=0,l=array.length;i<l;i++)map[array[i]]=obj||{};return map}var ni,attributesOrder,element;for(children=children||[],attributes=attributes||"","string"==typeof children&&(children=split(children)),ni=(name=split(name)).length;ni--;)element={attributes:arrayToMap(attributesOrder=split([globalAttributes,attributes].join(" "))),attributesOrder:attributesOrder,children:arrayToMap(children,dummyObj)},schema[name[ni]]=element}function addAttrs(name,attributes){var ni,schemaItem,i,l;for(ni=(name=split(name)).length,attributes=split(attributes);ni--;)for(schemaItem=schema[name[ni]],i=0,l=attributes.length;i<l;i++)schemaItem.attributes[attributes[i]]={},schemaItem.attributesOrder.push(attributes[i])}var globalAttributes,blockContent,phrasingContent,flowContent,html4BlockContent,html4PhrasingContent,schema={};return mapCache[type]?mapCache[type]:(globalAttributes="id accesskey class dir lang style tabindex title role",blockContent="address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul",phrasingContent="a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment","html4"!=type&&(globalAttributes+=" contenteditable contextmenu draggable dropzone hidden spellcheck translate",blockContent+=" article aside details dialog figure header footer hgroup section nav",phrasingContent+=" audio canvas command datalist mark meter output picture progress time wbr video ruby bdi keygen"),"html5-strict"!=type&&(globalAttributes+=" xml:lang",phrasingContent=[phrasingContent,html4PhrasingContent="acronym applet basefont big font strike tt"].join(" "),each(split(html4PhrasingContent),function(name){add(name,"",phrasingContent)}),blockContent=[blockContent,html4BlockContent="center dir isindex noframes"].join(" "),flowContent=[blockContent,phrasingContent].join(" "),each(split(html4BlockContent),function(name){add(name,"",flowContent)})),flowContent=flowContent||[blockContent,phrasingContent].join(" "),add("html","manifest","head body"),add("head","","base command link meta noscript script style title"),add("title hr noscript br"),add("base","href target"),add("link","href rel media hreflang type sizes hreflang"),add("meta","name http-equiv content charset"),add("style","media type scoped"),add("script","src async defer type charset"),add("body","onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload",flowContent),add("address dt dd div caption","",flowContent),add("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn","",phrasingContent),add("blockquote","cite",flowContent),add("ol","reversed start type","li"),add("ul","","li"),add("li","value",flowContent),add("dl","","dt dd"),add("a","href target rel media hreflang type",phrasingContent),add("q","cite",phrasingContent),add("ins del","cite datetime",flowContent),add("img","src sizes srcset alt usemap ismap width height"),add("iframe","src name width height",flowContent),add("embed","src type width height"),add("object","data type typemustmatch name usemap form width height",[flowContent,"param"].join(" ")),add("param","name value"),add("map","name",[flowContent,"area"].join(" ")),add("area","alt coords shape href target rel media hreflang type"),add("table","border","caption colgroup thead tfoot tbody tr"+("html4"==type?" col":"")),add("colgroup","span","col"),add("col","span"),add("tbody thead tfoot","","tr"),add("tr","","td th"),add("td","colspan rowspan headers",flowContent),add("th","colspan rowspan headers scope abbr",flowContent),add("form","accept-charset action autocomplete enctype method name novalidate target",flowContent),add("fieldset","disabled form name",[flowContent,"legend"].join(" ")),add("label","form for",phrasingContent),add("input","accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"),add("button","disabled form formaction formenctype formmethod formnovalidate formtarget name type value","html4"==type?flowContent:phrasingContent),add("select","disabled form multiple name required size","option optgroup"),add("optgroup","disabled label","option"),add("option","disabled label selected value"),add("textarea","cols dirname disabled form maxlength name readonly required rows wrap"),add("menu","type label",[flowContent,"li"].join(" ")),add("noscript","",flowContent),"html4"!=type&&(add("wbr"),add("ruby","",[phrasingContent,"rt rp"].join(" ")),add("figcaption","",flowContent),add("mark rt rp summary bdi","",phrasingContent),add("canvas","width height",flowContent),add("video","src crossorigin poster preload autoplay mediagroup loop muted controls width height buffered",[flowContent,"track source"].join(" ")),add("audio","src crossorigin preload autoplay mediagroup loop muted controls buffered volume",[flowContent,"track source"].join(" ")),add("picture","","img source"),add("source","src srcset type media sizes"),add("track","kind src srclang label default"),add("datalist","",[phrasingContent,"option"].join(" ")),add("article section nav aside header footer","",flowContent),add("hgroup","","h1 h2 h3 h4 h5 h6"),add("figure","",[flowContent,"figcaption"].join(" ")),add("time","datetime",phrasingContent),add("dialog","open",flowContent),add("command","type label icon disabled checked radiogroup command"),add("output","for form name",phrasingContent),add("progress","value max",phrasingContent),add("meter","value min max low high optimum",phrasingContent),add("details","open",[flowContent,"summary"].join(" ")),add("keygen","autofocus challenge disabled form keytype name")),"html5-strict"!=type&&(addAttrs("script","language xml:space"),addAttrs("style","xml:space"),addAttrs("object","declare classid code codebase codetype archive standby align border hspace vspace"),addAttrs("embed","align name hspace vspace"),addAttrs("param","valuetype type"),addAttrs("a","charset name rev shape coords"),addAttrs("br","clear"),addAttrs("applet","codebase archive code object alt name width height align hspace vspace"),addAttrs("img","name longdesc align border hspace vspace"),addAttrs("iframe","longdesc frameborder marginwidth marginheight scrolling align"),addAttrs("font basefont","size color face"),addAttrs("input","usemap align"),addAttrs("select","onchange"),addAttrs("textarea"),addAttrs("h1 h2 h3 h4 h5 h6 div p legend caption","align"),addAttrs("ul","type compact"),addAttrs("li","type"),addAttrs("ol dl menu dir","compact"),addAttrs("pre","width xml:space"),addAttrs("hr","align noshade size width"),addAttrs("isindex","prompt"),addAttrs("table","summary width frame rules cellspacing cellpadding align bgcolor"),addAttrs("col","width align char charoff valign"),addAttrs("colgroup","width align char charoff valign"),addAttrs("thead","align char charoff valign"),addAttrs("tr","align char charoff valign bgcolor"),addAttrs("th","axis align char charoff valign nowrap bgcolor width height"),addAttrs("form","accept"),addAttrs("td","abbr axis scope align char charoff valign nowrap bgcolor width height"),addAttrs("tfoot","align char charoff valign"),addAttrs("tbody","align char charoff valign"),addAttrs("area","nohref"),addAttrs("body","background bgcolor text link vlink alink")),"html4"!=type&&(addAttrs("input button select textarea","autofocus"),addAttrs("input textarea","placeholder"),addAttrs("a","download"),addAttrs("link script img","crossorigin"),addAttrs("iframe","sandbox seamless allowfullscreen")),each(split("a form meter progress dfn"),function(name){schema[name]&&delete schema[name].children[name]}),delete schema.caption.children.table,delete schema.script,mapCache[type]=schema,schema)}function compileElementMap(value,mode){var styles;return value&&(styles={},"string"==typeof value&&(value={"*":value}),each(value,function(value,key){styles[key]=styles[key.toUpperCase()]="map"==mode?makeMap(value,/[, ]/):explode(value,/[, ]/)})),styles}var mapCache={},dummyObj={},makeMap=Tools.makeMap,each=Tools.each,extend=Tools.extend,explode=Tools.explode,inArray=Tools.inArray;return function(settings){function createLookupTable(option,defaultValue,extendWith){var value=settings[option];return value?value=makeMap(value,/[, ]/,makeMap(value.toUpperCase(),/[, ]/)):(value=mapCache[option])||(value=makeMap(defaultValue," ",makeMap(defaultValue.toUpperCase()," ")),value=extend(value,extendWith),mapCache[option]=value),value}function patternToRegExp(str){return new RegExp("^"+str.replace(/([?+*])/g,".$1")+"$")}function addValidElements(validElements){var ei,el,ai,al,matches,element,attr,attrData,elementName,attrName,attrType,attributes,attributesOrder,prefix,outputName,globalAttributes,globalAttributesOrder,key,value,elementRuleRegExp=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)\])?$/,attrRuleRegExp=/^([!\-])?(\w+::\w+|[^=:<]+)?(?:([=:<])(.*))?$/,hasPatternsRegExp=/[*?+]/;if(validElements)for(validElements=split(validElements,","),elements["@"]&&(globalAttributes=elements["@"].attributes,globalAttributesOrder=elements["@"].attributesOrder),ei=0,el=validElements.length;ei<el;ei++)if(matches=elementRuleRegExp.exec(validElements[ei])){if(prefix=matches[1],elementName=matches[2],outputName=matches[3],attrData=matches[5],attributes={},attributesOrder=[],element={attributes:attributes,attributesOrder:attributesOrder},"#"===prefix&&(element.paddEmpty=!0),"-"===prefix&&(element.removeEmpty=!0),"!"===matches[4]&&(element.removeEmptyAttrs=!0),globalAttributes){for(key in globalAttributes)attributes[key]=globalAttributes[key];attributesOrder.push.apply(attributesOrder,globalAttributesOrder)}if(attrData)for(ai=0,al=(attrData=split(attrData,"|")).length;ai<al;ai++)if(matches=attrRuleRegExp.exec(attrData[ai])){if(attr={},attrType=matches[1],attrName=matches[2].replace(/::/g,":"),prefix=matches[3],value=matches[4],"!"===attrType&&(element.attributesRequired=element.attributesRequired||[],element.attributesRequired.push(attrName),attr.required=!0),"-"===attrType){delete attributes[attrName],attributesOrder.splice(inArray(attributesOrder,attrName),1);continue}prefix&&("="===prefix&&(element.attributesDefault=element.attributesDefault||[],element.attributesDefault.push({name:attrName,value:value}),attr.defaultValue=value),":"===prefix&&(element.attributesForced=element.attributesForced||[],element.attributesForced.push({name:attrName,value:value}),attr.forcedValue=value),"<"===prefix&&(attr.validValues=makeMap(value,"?"))),hasPatternsRegExp.test(attrName)?(element.attributePatterns=element.attributePatterns||[],attr.pattern=patternToRegExp(attrName),element.attributePatterns.push(attr)):(attributes[attrName]||attributesOrder.push(attrName),attributes[attrName]=attr)}globalAttributes||"@"!=elementName||(globalAttributes=attributes,globalAttributesOrder=attributesOrder),outputName&&(element.outputName=elementName,elements[outputName]=element),hasPatternsRegExp.test(elementName)?(element.pattern=patternToRegExp(elementName),patternElements.push(element)):elements[elementName]=element}}function setValidElements(validElements){elements={},patternElements=[],addValidElements(validElements),each(schemaItems,function(element,name){children[name]=element.children})}function addCustomElements(customElements){var customElementRegExp=/^(~)?(.+)$/;customElements&&(mapCache.text_block_elements=mapCache.block_elements=null,each(split(customElements,","),function(rule){var matches=customElementRegExp.exec(rule),inline="~"===matches[1],cloneName=inline?"span":"div",name=matches[2];if(children[name]=children[cloneName],customElementsMap[name]=cloneName,inline||(blockElementsMap[name.toUpperCase()]={},blockElementsMap[name]={}),!elements[name]){var customRule=elements[cloneName];delete(customRule=extend({},customRule)).removeEmptyAttrs,delete customRule.removeEmpty,elements[name]=customRule}each(children,function(element,elmName){element[cloneName]&&(children[elmName]=element=extend({},children[elmName]),element[name]=element[cloneName])})}))}function addValidChildren(validChildren){var childRuleRegExp=/^([+\-]?)(\w+)\[([^\]]+)\]$/;mapCache[settings.schema]=null,validChildren&&each(split(validChildren,","),function(rule){var parent,prefix,matches=childRuleRegExp.exec(rule);matches&&(prefix=matches[1],parent=prefix?children[matches[2]]:children[matches[2]]={"#comment":{}},parent=children[matches[2]],each(split(matches[3],"|"),function(child){"-"===prefix?delete parent[child]:parent[child]={}}))})}function getElementRule(name){var i,element=elements[name];if(element)return element;for(i=patternElements.length;i--;)if((element=patternElements[i]).pattern.test(name))return element}var validStyles,invalidStyles,schemaItems,whiteSpaceElementsMap,selfClosingElementsMap,shortEndedElementsMap,boolAttrMap,validClasses,blockElementsMap,nonEmptyElementsMap,moveCaretBeforeOnEnterElementsMap,textBlockElementsMap,textInlineElementsMap,self=this,elements={},children={},patternElements=[],customElementsMap={},specialElements={};schemaItems=compileSchema((settings=settings||{}).schema),!1===settings.verify_html&&(settings.valid_elements="*[*]"),validStyles=compileElementMap(settings.valid_styles),invalidStyles=compileElementMap(settings.invalid_styles,"map"),validClasses=compileElementMap(settings.valid_classes,"map"),whiteSpaceElementsMap=createLookupTable("whitespace_elements","pre script noscript style textarea video audio iframe object code"),selfClosingElementsMap=createLookupTable("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr"),shortEndedElementsMap=createLookupTable("short_ended_elements","area base basefont br col frame hr img input isindex link meta param embed source wbr track"),boolAttrMap=createLookupTable("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"),nonEmptyElementsMap=createLookupTable("non_empty_elements","td th iframe video audio object script pre code",shortEndedElementsMap),moveCaretBeforeOnEnterElementsMap=createLookupTable("move_caret_before_on_enter_elements","table",nonEmptyElementsMap),textBlockElementsMap=createLookupTable("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside nav figure"),blockElementsMap=createLookupTable("block_elements","hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex option datalist select optgroup figcaption",textBlockElementsMap),textInlineElementsMap=createLookupTable("text_inline_elements","span strong b em i font strike u var cite dfn code mark q sup sub samp"),each((settings.special||"script noscript noframes noembed title style textarea xmp").split(" "),function(name){specialElements[name]=new RegExp("</"+name+"[^>]*>","gi")}),settings.valid_elements?setValidElements(settings.valid_elements):(each(schemaItems,function(element,name){elements[name]={attributes:element.attributes,attributesOrder:element.attributesOrder},children[name]=element.children}),"html5"!=settings.schema&&each(split("strong/b em/i"),function(item){item=split(item,"/"),elements[item[1]].outputName=item[0]}),each(split("ol ul sub sup blockquote span font a table tbody tr strong em b i"),function(name){elements[name]&&(elements[name].removeEmpty=!0)}),each(split("p h1 h2 h3 h4 h5 h6 th td pre div address caption"),function(name){elements[name].paddEmpty=!0}),each(split("span"),function(name){elements[name].removeEmptyAttrs=!0})),addCustomElements(settings.custom_elements),addValidChildren(settings.valid_children),addValidElements(settings.extended_valid_elements),addValidChildren("+ol[ul|ol],+ul[ul|ol]"),each({dd:"dl",dt:"dl",li:"ul ol",td:"tr",th:"tr",tr:"tbody thead tfoot",tbody:"table",thead:"table",tfoot:"table",legend:"fieldset",area:"map",param:"video audio object"},function(parents,item){elements[item]&&(elements[item].parentsRequired=split(parents))}),settings.invalid_elements&&each(explode(settings.invalid_elements),function(item){elements[item]&&delete elements[item]}),getElementRule("span")||addValidElements("span[!data-mce-type|*]"),self.children=children,self.getValidStyles=function(){return validStyles},self.getInvalidStyles=function(){return invalidStyles},self.getValidClasses=function(){return validClasses},self.getBoolAttrs=function(){return boolAttrMap},self.getBlockElements=function(){return blockElementsMap},self.getTextBlockElements=function(){return textBlockElementsMap},self.getTextInlineElements=function(){return textInlineElementsMap},self.getShortEndedElements=function(){return shortEndedElementsMap},self.getSelfClosingElements=function(){return selfClosingElementsMap},self.getNonEmptyElements=function(){return nonEmptyElementsMap},self.getMoveCaretBeforeOnEnterElements=function(){return moveCaretBeforeOnEnterElementsMap},self.getWhiteSpaceElements=function(){return whiteSpaceElementsMap},self.getSpecialElements=function(){return specialElements},self.isValidChild=function(name,child){var parent=children[name.toLowerCase()];return!(!parent||!parent[child.toLowerCase()])},self.isValid=function(name,attr){var attrPatterns,i,rule=getElementRule(name);if(rule){if(!attr)return!0;if(rule.attributes[attr])return!0;if(attrPatterns=rule.attributePatterns)for(i=attrPatterns.length;i--;)if(attrPatterns[i].pattern.test(name))return!0}return!1},self.getElementRule=getElementRule,self.getCustomElements=function(){return customElementsMap},self.addValidElements=addValidElements,self.setValidElements=setValidElements,self.addCustomElements=addCustomElements,self.addValidChildren=addValidChildren,self.elements=elements}}),define("tinymce.core.html.Styles",[],function(){return function(settings,schema){function toHex(match,r,g,b){function hex(val){return(val=parseInt(val,10).toString(16)).length>1?val:"0"+val}return"#"+hex(r)+hex(g)+hex(b)}var i,encodingItems,validStyles,invalidStyles,rgbRegExp=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,urlOrStrRegExp=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,styleRegExp=/\s*([^:]+):\s*([^;]+);?/g,trimRightRegExp=/\s+$/,encodingLookup={};for(settings=settings||{},schema&&(validStyles=schema.getValidStyles(),invalidStyles=schema.getInvalidStyles()),encodingItems="\\\" \\' \\; \\: ; : \ufeff".split(" "),i=0;i<encodingItems.length;i++)encodingLookup[encodingItems[i]]="\ufeff"+i,encodingLookup["\ufeff"+i]=encodingItems[i];return{toHex:function(color){return color.replace(rgbRegExp,toHex)},parse:function(css){function compress(prefix,suffix,noJoin){var top,right,bottom,left;if((top=styles[prefix+"-top"+suffix])&&(right=styles[prefix+"-right"+suffix])&&(bottom=styles[prefix+"-bottom"+suffix])&&(left=styles[prefix+"-left"+suffix])){var box=[top,right,bottom,left];for(i=box.length-1;i--&&box[i]===box[i+1];);i>-1&&noJoin||(styles[prefix+suffix]=-1==i?box[0]:box.join(" "),delete styles[prefix+"-top"+suffix],delete styles[prefix+"-right"+suffix],delete styles[prefix+"-bottom"+suffix],delete styles[prefix+"-left"+suffix])}}function canCompress(key){var i,value=styles[key];if(value){for(i=(value=value.split(" ")).length;i--;)if(value[i]!==value[0])return!1;return styles[key]=value[0],!0}}function encode(str){return isEncoded=!0,encodingLookup[str]}function decode(str,keepSlashes){return isEncoded&&(str=str.replace(/\uFEFF[0-9]/g,function(str){return encodingLookup[str]})),keepSlashes||(str=str.replace(/\\([\'\";:])/g,"$1")),str}function decodeSingleHexSequence(escSeq){return String.fromCharCode(parseInt(escSeq.slice(1),16))}function decodeHexSequences(value){return value.replace(/\\[0-9a-f]+/gi,decodeSingleHexSequence)}var matches,name,value,isEncoded,styles={},urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope||this;if(css){for(css=(css=css.replace(/[\u0000-\u001F]/g,"")).replace(/\\[\"\';:\uFEFF]/g,encode).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(str){return str.replace(/[;:]/g,encode)});matches=styleRegExp.exec(css);)if(styleRegExp.lastIndex=matches.index+matches[0].length,name=matches[1].replace(trimRightRegExp,"").toLowerCase(),value=matches[2].replace(trimRightRegExp,""),name&&value){if(name=decodeHexSequences(name),value=decodeHexSequences(value),-1!==name.indexOf("\ufeff")||-1!==name.indexOf('"'))continue;if(!settings.allow_script_urls&&("behavior"==name||/expression\s*\(|\/\*|\*\//.test(value)))continue;"font-weight"===name&&"700"===value?value="bold":"color"!==name&&"background-color"!==name||(value=value.toLowerCase()),value=(value=value.replace(rgbRegExp,toHex)).replace(urlOrStrRegExp,function(match,url,url2,url3,str,str2){if(str=str||str2)return"'"+(str=decode(str)).replace(/\'/g,"\\'")+"'";if(url=decode(url||url2||url3),!settings.allow_script_urls){var scriptUrl=url.replace(/[\s\r\n]+/g,"");if(/(java|vb)script:/i.test(scriptUrl))return"";if(!settings.allow_svg_data_urls&&/^data:image\/svg/i.test(scriptUrl))return""}return urlConverter&&(url=urlConverter.call(urlConverterScope,url,"style")),"url('"+url.replace(/\'/g,"\\'")+"')"}),styles[name]=isEncoded?decode(value,!0):value}compress("border","",!0),compress("border","-width"),compress("border","-color"),compress("border","-style"),compress("padding",""),compress("margin",""),function(target,a,b,c){canCompress(a)&&canCompress(b)&&canCompress(c)&&(styles[target]=styles[a]+" "+styles[b]+" "+styles[c],delete styles[a],delete styles[b],delete styles[c])}("border","border-width","border-style","border-color"),"medium none"===styles.border&&delete styles.border,"none"===styles["border-image"]&&delete styles["border-image"]}return styles},serialize:function(styles,elementName){function serializeStyles(name){var styleList,i,l,value;if(styleList=validStyles[name])for(i=0,l=styleList.length;i<l;i++)name=styleList[i],(value=styles[name])&&(css+=(css.length>0?" ":"")+name+": "+value+";")}var name,value,css="";if(elementName&&validStyles)serializeStyles("*"),serializeStyles(elementName);else for(name in styles)!(value=styles[name])||invalidStyles&&!function(name,elementName){var styleMap;return!((styleMap=invalidStyles["*"])&&styleMap[name]||(styleMap=invalidStyles[elementName])&&styleMap[name])}(name,elementName)||(css+=(css.length>0?" ":"")+name+": "+value+";");return css}}}}),define("tinymce.core.dom.DOMUtils",["tinymce.core.dom.DomQuery","tinymce.core.dom.EventUtils","tinymce.core.dom.Range","tinymce.core.dom.Sizzle","tinymce.core.dom.StyleSheetLoader","tinymce.core.dom.TreeWalker","tinymce.core.Env","tinymce.core.html.Entities","tinymce.core.html.Schema","tinymce.core.html.Styles","tinymce.core.util.Tools"],function(DomQuery,EventUtils,Range,Sizzle,StyleSheetLoader,TreeWalker,Env,Entities,Schema,Styles,Tools){function setupAttrHooks(domUtils,settings){var keepUrlHook,attrHooks={},keepValues=settings.keep_values;return keepUrlHook={set:function($elm,value,name){settings.url_converter&&(value=settings.url_converter.call(settings.url_converter_scope||domUtils,value,name,$elm[0])),$elm.attr("data-mce-"+name,value).attr(name,value)},get:function($elm,name){return $elm.attr("data-mce-"+name)||$elm.attr(name)}},attrHooks={style:{set:function($elm,value){null===value||"object"!=typeof value?(keepValues&&$elm.attr("data-mce-style",value),$elm.attr("style",value)):$elm.css(value)},get:function($elm){var value=$elm.attr("data-mce-style")||$elm.attr("style");return value=domUtils.serializeStyle(domUtils.parseStyle(value),$elm[0].nodeName)}}},keepValues&&(attrHooks.href=attrHooks.src=keepUrlHook),attrHooks}function updateInternalStyleAttr(domUtils,$elm){var value=$elm.attr("style");(value=domUtils.serializeStyle(domUtils.parseStyle(value),$elm[0].nodeName))||(value=null),$elm.attr("data-mce-style",value)}function nodeIndex(node,normalized){var lastNodeType,nodeType,idx=0;if(node)for(lastNodeType=node.nodeType,node=node.previousSibling;node;node=node.previousSibling)nodeType=node.nodeType,(!normalized||3!=nodeType||nodeType!=lastNodeType&&node.nodeValue.length)&&(idx++,lastNodeType=nodeType);return idx}function DOMUtils(doc,settings){var blockElementsMap,self=this;self.doc=doc,self.win=window,self.files={},self.counter=0,self.stdMode=!isIE||doc.documentMode>=8,self.boxModel=!isIE||"CSS1Compat"==doc.compatMode||self.stdMode,self.styleSheetLoader=new StyleSheetLoader(doc),self.boundEvents=[],self.settings=settings=settings||{},self.schema=settings.schema?settings.schema:new Schema({}),self.styles=new Styles({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope},settings.schema),self.fixDoc(doc),self.events=settings.ownEvents?new EventUtils(settings.proxy):EventUtils.Event,self.attrHooks=setupAttrHooks(self,settings),blockElementsMap=settings.schema?settings.schema.getBlockElements():{},self.$=DomQuery.overrideDefaults(function(){return{context:doc,element:self.getRoot()}}),self.isBlock=function(node){if(!node)return!1;var type=node.nodeType;return type?!(1!==type||!blockElementsMap[node.nodeName]):!!blockElementsMap[node]}}var each=Tools.each,is=Tools.is,grep=Tools.grep,trim=Tools.trim,isIE=Env.ie,simpleSelectorRe=/^([a-z0-9],?)+$/i,whiteSpaceRegExp=/^[ \t\r\n]*$/;return DOMUtils.prototype={$$:function(elm){return"string"==typeof elm&&(elm=this.get(elm)),this.$(elm)},root:null,fixDoc:function(doc){var name,settings=this.settings;if(isIE&&settings.schema){"abbr article aside audio canvas details figcaption figure footer header hgroup mark menu meter nav output progress section summary time video".replace(/\w+/g,function(name){doc.createElement(name)});for(name in settings.schema.getCustomElements())doc.createElement(name)}},clone:function(node,deep){var clone,doc,self=this;return!isIE||1!==node.nodeType||deep?node.cloneNode(deep):(doc=self.doc,deep?clone.firstChild:(clone=doc.createElement(node.nodeName),each(self.getAttribs(node),function(attr){self.setAttrib(clone,attr.nodeName,self.getAttrib(node,attr.nodeName))}),clone))},getRoot:function(){var self=this;return self.settings.root_element||self.doc.body},getViewPort:function(win){var doc,rootElm;return win=win||this.win,doc=win.document,rootElm=this.boxModel?doc.documentElement:doc.body,{x:win.pageXOffset||rootElm.scrollLeft,y:win.pageYOffset||rootElm.scrollTop,w:win.innerWidth||rootElm.clientWidth,h:win.innerHeight||rootElm.clientHeight}},getRect:function(elm){var pos,size,self=this;return elm=self.get(elm),pos=self.getPos(elm),size=self.getSize(elm),{x:pos.x,y:pos.y,w:size.w,h:size.h}},getSize:function(elm){var w,h,self=this;return elm=self.get(elm),w=self.getStyle(elm,"width"),h=self.getStyle(elm,"height"),-1===w.indexOf("px")&&(w=0),-1===h.indexOf("px")&&(h=0),{w:parseInt(w,10)||elm.offsetWidth||elm.clientWidth,h:parseInt(h,10)||elm.offsetHeight||elm.clientHeight}},getParent:function(node,selector,root){return this.getParents(node,selector,root,!1)},getParents:function(node,selector,root,collect){var selectorVal,self=this,result=[];for(node=self.get(node),collect=void 0===collect,root=root||("BODY"!=self.getRoot().nodeName?self.getRoot().parentNode:null),is(selector,"string")&&(selectorVal=selector,selector="*"===selector?function(node){return 1==node.nodeType}:function(node){return self.is(node,selectorVal)});node&&node!=root&&node.nodeType&&9!==node.nodeType;){if(!selector||selector(node)){if(!collect)return node;result.push(node)}node=node.parentNode}return collect?result:null},get:function(elm){var name;return elm&&this.doc&&"string"==typeof elm&&(name=elm,(elm=this.doc.getElementById(elm))&&elm.id!==name)?this.doc.getElementsByName(name)[1]:elm},getNext:function(node,selector){return this._findSib(node,selector,"nextSibling")},getPrev:function(node,selector){return this._findSib(node,selector,"previousSibling")},select:function(selector,scope){var self=this;return Sizzle(selector,self.get(scope)||self.settings.root_element||self.doc,[])},is:function(elm,selector){var i;if(!elm)return!1;if(void 0===elm.length){if("*"===selector)return 1==elm.nodeType;if(simpleSelectorRe.test(selector)){for(selector=selector.toLowerCase().split(/,/),elm=elm.nodeName.toLowerCase(),i=selector.length-1;i>=0;i--)if(selector[i]==elm)return!0;return!1}}if(elm.nodeType&&1!=elm.nodeType)return!1;var elms=elm.nodeType?[elm]:elm;return Sizzle(selector,elms[0].ownerDocument||elms[0],null,elms).length>0},add:function(parentElm,name,attrs,html,create){var self=this;return this.run(parentElm,function(parentElm){var newElm;return newElm=is(name,"string")?self.doc.createElement(name):name,self.setAttribs(newElm,attrs),html&&(html.nodeType?newElm.appendChild(html):self.setHTML(newElm,html)),create?newElm:parentElm.appendChild(newElm)})},create:function(name,attrs,html){return this.add(this.doc.createElement(name),name,attrs,html,1)},createHTML:function(name,attrs,html){var key,outHtml="";outHtml+="<"+name;for(key in attrs)attrs.hasOwnProperty(key)&&null!==attrs[key]&&void 0!==attrs[key]&&(outHtml+=" "+key+'="'+this.encode(attrs[key])+'"');return void 0!==html?outHtml+">"+html+"</"+name+">":outHtml+" />"},createFragment:function(html){var frag,node,container,doc=this.doc;for(container=doc.createElement("div"),frag=doc.createDocumentFragment(),html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag},remove:function(node,keepChildren){return node=this.$$(node),keepChildren?node.each(function(){for(var child;child=this.firstChild;)3==child.nodeType&&0===child.data.length?this.removeChild(child):this.parentNode.insertBefore(child,this)}).remove():node.remove(),node.length>1?node.toArray():node[0]},setStyle:function(elm,name,value){elm=this.$$(elm).css(name,value),this.settings.update_styles&&updateInternalStyleAttr(this,elm)},getStyle:function(elm,name,computed){return elm=this.$$(elm),computed?elm.css(name):("float"==(name=name.replace(/-(\D)/g,function(a,b){return b.toUpperCase()}))&&(name=Env.ie&&Env.ie<12?"styleFloat":"cssFloat"),elm[0]&&elm[0].style?elm[0].style[name]:void 0)},setStyles:function(elm,styles){elm=this.$$(elm).css(styles),this.settings.update_styles&&updateInternalStyleAttr(this,elm)},removeAllAttribs:function(e){return this.run(e,function(e){var i,attrs=e.attributes;for(i=attrs.length-1;i>=0;i--)e.removeAttributeNode(attrs.item(i))})},setAttrib:function(elm,name,value){var originalValue,hook,self=this,settings=self.settings;""===value&&(value=null),originalValue=(elm=self.$$(elm)).attr(name),elm.length&&((hook=self.attrHooks[name])&&hook.set?hook.set(elm,value,name):elm.attr(name,value),originalValue!=value&&settings.onSetAttrib&&settings.onSetAttrib({attrElm:elm,attrName:name,attrValue:value}))},setAttribs:function(elm,attrs){var self=this;self.$$(elm).each(function(i,node){each(attrs,function(value,name){self.setAttrib(node,name,value)})})},getAttrib:function(elm,name,defaultVal){var hook,value,self=this;return(elm=self.$$(elm)).length&&(value=(hook=self.attrHooks[name])&&hook.get?hook.get(elm,name):elm.attr(name)),void 0===value&&(value=defaultVal||""),value},getPos:function(elm,rootElm){var offsetParent,pos,self=this,x=0,y=0,doc=self.doc,body=doc.body;if(elm=self.get(elm),rootElm=rootElm||body,elm){if(rootElm===body&&elm.getBoundingClientRect&&"static"===DomQuery(body).css("position"))return pos=elm.getBoundingClientRect(),rootElm=self.boxModel?doc.documentElement:body,x=pos.left+(doc.documentElement.scrollLeft||body.scrollLeft)-rootElm.clientLeft,y=pos.top+(doc.documentElement.scrollTop||body.scrollTop)-rootElm.clientTop,{x:x,y:y};for(offsetParent=elm;offsetParent&&offsetParent!=rootElm&&offsetParent.nodeType;)x+=offsetParent.offsetLeft||0,y+=offsetParent.offsetTop||0,offsetParent=offsetParent.offsetParent;for(offsetParent=elm.parentNode;offsetParent&&offsetParent!=rootElm&&offsetParent.nodeType;)x-=offsetParent.scrollLeft||0,y-=offsetParent.scrollTop||0,offsetParent=offsetParent.parentNode}return{x:x,y:y}},parseStyle:function(cssText){return this.styles.parse(cssText)},serializeStyle:function(styles,name){return this.styles.serialize(styles,name)},addStyle:function(cssText){var head,styleElm,self=this,doc=self.doc;if(self!==DOMUtils.DOM&&doc===document){var addedStyles=DOMUtils.DOM.addedStyles;if((addedStyles=addedStyles||[])[cssText])return;addedStyles[cssText]=!0,DOMUtils.DOM.addedStyles=addedStyles}(styleElm=doc.getElementById("mceDefaultStyles"))||((styleElm=doc.createElement("style")).id="mceDefaultStyles",styleElm.type="text/css",(head=doc.getElementsByTagName("head")[0]).firstChild?head.insertBefore(styleElm,head.firstChild):head.appendChild(styleElm)),styleElm.styleSheet?styleElm.styleSheet.cssText+=cssText:styleElm.appendChild(doc.createTextNode(cssText))},loadCSS:function(url){var head,self=this,doc=self.doc;self===DOMUtils.DOM||doc!==document?(url||(url=""),head=doc.getElementsByTagName("head")[0],each(url.split(","),function(url){var link;url=Tools._addCacheSuffix(url),self.files[url]||(self.files[url]=!0,link=self.create("link",{rel:"stylesheet",href:url}),isIE&&doc.documentMode&&doc.recalc&&(link.onload=function(){doc.recalc&&doc.recalc(),link.onload=null}),head.appendChild(link))})):DOMUtils.DOM.loadCSS(url)},addClass:function(elm,cls){this.$$(elm).addClass(cls)},removeClass:function(elm,cls){this.toggleClass(elm,cls,!1)},hasClass:function(elm,cls){return this.$$(elm).hasClass(cls)},toggleClass:function(elm,cls,state){this.$$(elm).toggleClass(cls,state).each(function(){""===this.className&&DomQuery(this).attr("class",null)})},show:function(elm){this.$$(elm).show()},hide:function(elm){this.$$(elm).hide()},isHidden:function(elm){return"none"==this.$$(elm).css("display")},uniqueId:function(prefix){return(prefix||"mce_")+this.counter++},setHTML:function(elm,html){elm=this.$$(elm),isIE?elm.each(function(i,target){if(!1!==target.canHaveHTML){for(;target.firstChild;)target.removeChild(target.firstChild);try{target.innerHTML="<br>"+html,target.removeChild(target.firstChild)}catch(ex){DomQuery("<div></div>").html("<br>"+html).contents().slice(1).appendTo(target)}return html}}):elm.html(html)},getOuterHTML:function(elm){return 1==(elm=this.get(elm)).nodeType&&"outerHTML"in elm?elm.outerHTML:DomQuery("<div></div>").append(DomQuery(elm).clone()).html()},setOuterHTML:function(elm,html){var self=this;self.$$(elm).each(function(){try{if("outerHTML"in this)return void(this.outerHTML=html)}catch(ex){}self.remove(DomQuery(this).html(html),!0)})},decode:Entities.decode,encode:Entities.encodeAllRaw,insertAfter:function(node,referenceNode){return referenceNode=this.get(referenceNode),this.run(node,function(node){var parent,nextSibling;return parent=referenceNode.parentNode,(nextSibling=referenceNode.nextSibling)?parent.insertBefore(node,nextSibling):parent.appendChild(node),node})},replace:function(newElm,oldElm,keepChildren){return this.run(oldElm,function(oldElm){return is(oldElm,"array")&&(newElm=newElm.cloneNode(!0)),keepChildren&&each(grep(oldElm.childNodes),function(node){newElm.appendChild(node)}),oldElm.parentNode.replaceChild(newElm,oldElm)})},rename:function(elm,name){var newElm,self=this;return elm.nodeName!=name.toUpperCase()&&(newElm=self.create(name),each(self.getAttribs(elm),function(attrNode){self.setAttrib(newElm,attrNode.nodeName,self.getAttrib(elm,attrNode.nodeName))}),self.replace(newElm,elm,1)),newElm||elm},findCommonAncestor:function(a,b){for(var pe,ps=a;ps;){for(pe=b;pe&&ps!=pe;)pe=pe.parentNode;if(ps==pe)break;ps=ps.parentNode}return!ps&&a.ownerDocument?a.ownerDocument.documentElement:ps},toHex:function(rgbVal){return this.styles.toHex(Tools.trim(rgbVal))},run:function(elm,func,scope){var result,self=this;return"string"==typeof elm&&(elm=self.get(elm)),!!elm&&(scope=scope||this,elm.nodeType||!elm.length&&0!==elm.length?func.call(scope,elm):(result=[],each(elm,function(elm,i){elm&&("string"==typeof elm&&(elm=self.get(elm)),result.push(func.call(scope,elm,i)))}),result))},getAttribs:function(elm){var attrs;if(!(elm=this.get(elm)))return[];if(isIE){if(attrs=[],"OBJECT"==elm.nodeName)return elm.attributes;"OPTION"===elm.nodeName&&this.getAttrib(elm,"selected")&&attrs.push({specified:1,nodeName:"selected"});var attrRegExp=/<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi;return elm.cloneNode(!1).outerHTML.replace(attrRegExp,"").replace(/[\w:\-]+/gi,function(a){attrs.push({specified:1,nodeName:a})}),attrs}return elm.attributes},isEmpty:function(node,elements){var i,attributes,type,whitespace,walker,name,self=this,brCount=0;if(node=node.firstChild){walker=new TreeWalker(node,node.parentNode),elements=elements||(self.schema?self.schema.getNonEmptyElements():null),whitespace=self.schema?self.schema.getWhiteSpaceElements():{};do{if(1===(type=node.nodeType)){var bogusVal=node.getAttribute("data-mce-bogus");if(bogusVal){node=walker.next("all"===bogusVal);continue}if(name=node.nodeName.toLowerCase(),elements&&elements[name]){if("br"===name){brCount++,node=walker.next();continue}return!1}for(i=(attributes=self.getAttribs(node)).length;i--;)if("name"===(name=attributes[i].nodeName)||"data-mce-bookmark"===name)return!1}if(8==type)return!1;if(3===type&&!whiteSpaceRegExp.test(node.nodeValue))return!1;if(3===type&&node.parentNode&&whitespace[node.parentNode.nodeName]&&whiteSpaceRegExp.test(node.nodeValue))return!1;node=walker.next()}while(node)}return brCount<=1},createRng:function(){var doc=this.doc;return doc.createRange?doc.createRange():new Range(this)},nodeIndex:nodeIndex,split:function(parentElm,splitElm,replacementElm){function trimNode(node){var i,children=node.childNodes,type=node.nodeType;if(1!=type||"bookmark"!=node.getAttribute("data-mce-type")){for(i=children.length-1;i>=0;i--)trimNode(children[i]);if(9!=type){if(3==type&&node.nodeValue.length>0){var trimmedLength=trim(node.nodeValue).length;if(!self.isBlock(node.parentNode)||trimmedLength>0||0===trimmedLength&&function(node){var previousIsSpan=node.previousSibling&&"SPAN"==node.previousSibling.nodeName,nextIsSpan=node.nextSibling&&"SPAN"==node.nextSibling.nodeName;return previousIsSpan&&nextIsSpan}(node))return}else if(1==type&&(1==(children=node.childNodes).length&&children[0]&&1==children[0].nodeType&&"bookmark"==children[0].getAttribute("data-mce-type")&&node.parentNode.insertBefore(children[0],node),children.length||/^(br|hr|input|img)$/i.test(node.nodeName)))return;self.remove(node)}return node}}var bef,aft,pa,self=this,r=self.createRng();if(parentElm&&splitElm)return r.setStart(parentElm.parentNode,self.nodeIndex(parentElm)),r.setEnd(splitElm.parentNode,self.nodeIndex(splitElm)),bef=r.extractContents(),(r=self.createRng()).setStart(splitElm.parentNode,self.nodeIndex(splitElm)+1),r.setEnd(parentElm.parentNode,self.nodeIndex(parentElm)+1),aft=r.extractContents(),(pa=parentElm.parentNode).insertBefore(trimNode(bef),parentElm),replacementElm?pa.insertBefore(replacementElm,parentElm):pa.insertBefore(splitElm,parentElm),pa.insertBefore(trimNode(aft),parentElm),self.remove(parentElm),replacementElm||splitElm},bind:function(target,name,func,scope){var self=this;if(Tools.isArray(target)){for(var i=target.length;i--;)target[i]=self.bind(target[i],name,func,scope);return target}return!self.settings.collect||target!==self.doc&&target!==self.win||self.boundEvents.push([target,name,func,scope]),self.events.bind(target,name,func,scope||self)},unbind:function(target,name,func){var i,self=this;if(Tools.isArray(target)){for(i=target.length;i--;)target[i]=self.unbind(target[i],name,func);return target}if(self.boundEvents&&(target===self.doc||target===self.win))for(i=self.boundEvents.length;i--;){var item=self.boundEvents[i];target!=item[0]||name&&name!=item[1]||func&&func!=item[2]||this.events.unbind(item[0],item[1],item[2])}return this.events.unbind(target,name,func)},fire:function(target,name,evt){return this.events.fire(target,name,evt)},getContentEditable:function(node){var contentEditable;return node&&1==node.nodeType?(contentEditable=node.getAttribute("data-mce-contenteditable"))&&"inherit"!==contentEditable?contentEditable:"inherit"!==node.contentEditable?node.contentEditable:null:null},getContentEditableParent:function(node){for(var root=this.getRoot(),state=null;node&&node!==root&&null===(state=this.getContentEditable(node));node=node.parentNode);return state},destroy:function(){var self=this;if(self.boundEvents){for(var i=self.boundEvents.length;i--;){var item=self.boundEvents[i];this.events.unbind(item[0],item[1],item[2])}self.boundEvents=null}Sizzle.setDocument&&Sizzle.setDocument(),self.win=self.doc=self.root=self.events=self.frag=null},isChildOf:function(node,parent){for(;node;){if(parent===node)return!0;node=node.parentNode}return!1},dumpRng:function(r){return"startContainer: "+r.startContainer.nodeName+", startOffset: "+r.startOffset+", endContainer: "+r.endContainer.nodeName+", endOffset: "+r.endOffset},_findSib:function(node,selector,name){var self=this,func=selector;if(node)for("string"==typeof func&&(func=function(node){return self.is(node,selector)}),node=node[name];node;node=node[name])if(func(node))return node;return null}},DOMUtils.DOM=new DOMUtils(document),DOMUtils.nodeIndex=nodeIndex,DOMUtils}),define("tinymce.core.util.Fun",[],function(){function curry(fn){var args=slice.call(arguments);return args.length-1>=fn.length?fn.apply(this,args.slice(1)):function(){var tempArgs=args.concat([].slice.call(arguments));return curry.apply(this,tempArgs)}}var slice=[].slice;return{constant:function(value){return function(){return value}},negate:function(predicate){return function(x){return!predicate(x)}},and:function(){var args=slice.call(arguments);return function(x){for(var i=0;i<args.length;i++)if(!args[i](x))return!1;return!0}},or:function(){var args=slice.call(arguments);return function(x){for(var i=0;i<args.length;i++)if(args[i](x))return!0;return!1}},curry:curry,compose:function(f,g){return function(x){return f(g(x))}},noop:function(){}}}),define("tinymce.core.text.Zwsp",[],function(){return{isZwsp:function(chr){return"\ufeff"===chr},ZWSP:"\ufeff",trim:function(text){return text.replace(new RegExp("\ufeff","g"),"")}}}),define("tinymce.core.caret.CaretContainer",["tinymce.core.dom.NodeType","tinymce.core.text.Zwsp"],function(NodeType,Zwsp){function isCaretContainerBlock(node){return isText(node)&&(node=node.parentNode),isElement(node)&&node.hasAttribute("data-mce-caret")}function isCaretContainerInline(node){return isText(node)&&Zwsp.isZwsp(node.data)}function isCaretContainer(node){return isCaretContainerBlock(node)||isCaretContainerInline(node)}function createBogusBr(){var br=document.createElement("br");return br.setAttribute("data-mce-bogus","1"),br}function startsWithCaretContainer(node){return isText(node)&&node.data[0]==Zwsp.ZWSP}function endsWithCaretContainer(node){return isText(node)&&node.data[node.data.length-1]==Zwsp.ZWSP}function trimBogusBr(elm){var brs=elm.getElementsByTagName("br"),lastBr=brs[brs.length-1];NodeType.isBogus(lastBr)&&lastBr.parentNode.removeChild(lastBr)}var isElement=NodeType.isElement,isText=NodeType.isText;return{isCaretContainer:isCaretContainer,isCaretContainerBlock:isCaretContainerBlock,isCaretContainerInline:isCaretContainerInline,showCaretContainerBlock:function(caretContainer){return caretContainer&&caretContainer.hasAttribute("data-mce-caret")?(trimBogusBr(caretContainer),caretContainer.removeAttribute("data-mce-caret"),caretContainer.removeAttribute("data-mce-bogus"),caretContainer.removeAttribute("style"),caretContainer.removeAttribute("_moz_abspos"),caretContainer):null},insertInline:function(node,before){var doc,sibling,textNode,parentNode;if(doc=node.ownerDocument,textNode=doc.createTextNode(Zwsp.ZWSP),parentNode=node.parentNode,before){if(sibling=node.previousSibling,isText(sibling)){if(isCaretContainer(sibling))return sibling;if(endsWithCaretContainer(sibling))return sibling.splitText(sibling.data.length-1)}parentNode.insertBefore(textNode,node)}else{if(sibling=node.nextSibling,isText(sibling)){if(isCaretContainer(sibling))return sibling;if(startsWithCaretContainer(sibling))return sibling.splitText(1),sibling}node.nextSibling?parentNode.insertBefore(textNode,node.nextSibling):parentNode.appendChild(textNode)}return textNode},prependInline:function(node){if(NodeType.isText(node)){var data=node.data;return data.length>0&&data.charAt(0)!==Zwsp.ZWSP&&node.insertData(0,Zwsp.ZWSP),node}return null},appendInline:function(node){if(NodeType.isText(node)){var data=node.data;return data.length>0&&data.charAt(data.length-1)!==Zwsp.ZWSP&&node.insertData(data.length,Zwsp.ZWSP),node}return null},isBeforeInline:function(pos){return pos&&NodeType.isText(pos.container())&&pos.container().data.charAt(pos.offset())===Zwsp.ZWSP},isAfterInline:function(pos){return pos&&NodeType.isText(pos.container())&&pos.container().data.charAt(pos.offset()-1)===Zwsp.ZWSP},insertBlock:function(blockName,node,before){var doc,blockNode,parentNode;return doc=node.ownerDocument,(blockNode=doc.createElement(blockName)).setAttribute("data-mce-caret",before?"before":"after"),blockNode.setAttribute("data-mce-bogus","all"),blockNode.appendChild(createBogusBr()),parentNode=node.parentNode,before?parentNode.insertBefore(blockNode,node):node.nextSibling?parentNode.insertBefore(blockNode,node.nextSibling):parentNode.appendChild(blockNode),blockNode},hasContent:function(node){return node.firstChild!==node.lastChild||!NodeType.isBr(node.firstChild)},startsWithCaretContainer:startsWithCaretContainer,endsWithCaretContainer:endsWithCaretContainer}}),define("tinymce.core.dom.RangeUtils",["tinymce.core.util.Tools","tinymce.core.dom.TreeWalker","tinymce.core.dom.NodeType","tinymce.core.dom.Range","tinymce.core.caret.CaretContainer"],function(Tools,TreeWalker,NodeType,Range,CaretContainer){function hasCeProperty(node){return isContentEditableTrue(node)||isContentEditableFalse(node)}function getEndChild(container,index){var childNodes=container.childNodes;return--index>childNodes.length-1?index=childNodes.length-1:index<0&&(index=0),childNodes[index]||container}function findParent(node,rootNode,predicate){for(;node&&node!==rootNode;){if(predicate(node))return node;node=node.parentNode}return null}function hasParent(node,rootNode,predicate){return null!==findParent(node,rootNode,predicate)}function hasParentWithName(node,rootNode,name){return hasParent(node,rootNode,function(node){return node.nodeName===name})}function isFormatterCaret(node){return"_mce_caret"===node.id}function isCeFalseCaretContainer(node,rootNode){return isCaretContainer(node)&&!1===hasParent(node,rootNode,isFormatterCaret)}function RangeUtils(dom){this.walk=function(rng,callback){function exclude(nodes){var node;return 3===(node=nodes[0]).nodeType&&node===startContainer&&startOffset>=node.nodeValue.length&&nodes.splice(0,1),node=nodes[nodes.length-1],0===endOffset&&nodes.length>0&&node===endContainer&&3===node.nodeType&&nodes.splice(nodes.length-1,1),nodes}function collectSiblings(node,name,endNode){for(var siblings=[];node&&node!=endNode;node=node[name])siblings.push(node);return siblings}function findEndPoint(node,root){do{if(node.parentNode==root)return node;node=node.parentNode}while(node)}function walkBoundary(startNode,endNode,next){var siblingName=next?"nextSibling":"previousSibling";for(parent=(node=startNode).parentNode;node&&node!=endNode;node=parent)parent=node.parentNode,(siblings=collectSiblings(node==startNode?node:node[siblingName],siblingName)).length&&(next||siblings.reverse(),callback(exclude(siblings)))}var ancestor,startPoint,endPoint,node,parent,siblings,nodes,startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;if((nodes=dom.select("td[data-mce-selected],th[data-mce-selected]")).length>0)each(nodes,function(node){callback([node])});else{if(1==startContainer.nodeType&&startContainer.hasChildNodes()&&(startContainer=startContainer.childNodes[startOffset]),1==endContainer.nodeType&&endContainer.hasChildNodes()&&(endContainer=getEndChild(endContainer,endOffset)),startContainer==endContainer)return callback(exclude([startContainer]));for(ancestor=dom.findCommonAncestor(startContainer,endContainer),node=startContainer;node;node=node.parentNode){if(node===endContainer)return walkBoundary(startContainer,ancestor,!0);if(node===ancestor)break}for(node=endContainer;node;node=node.parentNode){if(node===startContainer)return walkBoundary(endContainer,ancestor);if(node===ancestor)break}startPoint=findEndPoint(startContainer,ancestor)||startContainer,endPoint=findEndPoint(endContainer,ancestor)||endContainer,walkBoundary(startContainer,startPoint,!0),(siblings=collectSiblings(startPoint==startContainer?startPoint:startPoint.nextSibling,"nextSibling",endPoint==endContainer?endPoint.nextSibling:endPoint)).length&&callback(exclude(siblings)),walkBoundary(endContainer,endPoint)}},this.split=function(rng){function splitText(node,offset){return node.splitText(offset)}var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;return startContainer==endContainer&&3==startContainer.nodeType?startOffset>0&&startOffset<startContainer.nodeValue.length&&(startContainer=(endContainer=splitText(startContainer,startOffset)).previousSibling,endOffset>startOffset?(startContainer=endContainer=splitText(endContainer,endOffset-=startOffset).previousSibling,endOffset=endContainer.nodeValue.length,startOffset=0):endOffset=0):(3==startContainer.nodeType&&startOffset>0&&startOffset<startContainer.nodeValue.length&&(startContainer=splitText(startContainer,startOffset),startOffset=0),3==endContainer.nodeType&&endOffset>0&&endOffset<endContainer.nodeValue.length&&(endOffset=(endContainer=splitText(endContainer,endOffset).previousSibling).nodeValue.length)),{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset}},this.normalize=function(rng){function normalizeEndPoint(start){function hasBrBeforeAfter(node,left){for(var walker=new TreeWalker(node,dom.getParent(node.parentNode,dom.isBlock)||body);node=walker[left?"prev":"next"]();)if("BR"===node.nodeName)return!0}function findTextNodeRelative(left,startNode){var walker,lastInlineElement,parentBlockContainer;if(startNode=startNode||container,parentBlockContainer=dom.getParent(startNode.parentNode,dom.isBlock)||body,left&&"BR"==startNode.nodeName&&isAfterNode&&dom.isEmpty(parentBlockContainer))return container=startNode.parentNode,offset=dom.nodeIndex(startNode),void(normalized=!0);for(walker=new TreeWalker(startNode,parentBlockContainer);node=walker[left?"prev":"next"]();){if("false"===dom.getContentEditableParent(node)||isCeFalseCaretContainer(node,dom.getRoot()))return;if(3===node.nodeType&&node.nodeValue.length>0)return void(!1===hasParentWithName(node,body,"A")&&(container=node,offset=left?node.nodeValue.length:0,normalized=!0));if(dom.isBlock(node)||nonEmptyElementsMap[node.nodeName.toLowerCase()])return;lastInlineElement=node}collapsed&&lastInlineElement&&(container=lastInlineElement,normalized=!0,offset=0)}var container,offset,walker,node,nonEmptyElementsMap,directionLeft,isAfterNode,body=dom.getRoot();if(container=rng[(start?"start":"end")+"Container"],offset=rng[(start?"start":"end")+"Offset"],isAfterNode=1==container.nodeType&&offset===container.childNodes.length,nonEmptyElementsMap=dom.schema.getNonEmptyElements(),directionLeft=start,!isCaretContainer(container)){if(1==container.nodeType&&offset>container.childNodes.length-1&&(directionLeft=!1),9===container.nodeType&&(container=dom.getRoot(),offset=0),container===body){if(directionLeft&&(node=container.childNodes[offset>0?offset-1:0])){if(isCaretContainer(node))return;if(nonEmptyElementsMap[node.nodeName]||"TABLE"==node.nodeName)return}if(container.hasChildNodes()){if(offset=Math.min(!directionLeft&&offset>0?offset-1:offset,container.childNodes.length-1),container=container.childNodes[offset],offset=0,!collapsed&&container===body.lastChild&&"TABLE"===container.nodeName)return;if(function(node){for(;node&&node!=body;){if(isContentEditableFalse(node))return!0;node=node.parentNode}return!1}(container)||isCaretContainer(container))return;if(container.hasChildNodes()&&!/TABLE/.test(container.nodeName)){node=container,walker=new TreeWalker(container,body);do{if(isContentEditableFalse(node)||isCaretContainer(node)){normalized=!1;break}if(3===node.nodeType&&node.nodeValue.length>0){offset=directionLeft?0:node.nodeValue.length,container=node,normalized=!0;break}if(nonEmptyElementsMap[node.nodeName.toLowerCase()]&&!function(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)}(node)){offset=dom.nodeIndex(node),container=node.parentNode,"IMG"!==node.nodeName&&"PRE"!==node.nodeName||directionLeft||offset++,normalized=!0;break}}while(node=directionLeft?walker.next():walker.prev())}}}collapsed&&(3===container.nodeType&&0===offset&&findTextNodeRelative(!0),1===container.nodeType&&((node=container.childNodes[offset])||(node=container.childNodes[offset-1]),!node||"BR"!==node.nodeName||function(node,name){return node.previousSibling&&node.previousSibling.nodeName==name}(node,"A")||hasBrBeforeAfter(node)||hasBrBeforeAfter(node,!0)||findTextNodeRelative(!0,node))),directionLeft&&!collapsed&&3===container.nodeType&&offset===container.nodeValue.length&&findTextNodeRelative(!1),normalized&&rng["set"+(start?"Start":"End")](container,offset)}}var collapsed,normalized=!1;return collapsed=rng.collapsed,normalizeEndPoint(!0),collapsed||normalizeEndPoint(),normalized&&collapsed&&rng.collapse(!0),normalized}}function findClosestIeRange(clientX,clientY,doc){var element,rng,rects;if(element=doc.elementFromPoint(clientX,clientY),rng=doc.body.createTextRange(),element&&"HTML"!=element.tagName||(element=doc.body),rng.moveToElementText(element),rects=Tools.toArray(rng.getClientRects()),(rects=rects.sort(function(a,b){return a=Math.abs(Math.max(a.top-clientY,a.bottom-clientY)),b=Math.abs(Math.max(b.top-clientY,b.bottom-clientY)),a-b})).length>0){clientY=(rects[0].bottom+rects[0].top)/2;try{return rng.moveToPoint(clientX,clientY),rng.collapse(!0),rng}catch(ex){}}return null}function moveOutOfContentEditableFalse(rng,rootNode){var parentElement=rng&&rng.parentElement?rng.parentElement():null;return isContentEditableFalse(findParent(parentElement,rootNode,hasCeProperty))?null:rng}var each=Tools.each,isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isCaretContainer=CaretContainer.isCaretContainer;return RangeUtils.compareRanges=function(rng1,rng2){if(rng1&&rng2){if(!rng1.item&&!rng1.duplicate)return rng1.startContainer==rng2.startContainer&&rng1.startOffset==rng2.startOffset;if(rng1.item&&rng2.item&&rng1.item(0)===rng2.item(0))return!0;if(rng1.isEqual&&rng2.isEqual&&rng2.isEqual(rng1))return!0}return!1},RangeUtils.getCaretRangeFromPoint=function(clientX,clientY,doc){var rng,point;if(doc.caretPositionFromPoint)point=doc.caretPositionFromPoint(clientX,clientY),(rng=doc.createRange()).setStart(point.offsetNode,point.offset),rng.collapse(!0);else if(doc.caretRangeFromPoint)rng=doc.caretRangeFromPoint(clientX,clientY);else if(doc.body.createTextRange){rng=doc.body.createTextRange();try{rng.moveToPoint(clientX,clientY),rng.collapse(!0)}catch(ex){rng=findClosestIeRange(clientX,clientY,doc)}return moveOutOfContentEditableFalse(rng,doc.body)}return rng},RangeUtils.getSelectedNode=function(range){var startContainer=range.startContainer,startOffset=range.startOffset;return startContainer.hasChildNodes()&&range.endOffset==startOffset+1?startContainer.childNodes[startOffset]:null},RangeUtils.getNode=function(container,offset){return 1==container.nodeType&&container.hasChildNodes()&&(offset>=container.childNodes.length&&(offset=container.childNodes.length-1),container=container.childNodes[offset]),container},RangeUtils}),define("tinymce.core.caret.CaretCandidate",["tinymce.core.dom.NodeType","tinymce.core.util.Arr","tinymce.core.caret.CaretContainer"],function(NodeType,Arr,CaretContainer){function isCaretCandidate(node){return!isCaretContainer(node)&&(isText(node)?!isInvalidTextElement(node.parentNode):isAtomicInline(node)||isBr(node)||isTable(node)||isContentEditableFalse(node))}function isInEditable(node,rootNode){for(node=node.parentNode;node&&node!=rootNode;node=node.parentNode){if(isContentEditableFalse(node))return!1;if(isContentEditableTrue(node))return!0}return!0}function isAtomicContentEditableFalse(node){return!!isContentEditableFalse(node)&&!0!==Arr.reduce(node.getElementsByTagName("*"),function(result,elm){return result||isContentEditableTrue(elm)},!1)}var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isBr=NodeType.isBr,isText=NodeType.isText,isInvalidTextElement=NodeType.matchNodeNames("script style textarea"),isAtomicInline=NodeType.matchNodeNames("img input textarea hr iframe video audio object"),isTable=NodeType.matchNodeNames("table"),isCaretContainer=CaretContainer.isCaretContainer;return{isCaretCandidate:isCaretCandidate,isInEditable:isInEditable,isAtomic:function(node){return isAtomicInline(node)||isAtomicContentEditableFalse(node)},isEditableCaretCandidate:function(node,rootNode){return isCaretCandidate(node)&&isInEditable(node,rootNode)}}}),define("tinymce.core.geom.ClientRect",[],function(){function clone(rect){return rect?{left:round(rect.left),top:round(rect.top),bottom:round(rect.bottom),right:round(rect.right),width:round(rect.width),height:round(rect.height)}:{left:0,top:0,bottom:0,right:0,width:0,height:0}}function isValidOverflow(overflowY,clientRect1,clientRect2){return overflowY>=0&&overflowY<=Math.min(clientRect1.height,clientRect2.height)/2}function isAbove(clientRect1,clientRect2){return clientRect1.bottom-clientRect1.height/2<clientRect2.top||!(clientRect1.top>clientRect2.bottom)&&isValidOverflow(clientRect2.top-clientRect1.bottom,clientRect1,clientRect2)}function isBelow(clientRect1,clientRect2){return clientRect1.top>clientRect2.bottom||!(clientRect1.bottom<clientRect2.top)&&isValidOverflow(clientRect2.bottom-clientRect1.top,clientRect1,clientRect2)}function isLeft(clientRect1,clientRect2){return clientRect1.left<clientRect2.left}function isRight(clientRect1,clientRect2){return clientRect1.right>clientRect2.right}var round=Math.round;return{clone:clone,collapse:function(clientRect,toStart){return clientRect=clone(clientRect),toStart?clientRect.right=clientRect.left:(clientRect.left=clientRect.left+clientRect.width,clientRect.right=clientRect.left),clientRect.width=0,clientRect},isEqual:function(rect1,rect2){return rect1.left===rect2.left&&rect1.top===rect2.top&&rect1.bottom===rect2.bottom&&rect1.right===rect2.right},isAbove:isAbove,isBelow:isBelow,isLeft:isLeft,isRight:isRight,compare:function(clientRect1,clientRect2){return isAbove(clientRect1,clientRect2)?-1:isBelow(clientRect1,clientRect2)?1:isLeft(clientRect1,clientRect2)?-1:isRight(clientRect1,clientRect2)?1:0},containsXY:function(clientRect,clientX,clientY){return clientX>=clientRect.left&&clientX<=clientRect.right&&clientY>=clientRect.top&&clientY<=clientRect.bottom}}}),define("tinymce.core.text.ExtendingChar",[],function(){var extendingChars=new RegExp("[-----------------------------------------------------------------------------------------------------------------------------------]");return{isExtendingChar:function(ch){return"string"==typeof ch&&ch.charCodeAt(0)>=768&&extendingChars.test(ch)}}}),define("tinymce.core.caret.CaretPosition",["tinymce.core.util.Fun","tinymce.core.dom.NodeType","tinymce.core.dom.DOMUtils","tinymce.core.dom.RangeUtils","tinymce.core.caret.CaretCandidate","tinymce.core.geom.ClientRect","tinymce.core.text.ExtendingChar"],function(Fun,NodeType,DOMUtils,RangeUtils,CaretCandidate,ClientRect,ExtendingChar){function createRange(doc){return"createRange"in doc?doc.createRange():DOMUtils.DOM.createRng()}function isWhiteSpace(chr){return chr&&/[\r\n\t ]/.test(chr)}function isHiddenWhiteSpaceRange(range){var text,container=range.startContainer,offset=range.startOffset;return!!(isWhiteSpace(range.toString())&&isNotPre(container.parentNode)&&(text=container.data,isWhiteSpace(text[offset-1])||isWhiteSpace(text[offset+1])))}function getCaretPositionClientRects(caretPosition){function getBrClientRect(brNode){var clientRect,doc=brNode.ownerDocument,rng=createRange(doc),nbsp=doc.createTextNode(""),parentNode=brNode.parentNode;return parentNode.insertBefore(nbsp,brNode),rng.setStart(nbsp,0),rng.setEnd(nbsp,1),clientRect=ClientRect.clone(rng.getBoundingClientRect()),parentNode.removeChild(nbsp),clientRect}function getBoundingClientRect(item){var clientRect,clientRects;return clientRects=item.getClientRects(),clientRect=clientRects.length>0?ClientRect.clone(clientRects[0]):ClientRect.clone(item.getBoundingClientRect()),isBr(item)&&0===clientRect.left?getBrClientRect(item):clientRect}function collapseAndInflateWidth(clientRect,toStart){return clientRect=ClientRect.collapse(clientRect,toStart),clientRect.width=1,clientRect.right=clientRect.left+1,clientRect}function addUniqueAndValidRect(clientRect){0!==clientRect.height&&(clientRects.length>0&&ClientRect.isEqual(clientRect,clientRects[clientRects.length-1])||clientRects.push(clientRect))}function addCharacterOffset(container,offset){var range=createRange(container.ownerDocument);if(offset<container.data.length){if(ExtendingChar.isExtendingChar(container.data[offset]))return clientRects;if(ExtendingChar.isExtendingChar(container.data[offset-1])&&(range.setStart(container,offset),range.setEnd(container,offset+1),!isHiddenWhiteSpaceRange(range)))return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),!1)),clientRects}offset>0&&(range.setStart(container,offset-1),range.setEnd(container,offset),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),!1))),offset<container.data.length&&(range.setStart(container,offset),range.setEnd(container,offset+1),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),!0)))}var beforeNode,node,clientRects=[];if(isText(caretPosition.container()))return addCharacterOffset(caretPosition.container(),caretPosition.offset()),clientRects;if(isElement(caretPosition.container()))if(caretPosition.isAtEnd())node=resolveIndex(caretPosition.container(),caretPosition.offset()),isText(node)&&addCharacterOffset(node,node.data.length),isValidElementCaretCandidate(node)&&!isBr(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),!1));else{if(node=resolveIndex(caretPosition.container(),caretPosition.offset()),isText(node)&&addCharacterOffset(node,0),isValidElementCaretCandidate(node)&&caretPosition.isAtEnd())return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),!1)),clientRects;beforeNode=resolveIndex(caretPosition.container(),caretPosition.offset()-1),isValidElementCaretCandidate(beforeNode)&&!isBr(beforeNode)&&(isBlock(beforeNode)||isBlock(node)||!isValidElementCaretCandidate(node))&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode),!1)),isValidElementCaretCandidate(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),!0))}return clientRects}function CaretPosition(container,offset,clientRects){function getClientRects(){return clientRects||(clientRects=getCaretPositionClientRects(new CaretPosition(container,offset))),clientRects}return{container:Fun.constant(container),offset:Fun.constant(offset),toRange:function(){var range;return(range=createRange(container.ownerDocument)).setStart(container,offset),range.setEnd(container,offset),range},getClientRects:getClientRects,isVisible:function(){return getClientRects().length>0},isAtStart:function(){return isText(container),0===offset},isAtEnd:function(){return isText(container)?offset>=container.data.length:offset>=container.childNodes.length},isEqual:function(caretPosition){return caretPosition&&container===caretPosition.container()&&offset===caretPosition.offset()},getNode:function(before){return resolveIndex(container,before?offset-1:offset)}}}var isElement=NodeType.isElement,isCaretCandidate=CaretCandidate.isCaretCandidate,isBlock=NodeType.matchStyleValues("display","block table"),isFloated=NodeType.matchStyleValues("float","left right"),isValidElementCaretCandidate=Fun.and(isElement,isCaretCandidate,Fun.negate(isFloated)),isNotPre=Fun.negate(NodeType.matchStyleValues("white-space","pre pre-line pre-wrap")),isText=NodeType.isText,isBr=NodeType.isBr,nodeIndex=DOMUtils.nodeIndex,resolveIndex=RangeUtils.getNode;return CaretPosition.fromRangeStart=function(range){return new CaretPosition(range.startContainer,range.startOffset)},CaretPosition.fromRangeEnd=function(range){return new CaretPosition(range.endContainer,range.endOffset)},CaretPosition.after=function(node){return new CaretPosition(node.parentNode,nodeIndex(node)+1)},CaretPosition.before=function(node){return new CaretPosition(node.parentNode,nodeIndex(node))},CaretPosition.isAtStart=function(pos){return!!pos&&pos.isAtStart()},CaretPosition.isAtEnd=function(pos){return!!pos&&pos.isAtEnd()},CaretPosition.isTextPosition=function(pos){return!!pos&&NodeType.isText(pos.container())},CaretPosition}),define("tinymce.core.caret.CaretBookmark",["tinymce.core.dom.NodeType","tinymce.core.dom.DOMUtils","tinymce.core.util.Fun","tinymce.core.util.Arr","tinymce.core.caret.CaretPosition"],function(NodeType,DomUtils,Fun,Arr,CaretPosition){function normalizedParent(node){var parentNode=node.parentNode;return isBogus(parentNode)?normalizedParent(parentNode):parentNode}function getChildNodes(node){return node?Arr.reduce(node.childNodes,function(result,node){return isBogus(node)&&"BR"!=node.nodeName?result=result.concat(getChildNodes(node)):result.push(node),result},[]):[]}function normalizedTextOffset(textNode,offset){for(;(textNode=textNode.previousSibling)&&isText(textNode);)offset+=textNode.data.length;return offset}function equal(targetValue){return function(value){return targetValue===value}}function normalizedNodeIndex(node){var nodes,index,numTextFragments;return nodes=getChildNodes(normalizedParent(node)),index=Arr.findIndex(nodes,equal(node),node),nodes=nodes.slice(0,index+1),numTextFragments=Arr.reduce(nodes,function(result,node,i){return isText(node)&&isText(nodes[i-1])&&result++,result},0),nodes=Arr.filter(nodes,NodeType.matchNodeNames(node.nodeName)),(index=Arr.findIndex(nodes,equal(node),node))-numTextFragments}function createPathItem(node){return(isText(node)?"text()":node.nodeName.toLowerCase())+"["+normalizedNodeIndex(node)+"]"}function parentsUntil(rootNode,node,predicate){var parents=[];for(node=node.parentNode;node!=rootNode&&(!predicate||!predicate(node));node=node.parentNode)parents.push(node);return parents}function resolvePathItem(node,name,index){var nodes=getChildNodes(node);return nodes=Arr.filter(nodes,function(node,index){return!isText(node)||!isText(nodes[index-1])}),(nodes=Arr.filter(nodes,NodeType.matchNodeNames(name)))[index]}function findTextPosition(container,offset){for(var dataLen,node=container,targetOffset=0;isText(node);){if(dataLen=node.data.length,offset>=targetOffset&&offset<=targetOffset+dataLen){container=node,offset-=targetOffset;break}if(!isText(node.nextSibling)){container=node,offset=dataLen;break}targetOffset+=dataLen,node=node.nextSibling}return offset>container.data.length&&(offset=container.data.length),new CaretPosition(container,offset)}var isText=NodeType.isText,isBogus=NodeType.isBogus,nodeIndex=DomUtils.nodeIndex;return{create:function(rootNode,caretPosition){var container,offset,outputOffset,childNodes,parents,path=[];return container=caretPosition.container(),offset=caretPosition.offset(),isText(container)?outputOffset=normalizedTextOffset(container,offset):(offset>=(childNodes=container.childNodes).length?(outputOffset="after",offset=childNodes.length-1):outputOffset="before",container=childNodes[offset]),path.push(createPathItem(container)),parents=parentsUntil(rootNode,container),parents=Arr.filter(parents,Fun.negate(NodeType.isBogus)),(path=path.concat(Arr.map(parents,function(node){return createPathItem(node)}))).reverse().join("/")+","+outputOffset},resolve:function(rootNode,path){var parts,container,offset;return path?(parts=path.split(","),path=parts[0].split("/"),offset=parts.length>1?parts[1]:"before",(container=Arr.reduce(path,function(result,value){return(value=/([\w\-\(\)]+)\[([0-9]+)\]/.exec(value))?("text()"===value[1]&&(value[1]="#text"),resolvePathItem(result,value[1],parseInt(value[2],10))):null},rootNode))?isText(container)?findTextPosition(container,parseInt(offset,10)):(offset="after"===offset?nodeIndex(container)+1:nodeIndex(container),new CaretPosition(container.parentNode,offset)):null):null}}}),define("tinymce.core.dom.BookmarkManager",["tinymce.core.caret.CaretBookmark","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretPosition","tinymce.core.dom.NodeType","tinymce.core.dom.RangeUtils","tinymce.core.Env","tinymce.core.text.Zwsp","tinymce.core.util.Tools"],function(CaretBookmark,CaretContainer,CaretPosition,NodeType,RangeUtils,Env,Zwsp,Tools){function BookmarkManager(selection){var dom=selection.dom;this.getBookmark=function(type,normalized){function findIndex(name,element){var count=0;return Tools.each(dom.select(name),function(node){if("all"!==node.getAttribute("data-mce-bogus"))return node!=element&&void count++}),count}function normalizeTableCellSelection(rng){function moveEndPoint(start){var container,offset,childNodes,prefix=start?"start":"end";container=rng[prefix+"Container"],offset=rng[prefix+"Offset"],1==container.nodeType&&"TR"==container.nodeName&&(container=(childNodes=container.childNodes)[Math.min(start?offset:offset-1,childNodes.length-1)])&&(offset=start?0:container.childNodes.length,rng["set"+(start?"Start":"End")](container,offset))}return moveEndPoint(!0),moveEndPoint(),rng}var rng,rng2,id,collapsed,name,element,styles,chr="&#xFEFF;";if(2==type)return element=selection.getNode(),name=element?element.nodeName:null,rng=selection.getRng(),isContentEditableFalse(element)||"IMG"==name?{name:name,index:findIndex(name,element)}:selection.tridentSel?selection.tridentSel.getBookmark(type):(element=function(rng){function findSibling(node,offset){var sibling;if(NodeType.isElement(node)&&(node=RangeUtils.getNode(node,offset),isContentEditableFalse(node)))return node;if(CaretContainer.isCaretContainer(node)){if(NodeType.isText(node)&&CaretContainer.isCaretContainerBlock(node)&&(node=node.parentNode),sibling=node.previousSibling,isContentEditableFalse(sibling))return sibling;if(sibling=node.nextSibling,isContentEditableFalse(sibling))return sibling}}return findSibling(rng.startContainer,rng.startOffset)||findSibling(rng.endContainer,rng.endOffset)}(rng))?(name=element.tagName,{name:name,index:findIndex(name,element)}):function(rng){function getPoint(rng,start){var childNodes,container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"],point=[],after=0;for(3===container.nodeType?point.push(normalized?getNormalizedTextOffset(container,offset):offset):(offset>=(childNodes=container.childNodes).length&&childNodes.length&&(after=1,offset=Math.max(0,childNodes.length-1)),point.push(dom.nodeIndex(childNodes[offset],normalized)+after));container&&container!=root;container=container.parentNode)point.push(dom.nodeIndex(container,normalized));return point}var root=dom.getRoot(),bookmark={};return bookmark.start=getPoint(rng,!0),selection.isCollapsed()||(bookmark.end=getPoint(rng)),bookmark}(rng);if(3==type)return rng=selection.getRng(),{start:CaretBookmark.create(dom.getRoot(),CaretPosition.fromRangeStart(rng)),end:CaretBookmark.create(dom.getRoot(),CaretPosition.fromRangeEnd(rng))};if(type)return{rng:selection.getRng()};if(rng=selection.getRng(),id=dom.uniqueId(),collapsed=selection.isCollapsed(),styles="overflow:hidden;line-height:0px",rng.duplicate||rng.item){if(rng.item)return element=rng.item(0),name=element.nodeName,{name:name,index:findIndex(name,element)};rng2=rng.duplicate();try{rng.collapse(),rng.pasteHTML('<span data-mce-type="bookmark" id="'+id+'_start" style="'+styles+'">'+chr+"</span>"),collapsed||(rng2.collapse(!1),rng.moveToElementText(rng2.parentElement()),0===rng.compareEndPoints("StartToEnd",rng2)&&rng2.move("character",-1),rng2.pasteHTML('<span data-mce-type="bookmark" id="'+id+'_end" style="'+styles+'">'+chr+"</span>"))}catch(ex){return null}}else{if(element=selection.getNode(),"IMG"==(name=element.nodeName))return{name:name,index:findIndex(name,element)};if(rng2=normalizeTableCellSelection(rng.cloneRange()),!collapsed){rng2.collapse(!1);var endBookmarkNode=dom.create("span",{"data-mce-type":"bookmark",id:id+"_end",style:styles},chr);rng2.insertNode(endBookmarkNode),trimEmptyTextNode(endBookmarkNode.nextSibling)}(rng=normalizeTableCellSelection(rng)).collapse(!0);var startBookmarkNode=dom.create("span",{"data-mce-type":"bookmark",id:id+"_start",style:styles},chr);rng.insertNode(startBookmarkNode),trimEmptyTextNode(startBookmarkNode.previousSibling)}return selection.moveToBookmark({id:id,keep:1}),{id:id}},this.moveToBookmark=function(bookmark){function setEndPoint(start){var i,node,offset,children,point=bookmark[start?"start":"end"];if(point){for(offset=point[0],node=root,i=point.length-1;i>=1;i--){if(children=node.childNodes,point[i]>children.length-1)return;node=children[point[i]]}3===node.nodeType&&(offset=Math.min(point[0],node.nodeValue.length)),1===node.nodeType&&(offset=Math.min(point[0],node.childNodes.length)),start?rng.setStart(node,offset):rng.setEnd(node,offset)}return!0}function restoreEndPoint(suffix){var node,idx,next,prev,marker=dom.get(bookmark.id+"_"+suffix),keep=bookmark.keep;if(marker&&(node=marker.parentNode,"start"==suffix?(keep?(node=marker.firstChild,idx=1):idx=dom.nodeIndex(marker),startContainer=endContainer=node,startOffset=endOffset=idx):(keep?(node=marker.firstChild,idx=1):idx=dom.nodeIndex(marker),endContainer=node,endOffset=idx),!keep)){for(prev=marker.previousSibling,next=marker.nextSibling,Tools.each(Tools.grep(marker.childNodes),function(node){3==node.nodeType&&(node.nodeValue=node.nodeValue.replace(/\uFEFF/g,""))});marker=dom.get(bookmark.id+"_"+suffix);)dom.remove(marker,1);prev&&next&&prev.nodeType==next.nodeType&&3==prev.nodeType&&!Env.opera&&(idx=prev.nodeValue.length,prev.appendData(next.nodeValue),dom.remove(next),"start"==suffix?(startContainer=endContainer=prev,startOffset=endOffset=idx):(endContainer=prev,endOffset=idx))}}function addBogus(node){return!dom.isBlock(node)||node.innerHTML||Env.ie||(node.innerHTML='<br data-mce-bogus="1" />'),node}var rng,root,startContainer,endContainer,startOffset,endOffset;if(bookmark)if(Tools.isArray(bookmark.start)){if(rng=dom.createRng(),root=dom.getRoot(),selection.tridentSel)return selection.tridentSel.moveToBookmark(bookmark);setEndPoint(!0)&&setEndPoint()&&selection.setRng(rng)}else"string"==typeof bookmark.start?selection.setRng(function(){var rng,pos;return rng=dom.createRng(),pos=CaretBookmark.resolve(dom.getRoot(),bookmark.start),rng.setStart(pos.container(),pos.offset()),pos=CaretBookmark.resolve(dom.getRoot(),bookmark.end),rng.setEnd(pos.container(),pos.offset()),rng}()):bookmark.id?(restoreEndPoint("start"),restoreEndPoint("end"),startContainer&&((rng=dom.createRng()).setStart(addBogus(startContainer),startOffset),rng.setEnd(addBogus(endContainer),endOffset),selection.setRng(rng))):bookmark.name?selection.select(dom.select(bookmark.name)[bookmark.index]):bookmark.rng&&selection.setRng(bookmark.rng)}}var isContentEditableFalse=NodeType.isContentEditableFalse,getNormalizedTextOffset=function(container,offset){var node,trimmedOffset;for(trimmedOffset=Zwsp.trim(container.data.slice(0,offset)).length,node=container.previousSibling;node&&3===node.nodeType;node=node.previousSibling)trimmedOffset+=Zwsp.trim(node.data).length;return trimmedOffset},trimEmptyTextNode=function(node){NodeType.isText(node)&&0===node.data.length&&node.parentNode.removeChild(node)};return BookmarkManager.isBookmarkNode=function(node){return node&&"SPAN"===node.tagName&&"bookmark"===node.getAttribute("data-mce-type")},BookmarkManager}),define("tinymce.core.caret.CaretUtils",["tinymce.core.util.Fun","tinymce.core.dom.TreeWalker","tinymce.core.dom.NodeType","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretCandidate"],function(Fun,TreeWalker,NodeType,CaretPosition,CaretContainer,CaretCandidate){function isForwards(direction){return direction>0}function isBackwards(direction){return direction<0}function skipCaretContainers(walk,shallow){for(var node;node=walk(shallow);)if(!isCaretContainerBlock(node))return node;return null}function getEditingHost(node,rootNode){for(node=node.parentNode;node&&node!=rootNode;node=node.parentNode)if(isContentEditableTrue(node))return node;return rootNode}function getParentBlock(node,rootNode){for(;node&&node!=rootNode;){if(isBlockLike(node))return node;node=node.parentNode}return null}function getChildNodeAtRelativeOffset(relativeOffset,caretPosition){var container,offset;return caretPosition?(container=caretPosition.container(),offset=caretPosition.offset(),isElement(container)?container.childNodes[offset+relativeOffset]:null):null}function beforeAfter(before,node){var range=node.ownerDocument.createRange();return before?(range.setStartBefore(node),range.setEndBefore(node)):(range.setStartAfter(node),range.setEndAfter(node)),range}function isNodesInSameBlock(rootNode,node1,node2){return getParentBlock(node1,rootNode)==getParentBlock(node2,rootNode)}function lean(left,rootNode,node){var sibling,siblingName;for(siblingName=left?"previousSibling":"nextSibling";node&&node!=rootNode;){if(sibling=node[siblingName],isCaretContainer(sibling)&&(sibling=sibling[siblingName]),isContentEditableFalse(sibling)){if(isNodesInSameBlock(rootNode,sibling,node))return sibling;break}if(isCaretCandidate(sibling))break;node=node.parentNode}return null}function isNextToContentEditableFalse(relativeOffset,caretPosition){return isContentEditableFalse(getChildNodeAtRelativeOffset(relativeOffset,caretPosition))}var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isBlockLike=NodeType.matchStyleValues("display","block table table-cell table-caption list-item"),isCaretContainer=CaretContainer.isCaretContainer,isCaretContainerBlock=CaretContainer.isCaretContainerBlock,curry=Fun.curry,isElement=NodeType.isElement,isCaretCandidate=CaretCandidate.isCaretCandidate,before=curry(beforeAfter,!0),after=curry(beforeAfter,!1);return{isForwards:isForwards,isBackwards:isBackwards,findNode:function(node,direction,predicateFn,rootNode,shallow){var walker=new TreeWalker(node,rootNode);if(isBackwards(direction)){if((isContentEditableFalse(node)||isCaretContainerBlock(node))&&(node=skipCaretContainers(walker.prev,!0),predicateFn(node)))return node;for(;node=skipCaretContainers(walker.prev,shallow);)if(predicateFn(node))return node}if(isForwards(direction)){if((isContentEditableFalse(node)||isCaretContainerBlock(node))&&(node=skipCaretContainers(walker.next,!0),predicateFn(node)))return node;for(;node=skipCaretContainers(walker.next,shallow);)if(predicateFn(node))return node}return null},getEditingHost:getEditingHost,getParentBlock:getParentBlock,isInSameBlock:function(caretPosition1,caretPosition2,rootNode){return getParentBlock(caretPosition1.container(),rootNode)==getParentBlock(caretPosition2.container(),rootNode)},isInSameEditingHost:function(caretPosition1,caretPosition2,rootNode){return getEditingHost(caretPosition1.container(),rootNode)==getEditingHost(caretPosition2.container(),rootNode)},isBeforeContentEditableFalse:curry(isNextToContentEditableFalse,0),isAfterContentEditableFalse:curry(isNextToContentEditableFalse,-1),normalizeRange:function(direction,rootNode,range){var node,container,offset,location,leanLeft=curry(lean,!0,rootNode),leanRight=curry(lean,!1,rootNode);if(container=range.startContainer,offset=range.startOffset,CaretContainer.isCaretContainerBlock(container)){if(isElement(container)||(container=container.parentNode),"before"==(location=container.getAttribute("data-mce-caret"))&&(node=container.nextSibling,isContentEditableFalse(node)))return before(node);if("after"==location&&(node=container.previousSibling,isContentEditableFalse(node)))return after(node)}if(!range.collapsed)return range;if(NodeType.isText(container)){if(isCaretContainer(container)){if(1===direction){if(node=leanRight(container))return before(node);if(node=leanLeft(container))return after(node)}if(-1===direction){if(node=leanLeft(container))return after(node);if(node=leanRight(container))return before(node)}return range}if(CaretContainer.endsWithCaretContainer(container)&&offset>=container.data.length-1)return 1===direction&&(node=leanRight(container))?before(node):range;if(CaretContainer.startsWithCaretContainer(container)&&offset<=1)return-1===direction&&(node=leanLeft(container))?after(node):range;if(offset===container.data.length)return(node=leanRight(container))?before(node):range;if(0===offset)return(node=leanLeft(container))?after(node):range}return range}}}),define("tinymce.core.caret.CaretWalker",["tinymce.core.dom.NodeType","tinymce.core.caret.CaretCandidate","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.util.Arr","tinymce.core.util.Fun"],function(NodeType,CaretCandidate,CaretPosition,CaretUtils,Arr,Fun){function getParents(node,rootNode){for(var parents=[];node&&node!=rootNode;)parents.push(node),node=node.parentNode;return parents}function nodeAtIndex(container,offset){return container.hasChildNodes()&&offset<container.childNodes.length?container.childNodes[offset]:null}function getCaretCandidatePosition(direction,node){if(isForwards(direction)){if(isCaretCandidate(node.previousSibling)&&!isText(node.previousSibling))return CaretPosition.before(node);if(isText(node))return CaretPosition(node,0)}if(isBackwards(direction)){if(isCaretCandidate(node.nextSibling)&&!isText(node.nextSibling))return CaretPosition.after(node);if(isText(node))return CaretPosition(node,node.data.length)}return isBackwards(direction)?isBr(node)?CaretPosition.before(node):CaretPosition.after(node):CaretPosition.before(node)}function isBrBeforeBlock(node,rootNode){var next;return!!NodeType.isBr(node)&&(!!(next=findCaretPosition(1,CaretPosition.after(node),rootNode))&&!CaretUtils.isInSameBlock(CaretPosition.before(node),CaretPosition.before(next),rootNode))}function findCaretPosition(direction,startCaretPosition,rootNode){var container,offset,node,nextNode,innerNode,rootContentEditableFalseElm,caretPosition;if(!isElement(rootNode)||!startCaretPosition)return null;if(startCaretPosition.isEqual(CaretPosition.after(rootNode))&&rootNode.lastChild){if(caretPosition=CaretPosition.after(rootNode.lastChild),isBackwards(direction)&&isCaretCandidate(rootNode.lastChild)&&isElement(rootNode.lastChild))return isBr(rootNode.lastChild)?CaretPosition.before(rootNode.lastChild):caretPosition}else caretPosition=startCaretPosition;if(container=caretPosition.container(),offset=caretPosition.offset(),isText(container)){if(isBackwards(direction)&&offset>0)return CaretPosition(container,--offset);if(isForwards(direction)&&offset<container.length)return CaretPosition(container,++offset);node=container}else{if(isBackwards(direction)&&offset>0&&(nextNode=nodeAtIndex(container,offset-1),isCaretCandidate(nextNode)))return!isAtomic(nextNode)&&(innerNode=CaretUtils.findNode(nextNode,direction,isEditableCaretCandidate,nextNode))?isText(innerNode)?CaretPosition(innerNode,innerNode.data.length):CaretPosition.after(innerNode):isText(nextNode)?CaretPosition(nextNode,nextNode.data.length):CaretPosition.before(nextNode);if(isForwards(direction)&&offset<container.childNodes.length&&(nextNode=nodeAtIndex(container,offset),isCaretCandidate(nextNode)))return isBrBeforeBlock(nextNode,rootNode)?findCaretPosition(direction,CaretPosition.after(nextNode),rootNode):!isAtomic(nextNode)&&(innerNode=CaretUtils.findNode(nextNode,direction,isEditableCaretCandidate,nextNode))?isText(innerNode)?CaretPosition(innerNode,0):CaretPosition.before(innerNode):isText(nextNode)?CaretPosition(nextNode,0):CaretPosition.after(nextNode);node=caretPosition.getNode()}return(isForwards(direction)&&caretPosition.isAtEnd()||isBackwards(direction)&&caretPosition.isAtStart())&&(node=CaretUtils.findNode(node,direction,Fun.constant(!0),rootNode,!0),isEditableCaretCandidate(node))?getCaretCandidatePosition(direction,node):(nextNode=CaretUtils.findNode(node,direction,isEditableCaretCandidate,rootNode),!(rootContentEditableFalseElm=Arr.last(Arr.filter(getParents(container,rootNode),isContentEditableFalse)))||nextNode&&rootContentEditableFalseElm.contains(nextNode)?nextNode?getCaretCandidatePosition(direction,nextNode):null:caretPosition=isForwards(direction)?CaretPosition.after(rootContentEditableFalseElm):CaretPosition.before(rootContentEditableFalseElm))}var isContentEditableFalse=NodeType.isContentEditableFalse,isText=NodeType.isText,isElement=NodeType.isElement,isBr=NodeType.isBr,isForwards=CaretUtils.isForwards,isBackwards=CaretUtils.isBackwards,isCaretCandidate=CaretCandidate.isCaretCandidate,isAtomic=CaretCandidate.isAtomic,isEditableCaretCandidate=CaretCandidate.isEditableCaretCandidate;return function(rootNode){return{next:function(caretPosition){return findCaretPosition(1,caretPosition,rootNode)},prev:function(caretPosition){return findCaretPosition(-1,caretPosition,rootNode)}}}}),define("tinymce.core.caret.CaretFinder",["ephox.katamari.api.Fun","ephox.katamari.api.Option","tinymce.core.caret.CaretCandidate","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.caret.CaretWalker","tinymce.core.dom.NodeType"],function(Fun,Option,CaretCandidate,CaretPosition,CaretUtils,CaretWalker,NodeType){var walkToPositionIn=function(forward,rootNode,startNode){var position=forward?CaretPosition.before(startNode):CaretPosition.after(startNode);return fromPosition(forward,rootNode,position)},afterElement=function(node){return NodeType.isBr(node)?CaretPosition.before(node):CaretPosition.after(node)},isBeforeOrStart=function(position){return CaretPosition.isTextPosition(position)?0===position.offset():CaretCandidate.isCaretCandidate(position.getNode())},isAfterOrEnd=function(position){return CaretPosition.isTextPosition(position)?position.offset()===position.container().data.length:CaretCandidate.isCaretCandidate(position.getNode(!0))},isBeforeAfterSameElement=function(from,to){return!CaretPosition.isTextPosition(from)&&!CaretPosition.isTextPosition(to)&&from.getNode()===to.getNode(!0)},isAtBr=function(position){return!CaretPosition.isTextPosition(position)&&NodeType.isBr(position.getNode())},shouldSkipPosition=function(forward,from,to){return forward?!isBeforeAfterSameElement(from,to)&&!isAtBr(from)&&isAfterOrEnd(from)&&isBeforeOrStart(to):!isBeforeAfterSameElement(to,from)&&isBeforeOrStart(from)&&isAfterOrEnd(to)},fromPosition=function(forward,rootNode,position){var walker=new CaretWalker(rootNode);return Option.from(forward?walker.next(position):walker.prev(position))},positionIn=function(forward,element){var startNode=forward?element.firstChild:element.lastChild;return NodeType.isText(startNode)?Option.some(new CaretPosition(startNode,forward?0:startNode.data.length)):startNode?CaretCandidate.isCaretCandidate(startNode)?Option.some(forward?CaretPosition.before(startNode):afterElement(startNode)):walkToPositionIn(forward,element,startNode):Option.none()};return{fromPosition:fromPosition,nextPosition:Fun.curry(fromPosition,!0),prevPosition:Fun.curry(fromPosition,!1),navigate:function(forward,rootNode,from){return fromPosition(forward,rootNode,from).bind(function(to){return CaretUtils.isInSameBlock(from,to,rootNode)&&shouldSkipPosition(forward,from,to)?fromPosition(forward,rootNode,to):Option.some(to)})},positionIn:positionIn,firstPositionIn:Fun.curry(positionIn,!0),lastPositionIn:Fun.curry(positionIn,!1)}}),define("tinymce.core.dom.RangeNormalizer",["tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils"],function(CaretFinder,CaretPosition,CaretUtils){var createRange=function(sc,so,ec,eo){var rng=document.createRange();return rng.setStart(sc,so),rng.setEnd(ec,eo),rng},normalizeBlockSelectionRange=function(rng){var startPos=CaretPosition.fromRangeStart(rng),endPos=CaretPosition.fromRangeEnd(rng),rootNode=rng.commonAncestorContainer;return CaretFinder.fromPosition(!1,rootNode,endPos).map(function(newEndPos){return!CaretUtils.isInSameBlock(startPos,endPos,rootNode)&&CaretUtils.isInSameBlock(startPos,newEndPos,rootNode)?createRange(startPos.container(),startPos.offset(),newEndPos.container(),newEndPos.offset()):rng}).getOr(rng)},normalizeBlockSelection=function(rng){return rng.collapsed?rng:normalizeBlockSelectionRange(rng)};return{normalize:function(rng){return normalizeBlockSelection(rng)}}}),define("global!console",[],function(){return"undefined"==typeof console&&(console={log:function(){}}),console}),defineGlobal("global!document",document),define("ephox.sugar.api.node.Element",["ephox.katamari.api.Fun","global!Error","global!console","global!document"],function(Fun,Error,console,document){var fromDom=function(node){if(null===node||void 0===node)throw new Error("Node cannot be null or undefined");return{dom:Fun.constant(node)}};return{fromHtml:function(html,scope){var div=(scope||document).createElement("div");if(div.innerHTML=html,!div.hasChildNodes()||div.childNodes.length>1)throw console.error("HTML does not have a single root node",html),"HTML must have a single root node";return fromDom(div.childNodes[0])},fromTag:function(tag,scope){var node=(scope||document).createElement(tag);return fromDom(node)},fromText:function(text,scope){var node=(scope||document).createTextNode(text);return fromDom(node)},fromDom:fromDom}}),define("ephox.katamari.api.Type",["global!Array","global!String"],function(Array,String){var typeOf=function(x){if(null===x)return"null";var t=typeof x;return"object"===t&&Array.prototype.isPrototypeOf(x)?"array":"object"===t&&String.prototype.isPrototypeOf(x)?"string":t},isType=function(type){return function(value){return typeOf(value)===type}};return{isString:isType("string"),isObject:isType("object"),isArray:isType("array"),isNull:isType("null"),isBoolean:isType("boolean"),isUndefined:isType("undefined"),isFunction:isType("function"),isNumber:isType("number")}}),define("ephox.katamari.data.Immutable",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","global!Array","global!Error"],function(Arr,Fun,Array,Error){return function(){var fields=arguments;return function(){for(var values=new Array(arguments.length),i=0;i<values.length;i++)values[i]=arguments[i];if(fields.length!==values.length)throw new Error('Wrong number of arguments to struct. Expected "['+fields.length+']", got '+values.length+" arguments");var struct={};return Arr.each(fields,function(name,i){struct[name]=Fun.constant(values[i])}),struct}}}),define("ephox.katamari.api.Obj",["ephox.katamari.api.Option","global!Object"],function(Option,Object){var keys=function(){var fastKeys=Object.keys;return void 0===fastKeys?function(o){var r=[];for(var i in o)o.hasOwnProperty(i)&&r.push(i);return r}:fastKeys}(),each=function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i,obj)}},tupleMap=function(obj,f){var r={};return each(obj,function(x,i){var tuple=f(x,i,obj);r[tuple.k]=tuple.v}),r},mapToArray=function(obj,f){var r=[];return each(obj,function(value,name){r.push(f(value,name))}),r},values=function(obj){return mapToArray(obj,function(v){return v})};return{bifilter:function(obj,pred){var t={},f={};return each(obj,function(x,i){(pred(x,i)?t:f)[i]=x}),{t:t,f:f}},each:each,map:function(obj,f){return tupleMap(obj,function(x,i,obj){return{k:i,v:f(x,i,obj)}})},mapToArray:mapToArray,tupleMap:tupleMap,find:function(obj,pred){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k],x=obj[i];if(pred(x,i,obj))return Option.some(x)}return Option.none()},keys:keys,values:values,size:function(obj){return values(obj).length}}}),define("ephox.katamari.util.BagUtils",["ephox.katamari.api.Arr","ephox.katamari.api.Type","global!Error"],function(Arr,Type,Error){var sort=function(arr){return arr.slice(0).sort()};return{sort:sort,reqMessage:function(required,keys){throw new Error("All required keys ("+sort(required).join(", ")+") were not specified. Specified keys were: "+sort(keys).join(", ")+".")},unsuppMessage:function(unsupported){throw new Error("Unsupported keys for object: "+sort(unsupported).join(", "))},validateStrArr:function(label,array){if(!Type.isArray(array))throw new Error("The "+label+" fields must be an array. Was: "+array+".");Arr.each(array,function(a){if(!Type.isString(a))throw new Error("The value "+a+" in the "+label+" fields was not a string.")})},invalidTypeMessage:function(incorrect,type){throw new Error("All values need to be of type: "+type+". Keys ("+sort(incorrect).join(", ")+") were not.")},checkDupes:function(everything){var sorted=sort(everything);Arr.find(sorted,function(s,i){return i<sorted.length-1&&s===sorted[i+1]}).each(function(d){throw new Error("The field: "+d+" occurs more than once in the combined fields: ["+sorted.join(", ")+"].")})}}}),define("ephox.katamari.data.MixedBag",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Obj","ephox.katamari.api.Option","ephox.katamari.util.BagUtils","global!Error","global!Object"],function(Arr,Fun,Obj,Option,BagUtils,Error,Object){return function(required,optional){var everything=required.concat(optional);if(0===everything.length)throw new Error("You must specify at least one required or optional field.");return BagUtils.validateStrArr("required",required),BagUtils.validateStrArr("optional",optional),BagUtils.checkDupes(everything),function(obj){var keys=Obj.keys(obj);Arr.forall(required,function(req){return Arr.contains(keys,req)})||BagUtils.reqMessage(required,keys);var unsupported=Arr.filter(keys,function(key){return!Arr.contains(everything,key)});unsupported.length>0&&BagUtils.unsuppMessage(unsupported);var r={};return Arr.each(required,function(req){r[req]=Fun.constant(obj[req])}),Arr.each(optional,function(opt){r[opt]=Fun.constant(Object.prototype.hasOwnProperty.call(obj,opt)?Option.some(obj[opt]):Option.none())}),r}}}),define("ephox.katamari.api.Struct",["ephox.katamari.data.Immutable","ephox.katamari.data.MixedBag"],function(Immutable,MixedBag){return{immutable:Immutable,immutableBag:MixedBag}}),define("ephox.sugar.alien.Recurse",[],function(){return{toArray:function(target,f){var r=[],cur=f(target);do{cur=cur.bind(function(e){return r.push(e),f(e)})}while(cur.isSome());return r}}}),define("ephox.katamari.api.Global",[],function(){return"undefined"!=typeof window?window:Function("return this;")()}),define("ephox.katamari.api.Resolve",["ephox.katamari.api.Global"],function(Global){var path=function(parts,scope){for(var o=void 0!==scope?scope:Global,i=0;i<parts.length&&void 0!==o&&null!==o;++i)o=o[parts[i]];return o},step=function(o,part){return void 0!==o[part]&&null!==o[part]||(o[part]={}),o[part]},forge=function(parts,target){for(var o=void 0!==target?target:Global,i=0;i<parts.length;++i)o=step(o,parts[i]);return o};return{path:path,resolve:function(p,scope){var parts=p.split(".");return path(parts,scope)},forge:forge,namespace:function(name,target){var parts=name.split(".");return forge(parts,target)}}}),define("ephox.sand.util.Global",["ephox.katamari.api.Resolve"],function(Resolve){var unsafe=function(name,scope){return Resolve.resolve(name,scope)};return{getOrDie:function(name,scope){var actual=unsafe(name,scope);if(void 0===actual)throw name+" not available on this browser";return actual}}}),define("ephox.sand.api.Node",["ephox.sand.util.Global"],function(Global){var node=function(){return Global.getOrDie("Node")},compareDocumentPosition=function(a,b,match){return 0!=(a.compareDocumentPosition(b)&match)};return{documentPositionPreceding:function(a,b){return compareDocumentPosition(a,b,node().DOCUMENT_POSITION_PRECEDING)},documentPositionContainedBy:function(a,b){return compareDocumentPosition(a,b,node().DOCUMENT_POSITION_CONTAINED_BY)}}}),define("ephox.katamari.api.Thunk",[],function(){return{cached:function(f){var r,called=!1;return function(){return called||(called=!0,r=f.apply(null,arguments)),r}}}}),defineGlobal("global!Number",Number),define("ephox.sand.detect.Version",["ephox.katamari.api.Arr","global!Number","global!String"],function(Arr,Number,String){var firstMatch=function(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s))return x}},find=function(regexes,agent){var r=firstMatch(regexes,agent);if(!r)return{major:0,minor:0};var group=function(i){return Number(agent.replace(r,"$"+i))};return nu(group(1),group(2))},unknown=function(){return nu(0,0)},nu=function(major,minor){return{major:major,minor:minor}};return{nu:nu,detect:function(versionRegexes,agent){var cleanedAgent=String(agent).toLowerCase();return 0===versionRegexes.length?unknown():find(versionRegexes,cleanedAgent)},unknown:unknown}}),define("ephox.sand.core.Browser",["ephox.katamari.api.Fun","ephox.sand.detect.Version"],function(Fun,Version){var isBrowser=function(name,current){return function(){return current===name}},nu=function(info){var current=info.current;return{current:current,version:info.version,isEdge:isBrowser("Edge",current),isChrome:isBrowser("Chrome",current),isIE:isBrowser("IE",current),isOpera:isBrowser("Opera",current),isFirefox:isBrowser("Firefox",current),isSafari:isBrowser("Safari",current)}};return{unknown:function(){return nu({current:void 0,version:Version.unknown()})},nu:nu,edge:Fun.constant("Edge"),chrome:Fun.constant("Chrome"),ie:Fun.constant("IE"),opera:Fun.constant("Opera"),firefox:Fun.constant("Firefox"),safari:Fun.constant("Safari")}}),define("ephox.sand.core.OperatingSystem",["ephox.katamari.api.Fun","ephox.sand.detect.Version"],function(Fun,Version){var isOS=function(name,current){return function(){return current===name}},nu=function(info){var current=info.current;return{current:current,version:info.version,isWindows:isOS("Windows",current),isiOS:isOS("iOS",current),isAndroid:isOS("Android",current),isOSX:isOS("OSX",current),isLinux:isOS("Linux",current),isSolaris:isOS("Solaris",current),isFreeBSD:isOS("FreeBSD",current)}};return{unknown:function(){return nu({current:void 0,version:Version.unknown()})},nu:nu,windows:Fun.constant("Windows"),ios:Fun.constant("iOS"),android:Fun.constant("Android"),linux:Fun.constant("Linux"),osx:Fun.constant("OSX"),solaris:Fun.constant("Solaris"),freebsd:Fun.constant("FreeBSD")}}),define("ephox.sand.detect.DeviceType",["ephox.katamari.api.Fun"],function(Fun){return function(os,browser,userAgent){var isiPad=os.isiOS()&&!0===/ipad/i.test(userAgent),isiPhone=os.isiOS()&&!isiPad,isAndroid3=os.isAndroid()&&3===os.version.major,isAndroid4=os.isAndroid()&&4===os.version.major,isTablet=isiPad||isAndroid3||isAndroid4&&!0===/mobile/i.test(userAgent),isTouch=os.isiOS()||os.isAndroid(),isPhone=isTouch&&!isTablet,iOSwebview=browser.isSafari()&&os.isiOS()&&!1===/safari/i.test(userAgent);return{isiPad:Fun.constant(isiPad),isiPhone:Fun.constant(isiPhone),isTablet:Fun.constant(isTablet),isPhone:Fun.constant(isPhone),isTouch:Fun.constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:Fun.constant(iOSwebview)}}}),define("ephox.sand.detect.UaString",["ephox.katamari.api.Arr","ephox.sand.detect.Version","global!String"],function(Arr,Version,String){var detect=function(candidates,userAgent){var agent=String(userAgent).toLowerCase();return Arr.find(candidates,function(candidate){return candidate.search(agent)})};return{detectBrowser:function(browsers,userAgent){return detect(browsers,userAgent).map(function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version}})},detectOs:function(oses,userAgent){return detect(oses,userAgent).map(function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version}})}}}),define("ephox.katamari.str.StrAppend",[],function(){return{addToStart:function(str,prefix){return prefix+str},addToEnd:function(str,suffix){return str+suffix},removeFromStart:function(str,numChars){return str.substring(numChars)},removeFromEnd:function(str,numChars){return str.substring(0,str.length-numChars)}}}),define("ephox.katamari.str.StringParts",["ephox.katamari.api.Option","global!Error"],function(Option,Error){return{first:function(str,count){return str.substr(0,count)},last:function(str,count){return str.substr(str.length-count,str.length)},head:function(str){return""===str?Option.none():Option.some(str.substr(0,1))},tail:function(str){return""===str?Option.none():Option.some(str.substring(1))}}}),define("ephox.katamari.api.Strings",["ephox.katamari.str.StrAppend","ephox.katamari.str.StringParts","global!Error"],function(StrAppend,StringParts,Error){var checkRange=function(str,substr,start){return""===substr||!(str.length<substr.length)&&str.substr(start,start+substr.length)===substr},startsWith=function(str,prefix){return checkRange(str,prefix,0)},endsWith=function(str,suffix){return checkRange(str,suffix,str.length-suffix.length)};return{supplant:function(str,obj){var isStringOrNumber=function(a){var t=typeof a;return"string"===t||"number"===t};return str.replace(/\${([^{}]*)}/g,function(a,b){var value=obj[b];return isStringOrNumber(value)?value:a})},startsWith:startsWith,removeLeading:function(str,prefix){return startsWith(str,prefix)?StrAppend.removeFromStart(str,prefix.length):str},removeTrailing:function(str,prefix){return endsWith(str,prefix)?StrAppend.removeFromEnd(str,prefix.length):str},ensureLeading:function(str,prefix){return startsWith(str,prefix)?str:StrAppend.addToStart(str,prefix)},ensureTrailing:function(str,prefix){return endsWith(str,prefix)?str:StrAppend.addToEnd(str,prefix)},endsWith:endsWith,contains:function(str,substr){return-1!==str.indexOf(substr)},trim:function(str){return str.replace(/^\s+|\s+$/g,"")},lTrim:function(str){return str.replace(/^\s+/g,"")},rTrim:function(str){return str.replace(/\s+$/g,"")},capitalize:function(str){return StringParts.head(str).bind(function(head){return StringParts.tail(str).map(function(tail){return head.toUpperCase()+tail})}).getOr(str)}}}),define("ephox.sand.info.PlatformInfo",["ephox.katamari.api.Fun","ephox.katamari.api.Strings"],function(Fun,Strings){var normalVersionRegex=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,checkContains=function(target){return function(uastring){return Strings.contains(uastring,target)}},browsers=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(uastring){return Strings.contains(uastring,"edge/")&&Strings.contains(uastring,"chrome")&&Strings.contains(uastring,"safari")&&Strings.contains(uastring,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,normalVersionRegex],search:function(uastring){return Strings.contains(uastring,"chrome")&&!Strings.contains(uastring,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(uastring){return Strings.contains(uastring,"msie")||Strings.contains(uastring,"trident")}},{name:"Opera",versionRegexes:[normalVersionRegex,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains("firefox")},{name:"Safari",versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(uastring){return(Strings.contains(uastring,"safari")||Strings.contains(uastring,"mobile/"))&&Strings.contains(uastring,"applewebkit")}}],oses=[{name:"Windows",search:checkContains("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(uastring){return Strings.contains(uastring,"iphone")||Strings.contains(uastring,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:checkContains("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:checkContains("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:checkContains("linux"),versionRegexes:[]},{name:"Solaris",search:checkContains("sunos"),versionRegexes:[]},{name:"FreeBSD",search:checkContains("freebsd"),versionRegexes:[]}];return{browsers:Fun.constant(browsers),oses:Fun.constant(oses)}}),define("ephox.sand.core.PlatformDetection",["ephox.sand.core.Browser","ephox.sand.core.OperatingSystem","ephox.sand.detect.DeviceType","ephox.sand.detect.UaString","ephox.sand.info.PlatformInfo"],function(Browser,OperatingSystem,DeviceType,UaString,PlatformInfo){return{detect:function(userAgent){var browsers=PlatformInfo.browsers(),oses=PlatformInfo.oses(),browser=UaString.detectBrowser(browsers,userAgent).fold(Browser.unknown,Browser.nu),os=UaString.detectOs(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu);return{browser:browser,os:os,deviceType:DeviceType(os,browser,userAgent)}}}}),defineGlobal("global!navigator",navigator),define("ephox.sand.api.PlatformDetection",["ephox.katamari.api.Thunk","ephox.sand.core.PlatformDetection","global!navigator"],function(Thunk,PlatformDetection,navigator){return{detect:Thunk.cached(function(){var userAgent=navigator.userAgent;return PlatformDetection.detect(userAgent)})}}),define("ephox.sugar.api.node.NodeTypes",[],function(){return{ATTRIBUTE:2,CDATA_SECTION:4,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,ELEMENT:1,TEXT:3,PROCESSING_INSTRUCTION:7,ENTITY_REFERENCE:5,ENTITY:6,NOTATION:12}}),define("ephox.sugar.api.search.Selectors",["ephox.katamari.api.Arr","ephox.katamari.api.Option","ephox.sugar.api.node.Element","ephox.sugar.api.node.NodeTypes","global!Error","global!document"],function(Arr,Option,Element,NodeTypes,Error,document){var selectorType=function(){var test=document.createElement("span");return void 0!==test.matches?0:void 0!==test.msMatchesSelector?1:void 0!==test.webkitMatchesSelector?2:void 0!==test.mozMatchesSelector?3:-1}(),ELEMENT=NodeTypes.ELEMENT,DOCUMENT=NodeTypes.DOCUMENT,bypassSelector=function(dom){return dom.nodeType!==ELEMENT&&dom.nodeType!==DOCUMENT||0===dom.childElementCount};return{all:function(selector,scope){var base=void 0===scope?document:scope.dom();return bypassSelector(base)?[]:Arr.map(base.querySelectorAll(selector),Element.fromDom)},is:function(element,selector){var elem=element.dom();if(elem.nodeType!==ELEMENT)return!1;if(0===selectorType)return elem.matches(selector);if(1===selectorType)return elem.msMatchesSelector(selector);if(2===selectorType)return elem.webkitMatchesSelector(selector);if(3===selectorType)return elem.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")},one:function(selector,scope){var base=void 0===scope?document:scope.dom();return bypassSelector(base)?Option.none():Option.from(base.querySelector(selector)).map(Element.fromDom)}}}),define("ephox.sugar.api.dom.Compare",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.sand.api.Node","ephox.sand.api.PlatformDetection","ephox.sugar.api.search.Selectors"],function(Arr,Fun,Node,PlatformDetection,Selectors){var eq=function(e1,e2){return e1.dom()===e2.dom()},contains=PlatformDetection.detect().browser.isIE()?function(e1,e2){return Node.documentPositionContainedBy(e1.dom(),e2.dom())}:function(e1,e2){var d1=e1.dom(),d2=e2.dom();return d1!==d2&&d1.contains(d2)};return{eq:eq,isEqualNode:function(e1,e2){return e1.dom().isEqualNode(e2.dom())},member:function(element,elements){return Arr.exists(elements,Fun.curry(eq,element))},contains:contains,is:Selectors.is}}),define("ephox.sugar.api.search.Traverse",["ephox.katamari.api.Type","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Struct","ephox.sugar.alien.Recurse","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element"],function(Type,Arr,Fun,Option,Struct,Recurse,Compare,Element){var owner=function(element){return Element.fromDom(element.dom().ownerDocument)},parent=function(element){var dom=element.dom();return Option.from(dom.parentNode).map(Element.fromDom)},prevSibling=function(element){var dom=element.dom();return Option.from(dom.previousSibling).map(Element.fromDom)},nextSibling=function(element){var dom=element.dom();return Option.from(dom.nextSibling).map(Element.fromDom)},children=function(element){var dom=element.dom();return Arr.map(dom.childNodes,Element.fromDom)},child=function(element,index){var children=element.dom().childNodes;return Option.from(children[index]).map(Element.fromDom)},spot=Struct.immutable("element","offset");return{owner:owner,defaultView:function(element){var defaultView=element.dom().ownerDocument.defaultView;return Element.fromDom(defaultView)},documentElement:function(element){var doc=owner(element);return Element.fromDom(doc.dom().documentElement)},parent:parent,findIndex:function(element){return parent(element).bind(function(p){var kin=children(p);return Arr.findIndex(kin,function(elem){return Compare.eq(element,elem)})})},parents:function(element,isRoot){for(var stop=Type.isFunction(isRoot)?isRoot:Fun.constant(!1),dom=element.dom(),ret=[];null!==dom.parentNode&&void 0!==dom.parentNode;){var rawParent=dom.parentNode,parent=Element.fromDom(rawParent);if(ret.push(parent),!0===stop(parent))break;dom=rawParent}return ret},siblings:function(element){return parent(element).map(children).map(function(elements){return Arr.filter(elements,function(x){return!Compare.eq(element,x)})}).getOr([])},prevSibling:prevSibling,offsetParent:function(element){var dom=element.dom();return Option.from(dom.offsetParent).map(Element.fromDom)},prevSiblings:function(element){return Arr.reverse(Recurse.toArray(element,prevSibling))},nextSibling:nextSibling,nextSiblings:function(element){return Recurse.toArray(element,nextSibling)},children:children,child:child,firstChild:function(element){return child(element,0)},lastChild:function(element){return child(element,element.dom().childNodes.length-1)},leaf:function(element,offset){var cs=children(element);return cs.length>0&&offset<cs.length?spot(cs[offset],0):spot(element,offset)}}}),define("ephox.sugar.api.dom.Insert",["ephox.sugar.api.search.Traverse"],function(Traverse){var before=function(marker,element){Traverse.parent(marker).each(function(v){v.dom().insertBefore(element.dom(),marker.dom())})},append=function(parent,element){parent.dom().appendChild(element.dom())};return{before:before,after:function(marker,element){Traverse.nextSibling(marker).fold(function(){Traverse.parent(marker).each(function(v){append(v,element)})},function(v){before(v,element)})},prepend:function(parent,element){Traverse.firstChild(parent).fold(function(){append(parent,element)},function(v){parent.dom().insertBefore(element.dom(),v.dom())})},append:append,appendAt:function(parent,element,index){Traverse.child(parent,index).fold(function(){append(parent,element)},function(v){before(v,element)})},wrap:function(element,wrapper){before(element,wrapper),append(wrapper,element)}}}),define("ephox.sugar.api.dom.InsertAll",["ephox.katamari.api.Arr","ephox.sugar.api.dom.Insert"],function(Arr,Insert){return{before:function(marker,elements){Arr.each(elements,function(x){Insert.before(marker,x)})},after:function(marker,elements){Arr.each(elements,function(x,i){var e=0===i?marker:elements[i-1];Insert.after(e,x)})},prepend:function(parent,elements){Arr.each(elements.slice().reverse(),function(x){Insert.prepend(parent,x)})},append:function(parent,elements){Arr.each(elements,function(x){Insert.append(parent,x)})}}}),define("ephox.sugar.api.dom.Remove",["ephox.katamari.api.Arr","ephox.sugar.api.dom.InsertAll","ephox.sugar.api.search.Traverse"],function(Arr,InsertAll,Traverse){var remove=function(element){var dom=element.dom();null!==dom.parentNode&&dom.parentNode.removeChild(dom)};return{empty:function(element){element.dom().textContent="",Arr.each(Traverse.children(element),function(rogue){remove(rogue)})},remove:remove,unwrap:function(wrapper){var children=Traverse.children(wrapper);children.length>0&&InsertAll.before(wrapper,children),remove(wrapper)}}}),define("ephox.sugar.api.node.Node",["ephox.sugar.api.node.NodeTypes"],function(NodeTypes){var name=function(element){return element.dom().nodeName.toLowerCase()},type=function(element){return element.dom().nodeType},isType=function(t){return function(element){return type(element)===t}},isElement=isType(NodeTypes.ELEMENT),isText=isType(NodeTypes.TEXT),isDocument=isType(NodeTypes.DOCUMENT);return{name:name,type:type,value:function(element){return element.dom().nodeValue},isElement:isElement,isText:isText,isDocument:isDocument,isComment:function(element){return type(element)===NodeTypes.COMMENT||"#comment"===name(element)}}}),define("ephox.sugar.api.node.Body",["ephox.katamari.api.Thunk","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","global!document"],function(Thunk,Element,Node,document){var body=Thunk.cached(function(){return getBody(Element.fromDom(document))}),getBody=function(doc){var body=doc.dom().body;if(null===body||void 0===body)throw"Body is not available yet";return Element.fromDom(body)};return{body:body,getBody:getBody,inBody:function(element){var dom=Node.isText(element)?element.dom().parentNode:element.dom();return void 0!==dom&&null!==dom&&dom.ownerDocument.body.contains(dom)}}}),define("ephox.sugar.api.search.PredicateFilter",["ephox.katamari.api.Arr","ephox.sugar.api.node.Body","ephox.sugar.api.search.Traverse"],function(Arr,Body,Traverse){var descendants=function(scope,predicate){var result=[];return Arr.each(Traverse.children(scope),function(x){predicate(x)&&(result=result.concat([x])),result=result.concat(descendants(x,predicate))}),result};return{all:function(predicate){return descendants(Body.body(),predicate)},ancestors:function(scope,predicate,isRoot){return Arr.filter(Traverse.parents(scope,isRoot),predicate)},siblings:function(scope,predicate){return Arr.filter(Traverse.siblings(scope),predicate)},children:function(scope,predicate){return Arr.filter(Traverse.children(scope),predicate)},descendants:descendants}}),define("ephox.sugar.api.search.SelectorFilter",["ephox.sugar.api.search.PredicateFilter","ephox.sugar.api.search.Selectors"],function(PredicateFilter,Selectors){return{all:function(selector){return Selectors.all(selector)},ancestors:function(scope,selector,isRoot){return PredicateFilter.ancestors(scope,function(e){return Selectors.is(e,selector)},isRoot)},siblings:function(scope,selector){return PredicateFilter.siblings(scope,function(e){return Selectors.is(e,selector)})},children:function(scope,selector){return PredicateFilter.children(scope,function(e){return Selectors.is(e,selector)})},descendants:function(scope,selector){return Selectors.all(selector,scope)}}}),define("tinymce.core.dom.ElementType",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.sugar.api.node.Node"],function(Arr,Fun,Node){var blocks=["article","aside","details","div","dt","figcaption","footer","form","fieldset","header","hgroup","html","main","nav","section","summary","body","p","dl","multicol","dd","figure","address","center","blockquote","h1","h2","h3","h4","h5","h6","listing","xmp","pre","plaintext","menu","dir","ul","ol","li","hr","table","tbody","thead","tfoot","th","tr","td","caption"],voids=["area","base","basefont","br","col","frame","hr","img","input","isindex","link","meta","param","embed","source","wbr","track"],tableCells=["td","th"],textBlocks=["h1","h2","h3","h4","h5","h6","p","div","address","pre","form","blockquote","center","dir","fieldset","header","footer","article","section","hgroup","aside","nav","figure"],listItems=["li","dd","dt"],lazyLookup=function(items){var lookup;return function(node){return(lookup=lookup||Arr.mapToObject(items,Fun.constant(!0))).hasOwnProperty(Node.name(node))}},isHeading=lazyLookup(["h1","h2","h3","h4","h5","h6"]),isBlock=lazyLookup(blocks);return{isBlock:isBlock,isInline:function(node){return Node.isElement(node)&&!isBlock(node)},isHeading:isHeading,isTextBlock:lazyLookup(textBlocks),isListItem:lazyLookup(listItems),isVoid:lazyLookup(voids),isTableCell:lazyLookup(tableCells),isBr:function(node){return Node.isElement(node)&&"br"===Node.name(node)}}}),define("tinymce.core.dom.PaddingBr",["ephox.katamari.api.Arr","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.Remove","ephox.sugar.api.node.Element","ephox.sugar.api.search.SelectorFilter","tinymce.core.dom.ElementType"],function(Arr,Insert,Remove,Element,SelectorFilter,ElementType){var getLastChildren=function(elm){for(var children=[],rawNode=elm.dom();rawNode;)children.push(Element.fromDom(rawNode)),rawNode=rawNode.lastChild;return children};return{removeTrailingBr:function(elm){var allBrs=SelectorFilter.descendants(elm,"br"),brs=Arr.filter(getLastChildren(elm).slice(-1),ElementType.isBr);allBrs.length===brs.length&&Arr.each(brs,Remove.remove)},fillWithPaddingBr:function(elm){Remove.empty(elm),Insert.append(elm,Element.fromHtml('<br data-mce-bogus="1">'))}}}),define("tinymce.core.fmt.FormatUtils",["tinymce.core.dom.TreeWalker"],function(TreeWalker){var isInlineBlock=function(node){return node&&/^(IMG)$/.test(node.nodeName)},isWhiteSpaceNode=function(node){return node&&3===node.nodeType&&/^([\t \r\n]+|)$/.test(node.nodeValue)},normalizeStyleValue=function(dom,value,name){return"color"!==name&&"backgroundColor"!==name||(value=dom.toHex(value)),"fontWeight"===name&&700===value&&(value="bold"),"fontFamily"===name&&(value=value.replace(/[\'\"]/g,"").replace(/,\s+/g,",")),""+value};return{isInlineBlock:isInlineBlock,moveStart:function(dom,selection,rng){var walker,node,nodes,container=rng.startContainer,offset=rng.startOffset;if((rng.startContainer!==rng.endContainer||!isInlineBlock(rng.startContainer.childNodes[rng.startOffset]))&&(3===container.nodeType&&offset>=container.nodeValue.length&&(offset=dom.nodeIndex(container),container=container.parentNode),1===container.nodeType))for(offset<(nodes=container.childNodes).length?(container=nodes[offset],walker=new TreeWalker(container,dom.getParent(container,dom.isBlock))):(container=nodes[nodes.length-1],(walker=new TreeWalker(container,dom.getParent(container,dom.isBlock))).next(!0)),node=walker.current();node;node=walker.next())if(3===node.nodeType&&!isWhiteSpaceNode(node))return rng.setStart(node,0),void selection.setRng(rng)},getNonWhiteSpaceSibling:function(node,next,inc){if(node)for(next=next?"nextSibling":"previousSibling",node=inc?node:node[next];node;node=node[next])if(1===node.nodeType||!isWhiteSpaceNode(node))return node},isTextBlock:function(editor,name){return name.nodeType&&(name=name.nodeName),!!editor.schema.getTextBlockElements()[name.toLowerCase()]},isValid:function(ed,parent,child){return ed.schema.isValidChild(parent,child)},isWhiteSpaceNode:isWhiteSpaceNode,replaceVars:function(value,vars){return"string"!=typeof value?value=value(vars):vars&&(value=value.replace(/%(\w+)/g,function(str,name){return vars[name]||str})),value},isEq:function(str1,str2){return str1=str1||"",str2=str2||"",str1=""+(str1.nodeName||str1),str2=""+(str2.nodeName||str2),str1.toLowerCase()===str2.toLowerCase()},normalizeStyleValue:normalizeStyleValue,getStyle:function(dom,node,name){return normalizeStyleValue(dom,dom.getStyle(node,name),name)},getTextDecoration:function(dom,node){var decoration;return dom.getParent(node,function(n){return(decoration=dom.getStyle(n,"text-decoration"))&&"none"!==decoration}),decoration},getParents:function(dom,node,selector){return dom.getParents(node,selector,dom.getRoot())}}}),define("tinymce.core.fmt.ExpandRange",["tinymce.core.dom.BookmarkManager","tinymce.core.dom.TreeWalker","tinymce.core.fmt.FormatUtils"],function(BookmarkManager,TreeWalker,FormatUtils){var isBookmarkNode=BookmarkManager.isBookmarkNode,getParents=FormatUtils.getParents,isWhiteSpaceNode=FormatUtils.isWhiteSpaceNode,isTextBlock=FormatUtils.isTextBlock,findLeaf=function(node,offset){for(void 0===offset&&(offset=3===node.nodeType?node.length:node.childNodes.length);node&&node.hasChildNodes();)(node=node.childNodes[offset])&&(offset=3===node.nodeType?node.length:node.childNodes.length);return{node:node,offset:offset}},excludeTrailingWhitespace=function(endContainer,endOffset){var leaf=findLeaf(endContainer,endOffset);if(leaf.node){for(;leaf.node&&0===leaf.offset&&leaf.node.previousSibling;)leaf=findLeaf(leaf.node.previousSibling);leaf.node&&leaf.offset>0&&3===leaf.node.nodeType&&" "===leaf.node.nodeValue.charAt(leaf.offset-1)&&leaf.offset>1&&(endContainer=leaf.node).splitText(leaf.offset-1)}return endContainer},isBogusBr=function(node){return"BR"===node.nodeName&&node.getAttribute("data-mce-bogus")&&!node.nextSibling};return{expandRng:function(editor,rng,format,remove){var lastIdx,endPoint,startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,dom=editor.dom,findParentContainer=function(start){var container,parent,sibling,siblingName,root;if(container=parent=start?startContainer:endContainer,siblingName=start?"previousSibling":"nextSibling",root=dom.getRoot(),3===container.nodeType&&!isWhiteSpaceNode(container)&&(start?startOffset>0:endOffset<container.nodeValue.length))return container;for(;;){if(!format[0].block_expand&&dom.isBlock(parent))return parent;for(sibling=parent[siblingName];sibling;sibling=sibling[siblingName])if(!isBookmarkNode(sibling)&&!isWhiteSpaceNode(sibling)&&!isBogusBr(sibling))return parent;if(parent===root||parent.parentNode===root){container=parent;break}parent=parent.parentNode}return container};1===startContainer.nodeType&&startContainer.hasChildNodes()&&(lastIdx=startContainer.childNodes.length-1,3===(startContainer=startContainer.childNodes[startOffset>lastIdx?lastIdx:startOffset]).nodeType&&(startOffset=0)),1===endContainer.nodeType&&endContainer.hasChildNodes()&&(lastIdx=endContainer.childNodes.length-1,3===(endContainer=endContainer.childNodes[endOffset>lastIdx?lastIdx:endOffset-1]).nodeType&&(endOffset=endContainer.nodeValue.length));var findParentContentEditable=function(node){for(var parent=node;parent;){if(1===parent.nodeType&&dom.getContentEditable(parent))return"false"===dom.getContentEditable(parent)?parent:node;parent=parent.parentNode}return node},findWordEndPoint=function(container,offset,start){var walker,node,pos,lastTextNode,findSpace=function(node,offset){var pos,pos2,str=node.nodeValue;return void 0===offset&&(offset=start?str.length:0),start?-1===(pos=(pos=str.lastIndexOf(" ",offset))>(pos2=str.lastIndexOf("",offset))?pos:pos2)||remove||pos++:(pos=str.indexOf(" ",offset),pos2=str.indexOf("",offset),pos=-1!==pos&&(-1===pos2||pos<pos2)?pos:pos2),pos};if(3===container.nodeType){if(-1!==(pos=findSpace(container,offset)))return{container:container,offset:pos};lastTextNode=container}for(walker=new TreeWalker(container,dom.getParent(container,dom.isBlock)||editor.getBody());node=walker[start?"prev":"next"]();)if(3===node.nodeType){if(lastTextNode=node,-1!==(pos=findSpace(node)))return{container:node,offset:pos}}else if(dom.isBlock(node))break;if(lastTextNode)return offset=start?0:lastTextNode.length,{container:lastTextNode,offset:offset}},findSelectorEndPoint=function(container,siblingName){var parents,i,y,curFormat;for(3===container.nodeType&&0===container.nodeValue.length&&container[siblingName]&&(container=container[siblingName]),parents=getParents(dom,container),i=0;i<parents.length;i++)for(y=0;y<format.length;y++)if(!("collapsed"in(curFormat=format[y])&&curFormat.collapsed!==rng.collapsed)&&dom.is(parents[i],curFormat.selector))return parents[i];return container},findBlockEndPoint=function(container,siblingName){var node,root=dom.getRoot();if(format[0].wrapper||(node=dom.getParent(container,format[0].block,root)),!node){var scopeRoot=dom.getParent(container,"LI,TD,TH");node=dom.getParent(3===container.nodeType?container.parentNode:container,function(node){return node!==root&&isTextBlock(editor,node)},scopeRoot)}if(node&&format[0].wrapper&&(node=getParents(dom,node,"ul,ol").reverse()[0]||node),!node)for(node=container;node[siblingName]&&!dom.isBlock(node[siblingName])&&(node=node[siblingName],!FormatUtils.isEq(node,"br")););return node||container};return startContainer=findParentContentEditable(startContainer),endContainer=findParentContentEditable(endContainer),(isBookmarkNode(startContainer.parentNode)||isBookmarkNode(startContainer))&&(startContainer=isBookmarkNode(startContainer)?startContainer:startContainer.parentNode,3===(startContainer=startContainer.nextSibling||startContainer).nodeType&&(startOffset=0)),(isBookmarkNode(endContainer.parentNode)||isBookmarkNode(endContainer))&&(endContainer=isBookmarkNode(endContainer)?endContainer:endContainer.parentNode,3===(endContainer=endContainer.previousSibling||endContainer).nodeType&&(endOffset=endContainer.length)),format[0].inline&&(rng.collapsed&&((endPoint=findWordEndPoint(startContainer,startOffset,!0))&&(startContainer=endPoint.container,startOffset=endPoint.offset),(endPoint=findWordEndPoint(endContainer,endOffset))&&(endContainer=endPoint.container,endOffset=endPoint.offset)),endContainer=remove?endContainer:excludeTrailingWhitespace(endContainer,endOffset)),(format[0].inline||format[0].block_expand)&&(format[0].inline&&3===startContainer.nodeType&&0!==startOffset||(startContainer=findParentContainer(!0)),format[0].inline&&3===endContainer.nodeType&&endOffset!==endContainer.nodeValue.length||(endContainer=findParentContainer())),format[0].selector&&!1!==format[0].expand&&!format[0].inline&&(startContainer=findSelectorEndPoint(startContainer,"previousSibling"),endContainer=findSelectorEndPoint(endContainer,"nextSibling")),(format[0].block||format[0].selector)&&(startContainer=findBlockEndPoint(startContainer,"previousSibling"),endContainer=findBlockEndPoint(endContainer,"nextSibling"),format[0].block&&(dom.isBlock(startContainer)||(startContainer=findParentContainer(!0)),dom.isBlock(endContainer)||(endContainer=findParentContainer()))),1===startContainer.nodeType&&(startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode),1===endContainer.nodeType&&(endOffset=dom.nodeIndex(endContainer)+1,endContainer=endContainer.parentNode),{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset}}}}),define("tinymce.core.fmt.MatchFormat",["tinymce.core.fmt.FormatUtils"],function(FormatUtils){var isEq=FormatUtils.isEq,matchesUnInheritedFormatSelector=function(ed,node,name){var formatList=ed.formatter.get(name);if(formatList)for(var i=0;i<formatList.length;i++)if(!1===formatList[i].inherit&&ed.dom.is(node,formatList[i].selector))return!0;return!1},matchParents=function(editor,node,name,vars){var root=editor.dom.getRoot();return node!==root&&(node=editor.dom.getParent(node,function(node){return!!matchesUnInheritedFormatSelector(editor,node,name)||(node.parentNode===root||!!matchNode(editor,node,name,vars,!0))}),matchNode(editor,node,name,vars))},matchName=function(dom,node,format){return!!isEq(node,format.inline)||(!!isEq(node,format.block)||(format.selector?1===node.nodeType&&dom.is(node,format.selector):void 0))},matchItems=function(dom,node,format,itemName,similar,vars){var key,value,i,items=format[itemName];if(format.onmatch)return format.onmatch(node,format,itemName);if(items)if(void 0===items.length){for(key in items)if(items.hasOwnProperty(key)){if(value="attributes"===itemName?dom.getAttrib(node,key):FormatUtils.getStyle(dom,node,key),similar&&!value&&!format.exact)return;if((!similar||format.exact)&&!isEq(value,FormatUtils.normalizeStyleValue(dom,FormatUtils.replaceVars(items[key],vars),key)))return}}else for(i=0;i<items.length;i++)if("attributes"===itemName?dom.getAttrib(node,items[i]):FormatUtils.getStyle(dom,node,items[i]))return format;return format},matchNode=function(ed,node,name,vars,similar){var format,i,x,classes,formatList=ed.formatter.get(name),dom=ed.dom;if(formatList&&node)for(i=0;i<formatList.length;i++)if(format=formatList[i],matchName(ed.dom,node,format)&&matchItems(dom,node,format,"attributes",similar,vars)&&matchItems(dom,node,format,"styles",similar,vars)){if(classes=format.classes)for(x=0;x<classes.length;x++)if(!ed.dom.hasClass(node,classes[x]))return;return format}};return{matchNode:matchNode,matchName:matchName,match:function(editor,name,vars,node){var startNode;return node?matchParents(editor,node,name,vars):(node=editor.selection.getNode(),!!matchParents(editor,node,name,vars)||!((startNode=editor.selection.getStart())===node||!matchParents(editor,startNode,name,vars)))},matchAll:function(editor,names,vars){var startElement,matchedFormatNames=[],checkedMap={};return startElement=editor.selection.getStart(),editor.dom.getParent(startElement,function(node){var i,name;for(i=0;i<names.length;i++)name=names[i],!checkedMap[name]&&matchNode(editor,node,name,vars)&&(checkedMap[name]=!0,matchedFormatNames.push(name))},editor.dom.getRoot()),matchedFormatNames},canApply:function(editor,name){var startNode,parents,i,x,selector,formatList=editor.formatter.get(name),dom=editor.dom;if(formatList)for(startNode=editor.selection.getStart(),parents=FormatUtils.getParents(dom,startNode),x=formatList.length-1;x>=0;x--){if(!(selector=formatList[x].selector)||formatList[x].defaultBlock)return!0;for(i=parents.length-1;i>=0;i--)if(dom.is(parents[i],selector))return!0}return!1},matchesUnInheritedFormatSelector:matchesUnInheritedFormatSelector}}),define("tinymce.core.fmt.CaretFormat",["ephox.katamari.api.Arr","ephox.sugar.api.node.Element","tinymce.core.dom.PaddingBr","tinymce.core.dom.RangeUtils","tinymce.core.dom.TreeWalker","tinymce.core.fmt.ExpandRange","tinymce.core.fmt.FormatUtils","tinymce.core.fmt.MatchFormat","tinymce.core.text.Zwsp","tinymce.core.util.Fun","tinymce.core.util.Tools"],function(Arr,Element,PaddingBr,RangeUtils,TreeWalker,ExpandRange,FormatUtils,MatchFormat,Zwsp,Fun,Tools){var ZWSP=Zwsp.ZWSP,isCaretContainerEmpty=function(node,nodes){for(;node;){if(3===node.nodeType&&node.nodeValue!==ZWSP||node.childNodes.length>1)return!1;nodes&&1===node.nodeType&&nodes.push(node),node=node.firstChild}return!0},findFirstTextNode=function(node){var walker;if(node)for(node=(walker=new TreeWalker(node,node)).current();node;node=walker.next())if(3===node.nodeType)return node;return null},createCaretContainer=function(dom,fill){var caretContainer=dom.create("span",{id:"_mce_caret","data-mce-bogus":"1",style:""});return fill&&caretContainer.appendChild(dom.doc.createTextNode(ZWSP)),caretContainer},getParentCaretContainer=function(node){for(;node;){if("_mce_caret"===node.id)return node;node=node.parentNode}},unmarkBogusCaretParents=function(dom,selection){var caretContainer;(caretContainer=getParentCaretContainer(selection.getStart()))&&!dom.isEmpty(caretContainer)&&Tools.walk(caretContainer,function(node){1!==node.nodeType||"_mce_caret"===node.id||dom.isEmpty(node)||dom.setAttrib(node,"data-mce-bogus",null)},"childNodes")},trimZwspFromCaretContainer=function(caretContainerNode){var textNode=findFirstTextNode(caretContainerNode);return textNode&&textNode.nodeValue.charAt(0)===ZWSP&&textNode.deleteData(0,1),textNode},removeCaretContainerNode=function(dom,selection,node,moveCaret){var rng,block,textNode;rng=selection.getRng(!0),block=dom.getParent(node,dom.isBlock),isCaretContainerEmpty(node)?(!1!==moveCaret&&(rng.setStartBefore(node),rng.setEndBefore(node)),dom.remove(node)):(textNode=trimZwspFromCaretContainer(node),rng.startContainer===textNode&&rng.startOffset>0&&rng.setStart(textNode,rng.startOffset-1),rng.endContainer===textNode&&rng.endOffset>0&&rng.setEnd(textNode,rng.endOffset-1),dom.remove(node,!0)),block&&dom.isEmpty(block)&&PaddingBr.fillWithPaddingBr(Element.fromDom(block)),selection.setRng(rng)},removeCaretContainer=function(dom,selection,node,moveCaret){if(node)removeCaretContainerNode(dom,selection,node,moveCaret);else if(!(node=getParentCaretContainer(selection.getStart())))for(;node=dom.get("_mce_caret");)removeCaretContainerNode(dom,selection,node,!1)},insertCaretContainerNode=function(editor,caretContainer,formatNode){var dom=editor.dom,block=dom.getParent(formatNode,Fun.curry(FormatUtils.isTextBlock,editor));block&&dom.isEmpty(block)?formatNode.parentNode.replaceChild(caretContainer,formatNode):(PaddingBr.removeTrailingBr(Element.fromDom(formatNode)),dom.isEmpty(formatNode)?formatNode.parentNode.replaceChild(caretContainer,formatNode):dom.insertAfter(caretContainer,formatNode))},appendNode=function(parentNode,node){return parentNode.appendChild(node),node},insertFormatNodesIntoCaretContainer=function(formatNodes,caretContainer){var innerMostFormatNode=Arr.foldr(formatNodes,function(parentNode,formatNode){return appendNode(parentNode,formatNode.cloneNode(!1))},caretContainer);return appendNode(innerMostFormatNode,innerMostFormatNode.ownerDocument.createTextNode(ZWSP))},setupCaretEvents=function(editor){editor._hasCaretEvents||(bindEvents(editor),editor._hasCaretEvents=!0)},bindEvents=function(editor){var dom=editor.dom,selection=editor.selection;if(!editor._hasCaretEvents){var markCaretContainersBogus,disableCaretContainer;editor.on("BeforeGetContent",function(e){markCaretContainersBogus&&"raw"!==e.format&&markCaretContainersBogus()}),editor.on("mouseup keydown",function(e){disableCaretContainer&&disableCaretContainer(e)}),markCaretContainersBogus=function(){var i,nodes=[];if(isCaretContainerEmpty(getParentCaretContainer(selection.getStart()),nodes))for(i=nodes.length;i--;)dom.setAttrib(nodes[i],"data-mce-bogus","1")},disableCaretContainer=function(e){var keyCode=e.keyCode;removeCaretContainer(dom,selection,null,!1),8===keyCode&&selection.isCollapsed()&&selection.getStart().innerHTML===ZWSP&&removeCaretContainer(dom,selection,getParentCaretContainer(selection.getStart())),37!==keyCode&&39!==keyCode||removeCaretContainer(dom,selection,getParentCaretContainer(selection.getStart())),unmarkBogusCaretParents(dom,selection)},editor.on("SetContent",function(e){e.selection&&unmarkBogusCaretParents(dom,selection)}),editor._hasCaretEvents=!0}};return{applyCaretFormat:function(editor,name,vars){var rng,caretContainer,textNode,offset,bookmark,text,dom=editor.dom,selection=editor.selection;setupCaretEvents(editor),offset=(rng=selection.getRng(!0)).startOffset,text=rng.startContainer.nodeValue,(caretContainer=getParentCaretContainer(selection.getStart()))&&(textNode=findFirstTextNode(caretContainer));var wordcharRegex=/[^\s\u00a0\u00ad\u200b\ufeff]/;text&&offset>0&&offset<text.length&&wordcharRegex.test(text.charAt(offset))&&wordcharRegex.test(text.charAt(offset-1))?(bookmark=selection.getBookmark(),rng.collapse(!0),rng=ExpandRange.expandRng(editor,rng,editor.formatter.get(name)),rng=new RangeUtils(dom).split(rng),editor.formatter.apply(name,vars,rng),selection.moveToBookmark(bookmark)):(caretContainer&&textNode.nodeValue===ZWSP?editor.formatter.apply(name,vars,caretContainer):(textNode=(caretContainer=createCaretContainer(dom,!0)).firstChild,rng.insertNode(caretContainer),offset=1,editor.formatter.apply(name,vars,caretContainer)),selection.setCursorLocation(textNode,offset))},removeCaretFormat:function(editor,name,vars,similar){var container,offset,bookmark,hasContentAfter,node,formatNode,caretContainer,dom=editor.dom,selection=editor.selection,rng=selection.getRng(!0),parents=[];for(setupCaretEvents(editor),container=rng.startContainer,offset=rng.startOffset,node=container,3===container.nodeType&&(offset!==container.nodeValue.length&&(hasContentAfter=!0),node=node.parentNode);node;){if(MatchFormat.matchNode(editor,node,name,vars,similar)){formatNode=node;break}node.nextSibling&&(hasContentAfter=!0),parents.push(node),node=node.parentNode}if(formatNode)if(hasContentAfter)bookmark=selection.getBookmark(),rng.collapse(!0),rng=ExpandRange.expandRng(editor,rng,editor.formatter.get(name),!0),rng=new RangeUtils(dom).split(rng),editor.formatter.remove(name,vars,rng),selection.moveToBookmark(bookmark);else{caretContainer=getParentCaretContainer(formatNode);var newCaretContainer=createCaretContainer(dom,!1),caretNode=insertFormatNodesIntoCaretContainer(parents,newCaretContainer);caretContainer?insertCaretContainerNode(editor,newCaretContainer,caretContainer):insertCaretContainerNode(editor,newCaretContainer,formatNode),removeCaretContainerNode(dom,selection,caretContainer,!1),selection.setCursorLocation(caretNode,1),dom.isEmpty(formatNode)&&dom.remove(formatNode)}},isCaretNode:function(node){return 1===node.nodeType&&"_mce_caret"===node.id}}}),define("tinymce.core.fmt.Hooks",["tinymce.core.util.Arr","tinymce.core.dom.NodeType","tinymce.core.dom.DomQuery"],function(Arr,NodeType,$){var postProcessHooks={},filter=Arr.filter,each=Arr.each;return function(name,hook){var hooks=postProcessHooks[name];hooks||(postProcessHooks[name]=hooks=[]),postProcessHooks[name].push(hook)}("pre",function(editor){function joinPre(pre1,pre2){$(pre2).remove(),$(pre1).append("<br><br>").append(pre2.childNodes)}var isPre,blocks,rng=editor.selection.getRng();isPre=NodeType.matchNodeNames("pre"),rng.collapsed||(blocks=editor.selection.getSelectedBlocks(),each(filter(filter(blocks,isPre),function(pre){return isPre(pre.previousSibling)&&-1!==Arr.indexOf(blocks,pre.previousSibling)}),function(pre){joinPre(pre.previousSibling,pre)}))}),{postProcess:function(name,editor){each(postProcessHooks[name],function(hook){hook(editor)})}}}),define("tinymce.core.dom.ElementUtils",["tinymce.core.dom.BookmarkManager","tinymce.core.util.Tools"],function(BookmarkManager,Tools){var each=Tools.each;return function(dom){this.compare=function(node1,node2){function getAttribs(node){var attribs={};return each(dom.getAttribs(node),function(attr){var name=attr.nodeName.toLowerCase();0!==name.indexOf("_")&&"style"!==name&&0!==name.indexOf("data-")&&(attribs[name]=dom.getAttrib(node,name))}),attribs}function compareObjects(obj1,obj2){var value,name;for(name in obj1)if(obj1.hasOwnProperty(name)){if(void 0===(value=obj2[name]))return!1;if(obj1[name]!=value)return!1;delete obj2[name]}for(name in obj2)if(obj2.hasOwnProperty(name))return!1;return!0}return!(node1.nodeName!=node2.nodeName||!compareObjects(getAttribs(node1),getAttribs(node2))||!compareObjects(dom.parseStyle(dom.getAttrib(node1,"style")),dom.parseStyle(dom.getAttrib(node2,"style")))||BookmarkManager.isBookmarkNode(node1)||BookmarkManager.isBookmarkNode(node2))}}}),define("tinymce.core.fmt.RemoveFormat",["ephox.katamari.api.Fun","tinymce.core.dom.BookmarkManager","tinymce.core.dom.RangeUtils","tinymce.core.dom.TreeWalker","tinymce.core.fmt.CaretFormat","tinymce.core.fmt.ExpandRange","tinymce.core.fmt.FormatUtils","tinymce.core.fmt.MatchFormat","tinymce.core.util.Tools"],function(Fun,BookmarkManager,RangeUtils,TreeWalker,CaretFormat,ExpandRange,FormatUtils,MatchFormat,Tools){var MCE_ATTR_RE=/^(src|href|style)$/,each=Tools.each,isEq=FormatUtils.isEq,isTableCell=function(node){return/^(TH|TD)$/.test(node.nodeName)},getContainer=function(ed,rng,start){var container,offset,lastIdx;return container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"],1===container.nodeType&&(lastIdx=container.childNodes.length-1,!start&&offset&&offset--,container=container.childNodes[offset>lastIdx?lastIdx:offset]),3===container.nodeType&&start&&offset>=container.nodeValue.length&&(container=new TreeWalker(container,ed.getBody()).next()||container),3!==container.nodeType||start||0!==offset||(container=new TreeWalker(container,ed.getBody()).prev()||container),container},wrap=function(dom,node,name,attrs){var wrapper=dom.create(name,attrs);return node.parentNode.insertBefore(wrapper,node),wrapper.appendChild(node),wrapper},matchName=function(dom,node,format){return!!isEq(node,format.inline)||(!!isEq(node,format.block)||(format.selector?1===node.nodeType&&dom.is(node,format.selector):void 0))},isColorFormatAndAnchor=function(node,format){return format.links&&"A"===node.tagName},find=function(dom,node,next,inc){return!(node=FormatUtils.getNonWhiteSpaceSibling(node,next,inc))||"BR"===node.nodeName||dom.isBlock(node)},removeNode=function(ed,node,format){var rootBlockElm,parentNode=node.parentNode,dom=ed.dom,forcedRootBlock=ed.settings.forced_root_block;format.block&&(forcedRootBlock?parentNode===dom.getRoot()&&(format.list_block&&isEq(node,format.list_block)||each(Tools.grep(node.childNodes),function(node){FormatUtils.isValid(ed,forcedRootBlock,node.nodeName.toLowerCase())?rootBlockElm?rootBlockElm.appendChild(node):(rootBlockElm=wrap(dom,node,forcedRootBlock),dom.setAttribs(rootBlockElm,ed.settings.forced_root_block_attrs)):rootBlockElm=0})):dom.isBlock(node)&&!dom.isBlock(parentNode)&&(find(dom,node,!1)||find(dom,node.firstChild,!0,1)||node.insertBefore(dom.create("br"),node.firstChild),find(dom,node,!0)||find(dom,node.lastChild,!1,1)||node.appendChild(dom.create("br")))),format.selector&&format.inline&&!isEq(format.inline,node)||dom.remove(node,1)},removeFormat=function(ed,format,vars,node,compareNode){var i,attrs,stylesModified,dom=ed.dom;if(!matchName(dom,node,format)&&!isColorFormatAndAnchor(node,format))return!1;if("all"!==format.remove)for(each(format.styles,function(value,name){value=FormatUtils.normalizeStyleValue(dom,FormatUtils.replaceVars(value,vars),name),"number"==typeof name&&(name=value,compareNode=0),(format.remove_similar||!compareNode||isEq(FormatUtils.getStyle(dom,compareNode,name),value))&&dom.setStyle(node,name,""),stylesModified=1}),stylesModified&&""===dom.getAttrib(node,"style")&&(node.removeAttribute("style"),node.removeAttribute("data-mce-style")),each(format.attributes,function(value,name){var valueOut;if(value=FormatUtils.replaceVars(value,vars),"number"==typeof name&&(name=value,compareNode=0),!compareNode||isEq(dom.getAttrib(compareNode,name),value)){if("class"===name&&(value=dom.getAttrib(node,name))&&(valueOut="",each(value.split(/\s+/),function(cls){/mce\-\w+/.test(cls)&&(valueOut+=(valueOut?" ":"")+cls)}),valueOut))return void dom.setAttrib(node,name,valueOut);"class"===name&&node.removeAttribute("className"),MCE_ATTR_RE.test(name)&&node.removeAttribute("data-mce-"+name),node.removeAttribute(name)}}),each(format.classes,function(value){value=FormatUtils.replaceVars(value,vars),compareNode&&!dom.hasClass(compareNode,value)||dom.removeClass(node,value)}),attrs=dom.getAttribs(node),i=0;i<attrs.length;i++){var attrName=attrs[i].nodeName;if(0!==attrName.indexOf("_")&&0!==attrName.indexOf("data-"))return!1}return"none"!==format.remove?(removeNode(ed,node,format),!0):void 0},findFormatRoot=function(editor,container,name,vars,similar){var formatRoot;return each(FormatUtils.getParents(editor.dom,container.parentNode).reverse(),function(parent){var format;formatRoot||"_start"===parent.id||"_end"===parent.id||(format=MatchFormat.matchNode(editor,parent,name,vars,similar))&&!1!==format.split&&(formatRoot=parent)}),formatRoot},wrapAndSplit=function(editor,formatList,formatRoot,container,target,split,format,vars){var parent,clone,lastClone,firstClone,i,formatRootParent,dom=editor.dom;if(formatRoot){for(formatRootParent=formatRoot.parentNode,parent=container.parentNode;parent&&parent!==formatRootParent;parent=parent.parentNode){for(clone=dom.clone(parent,!1),i=0;i<formatList.length;i++)if(removeFormat(editor,formatList[i],vars,clone,clone)){clone=0;break}clone&&(lastClone&&clone.appendChild(lastClone),firstClone||(firstClone=clone),lastClone=clone)}!split||format.mixed&&dom.isBlock(formatRoot)||(container=dom.split(formatRoot,container)),lastClone&&(target.parentNode.insertBefore(lastClone,target),firstClone.appendChild(target))}return container};return{removeFormat:removeFormat,remove:function(ed,name,vars,node,similar){var bookmark,rng,formatList=ed.formatter.get(name),format=formatList[0],contentEditable=!0,dom=ed.dom,selection=ed.selection,splitToFormatRoot=function(container){var formatRoot=findFormatRoot(ed,container,name,vars,similar);return wrapAndSplit(ed,formatList,formatRoot,container,container,!0,format,vars)},process=function(node){var children,i,l,lastContentEditable,hasContentEditableState;if(1===node.nodeType&&dom.getContentEditable(node)&&(lastContentEditable=contentEditable,contentEditable="true"===dom.getContentEditable(node),hasContentEditableState=!0),children=Tools.grep(node.childNodes),contentEditable&&!hasContentEditableState)for(i=0,l=formatList.length;i<l&&!removeFormat(ed,formatList[i],vars,node,node);i++);if(format.deep&&children.length){for(i=0,l=children.length;i<l;i++)process(children[i]);hasContentEditableState&&(contentEditable=lastContentEditable)}},unwrap=function(start){var node=dom.get(start?"_start":"_end"),out=node[start?"firstChild":"lastChild"];return BookmarkManager.isBookmarkNode(out)&&(out=out[start?"firstChild":"lastChild"]),3===out.nodeType&&0===out.data.length&&(out=start?node.previousSibling||node.nextSibling:node.nextSibling||node.previousSibling),dom.remove(node,!0),out},removeRngStyle=function(rng){var startContainer,endContainer,commonAncestorContainer=rng.commonAncestorContainer;if(rng=ExpandRange.expandRng(ed,rng,formatList,!0),format.split){if(startContainer=getContainer(ed,rng,!0),endContainer=getContainer(ed,rng),startContainer!==endContainer){if(/^(TR|TH|TD)$/.test(startContainer.nodeName)&&startContainer.firstChild&&(startContainer="TR"===startContainer.nodeName?startContainer.firstChild.firstChild||startContainer:startContainer.firstChild||startContainer),commonAncestorContainer&&/^T(HEAD|BODY|FOOT|R)$/.test(commonAncestorContainer.nodeName)&&isTableCell(endContainer)&&endContainer.firstChild&&(endContainer=endContainer.firstChild||endContainer),dom.isChildOf(startContainer,endContainer)&&!dom.isBlock(endContainer)&&!isTableCell(startContainer)&&!isTableCell(endContainer))return startContainer=wrap(dom,startContainer,"span",{id:"_start","data-mce-type":"bookmark"}),splitToFormatRoot(startContainer),void(startContainer=unwrap(!0));startContainer=wrap(dom,startContainer,"span",{id:"_start","data-mce-type":"bookmark"}),endContainer=wrap(dom,endContainer,"span",{id:"_end","data-mce-type":"bookmark"}),splitToFormatRoot(startContainer),splitToFormatRoot(endContainer),startContainer=unwrap(!0),endContainer=unwrap()}else startContainer=endContainer=splitToFormatRoot(startContainer);rng.startContainer=startContainer.parentNode?startContainer.parentNode:startContainer,rng.startOffset=dom.nodeIndex(startContainer),rng.endContainer=endContainer.parentNode?endContainer.parentNode:endContainer,rng.endOffset=dom.nodeIndex(endContainer)+1}new RangeUtils(dom).walk(rng,function(nodes){each(nodes,function(node){process(node),1===node.nodeType&&"underline"===ed.dom.getStyle(node,"text-decoration")&&node.parentNode&&"underline"===FormatUtils.getTextDecoration(dom,node.parentNode)&&removeFormat(ed,{deep:!1,exact:!0,inline:"span",styles:{textDecoration:"underline"}},null,node)})})};if(node)node.nodeType?((rng=dom.createRng()).setStartBefore(node),rng.setEndAfter(node),removeRngStyle(rng)):removeRngStyle(node);else if("false"!==dom.getContentEditable(selection.getNode()))selection.isCollapsed()&&format.inline&&!dom.select("td[data-mce-selected],th[data-mce-selected]").length?CaretFormat.removeCaretFormat(ed,name,vars,similar):(bookmark=selection.getBookmark(),removeRngStyle(selection.getRng(!0)),selection.moveToBookmark(bookmark),format.inline&&MatchFormat.match(ed,name,vars,selection.getStart())&&FormatUtils.moveStart(dom,selection,selection.getRng(!0)),ed.nodeChanged());else{node=selection.getNode();for(var i=0,l=formatList.length;i<l&&(!formatList[i].ceFalseOverride||!removeFormat(ed,formatList[i],vars,node,node));i++);}}}}),define("tinymce.core.fmt.MergeFormats",["ephox.katamari.api.Fun","tinymce.core.dom.BookmarkManager","tinymce.core.dom.ElementUtils","tinymce.core.dom.NodeType","tinymce.core.fmt.CaretFormat","tinymce.core.fmt.FormatUtils","tinymce.core.fmt.MatchFormat","tinymce.core.fmt.RemoveFormat","tinymce.core.util.Tools"],function(Fun,BookmarkManager,ElementUtils,NodeType,CaretFormat,FormatUtils,MatchFormat,RemoveFormat,Tools){var each=Tools.each,isElementNode=function(node){return node&&1===node.nodeType&&!BookmarkManager.isBookmarkNode(node)&&!CaretFormat.isCaretNode(node)&&!NodeType.isBogus(node)},findElementSibling=function(node,siblingName){var sibling;for(sibling=node;sibling;sibling=sibling[siblingName]){if(3===sibling.nodeType&&0!==sibling.nodeValue.length)return node;if(1===sibling.nodeType&&!BookmarkManager.isBookmarkNode(sibling))return sibling}return node},mergeSiblingsNodes=function(dom,prev,next){var sibling,tmpSibling,elementUtils=new ElementUtils(dom);if(prev&&next&&(prev=findElementSibling(prev,"previousSibling"),next=findElementSibling(next,"nextSibling"),elementUtils.compare(prev,next))){for(sibling=prev.nextSibling;sibling&&sibling!==next;)tmpSibling=sibling,sibling=sibling.nextSibling,prev.appendChild(tmpSibling);return dom.remove(next),Tools.each(Tools.grep(next.childNodes),function(node){prev.appendChild(node)}),prev}return next},processChildElements=function(node,filter,process){each(node.childNodes,function(node){isElementNode(node)&&(filter(node)&&process(node),node.hasChildNodes()&&processChildElements(node,filter,process))})},hasStyle=function(dom,name){return Fun.curry(function(name,node){return!(!node||!FormatUtils.getStyle(dom,node,name))},name)},applyStyle=function(dom,name,value){return Fun.curry(function(name,value,node){dom.setStyle(node,name,value),""===node.getAttribute("style")&&node.removeAttribute("style"),unwrapEmptySpan(dom,node)},name,value)},unwrapEmptySpan=function(dom,node){"SPAN"===node.nodeName&&0===dom.getAttribs(node).length&&dom.remove(node,!0)},processUnderlineAndColor=function(dom,node){var textDecoration;1===node.nodeType&&node.parentNode&&1===node.parentNode.nodeType&&(textDecoration=FormatUtils.getTextDecoration(dom,node.parentNode),dom.getStyle(node,"color")&&textDecoration?dom.setStyle(node,"text-decoration",textDecoration):dom.getStyle(node,"text-decoration")===textDecoration&&dom.setStyle(node,"text-decoration",null))},clearChildStyles=function(dom,format,node){if(format.clear_child_styles){var selector=format.links?"*:not(a)":"*";each(dom.select(selector,node),function(node){isElementNode(node)&&each(format.styles,function(value,name){dom.setStyle(node,name,"")})})}};return{mergeWithChildren:function(editor,formatList,vars,node){each(formatList,function(format){each(editor.dom.select(format.inline,node),function(child){isElementNode(child)&&RemoveFormat.removeFormat(editor,format,vars,child,format.exact?child:null)}),clearChildStyles(editor.dom,format,node)})},mergeUnderlineAndColor:function(dom,format,vars,node){(format.styles.color||format.styles.textDecoration)&&(Tools.walk(node,Fun.curry(processUnderlineAndColor,dom),"childNodes"),processUnderlineAndColor(dom,node))},mergeBackgroundColorAndFontSize:function(dom,format,vars,node){format.styles&&format.styles.backgroundColor&&processChildElements(node,hasStyle(dom,"fontSize"),applyStyle(dom,"backgroundColor",FormatUtils.replaceVars(format.styles.backgroundColor,vars)))},mergeSubSup:function(dom,format,vars,node){"sub"!==format.inline&&"sup"!==format.inline||(processChildElements(node,hasStyle(dom,"fontSize"),applyStyle(dom,"fontSize","")),dom.remove(dom.select("sup"===format.inline?"sub":"sup",node),!0))},mergeSiblings:function(dom,format,vars,node){node&&!1!==format.merge_siblings&&(node=mergeSiblingsNodes(dom,FormatUtils.getNonWhiteSpaceSibling(node),node),node=mergeSiblingsNodes(dom,node,FormatUtils.getNonWhiteSpaceSibling(node,!0)))},mergeWithParents:function(editor,format,name,vars,node){MatchFormat.matchNode(editor,node.parentNode,name,vars)&&RemoveFormat.removeFormat(editor,format,vars,node)||format.merge_with_parents&&editor.dom.getParent(node.parentNode,function(parent){if(MatchFormat.matchNode(editor,parent,name,vars))return RemoveFormat.removeFormat(editor,format,vars,node),!0})}}}),define("tinymce.core.fmt.ApplyFormat",["tinymce.core.dom.BookmarkManager","tinymce.core.dom.NodeType","tinymce.core.dom.RangeNormalizer","tinymce.core.dom.RangeUtils","tinymce.core.fmt.CaretFormat","tinymce.core.fmt.ExpandRange","tinymce.core.fmt.FormatUtils","tinymce.core.fmt.Hooks","tinymce.core.fmt.MatchFormat","tinymce.core.fmt.MergeFormats","tinymce.core.util.Tools"],function(BookmarkManager,NodeType,RangeNormalizer,RangeUtils,CaretFormat,ExpandRange,FormatUtils,Hooks,MatchFormat,MergeFormats,Tools){var each=Tools.each,isElementNode=function(node){return node&&1===node.nodeType&&!BookmarkManager.isBookmarkNode(node)&&!CaretFormat.isCaretNode(node)&&!NodeType.isBogus(node)},applyFormat=function(ed,name,vars,node){var bookmark,rng,formatList=ed.formatter.get(name),format=formatList[0],isCollapsed=!node&&ed.selection.isCollapsed(),dom=ed.dom,selection=ed.selection,setElementFormat=function(elm,fmt){if(fmt=fmt||format,elm){if(fmt.onformat&&fmt.onformat(elm,fmt,vars,node),each(fmt.styles,function(value,name){dom.setStyle(elm,name,FormatUtils.replaceVars(value,vars))}),fmt.styles){var styleVal=dom.getAttrib(elm,"style");styleVal&&elm.setAttribute("data-mce-style",styleVal)}each(fmt.attributes,function(value,name){dom.setAttrib(elm,name,FormatUtils.replaceVars(value,vars))}),each(fmt.classes,function(value){value=FormatUtils.replaceVars(value,vars),dom.hasClass(elm,value)||dom.addClass(elm,value)})}},applyNodeStyle=function(formatList,node){var found=!1;return!!format.selector&&(each(formatList,function(format){if(!("collapsed"in format&&format.collapsed!==isCollapsed))return dom.is(node,format.selector)&&!CaretFormat.isCaretNode(node)?(setElementFormat(node,format),found=!0,!1):void 0}),found)},applyRngStyle=function(dom,rng,bookmark,nodeSpecific){var wrapName,wrapElm,newWrappers=[],contentEditable=!0;wrapName=format.inline||format.block,wrapElm=dom.create(wrapName),setElementFormat(wrapElm),new RangeUtils(dom).walk(rng,function(nodes){var currentWrapElm,process=function(node){var nodeName,parentName,hasContentEditableState,lastContentEditable;if(lastContentEditable=contentEditable,nodeName=node.nodeName.toLowerCase(),parentName=node.parentNode.nodeName.toLowerCase(),1===node.nodeType&&dom.getContentEditable(node)&&(lastContentEditable=contentEditable,contentEditable="true"===dom.getContentEditable(node),hasContentEditableState=!0),FormatUtils.isEq(nodeName,"br"))return currentWrapElm=0,void(format.block&&dom.remove(node));if(format.wrapper&&MatchFormat.matchNode(ed,node,name,vars))currentWrapElm=0;else{if(contentEditable&&!hasContentEditableState&&format.block&&!format.wrapper&&FormatUtils.isTextBlock(ed,nodeName)&&FormatUtils.isValid(ed,parentName,wrapName))return node=dom.rename(node,wrapName),setElementFormat(node),newWrappers.push(node),void(currentWrapElm=0);if(format.selector){var found=applyNodeStyle(formatList,node);if(!format.inline||found)return void(currentWrapElm=0)}!contentEditable||hasContentEditableState||!FormatUtils.isValid(ed,wrapName,nodeName)||!FormatUtils.isValid(ed,parentName,wrapName)||!nodeSpecific&&3===node.nodeType&&1===node.nodeValue.length&&65279===node.nodeValue.charCodeAt(0)||CaretFormat.isCaretNode(node)||format.inline&&dom.isBlock(node)?(currentWrapElm=0,each(Tools.grep(node.childNodes),process),hasContentEditableState&&(contentEditable=lastContentEditable),currentWrapElm=0):(currentWrapElm||(currentWrapElm=dom.clone(wrapElm,!1),node.parentNode.insertBefore(currentWrapElm,node),newWrappers.push(currentWrapElm)),currentWrapElm.appendChild(node))}};each(nodes,process)}),!0===format.links&&each(newWrappers,function(node){var process=function(node){"A"===node.nodeName&&setElementFormat(node,format),each(Tools.grep(node.childNodes),process)};process(node)}),each(newWrappers,function(node){var childCount,getChildElementNode=function(root){var child=!1;return each(root.childNodes,function(node){if(isElementNode(node))return child=node,!1}),child};childCount=function(node){var count=0;return each(node.childNodes,function(node){FormatUtils.isWhiteSpaceNode(node)||BookmarkManager.isBookmarkNode(node)||count++}),count}(node),!(newWrappers.length>1)&&dom.isBlock(node)||0!==childCount?(format.inline||format.wrapper)&&(format.exact||1!==childCount||(node=function(node){var child,clone;return(child=getChildElementNode(node))&&!BookmarkManager.isBookmarkNode(child)&&MatchFormat.matchName(dom,child,format)&&(clone=dom.clone(child,!1),setElementFormat(clone),dom.replace(clone,node,!0),dom.remove(child,1)),clone||node}(node)),MergeFormats.mergeWithChildren(ed,formatList,vars,node),MergeFormats.mergeWithParents(ed,format,name,vars,node),MergeFormats.mergeBackgroundColorAndFontSize(dom,format,vars,node),MergeFormats.mergeSubSup(dom,format,vars,node),MergeFormats.mergeSiblings(dom,format,vars,node)):dom.remove(node,1)})};if("false"!==dom.getContentEditable(selection.getNode())){if(format){if(node)node.nodeType?applyNodeStyle(formatList,node)||((rng=dom.createRng()).setStartBefore(node),rng.setEndAfter(node),applyRngStyle(dom,ExpandRange.expandRng(ed,rng,formatList),0,!0)):applyRngStyle(dom,node,0,!0);else if(isCollapsed&&format.inline&&!dom.select("td[data-mce-selected],th[data-mce-selected]").length)CaretFormat.applyCaretFormat(ed,name,vars);else{var curSelNode=ed.selection.getNode();ed.settings.forced_root_block||!formatList[0].defaultBlock||dom.getParent(curSelNode,dom.isBlock)||applyFormat(ed,formatList[0].defaultBlock),ed.selection.setRng(RangeNormalizer.normalize(ed.selection.getRng())),bookmark=selection.getBookmark(),applyRngStyle(dom,ExpandRange.expandRng(ed,selection.getRng(!0),formatList)),format.styles&&MergeFormats.mergeUnderlineAndColor(dom,format,vars,curSelNode),selection.moveToBookmark(bookmark),FormatUtils.moveStart(dom,selection,selection.getRng(!0)),ed.nodeChanged()}Hooks.postProcess(name,ed)}}else{node=selection.getNode();for(var i=0,l=formatList.length;i<l;i++)if(formatList[i].ceFalseOverride&&dom.is(node,formatList[i].selector))return void setElementFormat(node,formatList[i])}};return{applyFormat:applyFormat}}),define("tinymce.core.fmt.FormatChanged",["ephox.katamari.api.Cell","tinymce.core.fmt.FormatUtils","tinymce.core.fmt.MatchFormat","tinymce.core.util.Tools"],function(Cell,FormatUtils,MatchFormat,Tools){var each=Tools.each,setup=function(formatChangeData,editor){var currentFormats={};formatChangeData.set({}),editor.on("NodeChange",function(e){var parents=FormatUtils.getParents(editor.dom,e.element),matchedFormats={};parents=Tools.grep(parents,function(node){return 1===node.nodeType&&!node.getAttribute("data-mce-bogus")}),each(formatChangeData.get(),function(callbacks,format){each(parents,function(node){return editor.formatter.matchNode(node,format,{},callbacks.similar)?(currentFormats[format]||(each(callbacks,function(callback){callback(!0,{node:node,format:format,parents:parents})}),currentFormats[format]=callbacks),matchedFormats[format]=callbacks,!1):!MatchFormat.matchesUnInheritedFormatSelector(editor,node,format)&&void 0})}),each(currentFormats,function(callbacks,format){matchedFormats[format]||(delete currentFormats[format],each(callbacks,function(callback){callback(!1,{node:e.element,format:format,parents:parents})}))})})},addListeners=function(formatChangeData,formats,callback,similar){var formatChangeItems=formatChangeData.get();each(formats.split(","),function(format){formatChangeItems[format]||(formatChangeItems[format]=[],formatChangeItems[format].similar=similar),formatChangeItems[format].push(callback)}),formatChangeData.set(formatChangeItems)};return{formatChanged:function(editor,formatChangeState,formats,callback,similar){null===formatChangeState.get()&&setup(formatChangeState,editor),addListeners(formatChangeState,formats,callback,similar)}}}),define("tinymce.core.fmt.DefaultFormats",["tinymce.core.util.Tools"],function(Tools){return{get:function(dom){var formats={valigntop:[{selector:"td,th",styles:{verticalAlign:"top"}}],valignmiddle:[{selector:"td,th",styles:{verticalAlign:"middle"}}],valignbottom:[{selector:"td,th",styles:{verticalAlign:"bottom"}}],alignleft:[{selector:"figure.image",collapsed:!1,classes:"align-left",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"left"},inherit:!1,preview:!1,defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{float:"left"},preview:"font-family font-size"}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"center"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"figure.image",collapsed:!1,classes:"align-center",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"img",collapsed:!1,styles:{display:"block",marginLeft:"auto",marginRight:"auto"},preview:!1},{selector:"table",collapsed:!1,styles:{marginLeft:"auto",marginRight:"auto"},preview:"font-family font-size"}],alignright:[{selector:"figure.image",collapsed:!1,classes:"align-right",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"right"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{float:"right"},preview:"font-family font-size"}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"justify"},inherit:!1,defaultBlock:"div",preview:"font-family font-size"}],bold:[{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all"}],italic:[{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all"}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:!0},{inline:"u",remove:"all"}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:!0},{inline:"strike",remove:"all"}],forecolor:{inline:"span",styles:{color:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},fontname:{inline:"span",styles:{fontFamily:"%value"},clear_child_styles:!0},fontsize:{inline:"span",styles:{fontSize:"%value"},clear_child_styles:!0},fontsize_class:{inline:"span",attributes:{class:"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:!0,deep:!0,onmatch:function(){return!0},onformat:function(elm,fmt,vars){Tools.each(vars,function(value,key){dom.setAttrib(elm,key,value)})}},removeformat:[{selector:"b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}]};return Tools.each("p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp".split(/\s/),function(name){formats[name]={block:name,remove:"all"}}),formats}}}),define("tinymce.core.fmt.FormatRegistry",["tinymce.core.fmt.DefaultFormats","tinymce.core.util.Tools"],function(DefaultFormats,Tools){return function(editor){var formats={},register=function(name,format){name&&("string"!=typeof name?Tools.each(name,function(format,name){register(name,format)}):(format=format.length?format:[format],Tools.each(format,function(format){void 0===format.deep&&(format.deep=!format.selector),void 0===format.split&&(format.split=!format.selector||format.inline),void 0===format.remove&&format.selector&&!format.inline&&(format.remove="none"),format.selector&&format.inline&&(format.mixed=!0,format.block_expand=!0),"string"==typeof format.classes&&(format.classes=format.classes.split(/\s+/))}),formats[name]=format))};return register(DefaultFormats.get(editor.dom)),register(editor.settings.formats),{get:function(name){return name?formats[name]:formats},register:register,unregister:function(name){return name&&formats[name]&&delete formats[name],formats}}}}),define("tinymce.core.fmt.Preview",["tinymce.core.dom.DOMUtils","tinymce.core.util.Tools","tinymce.core.html.Schema"],function(DOMUtils,Tools,Schema){function parsedSelectorToHtml(ancestry,editor){function decorate(elm,item){item.classes.length&&dom.addClass(elm,item.classes.join(" ")),dom.setAttribs(elm,item.attrs)}function createElement(sItem){var elm;return item="string"==typeof sItem?{name:sItem,classes:[],attrs:{}}:sItem,elm=dom.create(item.name),decorate(elm,item),elm}function getRequiredParent(elm,candidate){var name="string"!=typeof elm?elm.nodeName.toLowerCase():elm,elmRule=schema.getElementRule(name),parentsRequired=elmRule&&elmRule.parentsRequired;return!(!parentsRequired||!parentsRequired.length)&&(candidate&&-1!==Tools.inArray(parentsRequired,candidate)?candidate:parentsRequired[0])}function wrapInHtml(elm,ancestry,siblings){var parent,parentCandidate,parentRequired,ancestor=ancestry.length>0&&ancestry[0],ancestorName=ancestor&&ancestor.name;if(parentRequired=getRequiredParent(elm,ancestorName))ancestorName===parentRequired?(parentCandidate=ancestry[0],ancestry=ancestry.slice(1)):parentCandidate=parentRequired;else if(ancestor)parentCandidate=ancestry[0],ancestry=ancestry.slice(1);else if(!siblings)return elm;return parentCandidate&&(parent=createElement(parentCandidate)).appendChild(elm),siblings&&(parent||(parent=dom.create("div")).appendChild(elm),Tools.each(siblings,function(sibling){var siblingElm=createElement(sibling);parent.insertBefore(siblingElm,elm)})),wrapInHtml(parent,ancestry,parentCandidate&&parentCandidate.siblings)}var elm,item,fragment,schema=editor&&editor.schema||new Schema({});return ancestry&&ancestry.length?(item=ancestry[0],elm=createElement(item),(fragment=dom.create("div")).appendChild(wrapInHtml(elm,ancestry.slice(1),item.siblings)),fragment):""}function parseSelectorItem(item){var tagName,obj={classes:[],attrs:{}};return"*"!==(item=obj.selector=Tools.trim(item))&&(tagName=item.replace(/(?:([#\.]|::?)([\w\-]+)|(\[)([^\]]+)\]?)/g,function($0,$1,$2,$3,$4){switch($1){case"#":obj.attrs.id=$2;break;case".":obj.classes.push($2);break;case":":-1!==Tools.inArray("checked disabled enabled read-only required".split(" "),$2)&&(obj.attrs[$2]=$2)}if("["===$3){var m=$4.match(/([\w\-]+)(?:\=\"([^\"]+))?/);m&&(obj.attrs[m[1]]=m[2])}return""})),obj.name=tagName||"div",obj}function parseSelector(selector){return selector&&"string"==typeof selector?(selector=selector.split(/\s*,\s*/)[0],selector=selector.replace(/\s*(~\+|~|\+|>)\s*/g,"$1"),Tools.map(selector.split(/(?:>|\s+(?![^\[\]]+\]))/),function(item){var siblings=Tools.map(item.split(/(?:~\+|~|\+)/),parseSelectorItem),obj=siblings.pop();return siblings.length&&(obj.siblings=siblings),obj}).reverse()):[]}var each=Tools.each,dom=DOMUtils.DOM;return{getCssText:function(editor,format){function removeVars(val){return val.replace(/%(\w+)/g,"")}var name,previewFrag,previewElm,items,parentFontSize,previewStyles,previewCss="";if(!1===(previewStyles=editor.settings.preview_styles))return"";if("string"!=typeof previewStyles&&(previewStyles="font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow"),"string"==typeof format){if(!(format=editor.formatter.get(format)))return;format=format[0]}return"preview"in format&&!1===(previewStyles=format.preview)?"":(name=format.block||format.inline||"span",(items=parseSelector(format.selector)).length?(items[0].name||(items[0].name=name),name=format.selector,previewFrag=parsedSelectorToHtml(items,editor)):previewFrag=parsedSelectorToHtml([name],editor),previewElm=dom.select(name,previewFrag)[0]||previewFrag.firstChild,each(format.styles,function(value,name){(value=removeVars(value))&&dom.setStyle(previewElm,name,value)}),each(format.attributes,function(value,name){(value=removeVars(value))&&dom.setAttrib(previewElm,name,value)}),each(format.classes,function(value){value=removeVars(value),dom.hasClass(previewElm,value)||dom.addClass(previewElm,value)}),editor.fire("PreviewFormats"),dom.setStyles(previewFrag,{position:"absolute",left:-65535}),editor.getBody().appendChild(previewFrag),parentFontSize=dom.getStyle(editor.getBody(),"fontSize",!0),parentFontSize=/px$/.test(parentFontSize)?parseInt(parentFontSize,10):0,each(previewStyles.split(" "),function(name){var value=dom.getStyle(previewElm,name,!0);if(!("background-color"===name&&/transparent|rgba\s*\([^)]+,\s*0\)/.test(value)&&(value=dom.getStyle(editor.getBody(),name,!0),"#ffffff"===dom.toHex(value).toLowerCase())||"color"===name&&"#000000"===dom.toHex(value).toLowerCase())){if("font-size"===name&&/em|%$/.test(value)){if(0===parentFontSize)return;value=(value=parseFloat(value,10)/(/%$/.test(value)?100:1))*parentFontSize+"px"}"border"===name&&value&&(previewCss+="padding:0 2px;"),previewCss+=name+":"+value+";"}}),editor.fire("AfterPreviewFormats"),dom.remove(previewFrag),previewCss)},parseSelector:parseSelector,selectorToHtml:function(selector,editor){return parsedSelectorToHtml(parseSelector(selector),editor)}}}),define("tinymce.core.fmt.ToggleFormat",["tinymce.core.fmt.ApplyFormat","tinymce.core.fmt.MatchFormat","tinymce.core.fmt.RemoveFormat"],function(ApplyFormat,MatchFormat,RemoveFormat){return{toggle:function(editor,formats,name,vars,node){var fmt=formats.get(name);!MatchFormat.match(editor,name,vars,node)||"toggle"in fmt[0]&&!fmt[0].toggle?ApplyFormat.applyFormat(editor,name,vars,node):RemoveFormat.remove(editor,name,vars,node)}}}),define("tinymce.core.keyboard.FormatShortcuts",[],function(){return{setup:function(editor){editor.addShortcut("meta+b","","Bold"),editor.addShortcut("meta+i","","Italic"),editor.addShortcut("meta+u","","Underline");for(var i=1;i<=6;i++)editor.addShortcut("access+"+i,"",["FormatBlock",!1,"h"+i]);editor.addShortcut("access+7","",["FormatBlock",!1,"p"]),editor.addShortcut("access+8","",["FormatBlock",!1,"div"]),editor.addShortcut("access+9","",["FormatBlock",!1,"address"])}}}),define("tinymce.core.api.Formatter",["ephox.katamari.api.Cell","ephox.katamari.api.Fun","tinymce.core.fmt.ApplyFormat","tinymce.core.fmt.FormatChanged","tinymce.core.fmt.FormatRegistry","tinymce.core.fmt.MatchFormat","tinymce.core.fmt.Preview","tinymce.core.fmt.RemoveFormat","tinymce.core.fmt.ToggleFormat","tinymce.core.keyboard.FormatShortcuts"],function(Cell,Fun,ApplyFormat,FormatChanged,FormatRegistry,MatchFormat,Preview,RemoveFormat,ToggleFormat,FormatShortcuts){return function(editor){var formats=FormatRegistry(editor),formatChangeState=Cell(null);return FormatShortcuts.setup(editor),{get:formats.get,register:formats.register,unregister:formats.unregister,apply:Fun.curry(ApplyFormat.applyFormat,editor),remove:Fun.curry(RemoveFormat.remove,editor),toggle:Fun.curry(ToggleFormat.toggle,editor,formats),match:Fun.curry(MatchFormat.match,editor),matchAll:Fun.curry(MatchFormat.matchAll,editor),matchNode:Fun.curry(MatchFormat.matchNode,editor),canApply:Fun.curry(MatchFormat.canApply,editor),formatChanged:Fun.curry(FormatChanged.formatChanged,editor,formatChangeState),getCssText:Fun.curry(Preview.getCssText,editor)}}}),define("tinymce.core.geom.Rect",[],function(){"use strict";function relativePosition(rect,targetRect,rel){var x,y,w,h,targetW,targetH;return x=targetRect.x,y=targetRect.y,w=rect.w,h=rect.h,targetW=targetRect.w,targetH=targetRect.h,"b"===(rel=(rel||"").split(""))[0]&&(y+=targetH),"r"===rel[1]&&(x+=targetW),"c"===rel[0]&&(y+=round(targetH/2)),"c"===rel[1]&&(x+=round(targetW/2)),"b"===rel[3]&&(y-=h),"r"===rel[4]&&(x-=w),"c"===rel[3]&&(y-=round(h/2)),"c"===rel[4]&&(x-=round(w/2)),create(x,y,w,h)}function create(x,y,w,h){return{x:x,y:y,w:w,h:h}}var min=Math.min,max=Math.max,round=Math.round;return{inflate:function(rect,w,h){return create(rect.x-w,rect.y-h,rect.w+2*w,rect.h+2*h)},relativePosition:relativePosition,findBestRelativePosition:function(rect,targetRect,constrainRect,rels){var pos,i;for(i=0;i<rels.length;i++)if((pos=relativePosition(rect,targetRect,rels[i])).x>=constrainRect.x&&pos.x+pos.w<=constrainRect.w+constrainRect.x&&pos.y>=constrainRect.y&&pos.y+pos.h<=constrainRect.h+constrainRect.y)return rels[i];return null},intersect:function(rect,cropRect){var x1,y1,x2,y2;return x1=max(rect.x,cropRect.x),y1=max(rect.y,cropRect.y),x2=min(rect.x+rect.w,cropRect.x+cropRect.w),y2=min(rect.y+rect.h,cropRect.y+cropRect.h),x2-x1<0||y2-y1<0?null:create(x1,y1,x2-x1,y2-y1)},clamp:function(rect,clampRect,fixedSize){var underflowX1,underflowY1,overflowX2,overflowY2,x1,y1,x2,y2,cx2,cy2;return x1=rect.x,y1=rect.y,x2=rect.x+rect.w,y2=rect.y+rect.h,cx2=clampRect.x+clampRect.w,cy2=clampRect.y+clampRect.h,underflowX1=max(0,clampRect.x-x1),underflowY1=max(0,clampRect.y-y1),overflowX2=max(0,x2-cx2),overflowY2=max(0,y2-cy2),x1+=underflowX1,y1+=underflowY1,fixedSize&&(x2+=underflowX1,y2+=underflowY1,x1-=overflowX2,y1-=overflowY2),x2-=overflowX2,y2-=overflowY2,create(x1,y1,x2-x1,y2-y1)},create:create,fromClientRect:function(clientRect){return create(clientRect.left,clientRect.top,clientRect.width,clientRect.height)}}}),define("tinymce.core.dom.ScriptLoader",["tinymce.core.dom.DOMUtils","tinymce.core.util.Tools"],function(DOMUtils,Tools){function ScriptLoader(){function loadScript(url,success,failure){function done(){dom.remove(id),elm&&(elm.onreadystatechange=elm.onload=elm=null),success()}var elm,id,dom=DOM;id=dom.uniqueId(),(elm=document.createElement("script")).id=id,elm.type="text/javascript",elm.src=Tools._addCacheSuffix(url),"onreadystatechange"in elm?elm.onreadystatechange=function(){/loaded|complete/.test(elm.readyState)&&done()}:elm.onload=done,elm.onerror=function(){isFunction(failure)?failure():"undefined"!=typeof console&&console.log&&console.log("Failed to load script: "+url)},(document.getElementsByTagName("head")[0]||document.body).appendChild(elm)}var undef,states={},queue=[],scriptLoadedCallbacks={},queueLoadedCallbacks=[],loading=0;this.isDone=function(url){return 2==states[url]},this.markDone=function(url){states[url]=2},this.add=this.load=function(url,success,scope,failure){states[url]==undef&&(queue.push(url),states[url]=0),success&&(scriptLoadedCallbacks[url]||(scriptLoadedCallbacks[url]=[]),scriptLoadedCallbacks[url].push({success:success,failure:failure,scope:scope||this}))},this.remove=function(url){delete states[url],delete scriptLoadedCallbacks[url]},this.loadQueue=function(success,scope,failure){this.loadScripts(queue,success,scope,failure)},this.loadScripts=function(scripts,success,scope,failure){function execCallbacks(name,url){each(scriptLoadedCallbacks[url],function(callback){isFunction(callback[name])&&callback[name].call(callback.scope)}),scriptLoadedCallbacks[url]=undef}var loadScripts,failures=[];queueLoadedCallbacks.push({success:success,failure:failure,scope:scope||this}),(loadScripts=function(){var loadingScripts=grep(scripts);scripts.length=0,each(loadingScripts,function(url){2!==states[url]?3!==states[url]?1!==states[url]&&(states[url]=1,loading++,loadScript(url,function(){states[url]=2,loading--,execCallbacks("success",url),loadScripts()},function(){states[url]=3,loading--,failures.push(url),execCallbacks("failure",url),loadScripts()})):execCallbacks("failure",url):execCallbacks("success",url)}),loading||(each(queueLoadedCallbacks,function(callback){0===failures.length?isFunction(callback.success)&&callback.success.call(callback.scope):isFunction(callback.failure)&&callback.failure.call(callback.scope,failures)}),queueLoadedCallbacks.length=0)})()}}var DOM=DOMUtils.DOM,each=Tools.each,grep=Tools.grep,isFunction=function(f){return"function"==typeof f};return ScriptLoader.ScriptLoader=new ScriptLoader,ScriptLoader}),define("tinymce.core.AddOnManager",["tinymce.core.dom.ScriptLoader","tinymce.core.util.Tools"],function(ScriptLoader,Tools){function AddOnManager(){var self=this;self.items=[],self.urls={},self.lookup={}}var each=Tools.each;return AddOnManager.prototype={get:function(name){if(this.lookup[name])return this.lookup[name].instance},dependencies:function(name){var result;return this.lookup[name]&&(result=this.lookup[name].dependencies),result||[]},requireLangPack:function(name,languages){var language=AddOnManager.language;if(language&&!1!==AddOnManager.languageLoad){if(languages)if(-1!=(languages=","+languages+",").indexOf(","+language.substr(0,2)+","))language=language.substr(0,2);else if(-1==languages.indexOf(","+language+","))return;ScriptLoader.ScriptLoader.add(this.urls[name]+"/langs/"+language+".js")}},add:function(id,addOn,dependencies){return this.items.push(addOn),this.lookup[id]={instance:addOn,dependencies:dependencies},addOn},remove:function(name){delete this.urls[name],delete this.lookup[name]},createUrl:function(baseUrl,dep){return"object"==typeof dep?dep:{prefix:baseUrl.prefix,resource:dep,suffix:baseUrl.suffix}},addComponents:function(pluginName,scripts){var pluginUrl=this.urls[pluginName];each(scripts,function(script){ScriptLoader.ScriptLoader.add(pluginUrl+"/"+script)})},load:function(name,addOnUrl,success,scope,failure){function loadDependencies(){var dependencies=self.dependencies(name);each(dependencies,function(dep){var newUrl=self.createUrl(addOnUrl,dep);self.load(newUrl.resource,newUrl,void 0,void 0)}),success&&(scope?success.call(scope):success.call(ScriptLoader))}var self=this,url=addOnUrl;self.urls[name]||("object"==typeof addOnUrl&&(url=addOnUrl.prefix+addOnUrl.resource+addOnUrl.suffix),0!==url.indexOf("/")&&-1==url.indexOf("://")&&(url=AddOnManager.baseURL+"/"+url),self.urls[name]=url.substring(0,url.lastIndexOf("/")),self.lookup[name]?loadDependencies():ScriptLoader.ScriptLoader.add(url,loadDependencies,scope,failure))}},AddOnManager.PluginManager=new AddOnManager,AddOnManager.ThemeManager=new AddOnManager,AddOnManager}),define("tinymce.core.html.Node",[],function(){function walk(node,rootNode,prev){var sibling,parent,startName=prev?"lastChild":"firstChild",siblingName=prev?"prev":"next";if(node[startName])return node[startName];if(node!==rootNode){if(sibling=node[siblingName])return sibling;for(parent=node.parent;parent&&parent!==rootNode;parent=parent.parent)if(sibling=parent[siblingName])return sibling}}function Node(name,type){this.name=name,this.type=type,1===type&&(this.attributes=[],this.attributes.map={})}var whiteSpaceRegExp=/^[ \t\r\n]*$/,typeLookup={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11};return Node.prototype={replace:function(node){var self=this;return node.parent&&node.remove(),self.insert(node,self),self.remove(),self},attr:function(name,value){var attrs,i,self=this;if("string"!=typeof name){for(i in name)self.attr(i,name[i]);return self}if(attrs=self.attributes){if(void 0!==value){if(null===value){if(name in attrs.map)for(delete attrs.map[name],i=attrs.length;i--;)if(attrs[i].name===name)return attrs=attrs.splice(i,1),self;return self}if(name in attrs.map){for(i=attrs.length;i--;)if(attrs[i].name===name){attrs[i].value=value;break}}else attrs.push({name:name,value:value});return attrs.map[name]=value,self}return attrs.map[name]}},clone:function(){var i,l,selfAttrs,selfAttr,cloneAttrs,self=this,clone=new Node(self.name,self.type);if(selfAttrs=self.attributes){for((cloneAttrs=[]).map={},i=0,l=selfAttrs.length;i<l;i++)"id"!==(selfAttr=selfAttrs[i]).name&&(cloneAttrs[cloneAttrs.length]={name:selfAttr.name,value:selfAttr.value},cloneAttrs.map[selfAttr.name]=selfAttr.value);clone.attributes=cloneAttrs}return clone.value=self.value,clone.shortEnded=self.shortEnded,clone},wrap:function(wrapper){var self=this;return self.parent.insert(wrapper,self),wrapper.append(self),self},unwrap:function(){var node,next,self=this;for(node=self.firstChild;node;)next=node.next,self.insert(node,self,!0),node=next;self.remove()},remove:function(){var self=this,parent=self.parent,next=self.next,prev=self.prev;return parent&&(parent.firstChild===self?(parent.firstChild=next,next&&(next.prev=null)):prev.next=next,parent.lastChild===self?(parent.lastChild=prev,prev&&(prev.next=null)):next.prev=prev,self.parent=self.next=self.prev=null),self},append:function(node){var last,self=this;return node.parent&&node.remove(),(last=self.lastChild)?(last.next=node,node.prev=last,self.lastChild=node):self.lastChild=self.firstChild=node,node.parent=self,node},insert:function(node,refNode,before){var parent;return node.parent&&node.remove(),parent=refNode.parent||this,before?(refNode===parent.firstChild?parent.firstChild=node:refNode.prev.next=node,node.prev=refNode.prev,node.next=refNode,refNode.prev=node):(refNode===parent.lastChild?parent.lastChild=node:refNode.next.prev=node,node.next=refNode.next,node.prev=refNode,refNode.next=node),node.parent=parent,node},getAll:function(name){var node,self=this,collection=[];for(node=self.firstChild;node;node=walk(node,self))node.name===name&&collection.push(node);return collection},empty:function(){var nodes,i,node,self=this;if(self.firstChild){for(nodes=[],node=self.firstChild;node;node=walk(node,self))nodes.push(node);for(i=nodes.length;i--;)(node=nodes[i]).parent=node.firstChild=node.lastChild=node.next=node.prev=null}return self.firstChild=self.lastChild=null,self},isEmpty:function(elements,whitespace){var i,name,self=this,node=self.firstChild;if(whitespace=whitespace||{},node)do{if(1===node.type){if(node.attributes.map["data-mce-bogus"])continue;if(elements[node.name])return!1;for(i=node.attributes.length;i--;)if("name"===(name=node.attributes[i].name)||0===name.indexOf("data-mce-bookmark"))return!1}if(8===node.type)return!1;if(3===node.type&&!whiteSpaceRegExp.test(node.value))return!1;if(3===node.type&&node.parent&&whitespace[node.parent.name]&&whiteSpaceRegExp.test(node.value))return!1}while(node=walk(node,self));return!0},walk:function(prev){return walk(this,null,prev)}},Node.create=function(name,attrs){var node,attrName;if(node=new Node(name,typeLookup[name]||1),attrs)for(attrName in attrs)node.attr(attrName,attrs[attrName]);return node},Node}),define("tinymce.core.html.SaxParser",["tinymce.core.html.Schema","tinymce.core.html.Entities","tinymce.core.util.Tools"],function(Schema,Entities,Tools){function findEndTag(schema,html,startIndex){var index,matches,tokenRegExp,shortEndedElements,count=1;for(shortEndedElements=schema.getShortEndedElements(),(tokenRegExp=/<([!?\/])?([A-Za-z0-9\-_\:\.]+)((?:\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\/|\s+)>/g).lastIndex=index=startIndex;matches=tokenRegExp.exec(html);){if(index=tokenRegExp.lastIndex,"/"===matches[1])count--;else if(!matches[1]){if(matches[2]in shortEndedElements)continue;count++}if(0===count)break}return index}function SaxParser(settings,schema){function noop(){}var self=this;settings=settings||{},self.schema=schema=schema||new Schema,!1!==settings.fix_self_closing&&(settings.fix_self_closing=!0),each("comment cdata text start end pi doctype".split(" "),function(name){name&&(self[name]=settings[name]||noop)}),self.parse=function(html){function processEndTag(name){var pos,i;for(pos=stack.length;pos--&&stack[pos].name!==name;);if(pos>=0){for(i=stack.length-1;i>=pos;i--)(name=stack[i]).valid&&self.end(name.name);stack.length=pos}}var matches,value,endRegExp,attrList,i,text,name,isInternalElement,removeInternalElements,shortEndedElements,fillAttrsMap,isShortEnded,validate,elementRule,isValidElement,attr,attribsValue,validAttributesMap,validAttributePatterns,attributesRequired,attributesDefault,attributesForced,processHtml,selfClosing,tokenRegExp,attrRegExp,specialElements,attrValue,fixSelfClosing,self=this,index=0,stack=[],idCount=0,decode=Entities.decode,filteredUrlAttrs=Tools.makeMap("src,href,data,background,formaction,poster"),scriptUriRegExp=/((java|vb)script|mhtml):/i,dataUriRegExp=/^data:/i;for(tokenRegExp=new RegExp("<(?:(?:!--([\\w\\W]*?)--\x3e)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:!DOCTYPE([\\w\\W]*?)>)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)>)|(?:([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)((?:\\s+[^\"'>]+(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>]*))*|\\/|\\s+)>))","g"),attrRegExp=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g,shortEndedElements=schema.getShortEndedElements(),selfClosing=settings.self_closing_elements||schema.getSelfClosingElements(),fillAttrsMap=schema.getBoolAttrs(),validate=settings.validate,removeInternalElements=settings.remove_internals,fixSelfClosing=settings.fix_self_closing,specialElements=schema.getSpecialElements(),processHtml=html+">";matches=tokenRegExp.exec(processHtml);){if(index<matches.index&&self.text(decode(html.substr(index,matches.index-index))),value=matches[6])":"===(value=value.toLowerCase()).charAt(0)&&(value=value.substr(1)),processEndTag(value);else if(value=matches[7]){if(matches.index+matches[0].length>html.length){self.text(decode(html.substr(matches.index))),index=matches.index+matches[0].length;continue}if(":"===(value=value.toLowerCase()).charAt(0)&&(value=value.substr(1)),isShortEnded=value in shortEndedElements,fixSelfClosing&&selfClosing[value]&&stack.length>0&&stack[stack.length-1].name===value&&processEndTag(value),!validate||(elementRule=schema.getElementRule(value))){if(isValidElement=!0,validate&&(validAttributesMap=elementRule.attributes,validAttributePatterns=elementRule.attributePatterns),(attribsValue=matches[8])?((isInternalElement=-1!==attribsValue.indexOf("data-mce-type"))&&removeInternalElements&&(isValidElement=!1),(attrList=[]).map={},attribsValue.replace(attrRegExp,function(match,name,value,val2,val3){var attrRule,i,trimRegExp=/[\s\u0000-\u001F]+/g;if(name=name.toLowerCase(),value=name in fillAttrsMap?name:decode(value||val2||val3||""),validate&&!isInternalElement&&!1===isValidPrefixAttrName(name)){if(!(attrRule=validAttributesMap[name])&&validAttributePatterns){for(i=validAttributePatterns.length;i--&&!(attrRule=validAttributePatterns[i]).pattern.test(name););-1===i&&(attrRule=null)}if(!attrRule)return;if(attrRule.validValues&&!(value in attrRule.validValues))return}if(filteredUrlAttrs[name]&&!settings.allow_script_urls){var uri=value.replace(trimRegExp,"");try{uri=decodeURIComponent(uri)}catch(ex){uri=unescape(uri)}if(scriptUriRegExp.test(uri))return;if(!settings.allow_html_data_urls&&dataUriRegExp.test(uri)&&!/^data:image\//i.test(uri))return}isInternalElement&&(name in filteredUrlAttrs||0===name.indexOf("on"))||(attrList.map[name]=value,attrList.push({name:name,value:value}))})):(attrList=[]).map={},validate&&!isInternalElement){if(attributesRequired=elementRule.attributesRequired,attributesDefault=elementRule.attributesDefault,attributesForced=elementRule.attributesForced,elementRule.removeEmptyAttrs&&!attrList.length&&(isValidElement=!1),attributesForced)for(i=attributesForced.length;i--;)name=(attr=attributesForced[i]).name,"{$uid}"===(attrValue=attr.value)&&(attrValue="mce_"+idCount++),attrList.map[name]=attrValue,attrList.push({name:name,value:attrValue});if(attributesDefault)for(i=attributesDefault.length;i--;)(name=(attr=attributesDefault[i]).name)in attrList.map||("{$uid}"===(attrValue=attr.value)&&(attrValue="mce_"+idCount++),attrList.map[name]=attrValue,attrList.push({name:name,value:attrValue}));if(attributesRequired){for(i=attributesRequired.length;i--&&!(attributesRequired[i]in attrList.map););-1===i&&(isValidElement=!1)}if(attr=attrList.map["data-mce-bogus"]){if("all"===attr){index=findEndTag(schema,html,tokenRegExp.lastIndex),tokenRegExp.lastIndex=index;continue}isValidElement=!1}}isValidElement&&self.start(value,attrList,isShortEnded)}else isValidElement=!1;if(endRegExp=specialElements[value]){endRegExp.lastIndex=index=matches.index+matches[0].length,(matches=endRegExp.exec(html))?(isValidElement&&(text=html.substr(index,matches.index-index)),index=matches.index+matches[0].length):(text=html.substr(index),index=html.length),isValidElement&&(text.length>0&&self.text(text,!0),self.end(value)),tokenRegExp.lastIndex=index;continue}isShortEnded||(attribsValue&&attribsValue.indexOf("/")==attribsValue.length-1?isValidElement&&self.end(value):stack.push({name:value,valid:isValidElement}))}else(value=matches[1])?(">"===value.charAt(0)&&(value=" "+value),settings.allow_conditional_comments||"[if"!==value.substr(0,3).toLowerCase()||(value=" "+value),self.comment(value)):(value=matches[2])?self.cdata(trimComments(value)):(value=matches[3])?self.doctype(value):(value=matches[4])&&self.pi(value,matches[5]);index=matches.index+matches[0].length}for(index<html.length&&self.text(decode(html.substr(index))),i=stack.length-1;i>=0;i--)(value=stack[i]).valid&&self.end(value.name)}}var each=Tools.each,isValidPrefixAttrName=function(name){return 0===name.indexOf("data-")||0===name.indexOf("aria-")},trimComments=function(text){return text.replace(/<!--|-->/g,"")};return SaxParser.findEndTag=findEndTag,SaxParser}),define("tinymce.core.html.DomParser",["tinymce.core.html.Node","tinymce.core.html.Schema","tinymce.core.html.SaxParser","tinymce.core.util.Tools"],function(Node,Schema,SaxParser,Tools){var makeMap=Tools.makeMap,each=Tools.each,explode=Tools.explode,extend=Tools.extend,paddEmptyNode=function(settings,node){settings.padd_empty_with_br?node.empty().append(new Node("br","1")).shortEnded=!0:node.empty().append(new Node("#text","3")).value=""},hasOnlyChild=function(node,name){return node&&node.firstChild===node.lastChild&&node.firstChild.name===name};return function(settings,schema){function fixInvalidChildren(nodes){var ni,node,parent,parents,newParent,currentNode,tempNode,childNode,i,nonEmptyElements,whitespaceElements,nonSplitableElements,textBlockElements,specialElements,sibling,nextNode;for(nonSplitableElements=makeMap("tr,td,th,tbody,thead,tfoot,table"),nonEmptyElements=schema.getNonEmptyElements(),whitespaceElements=schema.getWhiteSpaceElements(),textBlockElements=schema.getTextBlockElements(),specialElements=schema.getSpecialElements(),ni=0;ni<nodes.length;ni++)if((node=nodes[ni]).parent&&!node.fixed)if(textBlockElements[node.name]&&"li"==node.parent.name){for(sibling=node.next;sibling&&textBlockElements[sibling.name];)sibling.name="li",sibling.fixed=!0,node.parent.insert(sibling,node.parent),sibling=sibling.next;node.unwrap(node)}else{for(parents=[node],parent=node.parent;parent&&!schema.isValidChild(parent.name,node.name)&&!nonSplitableElements[parent.name];parent=parent.parent)parents.push(parent);if(parent&&parents.length>1){for(parents.reverse(),newParent=currentNode=self.filterNode(parents[0].clone()),i=0;i<parents.length-1;i++){for(schema.isValidChild(currentNode.name,parents[i].name)?(tempNode=self.filterNode(parents[i].clone()),currentNode.append(tempNode)):tempNode=currentNode,childNode=parents[i].firstChild;childNode&&childNode!=parents[i+1];)nextNode=childNode.next,tempNode.append(childNode),childNode=nextNode;currentNode=tempNode}newParent.isEmpty(nonEmptyElements,whitespaceElements)?parent.insert(node,parents[0],!0):(parent.insert(newParent,parents[0],!0),parent.insert(node,newParent)),((parent=parents[0]).isEmpty(nonEmptyElements,whitespaceElements)||hasOnlyChild(parent,"br"))&&parent.empty().remove()}else if(node.parent){if("li"===node.name){if((sibling=node.prev)&&("ul"===sibling.name||"ul"===sibling.name)){sibling.append(node);continue}if((sibling=node.next)&&("ul"===sibling.name||"ul"===sibling.name)){sibling.insert(node,sibling.firstChild,!0);continue}node.wrap(self.filterNode(new Node("ul",1)));continue}schema.isValidChild(node.parent.name,"div")&&schema.isValidChild("div",node.name)?node.wrap(self.filterNode(new Node("div",1))):specialElements[node.name]?node.empty().remove():node.unwrap()}}}var self=this,nodeFilters={},attributeFilters=[],matchedNodes={},matchedAttributes={};(settings=settings||{}).validate=!("validate"in settings)||settings.validate,settings.root_name=settings.root_name||"body",self.schema=schema=schema||new Schema,self.filterNode=function(node){var i,name,list;name in nodeFilters&&((list=matchedNodes[name])?list.push(node):matchedNodes[name]=[node]),i=attributeFilters.length;for(;i--;)(name=attributeFilters[i].name)in node.attributes.map&&((list=matchedAttributes[name])?list.push(node):matchedAttributes[name]=[node]);return node},self.addNodeFilter=function(name,callback){each(explode(name),function(name){var list=nodeFilters[name];list||(nodeFilters[name]=list=[]),list.push(callback)})},self.addAttributeFilter=function(name,callback){each(explode(name),function(name){var i;for(i=0;i<attributeFilters.length;i++)if(attributeFilters[i].name===name)return void attributeFilters[i].callbacks.push(callback);attributeFilters.push({name:name,callbacks:[callback]})})},self.parse=function(html,args){function createNode(name,type){var list,node=new Node(name,type);return name in nodeFilters&&((list=matchedNodes[name])?list.push(node):matchedNodes[name]=[node]),node}function removeWhitespaceBefore(node){var textNode,textNodeNext,textVal,sibling,blockElements=schema.getBlockElements();for(textNode=node.prev;textNode&&3===textNode.type;){if((textVal=textNode.value.replace(endWhiteSpaceRegExp,"")).length>0)return void(textNode.value=textVal);if(textNodeNext=textNode.next){if(3==textNodeNext.type&&textNodeNext.value.length){textNode=textNode.prev;continue}if(!blockElements[textNodeNext.name]&&"script"!=textNodeNext.name&&"style"!=textNodeNext.name){textNode=textNode.prev;continue}}sibling=textNode.prev,textNode.remove(),textNode=sibling}}var parser,rootNode,node,nodes,i,l,fi,fl,list,name,validate,blockElements,startWhiteSpaceRegExp,isInWhiteSpacePreservedElement,endWhiteSpaceRegExp,allWhiteSpaceRegExp,isAllWhiteSpaceRegExp,whiteSpaceElements,children,nonEmptyElements,rootBlockName,invalidChildren=[];if(args=args||{},matchedNodes={},matchedAttributes={},blockElements=extend(makeMap("script,style,head,html,body,title,meta,param"),schema.getBlockElements()),nonEmptyElements=schema.getNonEmptyElements(),children=schema.children,validate=settings.validate,rootBlockName="forced_root_block"in args?args.forced_root_block:settings.forced_root_block,whiteSpaceElements=schema.getWhiteSpaceElements(),startWhiteSpaceRegExp=/^[ \t\r\n]+/,endWhiteSpaceRegExp=/[ \t\r\n]+$/,allWhiteSpaceRegExp=/[ \t\r\n]+/g,isAllWhiteSpaceRegExp=/^[ \t\r\n]+$/,parser=new SaxParser({validate:validate,allow_script_urls:settings.allow_script_urls,allow_conditional_comments:settings.allow_conditional_comments,self_closing_elements:function(input){var name,output={};for(name in input)"li"!==name&&"p"!=name&&(output[name]=input[name]);return output}(schema.getSelfClosingElements()),cdata:function(text){node.append(createNode("#cdata",4)).value=text},text:function(text,raw){var textNode;isInWhiteSpacePreservedElement||(text=text.replace(allWhiteSpaceRegExp," "),node.lastChild&&blockElements[node.lastChild.name]&&(text=text.replace(startWhiteSpaceRegExp,""))),0!==text.length&&((textNode=createNode("#text",3)).raw=!!raw,node.append(textNode).value=text)},comment:function(text){node.append(createNode("#comment",8)).value=text},pi:function(name,text){node.append(createNode(name,7)).value=text,removeWhitespaceBefore(node)},doctype:function(text){node.append(createNode("#doctype",10)).value=text,removeWhitespaceBefore(node)},start:function(name,attrs,empty){var newNode,attrFiltersLen,elementRule,attrName,parent;if(elementRule=validate?schema.getElementRule(name):{}){for((newNode=createNode(elementRule.outputName||name,1)).attributes=attrs,newNode.shortEnded=empty,node.append(newNode),(parent=children[node.name])&&children[newNode.name]&&!parent[newNode.name]&&invalidChildren.push(newNode),attrFiltersLen=attributeFilters.length;attrFiltersLen--;)(attrName=attributeFilters[attrFiltersLen].name)in attrs.map&&((list=matchedAttributes[attrName])?list.push(newNode):matchedAttributes[attrName]=[newNode]);blockElements[name]&&removeWhitespaceBefore(newNode),empty||(node=newNode),!isInWhiteSpacePreservedElement&&whiteSpaceElements[name]&&(isInWhiteSpacePreservedElement=!0)}},end:function(name){var textNode,elementRule,text,sibling,tempNode;if(elementRule=validate?schema.getElementRule(name):{}){if(blockElements[name]&&!isInWhiteSpacePreservedElement){if((textNode=node.firstChild)&&3===textNode.type)if((text=textNode.value.replace(startWhiteSpaceRegExp,"")).length>0)textNode.value=text,textNode=textNode.next;else for(sibling=textNode.next,textNode.remove(),textNode=sibling;textNode&&3===textNode.type;)text=textNode.value,sibling=textNode.next,(0===text.length||isAllWhiteSpaceRegExp.test(text))&&(textNode.remove(),textNode=sibling),textNode=sibling;if((textNode=node.lastChild)&&3===textNode.type)if((text=textNode.value.replace(endWhiteSpaceRegExp,"")).length>0)textNode.value=text,textNode=textNode.prev;else for(sibling=textNode.prev,textNode.remove(),textNode=sibling;textNode&&3===textNode.type;)text=textNode.value,sibling=textNode.prev,(0===text.length||isAllWhiteSpaceRegExp.test(text))&&(textNode.remove(),textNode=sibling),textNode=sibling}if(isInWhiteSpacePreservedElement&&whiteSpaceElements[name]&&(isInWhiteSpacePreservedElement=!1),(elementRule.removeEmpty||elementRule.paddEmpty)&&node.isEmpty(nonEmptyElements,whiteSpaceElements))if(elementRule.paddEmpty)paddEmptyNode(settings,node);else if(!node.attributes.map.name&&!node.attributes.map.id)return tempNode=node.parent,blockElements[node.name]?node.empty().remove():node.unwrap(),void(node=tempNode);node=node.parent}}},schema),rootNode=node=new Node(args.context||settings.root_name,11),parser.parse(html),validate&&invalidChildren.length&&(args.context?args.invalid=!0:fixInvalidChildren(invalidChildren)),rootBlockName&&("body"==rootNode.name||args.isRootContent)&&function(){function trim(rootBlockNode){rootBlockNode&&((node=rootBlockNode.firstChild)&&3==node.type&&(node.value=node.value.replace(startWhiteSpaceRegExp,"")),(node=rootBlockNode.lastChild)&&3==node.type&&(node.value=node.value.replace(endWhiteSpaceRegExp,"")))}var next,rootBlockNode,node=rootNode.firstChild;if(schema.isValidChild(rootNode.name,rootBlockName.toLowerCase())){for(;node;)next=node.next,3==node.type||1==node.type&&"p"!==node.name&&!blockElements[node.name]&&!node.attr("data-mce-type")?rootBlockNode?rootBlockNode.append(node):((rootBlockNode=createNode(rootBlockName,1)).attr(settings.forced_root_block_attrs),rootNode.insert(rootBlockNode,node),rootBlockNode.append(node)):(trim(rootBlockNode),rootBlockNode=null),node=next;trim(rootBlockNode)}}(),!args.invalid){for(name in matchedNodes){for(list=nodeFilters[name],fi=(nodes=matchedNodes[name]).length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(i=0,l=list.length;i<l;i++)list[i](nodes,name,args)}for(i=0,l=attributeFilters.length;i<l;i++)if((list=attributeFilters[i]).name in matchedAttributes){for(fi=(nodes=matchedAttributes[list.name]).length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(fi=0,fl=list.callbacks.length;fi<fl;fi++)list.callbacks[fi](nodes,list.name,args)}}return rootNode},settings.remove_trailing_brs&&self.addNodeFilter("br",function(nodes){var i,node,parent,lastParent,prev,prevName,elementRule,textNode,l=nodes.length,blockElements=extend({},schema.getBlockElements()),nonEmptyElements=schema.getNonEmptyElements(),whiteSpaceElements=schema.getNonEmptyElements();for(blockElements.body=1,i=0;i<l;i++)if(node=nodes[i],parent=node.parent,blockElements[node.parent.name]&&node===parent.lastChild){for(prev=node.prev;prev;){if("span"!==(prevName=prev.name)||"bookmark"!==prev.attr("data-mce-type")){if("br"!==prevName)break;if("br"===prevName){node=null;break}}prev=prev.prev}node&&(node.remove(),parent.isEmpty(nonEmptyElements,whiteSpaceElements)&&(elementRule=schema.getElementRule(parent.name))&&(elementRule.removeEmpty?parent.remove():elementRule.paddEmpty&&paddEmptyNode(settings,parent)))}else{for(lastParent=node;parent&&parent.firstChild===lastParent&&parent.lastChild===lastParent&&(lastParent=parent,!blockElements[parent.name]);)parent=parent.parent;lastParent===parent&&!0!==settings.padd_empty_with_br&&((textNode=new Node("#text",3)).value="",node.replace(textNode))}}),self.addAttributeFilter("href",function(nodes){var node,i=nodes.length,appendRel=function(rel){return rel.split(" ").filter(function(p){return p.length>0}).concat(["noopener"]).sort().join(" ")};if(!settings.allow_unsafe_link_target)for(;i--;)"a"===(node=nodes[i]).name&&"_blank"===node.attr("target")&&node.attr("rel",function(rel){var newRel=rel?Tools.trim(rel):"";return/\b(noopener)\b/g.test(newRel)?newRel:appendRel(newRel)}(node.attr("rel")))}),settings.allow_html_in_named_anchor||self.addAttributeFilter("id,name",function(nodes){for(var sibling,prevSibling,parent,node,i=nodes.length;i--;)if("a"===(node=nodes[i]).name&&node.firstChild&&!node.attr("href")){parent=node.parent,sibling=node.lastChild;do{prevSibling=sibling.prev,parent.insert(sibling,node),sibling=prevSibling}while(sibling)}}),settings.fix_list_elements&&self.addNodeFilter("ul,ol",function(nodes){for(var node,parentNode,i=nodes.length;i--;)if(node=nodes[i],"ul"===(parentNode=node.parent).name||"ol"===parentNode.name)if(node.prev&&"li"===node.prev.name)node.prev.append(node);else{var li=new Node("li",1);li.attr("style","list-style-type: none"),node.wrap(li)}}),settings.validate&&schema.getValidClasses()&&self.addAttributeFilter("class",function(nodes){for(var node,classList,ci,className,classValue,validClassesMap,valid,i=nodes.length,validClasses=schema.getValidClasses();i--;){for(classList=(node=nodes[i]).attr("class").split(" "),classValue="",ci=0;ci<classList.length;ci++)className=classList[ci],valid=!1,(validClassesMap=validClasses["*"])&&validClassesMap[className]&&(valid=!0),validClassesMap=validClasses[node.name],!valid&&validClassesMap&&validClassesMap[className]&&(valid=!0),valid&&(classValue&&(classValue+=" "),classValue+=className);classValue.length||(classValue=null),node.attr("class",classValue)}})}}),define("tinymce.core.html.Writer",["tinymce.core.html.Entities","tinymce.core.util.Tools"],function(Entities,Tools){var makeMap=Tools.makeMap;return function(settings){var indent,indentBefore,indentAfter,encode,htmlOutput,html=[];return settings=settings||{},indent=settings.indent,indentBefore=makeMap(settings.indent_before||""),indentAfter=makeMap(settings.indent_after||""),encode=Entities.getEncodeFunc(settings.entity_encoding||"raw",settings.entities),htmlOutput="html"==settings.element_format,{start:function(name,attrs,empty){var i,l,attr,value;if(indent&&indentBefore[name]&&html.length>0&&(value=html[html.length-1]).length>0&&"\n"!==value&&html.push("\n"),html.push("<",name),attrs)for(i=0,l=attrs.length;i<l;i++)attr=attrs[i],html.push(" ",attr.name,'="',encode(attr.value,!0),'"');html[html.length]=!empty||htmlOutput?">":" />",empty&&indent&&indentAfter[name]&&html.length>0&&(value=html[html.length-1]).length>0&&"\n"!==value&&html.push("\n")},end:function(name){var value;html.push("</",name,">"),indent&&indentAfter[name]&&html.length>0&&(value=html[html.length-1]).length>0&&"\n"!==value&&html.push("\n")},text:function(text,raw){text.length>0&&(html[html.length]=raw?text:encode(text))},cdata:function(text){html.push("<![CDATA[",text,"]]>")},comment:function(text){html.push("\x3c!--",text,"--\x3e")},pi:function(name,text){text?html.push("<?",name," ",encode(text),"?>"):html.push("<?",name,"?>"),indent&&html.push("\n")},doctype:function(text){html.push("<!DOCTYPE",text,">",indent?"\n":"")},reset:function(){html.length=0},getContent:function(){return html.join("").replace(/\n$/,"")}}}}),define("tinymce.core.html.Serializer",["tinymce.core.html.Writer","tinymce.core.html.Schema"],function(Writer,Schema){return function(settings,schema){var self=this,writer=new Writer(settings);(settings=settings||{}).validate=!("validate"in settings)||settings.validate,self.schema=schema=schema||new Schema,self.writer=writer,self.serialize=function(node){function walk(node){var name,isEmpty,attrs,attrName,attrValue,sortedAttrs,i,l,elementRule,handler=handlers[node.type];if(handler)handler(node);else{if(name=node.name,isEmpty=node.shortEnded,attrs=node.attributes,validate&&attrs&&attrs.length>1&&(sortedAttrs=[],sortedAttrs.map={},elementRule=schema.getElementRule(node.name))){for(i=0,l=elementRule.attributesOrder.length;i<l;i++)(attrName=elementRule.attributesOrder[i])in attrs.map&&(attrValue=attrs.map[attrName],sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue}));for(i=0,l=attrs.length;i<l;i++)(attrName=attrs[i].name)in sortedAttrs.map||(attrValue=attrs.map[attrName],sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue}));attrs=sortedAttrs}if(writer.start(node.name,attrs,isEmpty),!isEmpty){if(node=node.firstChild)do{walk(node)}while(node=node.next);writer.end(name)}}}var handlers,validate;return validate=settings.validate,handlers={3:function(node){writer.text(node.value,node.raw)},8:function(node){writer.comment(node.value)},7:function(node){writer.pi(node.name,node.value)},10:function(node){writer.doctype(node.value)},4:function(node){writer.cdata(node.value)},11:function(node){if(node=node.firstChild)do{walk(node)}while(node=node.next)}},writer.reset(),1!=node.type||settings.inner?handlers[11](node):walk(node),writer.getContent()}}}),define("tinymce.core.dom.Serializer",["tinymce.core.dom.DOMUtils","tinymce.core.html.DomParser","tinymce.core.html.SaxParser","tinymce.core.html.Entities","tinymce.core.html.Serializer","tinymce.core.html.Node","tinymce.core.html.Schema","tinymce.core.Env","tinymce.core.util.Tools","tinymce.core.text.Zwsp"],function(DOMUtils,DomParser,SaxParser,Entities,Serializer,Node,Schema,Env,Tools,Zwsp){function trimTrailingBr(rootNode){function isBr(node){return node&&"br"===node.name}var brNode1,brNode2;isBr(brNode1=rootNode.lastChild)&&isBr(brNode2=brNode1.prev)&&(brNode1.remove(),brNode2.remove())}var each=Tools.each,trim=Tools.trim,DOM=DOMUtils.DOM;return function(settings,editor){function trimHtml(html){var trimContentRegExp=new RegExp(["<span[^>]+data-mce-bogus[^>]+>[\ufeff]+<\\/span>","\\s?("+tempAttrs.join("|")+')="[^"]+"'].join("|"),"gi");return html=Zwsp.trim(html.replace(trimContentRegExp,""))}function trimContent(html){var endTagIndex,index,matchLength,matches,shortEndedElements,content=html,bogusAllRegExp=/<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g,schema=editor.schema;for(content=trimHtml(content),shortEndedElements=schema.getShortEndedElements();matches=bogusAllRegExp.exec(content);)index=bogusAllRegExp.lastIndex,matchLength=matches[0].length,endTagIndex=shortEndedElements[matches[1]]?index:SaxParser.findEndTag(schema,content,index),content=content.substring(0,index-matchLength)+content.substring(endTagIndex),bogusAllRegExp.lastIndex=index-matchLength;return content}var dom,schema,htmlParser,tempAttrs=["data-mce-selected"];return editor&&(dom=editor.dom,schema=editor.schema),dom=dom||DOM,schema=schema||new Schema(settings),settings.entity_encoding=settings.entity_encoding||"named",settings.remove_trailing_brs=!("remove_trailing_brs"in settings)||settings.remove_trailing_brs,(htmlParser=new DomParser(settings,schema)).addAttributeFilter("data-mce-tabindex",function(nodes,name){for(var node,i=nodes.length;i--;)(node=nodes[i]).attr("tabindex",node.attributes.map["data-mce-tabindex"]),node.attr(name,null)}),htmlParser.addAttributeFilter("src,href,style",function(nodes,name){for(var node,value,i=nodes.length,internalName="data-mce-"+name,urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope;i--;)void 0!==(value=(node=nodes[i]).attributes.map[internalName])?(node.attr(name,value.length>0?value:null),node.attr(internalName,null)):(value=node.attributes.map[name],"style"===name?value=dom.serializeStyle(dom.parseStyle(value),node.name):urlConverter&&(value=urlConverter.call(urlConverterScope,value,name,node.name)),node.attr(name,value.length>0?value:null))}),htmlParser.addAttributeFilter("class",function(nodes){for(var node,value,i=nodes.length;i--;)(value=(node=nodes[i]).attr("class"))&&(value=node.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,""),node.attr("class",value.length>0?value:null))}),htmlParser.addAttributeFilter("data-mce-type",function(nodes,name,args){for(var node,i=nodes.length;i--;)"bookmark"!==(node=nodes[i]).attributes.map["data-mce-type"]||args.cleanup||node.remove()}),htmlParser.addNodeFilter("noscript",function(nodes){for(var node,i=nodes.length;i--;)(node=nodes[i].firstChild)&&(node.value=Entities.decode(node.value))}),htmlParser.addNodeFilter("script,style",function(nodes,name){function trim(value){return value.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")}for(var node,value,type,i=nodes.length;i--;)value=(node=nodes[i]).firstChild?node.firstChild.value:"","script"===name?((type=node.attr("type"))&&node.attr("type","mce-no/type"==type?null:type.replace(/^mce\-/,"")),value.length>0&&(node.firstChild.value="// <![CDATA[\n"+trim(value)+"\n// ]]>")):value.length>0&&(node.firstChild.value="\x3c!--\n"+trim(value)+"\n--\x3e")}),htmlParser.addNodeFilter("#comment",function(nodes){for(var node,i=nodes.length;i--;)0===(node=nodes[i]).value.indexOf("[CDATA[")?(node.name="#cdata",node.type=4,node.value=node.value.replace(/^\[CDATA\[|\]\]$/g,"")):0===node.value.indexOf("mce:protected ")&&(node.name="#text",node.type=3,node.raw=!0,node.value=unescape(node.value).substr(14))}),htmlParser.addNodeFilter("xml:namespace,input",function(nodes,name){for(var node,i=nodes.length;i--;)7===(node=nodes[i]).type?node.remove():1===node.type&&("input"!==name||"type"in node.attributes.map||node.attr("type","text"))}),htmlParser.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-type,data-mce-resize",function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)}),{schema:schema,addNodeFilter:htmlParser.addNodeFilter,addAttributeFilter:htmlParser.addAttributeFilter,serialize:function(node,args){var impl,doc,oldDoc,htmlSerializer,content,rootNode,self=this;return Env.ie&&dom.select("script,style,select,map").length>0?(content=node.innerHTML,node=node.cloneNode(!1),dom.setHTML(node,content)):node=node.cloneNode(!0),(impl=document.implementation).createHTMLDocument&&(doc=impl.createHTMLDocument(""),each("BODY"==node.nodeName?node.childNodes:[node],function(node){doc.body.appendChild(doc.importNode(node,!0))}),node="BODY"!=node.nodeName?doc.body.firstChild:doc.body,oldDoc=dom.doc,dom.doc=doc),args=args||{},args.format=args.format||"html",args.selection&&(args.forced_root_block=""),args.no_events||(args.node=node,self.onPreProcess(args)),content=Zwsp.trim(trim(args.getInner?node.innerHTML:dom.getOuterHTML(node))),rootNode=htmlParser.parse(content,args),trimTrailingBr(rootNode),htmlSerializer=new Serializer(settings,schema),args.content=htmlSerializer.serialize(rootNode),args.no_events||self.onPostProcess(args),oldDoc&&(dom.doc=oldDoc),args.node=null,args.content},addRules:function(rules){schema.addValidElements(rules)},setRules:function(rules){schema.setValidElements(rules)},onPreProcess:function(args){editor&&editor.fire("PreProcess",args)},onPostProcess:function(args){editor&&editor.fire("PostProcess",args)},addTempAttr:function(name){-1===Tools.inArray(tempAttrs,name)&&(htmlParser.addAttributeFilter(name,function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)}),tempAttrs.push(name))},trimHtml:trimHtml,getTrimmedContent:function(){return trimContent(editor.getBody().innerHTML)},trimContent:trimContent}}}),define("tinymce.core.util.VK",["tinymce.core.Env"],function(Env){return{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,modifierPressed:function(e){return e.shiftKey||e.ctrlKey||e.altKey||this.metaKeyPressed(e)},metaKeyPressed:function(e){return Env.mac?e.metaKey:e.ctrlKey&&!e.altKey}}}),define("tinymce.core.dom.RangePoint",["ephox.katamari.api.Arr","tinymce.core.geom.ClientRect"],function(Arr,ClientRect){return{isXYWithinRange:function(clientX,clientY,range){return!range.collapsed&&Arr.foldl(range.getClientRects(),function(state,rect){return state||ClientRect.containsXY(rect,clientX,clientY)},!1)}}}),define("tinymce.core.dom.ControlSelection",["ephox.katamari.api.Fun","ephox.sugar.api.node.Element","ephox.sugar.api.search.Selectors","tinymce.core.dom.NodeType","tinymce.core.dom.RangePoint","tinymce.core.Env","tinymce.core.util.Delay","tinymce.core.util.Tools","tinymce.core.util.VK"],function(Fun,Element,Selectors,NodeType,RangePoint,Env,Delay,Tools,VK){function getContentEditableRoot(root,node){for(;node&&node!=root;){if(isContentEditableTrue(node)||isContentEditableFalse(node))return node;node=node.parentNode}return null}var isContentEditableFalse=NodeType.isContentEditableFalse,isContentEditableTrue=NodeType.isContentEditableTrue,isImage=function(elm){return elm&&"IMG"===elm.nodeName},isEventOnImageOutsideRange=function(evt,range){return isImage(evt.target)&&!RangePoint.isXYWithinRange(evt.clientX,evt.clientY,range)},contextMenuSelectImage=function(editor,evt){var target=evt.target;isEventOnImageOutsideRange(evt,editor.selection.getRng())&&!evt.isDefaultPrevented()&&(evt.preventDefault(),editor.selection.select(target))};return function(selection,editor){function isResizable(elm){var selector=editor.settings.object_resizing;return!1!==selector&&!Env.iOS&&("string"!=typeof selector&&(selector="table,img,div"),"false"!==elm.getAttribute("data-mce-resize")&&(elm!=editor.getBody()&&Selectors.is(Element.fromDom(elm),selector)))}function resizeGhostElement(e){var deltaX,deltaY,resizeHelperX,resizeHelperY;deltaX=e.screenX-startX,deltaY=e.screenY-startY,width=deltaX*selectedHandle[2]+startW,height=deltaY*selectedHandle[3]+startH,width=width<5?5:width,height=height<5?5:height,("IMG"==selectedElm.nodeName&&!1!==editor.settings.resize_img_proportional?!VK.modifierPressed(e):VK.modifierPressed(e)||"IMG"==selectedElm.nodeName&&selectedHandle[2]*selectedHandle[3]!=0)&&(abs(deltaX)>abs(deltaY)?(height=round(width*ratio),width=round(height/ratio)):(width=round(height/ratio),height=round(width*ratio))),dom.setStyles(selectedElmGhost,{width:width,height:height}),resizeHelperX=selectedHandle.startPos.x+deltaX,resizeHelperY=selectedHandle.startPos.y+deltaY,resizeHelperX=resizeHelperX>0?resizeHelperX:0,resizeHelperY=resizeHelperY>0?resizeHelperY:0,dom.setStyles(resizeHelper,{left:resizeHelperX,top:resizeHelperY,display:"block"}),resizeHelper.innerHTML=width+" &times; "+height,selectedHandle[2]<0&&selectedElmGhost.clientWidth<=width&&dom.setStyle(selectedElmGhost,"left",selectedElmX+(startW-width)),selectedHandle[3]<0&&selectedElmGhost.clientHeight<=height&&dom.setStyle(selectedElmGhost,"top",selectedElmY+(startH-height)),(deltaX=rootElement.scrollWidth-startScrollWidth)+(deltaY=rootElement.scrollHeight-startScrollHeight)!==0&&dom.setStyles(resizeHelper,{left:resizeHelperX-deltaX,top:resizeHelperY-deltaY}),resizeStarted||(editor.fire("ObjectResizeStart",{target:selectedElm,width:startW,height:startH}),resizeStarted=!0)}function endGhostResize(){function setSizeProp(name,value){value&&(selectedElm.style[name]||!editor.schema.isValid(selectedElm.nodeName.toLowerCase(),name)?dom.setStyle(selectedElm,name,value):dom.setAttrib(selectedElm,name,value))}resizeStarted=!1,setSizeProp("width",width),setSizeProp("height",height),dom.unbind(editableDoc,"mousemove",resizeGhostElement),dom.unbind(editableDoc,"mouseup",endGhostResize),rootDocument!=editableDoc&&(dom.unbind(rootDocument,"mousemove",resizeGhostElement),dom.unbind(rootDocument,"mouseup",endGhostResize)),dom.remove(selectedElmGhost),dom.remove(resizeHelper),isIE&&"TABLE"!=selectedElm.nodeName||showResizeRect(selectedElm),editor.fire("ObjectResized",{target:selectedElm,width:width,height:height}),dom.setAttrib(selectedElm,"style",dom.getAttrib(selectedElm,"style")),editor.nodeChanged()}function showResizeRect(targetElm,mouseDownHandleName,mouseDownEvent){var position,targetWidth,targetHeight,e,rect;hideResizeRect(),unbindResizeHandleEvents(),position=dom.getPos(targetElm,rootElement),selectedElmX=position.x,selectedElmY=position.y,rect=targetElm.getBoundingClientRect(),targetWidth=rect.width||rect.right-rect.left,targetHeight=rect.height||rect.bottom-rect.top,selectedElm!=targetElm&&(detachResizeStartListener(),selectedElm=targetElm,width=height=0),e=editor.fire("ObjectSelected",{target:targetElm}),isResizable(targetElm)&&!e.isDefaultPrevented()?each(resizeHandles,function(handle,name){function startDrag(e){startX=e.screenX,startY=e.screenY,startW=selectedElm.clientWidth,startH=selectedElm.clientHeight,ratio=startH/startW,selectedHandle=handle,handle.startPos={x:targetWidth*handle[0]+selectedElmX,y:targetHeight*handle[1]+selectedElmY},startScrollWidth=rootElement.scrollWidth,startScrollHeight=rootElement.scrollHeight,selectedElmGhost=selectedElm.cloneNode(!0),dom.addClass(selectedElmGhost,"mce-clonedresizable"),dom.setAttrib(selectedElmGhost,"data-mce-bogus","all"),selectedElmGhost.contentEditable=!1,selectedElmGhost.unSelectabe=!0,dom.setStyles(selectedElmGhost,{left:selectedElmX,top:selectedElmY,margin:0}),selectedElmGhost.removeAttribute("data-mce-selected"),rootElement.appendChild(selectedElmGhost),dom.bind(editableDoc,"mousemove",resizeGhostElement),dom.bind(editableDoc,"mouseup",endGhostResize),rootDocument!=editableDoc&&(dom.bind(rootDocument,"mousemove",resizeGhostElement),dom.bind(rootDocument,"mouseup",endGhostResize)),resizeHelper=dom.add(rootElement,"div",{class:"mce-resize-helper","data-mce-bogus":"all"},startW+" &times; "+startH)}var handleElm;mouseDownHandleName?name==mouseDownHandleName&&startDrag(mouseDownEvent):((handleElm=dom.get("mceResizeHandle"+name))&&dom.remove(handleElm),handleElm=dom.add(rootElement,"div",{id:"mceResizeHandle"+name,"data-mce-bogus":"all",class:"mce-resizehandle",unselectable:!0,style:"cursor:"+name+"-resize; margin:0; padding:0"}),Env.ie&&(handleElm.contentEditable=!1),dom.bind(handleElm,"mousedown",function(e){e.stopImmediatePropagation(),e.preventDefault(),startDrag(e)}),handle.elm=handleElm,dom.setStyles(handleElm,{left:targetWidth*handle[0]+selectedElmX-handleElm.offsetWidth/2,top:targetHeight*handle[1]+selectedElmY-handleElm.offsetHeight/2}))}):hideResizeRect(),selectedElm.setAttribute("data-mce-selected","1")}function hideResizeRect(){var name,handleElm;unbindResizeHandleEvents(),selectedElm&&selectedElm.removeAttribute("data-mce-selected");for(name in resizeHandles)(handleElm=dom.get("mceResizeHandle"+name))&&(dom.unbind(handleElm),dom.remove(handleElm))}function updateResizeRect(e){function isChildOrEqual(node,parent){if(node)do{if(node===parent)return!0}while(node=node.parentNode)}var startElm,controlElm;resizeStarted||editor.removed||(each(dom.select("img[data-mce-selected],hr[data-mce-selected]"),function(img){img.removeAttribute("data-mce-selected")}),controlElm="mousedown"==e.type?e.target:selection.getNode(),isChildOrEqual(controlElm=dom.$(controlElm).closest(isIE?"table":"table,img,hr")[0],rootElement)&&(disableGeckoResize(),startElm=selection.getStart(!0),isChildOrEqual(startElm,controlElm)&&isChildOrEqual(selection.getEnd(!0),controlElm)&&(!isIE||controlElm!=startElm&&"IMG"!==startElm.nodeName))?showResizeRect(controlElm):hideResizeRect())}function attachEvent(elm,name,func){elm&&elm.attachEvent&&elm.attachEvent("on"+name,func)}function detachEvent(elm,name,func){elm&&elm.detachEvent&&elm.detachEvent("on"+name,func)}function resizeNativeStart(e){var pos,name,corner,cornerX,cornerY,relativeX,relativeY,target=e.srcElement;pos=target.getBoundingClientRect(),relativeX=lastMouseDownEvent.clientX-pos.left,relativeY=lastMouseDownEvent.clientY-pos.top;for(name in resizeHandles)if(corner=resizeHandles[name],cornerX=target.offsetWidth*corner[0],cornerY=target.offsetHeight*corner[1],abs(cornerX-relativeX)<8&&abs(cornerY-relativeY)<8){selectedHandle=corner;break}resizeStarted=!0,editor.fire("ObjectResizeStart",{target:selectedElm,width:selectedElm.clientWidth,height:selectedElm.clientHeight}),editor.getDoc().selection.empty(),showResizeRect(target,name,lastMouseDownEvent)}function preventDefault(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function isWithinContentEditableFalse(elm){return isContentEditableFalse(getContentEditableRoot(editor.getBody(),elm))}function nativeControlSelect(e){var target=e.srcElement;if(isWithinContentEditableFalse(target))preventDefault(e);else if(target!=selectedElm){if(editor.fire("ObjectSelected",{target:target}),detachResizeStartListener(),0===target.id.indexOf("mceResizeHandle"))return void(e.returnValue=!1);"IMG"!=target.nodeName&&"TABLE"!=target.nodeName||(hideResizeRect(),selectedElm=target,attachEvent(target,"resizestart",resizeNativeStart))}}function detachResizeStartListener(){detachEvent(selectedElm,"resizestart",resizeNativeStart)}function unbindResizeHandleEvents(){for(var name in resizeHandles){var handle=resizeHandles[name];handle.elm&&(dom.unbind(handle.elm),delete handle.elm)}}function disableGeckoResize(){try{editor.getDoc().execCommand("enableObjectResizing",!1,!1)}catch(ex){}}function controlSelect(elm){var ctrlRng;if(isIE){ctrlRng=editableDoc.body.createControlRange();try{return ctrlRng.addElement(elm),ctrlRng.select(),!0}catch(ex){}}}var selectedElm,selectedElmGhost,resizeHelper,resizeHandles,selectedHandle,lastMouseDownEvent,startX,startY,selectedElmX,selectedElmY,startW,startH,ratio,resizeStarted,width,height,startScrollWidth,startScrollHeight,dom=editor.dom,each=Tools.each,editableDoc=editor.getDoc(),rootDocument=document,isIE=Env.ie&&Env.ie<11,abs=Math.abs,round=Math.round,rootElement=editor.getBody();resizeHandles={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]};var rootClass=".mce-content-body";return editor.contentStyles.push(rootClass+" div.mce-resizehandle {position: absolute;border: 1px solid black;box-sizing: box-sizing;background: #FFF;width: 7px;height: 7px;z-index: 10000}"+rootClass+" .mce-resizehandle:hover {background: #000}"+rootClass+" img[data-mce-selected],"+rootClass+" hr[data-mce-selected] {outline: 1px solid black;resize: none}"+rootClass+" .mce-clonedresizable {position: absolute;"+(Env.gecko?"":"outline: 1px dashed black;")+"opacity: .5;filter: alpha(opacity=50);z-index: 10000}"+rootClass+" .mce-resize-helper {background: #555;background: rgba(0,0,0,0.75);border-radius: 3px;border: 1px;color: white;display: none;font-family: sans-serif;font-size: 12px;white-space: nowrap;line-height: 14px;margin: 5px 10px;padding: 5px;position: absolute;z-index: 10001}"),editor.on("init",function(){isIE?(editor.on("ObjectResized",function(e){"TABLE"!=e.target.nodeName&&(hideResizeRect(),controlSelect(e.target))}),attachEvent(rootElement,"controlselect",nativeControlSelect),editor.on("mousedown",function(e){lastMouseDownEvent=e})):(disableGeckoResize(),Env.ie>=11&&(editor.on("mousedown click",function(e){var target=e.target,nodeName=target.nodeName;resizeStarted||!/^(TABLE|IMG|HR)$/.test(nodeName)||isWithinContentEditableFalse(target)||(2!==e.button&&editor.selection.select(target,"TABLE"==nodeName),"mousedown"==e.type&&editor.nodeChanged())}),editor.dom.bind(rootElement,"mscontrolselect",function(e){function delayedSelect(node){Delay.setEditorTimeout(editor,function(){editor.selection.select(node)})}if(isWithinContentEditableFalse(e.target))return e.preventDefault(),void delayedSelect(e.target);/^(TABLE|IMG|HR)$/.test(e.target.nodeName)&&(e.preventDefault(),"IMG"==e.target.tagName&&delayedSelect(e.target))})));var throttledUpdateResizeRect=Delay.throttle(function(e){editor.composing||updateResizeRect(e)});editor.on("nodechange ResizeEditor ResizeWindow drop",throttledUpdateResizeRect),editor.on("keyup compositionend",function(e){selectedElm&&"TABLE"==selectedElm.nodeName&&throttledUpdateResizeRect(e)}),editor.on("hide blur",hideResizeRect),editor.on("contextmenu",Fun.curry(contextMenuSelectImage,editor))}),editor.on("remove",unbindResizeHandleEvents),{isResizable:isResizable,showResizeRect:showResizeRect,hideResizeRect:hideResizeRect,updateResizeRect:updateResizeRect,controlSelect:controlSelect,destroy:function(){selectedElm=selectedElmGhost=null,isIE&&(detachResizeStartListener(),detachEvent(rootElement,"controlselect",nativeControlSelect))}}}}),define("tinymce.core.dom.ScrollIntoView",["tinymce.core.dom.NodeType"],function(NodeType){var getPos=function(elm){for(var x=0,y=0,offsetParent=elm;offsetParent&&offsetParent.nodeType;)x+=offsetParent.offsetLeft||0,y+=offsetParent.offsetTop||0,offsetParent=offsetParent.offsetParent;return{x:x,y:y}},fireScrollIntoViewEvent=function(editor,elm,alignToTop){var scrollEvent={elm:elm,alignToTop:alignToTop};return editor.fire("scrollIntoView",scrollEvent),scrollEvent.isDefaultPrevented()};return{scrollIntoView:function(editor,elm,alignToTop){var y,viewPort,viewPortY,viewPortH,dom=editor.dom,root=dom.getRoot(),offsetY=0;if(!fireScrollIntoViewEvent(editor,elm,alignToTop)&&NodeType.isElement(elm)){if(!1===alignToTop&&(offsetY=elm.offsetHeight),"BODY"!==root.nodeName){var scrollContainer=editor.selection.getScrollContainer();if(scrollContainer)return y=getPos(elm).y-getPos(scrollContainer).y+offsetY,viewPortH=scrollContainer.clientHeight,viewPortY=scrollContainer.scrollTop,void((y<viewPortY||y+25>viewPortY+viewPortH)&&(scrollContainer.scrollTop=y<viewPortY?y:y-viewPortH+25))}viewPort=dom.getViewPort(editor.getWin()),y=dom.getPos(elm).y+offsetY,viewPortY=viewPort.y,viewPortH=viewPort.h,(y<viewPort.y||y+25>viewPortY+viewPortH)&&editor.getWin().scrollTo(0,y<viewPortY?y:y-viewPortH+25)}}}}),define("tinymce.core.dom.TridentSelection",[],function(){return function(selection){function getPosition(rng,start){var checkRng,endIndex,inside,children,child,offset,index,parent,startIndex=0,position=-1;if((checkRng=rng.duplicate()).collapse(start),(parent=checkRng.parentElement()).ownerDocument===selection.dom.doc){for(;"false"===parent.contentEditable;)parent=parent.parentNode;if(!parent.hasChildNodes())return{node:parent,inside:1};for(endIndex=(children=parent.children).length-1;startIndex<=endIndex;)if(index=Math.floor((startIndex+endIndex)/2),child=children[index],checkRng.moveToElementText(child),(position=checkRng.compareEndPoints(start?"StartToStart":"EndToEnd",rng))>0)endIndex=index-1;else{if(!(position<0))return{node:child};startIndex=index+1}if(position<0)for(child?checkRng.collapse(!1):(checkRng.moveToElementText(parent),checkRng.collapse(!0),child=parent,inside=!0),offset=0;0!==checkRng.compareEndPoints(start?"StartToStart":"StartToEnd",rng)&&0!==checkRng.move("character",1)&&parent==checkRng.parentElement();)offset++;else for(checkRng.collapse(!0),offset=0;0!==checkRng.compareEndPoints(start?"StartToStart":"StartToEnd",rng)&&0!==checkRng.move("character",-1)&&parent==checkRng.parentElement();)offset++;return{node:child,position:position,offset:offset,inside:inside}}}var self=this,dom=selection.dom,FALSE=!1;this.getBookmark=function(type){function getIndexes(node){var parent,root,children,i,indexes=[];for(parent=node.parentNode,root=dom.getRoot().parentNode;parent!=root&&9!==parent.nodeType;){for(i=(children=parent.children).length;i--;)if(node===children[i]){indexes.push(i);break}node=parent,parent=parent.parentNode}return indexes}function getBookmarkEndPoint(start){var position;if(position=getPosition(rng,start))return{position:position.position,offset:position.offset,indexes:getIndexes(position.node),inside:position.inside}}var rng=selection.getRng(),bookmark={};return 2===type&&(rng.item?bookmark.start={ctrl:!0,indexes:getIndexes(rng.item(0))}:(bookmark.start=getBookmarkEndPoint(!0),selection.isCollapsed()||(bookmark.end=getBookmarkEndPoint()))),bookmark},this.moveToBookmark=function(bookmark){function resolveIndexes(indexes){var node,i,idx,children;for(node=dom.getRoot(),i=indexes.length-1;i>=0;i--)children=node.children,(idx=indexes[i])<=children.length-1&&(node=children[idx]);return node}function setBookmarkEndPoint(start){var moveLeft,moveRng,offset,endPoint=bookmark[start?"start":"end"];endPoint&&(moveLeft=endPoint.position>0,(moveRng=body.createTextRange()).moveToElementText(resolveIndexes(endPoint.indexes)),void 0!==(offset=endPoint.offset)?(moveRng.collapse(endPoint.inside||moveLeft),moveRng.moveStart("character",moveLeft?-offset:offset)):moveRng.collapse(start),rng.setEndPoint(start?"StartToStart":"EndToStart",moveRng),start&&rng.collapse(!0))}var rng,body=dom.doc.body;bookmark.start&&(bookmark.start.ctrl?((rng=body.createControlRange()).addElement(resolveIndexes(bookmark.start.indexes)),rng.select()):(rng=body.createTextRange(),setBookmarkEndPoint(!0),setBookmarkEndPoint(),rng.select()))},this.addRange=function(rng){function setEndPoint(start){var container,offset,marker,tmpRng,nodes;marker=dom.create("a"),container=start?startContainer:endContainer,offset=start?startOffset:endOffset,tmpRng=ieRng.duplicate(),container!=doc&&container!=doc.documentElement||(container=body,offset=0),3==container.nodeType?(container.parentNode.insertBefore(marker,container),tmpRng.moveToElementText(marker),tmpRng.moveStart("character",offset),dom.remove(marker),ieRng.setEndPoint(start?"StartToStart":"EndToEnd",tmpRng)):((nodes=container.childNodes).length?(offset>=nodes.length?dom.insertAfter(marker,nodes[nodes.length-1]):container.insertBefore(marker,nodes[offset]),tmpRng.moveToElementText(marker)):container.canHaveHTML&&(container.innerHTML="<span>&#xFEFF;</span>",marker=container.firstChild,tmpRng.moveToElementText(marker),tmpRng.collapse(FALSE)),ieRng.setEndPoint(start?"StartToStart":"EndToEnd",tmpRng),dom.remove(marker))}var ieRng,ctrlRng,startContainer,startOffset,endContainer,endOffset,sibling,nativeRng,ctrlElm,doc=selection.dom.doc,body=doc.body;if(startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,ieRng=body.createTextRange(),startContainer==endContainer&&1==startContainer.nodeType){if(startOffset==endOffset&&!startContainer.hasChildNodes()){if(startContainer.canHaveHTML)return(sibling=startContainer.previousSibling)&&!sibling.hasChildNodes()&&dom.isBlock(sibling)?sibling.innerHTML="&#xFEFF;":sibling=null,startContainer.innerHTML="<span>&#xFEFF;</span><span>&#xFEFF;</span>",ieRng.moveToElementText(startContainer.lastChild),ieRng.select(),dom.doc.selection.clear(),startContainer.innerHTML="",void(sibling&&(sibling.innerHTML=""));startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode}if(startOffset==endOffset-1)try{if(ctrlElm=startContainer.childNodes[startOffset],(ctrlRng=body.createControlRange()).addElement(ctrlElm),ctrlRng.select(),(nativeRng=selection.getRng()).item&&ctrlElm===nativeRng.item(0))return}catch(ex){}}setEndPoint(!0),setEndPoint(),ieRng.select()},this.getRangeAt=function(){function findEndPoint(start){var container,offset,sibling,nodeValue,endPoint=getPosition(ieRange,start),textNodeOffset=0;if(container=endPoint.node,offset=endPoint.offset,!endPoint.inside||container.hasChildNodes())if(void 0!==offset){if(endPoint.position<0){if(!(sibling=endPoint.inside?container.firstChild:container.nextSibling))return void domRange[start?"setStartAfter":"setEndAfter"](container);if(!offset)return void(3==sibling.nodeType?domRange[start?"setStart":"setEnd"](sibling,0):domRange[start?"setStartBefore":"setEndBefore"](sibling));for(;sibling;){if(3==sibling.nodeType&&(nodeValue=sibling.nodeValue,(textNodeOffset+=nodeValue.length)>=offset)){container=sibling,textNodeOffset-=offset,textNodeOffset=nodeValue.length-textNodeOffset;break}sibling=sibling.nextSibling}}else{if(!(sibling=container.previousSibling))return domRange[start?"setStartBefore":"setEndBefore"](container);if(!offset)return void(3==container.nodeType?domRange[start?"setStart":"setEnd"](sibling,container.nodeValue.length):domRange[start?"setStartAfter":"setEndAfter"](sibling));for(;sibling;){if(3==sibling.nodeType&&(textNodeOffset+=sibling.nodeValue.length)>=offset){container=sibling,textNodeOffset-=offset;break}sibling=sibling.previousSibling}}domRange[start?"setStart":"setEnd"](container,textNodeOffset)}else domRange[start?"setStartBefore":"setEndAfter"](container);else domRange[start?"setStart":"setEnd"](container,0)}var element,collapsed,tmpRange,element2,bookmark,ieRange=selection.getRng(),domRange=dom.createRng();if((element=ieRange.item?ieRange.item(0):ieRange.parentElement()).ownerDocument!=dom.doc)return domRange;if(collapsed=selection.isCollapsed(),ieRange.item)return domRange.setStart(element.parentNode,dom.nodeIndex(element)),domRange.setEnd(domRange.startContainer,domRange.startOffset+1),domRange;try{findEndPoint(!0),collapsed||findEndPoint()}catch(ex){if(-2147024809!=ex.number)throw ex;bookmark=self.getBookmark(2),(tmpRange=ieRange.duplicate()).collapse(!0),element=tmpRange.parentElement(),collapsed||((tmpRange=ieRange.duplicate()).collapse(!1),(element2=tmpRange.parentElement()).innerHTML=element2.innerHTML),element.innerHTML=element.innerHTML,self.moveToBookmark(bookmark),ieRange=selection.getRng(),findEndPoint(!0),collapsed||findEndPoint()}return domRange}}}),define("ephox.sugar.api.properties.Attr",["ephox.katamari.api.Type","ephox.katamari.api.Arr","ephox.katamari.api.Obj","ephox.sugar.api.node.Node","global!Error","global!console"],function(Type,Arr,Obj,Node,Error,console){var rawSet=function(dom,key,value){if(!(Type.isString(value)||Type.isBoolean(value)||Type.isNumber(value)))throw console.error("Invalid call to Attr.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")},set=function(element,key,value){rawSet(element.dom(),key,value)},get=function(element,key){var v=element.dom().getAttribute(key);return null===v?void 0:v},has=function(element,key){var dom=element.dom();return!(!dom||!dom.hasAttribute)&&dom.hasAttribute(key)},transferOne=function(source,destination,attr){has(source,attr)&&!has(destination,attr)&&set(destination,attr,get(source,attr))};return{clone:function(element){return Arr.foldl(element.dom().attributes,function(acc,attr){return acc[attr.name]=attr.value,acc},{})},set:set,setAll:function(element,attrs){var dom=element.dom();Obj.each(attrs,function(v,k){rawSet(dom,k,v)})},get:get,has:has,remove:function(element,key){element.dom().removeAttribute(key)},hasNone:function(element){var attrs=element.dom().attributes;return void 0===attrs||null===attrs||0===attrs.length},transfer:function(source,destination,attrs){Node.isElement(source)&&Node.isElement(destination)&&Arr.each(attrs,function(attr){transferOne(source,destination,attr)})}}}),define("ephox.sugar.api.dom.Replication",["ephox.sugar.api.properties.Attr","ephox.sugar.api.node.Element","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.InsertAll","ephox.sugar.api.dom.Remove","ephox.sugar.api.search.Traverse"],function(Attr,Element,Insert,InsertAll,Remove,Traverse){var clone=function(original,deep){return Element.fromDom(original.dom().cloneNode(deep))},deep=function(original){return clone(original,!0)},shallowAs=function(original,tag){var nu=Element.fromTag(tag),attributes=Attr.clone(original);return Attr.setAll(nu,attributes),nu};return{shallow:function(original){return clone(original,!1)},shallowAs:shallowAs,deep:deep,copy:function(original,tag){var nu=shallowAs(original,tag),cloneChildren=Traverse.children(deep(original));return InsertAll.append(nu,cloneChildren),nu},mutate:function(original,tag){var nu=shallowAs(original,tag);Insert.before(original,nu);var children=Traverse.children(original);return InsertAll.append(nu,children),Remove.remove(original),nu}}}),define("ephox.sugar.api.node.Fragment",["ephox.katamari.api.Arr","ephox.sugar.api.node.Element","global!document"],function(Arr,Element,document){return{fromElements:function(elements,scope){var fragment=(scope||document).createDocumentFragment();return Arr.each(elements,function(element){fragment.appendChild(element.dom())}),Element.fromDom(fragment)}}}),define("ephox.sugar.impl.ClosestOrAncestor",["ephox.katamari.api.Type","ephox.katamari.api.Option"],function(Type,Option){return function(is,ancestor,scope,a,isRoot){return is(scope,a)?Option.some(scope):Type.isFunction(isRoot)&&isRoot(scope)?Option.none():ancestor(scope,a,isRoot)}}),define("ephox.sugar.api.search.PredicateFind",["ephox.katamari.api.Type","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.node.Body","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.impl.ClosestOrAncestor"],function(Type,Arr,Fun,Option,Body,Compare,Element,ClosestOrAncestor){var ancestor=function(scope,predicate,isRoot){for(var element=scope.dom(),stop=Type.isFunction(isRoot)?isRoot:Fun.constant(!1);element.parentNode;){element=element.parentNode;var el=Element.fromDom(element);if(predicate(el))return Option.some(el);if(stop(el))break}return Option.none()},child=function(scope,predicate){return Arr.find(scope.dom().childNodes,Fun.compose(predicate,Element.fromDom)).map(Element.fromDom)},descendant=function(scope,predicate){var descend=function(element){for(var i=0;i<element.childNodes.length;i++){if(predicate(Element.fromDom(element.childNodes[i])))return Option.some(Element.fromDom(element.childNodes[i]));var res=descend(element.childNodes[i]);if(res.isSome())return res}return Option.none()};return descend(scope.dom())};return{first:function(predicate){return descendant(Body.body(),predicate)},ancestor:ancestor,closest:function(scope,predicate,isRoot){return ClosestOrAncestor(function(scope){return predicate(scope)},ancestor,scope,predicate,isRoot)},sibling:function(scope,predicate){var element=scope.dom();return element.parentNode?child(Element.fromDom(element.parentNode),function(x){return!Compare.eq(scope,x)&&predicate(x)}):Option.none()},child:child,descendant:descendant}}),define("ephox.sugar.api.search.SelectorFind",["ephox.sugar.api.search.PredicateFind","ephox.sugar.api.search.Selectors","ephox.sugar.impl.ClosestOrAncestor"],function(PredicateFind,Selectors,ClosestOrAncestor){var ancestor=function(scope,selector,isRoot){return PredicateFind.ancestor(scope,function(e){return Selectors.is(e,selector)},isRoot)};return{first:function(selector){return Selectors.one(selector)},ancestor:ancestor,sibling:function(scope,selector){return PredicateFind.sibling(scope,function(e){return Selectors.is(e,selector)})},child:function(scope,selector){return PredicateFind.child(scope,function(e){return Selectors.is(e,selector)})},descendant:function(scope,selector){return Selectors.one(selector,scope)},closest:function(scope,selector,isRoot){return ClosestOrAncestor(Selectors.is,ancestor,scope,selector,isRoot)}}}),define("tinymce.core.dom.Parents",["ephox.katamari.api.Fun","ephox.sugar.api.dom.Compare","ephox.sugar.api.search.Traverse"],function(Fun,Compare,Traverse){var dropLast=function(xs){return xs.slice(0,-1)},parentsUntil=function(startNode,rootElm,predicate){return Compare.contains(rootElm,startNode)?dropLast(Traverse.parents(startNode,function(elm){return predicate(elm)||Compare.eq(elm,rootElm)})):[]},parents=function(startNode,rootElm){return parentsUntil(startNode,rootElm,Fun.constant(!1))};return{parentsUntil:parentsUntil,parents:parents,parentsAndSelf:function(startNode,rootElm){return[startNode].concat(parents(startNode,rootElm))}}}),define("ephox.katamari.api.Options",["ephox.katamari.api.Option"],function(Option){return{cat:function(arr){for(var r=[],i=0;i<arr.length;i++)arr[i].each(function(x){r.push(x)});return r},findMap:function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Option.none()},liftN:function(arr,f){for(var r=[],i=0;i<arr.length;i++){var x=arr[i];if(!x.isSome())return Option.none();r.push(x.getOrDie())}return Option.some(f.apply(null,r))}}}),define("tinymce.core.selection.SelectionUtils",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Options","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.api.search.Traverse","tinymce.core.dom.NodeType"],function(Arr,Fun,Option,Options,Compare,Element,Node,Traverse,NodeType){var getStartNode=function(rng){var sc=rng.startContainer,so=rng.startOffset;return NodeType.isText(sc)?0===so?Option.some(Element.fromDom(sc)):Option.none():Option.from(sc.childNodes[so]).map(Element.fromDom)},getEndNode=function(rng){var ec=rng.endContainer,eo=rng.endOffset;return NodeType.isText(ec)?eo===ec.data.length?Option.some(Element.fromDom(ec)):Option.none():Option.from(ec.childNodes[eo-1]).map(Element.fromDom)},getFirstChildren=function(node){return Traverse.firstChild(node).fold(Fun.constant([node]),function(child){return[node].concat(getFirstChildren(child))})},getLastChildren=function(node){return Traverse.lastChild(node).fold(Fun.constant([node]),function(child){return"br"===Node.name(child)?Traverse.prevSibling(child).map(function(sibling){return[node].concat(getLastChildren(sibling))}).getOr([]):[node].concat(getLastChildren(child))})};return{hasAllContentsSelected:function(elm,rng){return Options.liftN([getStartNode(rng),getEndNode(rng)],function(startNode,endNode){var start=Arr.find(getFirstChildren(elm),Fun.curry(Compare.eq,startNode)),end=Arr.find(getLastChildren(elm),Fun.curry(Compare.eq,endNode));return start.isSome()&&end.isSome()}).getOr(!1)}}}),define("tinymce.core.selection.SimpleTableModel",["ephox.katamari.api.Arr","ephox.katamari.api.Option","ephox.katamari.api.Struct","ephox.sugar.api.dom.Compare","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.InsertAll","ephox.sugar.api.dom.Replication","ephox.sugar.api.node.Element","ephox.sugar.api.properties.Attr","ephox.sugar.api.search.SelectorFilter"],function(Arr,Option,Struct,Compare,Insert,InsertAll,Replication,Element,Attr,SelectorFilter){var tableModel=Struct.immutable("element","width","rows"),tableRow=Struct.immutable("element","cells"),cellPosition=Struct.immutable("x","y"),getSpan=function(td,key){var value=parseInt(Attr.get(td,key),10);return isNaN(value)?1:value},fillout=function(table,x,y,tr,td){for(var rowspan=getSpan(td,"rowspan"),colspan=getSpan(td,"colspan"),rows=table.rows(),y2=y;y2<y+rowspan;y2++){rows[y2]||(rows[y2]=tableRow(Replication.deep(tr),[]));for(var x2=x;x2<x+colspan;x2++)rows[y2].cells()[x2]=y2==y&&x2==x?td:Replication.shallow(td)}},cellExists=function(table,x,y){var rows=table.rows();return!!(rows[y]?rows[y].cells():[])[x]},skipCellsX=function(table,x,y){for(;cellExists(table,x,y);)x++;return x},getWidth=function(rows){return Arr.foldl(rows,function(acc,row){return row.cells().length>acc?row.cells().length:acc},0)},findElementPos=function(table,element){for(var rows=table.rows(),y=0;y<rows.length;y++)for(var cells=rows[y].cells(),x=0;x<cells.length;x++)if(Compare.eq(cells[x],element))return Option.some(cellPosition(x,y));return Option.none()},extractRows=function(table,sx,sy,ex,ey){for(var newRows=[],rows=table.rows(),y=sy;y<=ey;y++){var cells=rows[y].cells(),slice=sx<ex?cells.slice(sx,ex+1):cells.slice(ex,sx+1);newRows.push(tableRow(rows[y].element(),slice))}return newRows},subTable=function(table,startPos,endPos){var sx=startPos.x(),sy=startPos.y(),ex=endPos.x(),ey=endPos.y(),newRows=sy<ey?extractRows(table,sx,sy,ex,ey):extractRows(table,sx,ey,ex,sy);return tableModel(table.element(),getWidth(newRows),newRows)},createDomTable=function(table,rows){var tableElement=Replication.shallow(table.element()),tableBody=Element.fromTag("tbody");return InsertAll.append(tableBody,rows),Insert.append(tableElement,tableBody),tableElement},modelRowsToDomRows=function(table){return Arr.map(table.rows(),function(row){var cells=Arr.map(row.cells(),function(cell){var td=Replication.deep(cell);return Attr.remove(td,"colspan"),Attr.remove(td,"rowspan"),td}),tr=Replication.shallow(row.element());return InsertAll.append(tr,cells),tr})};return{fromDom:function(tableElm){var table=tableModel(Replication.shallow(tableElm),0,[]);return Arr.each(SelectorFilter.descendants(tableElm,"tr"),function(tr,y){Arr.each(SelectorFilter.descendants(tr,"td,th"),function(td,x){fillout(table,skipCellsX(table,x,y),y,tr,td)})}),tableModel(table.element(),getWidth(table.rows()),table.rows())},toDom:function(table){return createDomTable(table,modelRowsToDomRows(table))},subsection:function(table,startElement,endElement){return findElementPos(table,startElement).bind(function(startPos){return findElementPos(table,endElement).map(function(endPos){return subTable(table,startPos,endPos)})})}}}),define("tinymce.core.selection.FragmentReader",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.sugar.api.dom.Compare","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.Replication","ephox.sugar.api.node.Element","ephox.sugar.api.node.Fragment","ephox.sugar.api.node.Node","ephox.sugar.api.search.SelectorFilter","ephox.sugar.api.search.SelectorFind","tinymce.core.dom.ElementType","tinymce.core.dom.Parents","tinymce.core.selection.SelectionUtils","tinymce.core.selection.SimpleTableModel"],function(Arr,Fun,Compare,Insert,Replication,Element,Fragment,Node,SelectorFilter,SelectorFind,ElementType,Parents,SelectionUtils,SimpleTableModel){var findParentListContainer=function(parents){return Arr.find(parents,function(elm){return"ul"===Node.name(elm)||"ol"===Node.name(elm)})},getFullySelectedListWrappers=function(parents,rng){return Arr.find(parents,function(elm){return"li"===Node.name(elm)&&SelectionUtils.hasAllContentsSelected(elm,rng)}).fold(Fun.constant([]),function(li){return findParentListContainer(parents).map(function(listCont){return[Element.fromTag("li"),Element.fromTag(Node.name(listCont))]}).getOr([])})},wrap=function(innerElm,elms){var wrapped=Arr.foldl(elms,function(acc,elm){return Insert.append(elm,acc),elm},innerElm);return elms.length>0?Fragment.fromElements([wrapped]):wrapped},getWrapElements=function(rootNode,rng){var parents=Parents.parentsAndSelf(Element.fromDom(rng.commonAncestorContainer),rootNode),wrapElements=Arr.filter(parents,function(elm){return ElementType.isInline(elm)||ElementType.isHeading(elm)}),fullWrappers=getFullySelectedListWrappers(parents,rng);return Arr.map(wrapElements.concat(fullWrappers),Replication.shallow)},emptyFragment=function(){return Fragment.fromElements([])},getFragmentFromRange=function(rootNode,rng){return wrap(Element.fromDom(rng.cloneContents()),getWrapElements(rootNode,rng))},getTableCellSelection=function(rootNode){return SelectorFilter.descendants(rootNode,"td[data-mce-selected],th[data-mce-selected]")},getParentTable=function(rootElm,cell){return SelectorFind.ancestor(cell,"table",Fun.curry(Compare.eq,rootElm))},getTableFragment=function(rootNode,selectedTableCells){return getParentTable(rootNode,selectedTableCells[0]).bind(function(tableElm){var firstCell=selectedTableCells[0],lastCell=selectedTableCells[selectedTableCells.length-1],fullTableModel=SimpleTableModel.fromDom(tableElm);return SimpleTableModel.subsection(fullTableModel,firstCell,lastCell).map(function(sectionedTableModel){return Fragment.fromElements([SimpleTableModel.toDom(sectionedTableModel)])})}).getOrThunk(emptyFragment)},getSelectionFragment=function(rootNode,rng){return rng.collapsed?emptyFragment():getFragmentFromRange(rootNode,rng)};return{read:function(rootNode,rng){var selectedTableCells=getTableCellSelection(rootNode);return selectedTableCells.length>0?getTableFragment(rootNode,selectedTableCells):getSelectionFragment(rootNode,rng)}}}),define("tinymce.core.dom.Selection",["ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","tinymce.core.caret.CaretPosition","tinymce.core.dom.BookmarkManager","tinymce.core.dom.ControlSelection","tinymce.core.dom.NodeType","tinymce.core.dom.RangeUtils","tinymce.core.dom.ScrollIntoView","tinymce.core.dom.TreeWalker","tinymce.core.dom.TridentSelection","tinymce.core.Env","tinymce.core.selection.FragmentReader","tinymce.core.text.Zwsp","tinymce.core.util.Tools"],function(Compare,Element,CaretPosition,BookmarkManager,ControlSelection,NodeType,RangeUtils,ScrollIntoView,TreeWalker,TridentSelection,Env,FragmentReader,Zwsp,Tools){function Selection(dom,win,serializer,editor){var self=this;self.dom=dom,self.win=win,self.serializer=serializer,self.editor=editor,self.bookmarkManager=new BookmarkManager(self),self.controlSelection=new ControlSelection(self,editor),self.win.getSelection||(self.tridentSel=new TridentSelection(self))}var each=Tools.each,trim=Tools.trim,isIE=Env.ie,isAttachedToDom=function(node){return!(!node||!node.ownerDocument)&&Compare.contains(Element.fromDom(node.ownerDocument),Element.fromDom(node))},isValidRange=function(rng){return!!rng&&(!!rng.select||isAttachedToDom(rng.startContainer)&&isAttachedToDom(rng.endContainer))};return Selection.prototype={setCursorLocation:function(node,offset){var self=this,rng=self.dom.createRng();node?(rng.setStart(node,offset),rng.setEnd(node,offset),self.setRng(rng),self.collapse(!1)):(self._moveEndPoint(rng,self.editor.getBody(),!0),self.setRng(rng))},getContent:function(args){var whiteSpaceBefore,whiteSpaceAfter,fragment,self=this,rng=self.getRng(),tmpElm=self.dom.create("body"),se=self.getSel();return args=args||{},whiteSpaceBefore=whiteSpaceAfter="",args.get=!0,args.format=args.format||"html",args.selection=!0,self.editor.fire("BeforeGetContent",args),"text"===args.format?self.isCollapsed()?"":Zwsp.trim(rng.text||(se.toString?se.toString():"")):(rng.cloneContents?(fragment=args.contextual?FragmentReader.read(Element.fromDom(self.editor.getBody()),rng).dom():rng.cloneContents())&&tmpElm.appendChild(fragment):void 0!==rng.item||void 0!==rng.htmlText?(tmpElm.innerHTML="<br>"+(rng.item?rng.item(0).outerHTML:rng.htmlText),tmpElm.removeChild(tmpElm.firstChild)):tmpElm.innerHTML=rng.toString(),/^\s/.test(tmpElm.innerHTML)&&(whiteSpaceBefore=" "),/\s+$/.test(tmpElm.innerHTML)&&(whiteSpaceAfter=" "),args.getInner=!0,args.content=self.isCollapsed()?"":whiteSpaceBefore+self.serializer.serialize(tmpElm,args)+whiteSpaceAfter,self.editor.fire("GetContent",args),args.content)},setContent:function(content,args){var caretNode,frag,temp,self=this,rng=self.getRng(),doc=self.win.document;if(args=args||{format:"html"},args.set=!0,args.selection=!0,args.content=content,args.no_events||self.editor.fire("BeforeSetContent",args),content=args.content,rng.insertNode){content+='<span id="__caret">_</span>',rng.startContainer==doc&&rng.endContainer==doc?doc.body.innerHTML=content:(rng.deleteContents(),0===doc.body.childNodes.length?doc.body.innerHTML=content:rng.createContextualFragment?rng.insertNode(rng.createContextualFragment(content)):(frag=doc.createDocumentFragment(),temp=doc.createElement("div"),frag.appendChild(temp),temp.outerHTML=content,rng.insertNode(frag))),caretNode=self.dom.get("__caret"),(rng=doc.createRange()).setStartBefore(caretNode),rng.setEndBefore(caretNode),self.setRng(rng),self.dom.remove("__caret");try{self.setRng(rng)}catch(ex){}}else rng.item&&(doc.execCommand("Delete",!1,null),rng=self.getRng()),/^\s+/.test(content)?(rng.pasteHTML('<span id="__mce_tmp">_</span>'+content),self.dom.remove("__mce_tmp")):rng.pasteHTML(content);args.no_events||self.editor.fire("SetContent",args)},getStart:function(real){var startElement,parentElement,checkRng,node,self=this,rng=self.getRng();if(rng.duplicate||rng.item){if(rng.item)return rng.item(0);for((checkRng=rng.duplicate()).collapse(1),(startElement=checkRng.parentElement()).ownerDocument!==self.dom.doc&&(startElement=self.dom.getRoot()),parentElement=node=rng.parentElement();node=node.parentNode;)if(node==startElement){startElement=parentElement;break}return startElement}return 1==(startElement=rng.startContainer).nodeType&&startElement.hasChildNodes()&&(real&&rng.collapsed||(startElement=startElement.childNodes[Math.min(startElement.childNodes.length-1,rng.startOffset)])),startElement&&3==startElement.nodeType?startElement.parentNode:startElement},getEnd:function(real){var endElement,endOffset,self=this,rng=self.getRng();return rng.duplicate||rng.item?rng.item?rng.item(0):((rng=rng.duplicate()).collapse(0),(endElement=rng.parentElement()).ownerDocument!==self.dom.doc&&(endElement=self.dom.getRoot()),endElement&&"BODY"==endElement.nodeName?endElement.lastChild||endElement:endElement):(endElement=rng.endContainer,endOffset=rng.endOffset,1==endElement.nodeType&&endElement.hasChildNodes()&&(real&&rng.collapsed||(endElement=endElement.childNodes[endOffset>0?endOffset-1:endOffset])),endElement&&3==endElement.nodeType?endElement.parentNode:endElement)},getBookmark:function(type,normalized){return this.bookmarkManager.getBookmark(type,normalized)},moveToBookmark:function(bookmark){return this.bookmarkManager.moveToBookmark(bookmark)},select:function(node,content){var idx,self=this,dom=self.dom,rng=dom.createRng();if(self.lastFocusBookmark=null,node){if(!content&&self.controlSelection.controlSelect(node))return;idx=dom.nodeIndex(node),rng.setStart(node.parentNode,idx),rng.setEnd(node.parentNode,idx+1),content&&(self._moveEndPoint(rng,node,!0),self._moveEndPoint(rng,node)),self.setRng(rng)}return node},isCollapsed:function(){var self=this,rng=self.getRng(),sel=self.getSel();return!(!rng||rng.item)&&(rng.compareEndPoints?0===rng.compareEndPoints("StartToEnd",rng):!sel||rng.collapsed)},collapse:function(toStart){var node,self=this,rng=self.getRng();rng.item&&(node=rng.item(0),(rng=self.win.document.body.createTextRange()).moveToElementText(node)),rng.collapse(!!toStart),self.setRng(rng)},getSel:function(){var win=this.win;return win.getSelection?win.getSelection():win.document.selection},getRng:function(w3c){function tryCompareBoundaryPoints(how,sourceRange,destinationRange){try{return sourceRange.compareBoundaryPoints(how,destinationRange)}catch(ex){return-1}}var selection,rng,elm,doc,ieRng,evt,self=this;if(!self.win)return null;if(void 0===(doc=self.win.document)||null===doc)return null;if(!w3c&&self.lastFocusBookmark){var bookmark=self.lastFocusBookmark;return bookmark.startContainer?((rng=doc.createRange()).setStart(bookmark.startContainer,bookmark.startOffset),rng.setEnd(bookmark.endContainer,bookmark.endOffset)):rng=bookmark,rng}if(w3c&&self.tridentSel)return self.tridentSel.getRangeAt(0);try{(selection=self.getSel())&&(rng=selection.rangeCount>0?selection.getRangeAt(0):selection.createRange?selection.createRange():doc.createRange())}catch(ex){}if((evt=self.editor.fire("GetSelectionRange",{range:rng})).range!==rng)return evt.range;if(isIE&&rng&&rng.setStart&&doc.selection){try{ieRng=doc.selection.createRange()}catch(ex){}ieRng&&ieRng.item&&(elm=ieRng.item(0),(rng=doc.createRange()).setStartBefore(elm),rng.setEndAfter(elm))}return rng||(rng=doc.createRange?doc.createRange():doc.body.createTextRange()),rng.setStart&&9===rng.startContainer.nodeType&&rng.collapsed&&(elm=self.dom.getRoot(),rng.setStart(elm,0),rng.setEnd(elm,0)),self.selectedRange&&self.explicitRange&&(0===tryCompareBoundaryPoints(rng.START_TO_START,rng,self.selectedRange)&&0===tryCompareBoundaryPoints(rng.END_TO_END,rng,self.selectedRange)?rng=self.explicitRange:(self.selectedRange=null,self.explicitRange=null)),rng},setRng:function(rng,forward){var sel,node,evt,self=this;if(isValidRange(rng))if(rng.select){self.explicitRange=null;try{rng.select()}catch(ex){}}else if(self.tridentSel){if(rng.cloneRange)try{self.tridentSel.addRange(rng)}catch(ex){}}else{if(sel=self.getSel(),evt=self.editor.fire("SetSelectionRange",{range:rng,forward:forward}),rng=evt.range,sel){self.explicitRange=rng;try{sel.removeAllRanges(),sel.addRange(rng)}catch(ex){}!1===forward&&sel.extend&&(sel.collapse(rng.endContainer,rng.endOffset),sel.extend(rng.startContainer,rng.startOffset)),self.selectedRange=sel.rangeCount>0?sel.getRangeAt(0):null}rng.collapsed||rng.startContainer!==rng.endContainer||!sel.setBaseAndExtent||Env.ie||rng.endOffset-rng.startOffset<2&&rng.startContainer.hasChildNodes()&&(node=rng.startContainer.childNodes[rng.startOffset])&&"IMG"===node.tagName&&(sel.setBaseAndExtent(rng.startContainer,rng.startOffset,rng.endContainer,rng.endOffset),sel.anchorNode===rng.startContainer&&sel.focusNode===rng.endContainer||sel.setBaseAndExtent(node,0,node,1)),self.editor.fire("AfterSetSelectionRange",{range:rng,forward:forward})}},setNode:function(elm){var self=this;return self.setContent(self.dom.getOuterHTML(elm)),elm},getNode:function(){function skipEmptyTextNodes(node,forwards){for(var orig=node;node&&3===node.nodeType&&0===node.length;)node=forwards?node.nextSibling:node.previousSibling;return node||orig}var elm,startContainer,endContainer,startOffset,endOffset,self=this,rng=self.getRng(),root=self.dom.getRoot();return rng?(startContainer=rng.startContainer,endContainer=rng.endContainer,startOffset=rng.startOffset,endOffset=rng.endOffset,rng.setStart?(elm=rng.commonAncestorContainer,!rng.collapsed&&(startContainer==endContainer&&endOffset-startOffset<2&&startContainer.hasChildNodes()&&(elm=startContainer.childNodes[startOffset]),3===startContainer.nodeType&&3===endContainer.nodeType&&(startContainer=startContainer.length===startOffset?skipEmptyTextNodes(startContainer.nextSibling,!0):startContainer.parentNode,endContainer=0===endOffset?skipEmptyTextNodes(endContainer.previousSibling,!1):endContainer.parentNode,startContainer&&startContainer===endContainer))?startContainer:elm&&3==elm.nodeType?elm.parentNode:elm):((elm=rng.item?rng.item(0):rng.parentElement()).ownerDocument!==self.win.document&&(elm=root),elm)):root},getSelectedBlocks:function(startElm,endElm){var node,root,self=this,dom=self.dom,selectedBlocks=[];if(root=dom.getRoot(),startElm=dom.getParent(startElm||self.getStart(),dom.isBlock),endElm=dom.getParent(endElm||self.getEnd(),dom.isBlock),startElm&&startElm!=root&&selectedBlocks.push(startElm),startElm&&endElm&&startElm!=endElm){node=startElm;for(var walker=new TreeWalker(startElm,root);(node=walker.next())&&node!=endElm;)dom.isBlock(node)&&selectedBlocks.push(node)}return endElm&&startElm!=endElm&&endElm!=root&&selectedBlocks.push(endElm),selectedBlocks},isForward:function(){var anchorRange,focusRange,dom=this.dom,sel=this.getSel();return!(sel&&sel.anchorNode&&sel.focusNode)||((anchorRange=dom.createRng()).setStart(sel.anchorNode,sel.anchorOffset),anchorRange.collapse(!0),(focusRange=dom.createRng()).setStart(sel.focusNode,sel.focusOffset),focusRange.collapse(!0),anchorRange.compareBoundaryPoints(anchorRange.START_TO_START,focusRange)<=0)},normalize:function(){var self=this,rng=self.getRng();return Env.range&&new RangeUtils(self.dom).normalize(rng)&&self.setRng(rng,self.isForward()),rng},selectorChanged:function(selector,callback){var currentSelectors,self=this;return self.selectorChangedData||(self.selectorChangedData={},currentSelectors={},self.editor.on("NodeChange",function(e){var node=e.element,dom=self.dom,parents=dom.getParents(node,null,dom.getRoot()),matchedSelectors={};each(self.selectorChangedData,function(callbacks,selector){each(parents,function(node){if(dom.is(node,selector))return currentSelectors[selector]||(each(callbacks,function(callback){callback(!0,{node:node,selector:selector,parents:parents})}),currentSelectors[selector]=callbacks),matchedSelectors[selector]=callbacks,!1})}),each(currentSelectors,function(callbacks,selector){matchedSelectors[selector]||(delete currentSelectors[selector],each(callbacks,function(callback){callback(!1,{node:node,selector:selector,parents:parents})}))})})),self.selectorChangedData[selector]||(self.selectorChangedData[selector]=[]),self.selectorChangedData[selector].push(callback),self},getScrollContainer:function(){for(var scrollContainer,node=this.dom.getRoot();node&&"BODY"!=node.nodeName;){if(node.scrollHeight>node.clientHeight){scrollContainer=node;break}node=node.parentNode}return scrollContainer},scrollIntoView:function(elm,alignToTop){ScrollIntoView.scrollIntoView(this.editor,elm,alignToTop)},placeCaretAt:function(clientX,clientY){this.setRng(RangeUtils.getCaretRangeFromPoint(clientX,clientY,this.editor.getDoc()))},_moveEndPoint:function(rng,node,start){var root=node,walker=new TreeWalker(node,root),nonEmptyElementsMap=this.dom.schema.getNonEmptyElements();do{if(3==node.nodeType&&0!==trim(node.nodeValue).length)return void(start?rng.setStart(node,0):rng.setEnd(node,node.nodeValue.length));if(nonEmptyElementsMap[node.nodeName]&&!/^(TD|TH)$/.test(node.nodeName))return void(start?rng.setStartBefore(node):"BR"==node.nodeName?rng.setEndBefore(node):rng.setEndAfter(node));if(Env.ie&&Env.ie<11&&this.dom.isBlock(node)&&this.dom.isEmpty(node))return void(start?rng.setStart(node,0):rng.setEnd(node,0))}while(node=start?walker.next():walker.prev());"BODY"==root.nodeName&&(start?rng.setStart(root,0):rng.setEnd(root,root.childNodes.length))},getBoundingClientRect:function(){var rng=this.getRng();return rng.collapsed?CaretPosition.fromRangeStart(rng).getClientRects()[0]:rng.getBoundingClientRect()},destroy:function(){this.win=null,this.controlSelection.destroy()}},Selection}),define("tinymce.core.undo.Diff",[],function(){return{KEEP:0,DELETE:2,INSERT:1,diff:function(left,right){var size=left.length+right.length+2,vDown=new Array(size),vUp=new Array(size),snake=function(start,end,diag){return{start:start,end:end,diag:diag}},buildScript=function(start1,end1,start2,end2,script){var middle=getMiddleSnake(start1,end1,start2,end2);if(null===middle||middle.start===end1&&middle.diag===end1-end2||middle.end===start1&&middle.diag===start1-start2)for(var i=start1,j=start2;i<end1||j<end2;)i<end1&&j<end2&&left[i]===right[j]?(script.push([0,left[i]]),++i,++j):end1-start1>end2-start2?(script.push([2,left[i]]),++i):(script.push([1,right[j]]),++j);else{buildScript(start1,middle.start,start2,middle.start-middle.diag,script);for(var i2=middle.start;i2<middle.end;++i2)script.push([0,left[i2]]);buildScript(middle.end,end1,middle.end-middle.diag,end2,script)}},buildSnake=function(start,diag,end1,end2){for(var end=start;end-diag<end2&&end<end1&&left[end]===right[end-diag];)++end;return snake(start,end,diag)},getMiddleSnake=function(start1,end1,start2,end2){var m=end1-start1,n=end2-start2;if(0===m||0===n)return null;var delta=m-n,sum=n+m,offset=(sum%2==0?sum:sum+1)/2;vDown[1+offset]=start1,vUp[1+offset]=end1+1;for(var d=0;d<=offset;++d){for(var k=-d;k<=d;k+=2){var i=k+offset;k===-d||k!=d&&vDown[i-1]<vDown[i+1]?vDown[i]=vDown[i+1]:vDown[i]=vDown[i-1]+1;for(var x=vDown[i],y=x-start1+start2-k;x<end1&&y<end2&&left[x]===right[y];)vDown[i]=++x,++y;if(delta%2!=0&&delta-d<=k&&k<=delta+d&&vUp[i-delta]<=vDown[i])return buildSnake(vUp[i-delta],k+start1-start2,end1,end2)}for(k=delta-d;k<=delta+d;k+=2){for(i=k+offset-delta,k===delta-d||k!=delta+d&&vUp[i+1]<=vUp[i-1]?vUp[i]=vUp[i+1]-1:vUp[i]=vUp[i-1],y=(x=vUp[i]-1)-start1+start2-k;x>=start1&&y>=start2&&left[x]===right[y];)vUp[i]=x--,y--;if(delta%2==0&&-d<=k&&k<=d&&vUp[i]<=vDown[i+delta])return buildSnake(vUp[i],k+start1-start2,end1,end2)}}},script=[];return buildScript(0,left.length,0,right.length,script),script}}}),define("tinymce.core.undo.Fragments",["tinymce.core.util.Arr","tinymce.core.html.Entities","tinymce.core.undo.Diff"],function(Arr,Entities,Diff){var getOuterHtml=function(elm){return 1===elm.nodeType?elm.outerHTML:3===elm.nodeType?Entities.encodeRaw(elm.data,!1):8===elm.nodeType?"\x3c!--"+elm.data+"--\x3e":""},createFragment=function(html){var frag,node,container;for(container=document.createElement("div"),frag=document.createDocumentFragment(),html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag},insertAt=function(elm,html,index){var fragment=createFragment(html);if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.insertBefore(fragment,target)}else elm.appendChild(fragment)},removeAt=function(elm,index){if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.removeChild(target)}},applyDiff=function(diff,elm){var index=0;Arr.each(diff,function(action){action[0]===Diff.KEEP?index++:action[0]===Diff.INSERT?(insertAt(elm,action[1],index),index++):action[0]===Diff.DELETE&&removeAt(elm,index)})};return{read:function(elm){return Arr.filter(Arr.map(elm.childNodes,getOuterHtml),function(item){return item.length>0})},write:function(fragments,elm){var currentFragments=Arr.map(elm.childNodes,getOuterHtml);return applyDiff(Diff.diff(currentFragments,fragments),elm),elm}}}),define("tinymce.core.undo.Levels",["tinymce.core.util.Arr","tinymce.core.undo.Fragments"],function(Arr,Fragments){var hasIframes=function(html){return-1!==html.indexOf("</iframe>")},createFragmentedLevel=function(fragments){return{type:"fragmented",fragments:fragments,content:"",bookmark:null,beforeBookmark:null}},createCompleteLevel=function(content){return{type:"complete",fragments:null,content:content,bookmark:null,beforeBookmark:null}},getLevelContent=function(level){return"fragmented"===level.type?level.fragments.join(""):level.content};return{createFragmentedLevel:createFragmentedLevel,createCompleteLevel:createCompleteLevel,createFromEditor:function(editor){var fragments,content,trimmedFragments;return fragments=Fragments.read(editor.getBody()),trimmedFragments=Arr.map(fragments,function(html){return editor.serializer.trimContent(html)}),content=trimmedFragments.join(""),hasIframes(content)?createFragmentedLevel(trimmedFragments):createCompleteLevel(content)},applyToEditor:function(editor,level,before){"fragmented"===level.type?Fragments.write(level.fragments,editor.getBody()):editor.setContent(level.content,{format:"raw"}),editor.selection.moveToBookmark(before?level.beforeBookmark:level.bookmark)},isEq:function(level1,level2){return!!level1&&!!level2&&getLevelContent(level1)===getLevelContent(level2)}}}),define("tinymce.core.UndoManager",["tinymce.core.util.VK","tinymce.core.util.Tools","tinymce.core.undo.Levels"],function(VK,Tools,Levels){return function(editor){function setDirty(state){editor.setDirty(state)}function addNonTypingUndoLevel(e){setTyping(!1),self.add({},e)}function endTyping(){self.typing&&(setTyping(!1),self.add())}var beforeBookmark,isFirstTypedCharacter,self=this,index=0,data=[],locks=0,isUnlocked=function(){return 0===locks},setTyping=function(typing){isUnlocked()&&(self.typing=typing)};return editor.on("init",function(){self.add()}),editor.on("BeforeExecCommand",function(e){var cmd=e.command;"Undo"!==cmd&&"Redo"!==cmd&&"mceRepaint"!==cmd&&(endTyping(),self.beforeChange())}),editor.on("ExecCommand",function(e){var cmd=e.command;"Undo"!==cmd&&"Redo"!==cmd&&"mceRepaint"!==cmd&&addNonTypingUndoLevel(e)}),editor.on("ObjectResizeStart Cut",function(){self.beforeChange()}),editor.on("SaveContent ObjectResized blur",addNonTypingUndoLevel),editor.on("DragEnd",addNonTypingUndoLevel),editor.on("KeyUp",function(e){var keyCode=e.keyCode;e.isDefaultPrevented()||((keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||45===keyCode||e.ctrlKey)&&(addNonTypingUndoLevel(),editor.nodeChanged()),46!==keyCode&&8!==keyCode||editor.nodeChanged(),isFirstTypedCharacter&&self.typing&&!1===Levels.isEq(Levels.createFromEditor(editor),data[0])&&(!1===editor.isDirty()&&(setDirty(!0),editor.fire("change",{level:data[0],lastLevel:null})),editor.fire("TypingUndo"),isFirstTypedCharacter=!1,editor.nodeChanged()))}),editor.on("KeyDown",function(e){var keyCode=e.keyCode;if(!e.isDefaultPrevented())if(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||45===keyCode)self.typing&&addNonTypingUndoLevel(e);else{var modKey=e.ctrlKey&&!e.altKey||e.metaKey;!(keyCode<16||keyCode>20)||224===keyCode||91===keyCode||self.typing||modKey||(self.beforeChange(),setTyping(!0),self.add({},e),isFirstTypedCharacter=!0)}}),editor.on("MouseDown",function(e){self.typing&&addNonTypingUndoLevel(e)}),editor.addShortcut("meta+z","","Undo"),editor.addShortcut("meta+y,meta+shift+z","","Redo"),editor.on("AddUndo Undo Redo ClearUndos",function(e){e.isDefaultPrevented()||editor.nodeChanged()}),self={data:data,typing:!1,beforeChange:function(){isUnlocked()&&(beforeBookmark=editor.selection.getBookmark(2,!0))},add:function(level,event){var i,lastLevel,currentLevel,settings=editor.settings;if(currentLevel=Levels.createFromEditor(editor),level=level||{},level=Tools.extend(level,currentLevel),!1===isUnlocked()||editor.removed)return null;if(lastLevel=data[index],editor.fire("BeforeAddUndo",{level:level,lastLevel:lastLevel,originalEvent:event}).isDefaultPrevented())return null;if(lastLevel&&Levels.isEq(lastLevel,level))return null;if(data[index]&&(data[index].beforeBookmark=beforeBookmark),settings.custom_undo_redo_levels&&data.length>settings.custom_undo_redo_levels){for(i=0;i<data.length-1;i++)data[i]=data[i+1];data.length--,index=data.length}level.bookmark=editor.selection.getBookmark(2,!0),index<data.length-1&&(data.length=index+1),data.push(level),index=data.length-1;var args={level:level,lastLevel:lastLevel,originalEvent:event};return editor.fire("AddUndo",args),index>0&&(setDirty(!0),editor.fire("change",args)),level},undo:function(){var level;return self.typing&&(self.add(),self.typing=!1,setTyping(!1)),index>0&&(level=data[--index],Levels.applyToEditor(editor,level,!0),setDirty(!0),editor.fire("undo",{level:level})),level},redo:function(){var level;return index<data.length-1&&(level=data[++index],Levels.applyToEditor(editor,level,!1),setDirty(!0),editor.fire("redo",{level:level})),level},clear:function(){data=[],index=0,self.typing=!1,self.data=data,editor.fire("ClearUndos")},hasUndo:function(){return index>0||self.typing&&data[0]&&!Levels.isEq(Levels.createFromEditor(editor),data[0])},hasRedo:function(){return index<data.length-1&&!self.typing},transact:function(callback){return endTyping(),self.beforeChange(),self.ignore(callback),self.add()},ignore:function(callback){try{locks++,callback()}finally{locks--}},extra:function(callback1,callback2){var lastLevel,bookmark;self.transact(callback1)&&(bookmark=data[index].bookmark,lastLevel=data[index-1],Levels.applyToEditor(editor,lastLevel,!0),self.transact(callback2)&&(data[index-1].beforeBookmark=bookmark))}}}}),define("tinymce.core.delete.DeleteUtils",["ephox.katamari.api.Option","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.api.search.PredicateFind","tinymce.core.dom.ElementType"],function(Option,Compare,Element,PredicateFind,ElementType){var isBeforeRoot=function(rootNode){return function(elm){return Compare.eq(rootNode,Element.fromDom(elm.dom().parentNode))}},placeCaretInEmptyBody=function(editor){var body=editor.getBody(),node=body.firstChild&&editor.dom.isBlock(body.firstChild)?body.firstChild:body;editor.selection.setCursorLocation(node,0)};return{getParentBlock:function(rootNode,elm){return Compare.contains(rootNode,elm)?PredicateFind.closest(elm,function(element){return ElementType.isTextBlock(element)||ElementType.isListItem(element)},isBeforeRoot(rootNode)):Option.none()},paddEmptyBody:function(editor){editor.dom.isEmpty(editor.getBody())&&(editor.setContent(""),placeCaretInEmptyBody(editor))}}}),define("ephox.sugar.api.search.SelectorExists",["ephox.sugar.api.search.SelectorFind"],function(SelectorFind){return{any:function(selector){return SelectorFind.first(selector).isSome()},ancestor:function(scope,selector,isRoot){return SelectorFind.ancestor(scope,selector,isRoot).isSome()},sibling:function(scope,selector){return SelectorFind.sibling(scope,selector).isSome()},child:function(scope,selector){return SelectorFind.child(scope,selector).isSome()},descendant:function(scope,selector){return SelectorFind.descendant(scope,selector).isSome()},closest:function(scope,selector,isRoot){return SelectorFind.closest(scope,selector,isRoot).isSome()}}}),define("tinymce.core.dom.Empty",["ephox.katamari.api.Fun","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.api.search.SelectorExists","tinymce.core.caret.CaretCandidate","tinymce.core.dom.NodeType","tinymce.core.dom.TreeWalker"],function(Fun,Compare,Element,SelectorExists,CaretCandidate,NodeType,TreeWalker){var hasWhitespacePreserveParent=function(rootNode,node){var rootElement=Element.fromDom(rootNode),startNode=Element.fromDom(node);return SelectorExists.ancestor(startNode,"pre,code",Fun.curry(Compare.eq,rootElement))},isWhitespace=function(rootNode,node){return NodeType.isText(node)&&/^[ \t\r\n]*$/.test(node.data)&&!1===hasWhitespacePreserveParent(rootNode,node)},isNamedAnchor=function(node){return NodeType.isElement(node)&&"A"===node.nodeName&&node.hasAttribute("name")},isContent=function(rootNode,node){return CaretCandidate.isCaretCandidate(node)&&!1===isWhitespace(rootNode,node)||isNamedAnchor(node)||isBookmark(node)},isBookmark=NodeType.hasAttribute("data-mce-bookmark"),isBogus=NodeType.hasAttribute("data-mce-bogus"),isBogusAll=NodeType.hasAttributeValue("data-mce-bogus","all"),isEmptyNode=function(targetNode){var walker,node,brCount=0;if(isContent(targetNode,targetNode))return!1;if(!(node=targetNode.firstChild))return!0;walker=new TreeWalker(node,targetNode);do{if(isBogusAll(node))node=walker.next(!0);else if(isBogus(node))node=walker.next();else if(NodeType.isBr(node))brCount++,node=walker.next();else{if(isContent(targetNode,node))return!1;node=walker.next()}}while(node);return brCount<=1};return{isEmpty:function(elm){return isEmptyNode(elm.dom())}}}),define("tinymce.core.delete.BlockBoundary",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Options","ephox.katamari.api.Struct","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.api.search.PredicateFind","ephox.sugar.api.search.Traverse","tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.delete.DeleteUtils","tinymce.core.dom.Empty","tinymce.core.dom.NodeType"],function(Arr,Fun,Option,Options,Struct,Compare,Element,Node,PredicateFind,Traverse,CaretFinder,CaretPosition,DeleteUtils,Empty,NodeType){var BlockPosition=Struct.immutable("block","position"),BlockBoundary=Struct.immutable("from","to"),getBlockPosition=function(rootNode,pos){var rootElm=Element.fromDom(rootNode),containerElm=Element.fromDom(pos.container());return DeleteUtils.getParentBlock(rootElm,containerElm).map(function(block){return BlockPosition(block,pos)})},isDifferentBlocks=function(blockBoundary){return!1===Compare.eq(blockBoundary.from().block(),blockBoundary.to().block())},hasSameParent=function(blockBoundary){return Traverse.parent(blockBoundary.from().block()).bind(function(parent1){return Traverse.parent(blockBoundary.to().block()).filter(function(parent2){return Compare.eq(parent1,parent2)})}).isSome()},isEditable=function(blockBoundary){return!1===NodeType.isContentEditableFalse(blockBoundary.from().block())&&!1===NodeType.isContentEditableFalse(blockBoundary.to().block())},skipLastBr=function(rootNode,forward,blockPosition){return NodeType.isBr(blockPosition.position().getNode())&&!1===Empty.isEmpty(blockPosition.block())?CaretFinder.positionIn(!1,blockPosition.block().dom()).bind(function(lastPositionInBlock){return lastPositionInBlock.isEqual(blockPosition.position())?CaretFinder.fromPosition(forward,rootNode,lastPositionInBlock).bind(function(to){return getBlockPosition(rootNode,to)}):Option.some(blockPosition)}).getOr(blockPosition):blockPosition},readFromRange=function(rootNode,forward,rng){var fromBlockPos=getBlockPosition(rootNode,CaretPosition.fromRangeStart(rng)),toBlockPos=fromBlockPos.bind(function(blockPos){return CaretFinder.fromPosition(forward,rootNode,blockPos.position()).bind(function(to){return getBlockPosition(rootNode,to).map(function(blockPos){return skipLastBr(rootNode,forward,blockPos)})})});return Options.liftN([fromBlockPos,toBlockPos],BlockBoundary).filter(function(blockBoundary){return isDifferentBlocks(blockBoundary)&&hasSameParent(blockBoundary)&&isEditable(blockBoundary)})};return{read:function(rootNode,forward,rng){return rng.collapsed?readFromRange(rootNode,forward,rng):Option.none()}}}),define("tinymce.core.delete.MergeBlocks",["ephox.katamari.api.Arr","ephox.katamari.api.Option","ephox.sugar.api.dom.Compare","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.Remove","ephox.sugar.api.node.Element","ephox.sugar.api.search.Traverse","tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.dom.ElementType","tinymce.core.dom.Empty","tinymce.core.dom.NodeType","tinymce.core.dom.Parents"],function(Arr,Option,Compare,Insert,Remove,Element,Traverse,CaretFinder,CaretPosition,ElementType,Empty,NodeType,Parents){var getChildrenUntilBlockBoundary=function(block){var children=Traverse.children(block);return Arr.findIndex(children,ElementType.isBlock).fold(function(){return children},function(index){return children.slice(0,index)})},extractChildren=function(block){var children=getChildrenUntilBlockBoundary(block);return Arr.each(children,function(node){Remove.remove(node)}),children},trimBr=function(first,block){CaretFinder.positionIn(first,block.dom()).each(function(position){var node=position.getNode();NodeType.isBr(node)&&Remove.remove(Element.fromDom(node))})},removeEmptyRoot=function(rootNode,block){var parents=Parents.parentsAndSelf(block,rootNode);return Arr.find(parents.reverse(),Empty.isEmpty).each(Remove.remove)},findParentInsertPoint=function(toBlock,block){var parents=Traverse.parents(block,function(elm){return Compare.eq(elm,toBlock)});return Option.from(parents[parents.length-2])},getInsertionPoint=function(fromBlock,toBlock){return Compare.contains(toBlock,fromBlock)?Traverse.parent(fromBlock).bind(function(parent){return Compare.eq(parent,toBlock)?Option.some(fromBlock):findParentInsertPoint(toBlock,fromBlock)}):Option.none()},mergeBlockInto=function(rootNode,fromBlock,toBlock){if(Empty.isEmpty(toBlock))return Remove.remove(toBlock),CaretFinder.firstPositionIn(fromBlock.dom());trimBr(!0,fromBlock),trimBr(!1,toBlock);var children=extractChildren(fromBlock);return getInsertionPoint(fromBlock,toBlock).fold(function(){removeEmptyRoot(rootNode,fromBlock);var position=CaretFinder.lastPositionIn(toBlock.dom());return Arr.each(children,function(node){Insert.append(toBlock,node)}),position},function(target){var position=CaretFinder.prevPosition(toBlock.dom(),CaretPosition.before(target.dom()));return Arr.each(children,function(node){Insert.before(target,node)}),removeEmptyRoot(rootNode,fromBlock),position})};return{mergeBlocks:function(rootNode,forward,block1,block2){return forward?mergeBlockInto(rootNode,block2,block1):mergeBlockInto(rootNode,block1,block2)}}}),define("tinymce.core.delete.BlockBoundaryDelete",["ephox.sugar.api.node.Element","tinymce.core.delete.BlockBoundary","tinymce.core.delete.MergeBlocks"],function(Element,BlockBoundary,MergeBlocks){return{backspaceDelete:function(editor,forward){var position,rootNode=Element.fromDom(editor.getBody());return(position=BlockBoundary.read(rootNode.dom(),forward,editor.selection.getRng()).bind(function(blockBoundary){return MergeBlocks.mergeBlocks(rootNode,forward,blockBoundary.from().block(),blockBoundary.to().block())})).each(function(pos){editor.selection.setRng(pos.toRange())}),position.isSome()}}}),define("tinymce.core.delete.BlockRangeDelete",["ephox.katamari.api.Options","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.delete.DeleteUtils","tinymce.core.delete.MergeBlocks"],function(Options,Compare,Element,CaretFinder,CaretPosition,DeleteUtils,MergeBlocks){var deleteRangeMergeBlocks=function(rootNode,selection){var rng=selection.getRng();return Options.liftN([DeleteUtils.getParentBlock(rootNode,Element.fromDom(rng.startContainer)),DeleteUtils.getParentBlock(rootNode,Element.fromDom(rng.endContainer))],function(block1,block2){return!1===Compare.eq(block1,block2)&&(rng.deleteContents(),MergeBlocks.mergeBlocks(rootNode,!0,block1,block2).each(function(pos){selection.setRng(pos.toRange())}),!0)}).getOr(!1)},isEverythingSelected=function(rootNode,rng){var noPrevious=CaretFinder.prevPosition(rootNode.dom(),CaretPosition.fromRangeStart(rng)).isNone(),noNext=CaretFinder.nextPosition(rootNode.dom(),CaretPosition.fromRangeEnd(rng)).isNone();return noPrevious&&noNext},emptyEditor=function(editor){return editor.setContent(""),editor.selection.setCursorLocation(),!0},deleteRange=function(editor){var rootNode=Element.fromDom(editor.getBody()),rng=editor.selection.getRng();return isEverythingSelected(rootNode,rng)?emptyEditor(editor):deleteRangeMergeBlocks(rootNode,editor.selection)};return{backspaceDelete:function(editor,forward){return!editor.selection.isCollapsed()&&deleteRange(editor,editor.selection.getRng())}}}),define("ephox.katamari.api.Adt",["ephox.katamari.api.Arr","ephox.katamari.api.Obj","ephox.katamari.api.Type","global!Array","global!Error","global!console"],function(Arr,Obj,Type,Array,Error,console){return{generate:function(cases){if(!Type.isArray(cases))throw new Error("cases must be an array");if(0===cases.length)throw new Error("there must be at least one case");var constructors=[],adt={};return Arr.each(cases,function(acase,count){var keys=Obj.keys(acase);if(1!==keys.length)throw new Error("one and only one name per case");var key=keys[0],value=acase[key];if(void 0!==adt[key])throw new Error("duplicate key detected:"+key);if("cata"===key)throw new Error("cannot have a case named cata (sorry)");if(!Type.isArray(value))throw new Error("case arguments must be an array");constructors.push(key),adt[key]=function(){var argLength=arguments.length;if(argLength!==value.length)throw new Error("Wrong number of arguments to case "+key+". Expected "+value.length+" ("+value+"), got "+argLength);for(var args=new Array(argLength),i=0;i<args.length;i++)args[i]=arguments[i];return{fold:function(){if(arguments.length!==cases.length)throw new Error("Wrong number of arguments to fold. Expected "+cases.length+", got "+arguments.length);return arguments[count].apply(null,args)},match:function(branches){var branchKeys=Obj.keys(branches);if(constructors.length!==branchKeys.length)throw new Error("Wrong number of arguments to match. Expected: "+constructors.join(",")+"\nActual: "+branchKeys.join(","));if(!Arr.forall(constructors,function(reqKey){return Arr.contains(branchKeys,reqKey)}))throw new Error("Not all branches were specified when using match. Specified: "+branchKeys.join(", ")+"\nRequired: "+constructors.join(", "));return branches[key].apply(null,args)},log:function(label){console.log(label,{constructors:constructors,constructor:key,params:args})}}}}),adt}}}),define("tinymce.core.delete.CefDeleteAction",["ephox.katamari.api.Adt","ephox.katamari.api.Option","ephox.sugar.api.node.Element","tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.delete.DeleteUtils","tinymce.core.dom.Empty","tinymce.core.dom.NodeType"],function(Adt,Option,Element,CaretFinder,CaretPosition,CaretUtils,DeleteUtils,Empty,NodeType){var DeleteAction=Adt.generate([{remove:["element"]},{moveToElement:["element"]},{moveToPosition:["position"]}]),isAtContentEditableBlockCaret=function(forward,from){var elm=from.getNode(!1===forward),caretLocation=forward?"after":"before";return NodeType.isElement(elm)&&elm.getAttribute("data-mce-caret")===caretLocation},deleteEmptyBlockOrMoveToCef=function(rootNode,forward,from,to){var toCefElm=to.getNode(!1===forward);return DeleteUtils.getParentBlock(Element.fromDom(rootNode),Element.fromDom(from.getNode())).map(function(blockElm){return Empty.isEmpty(blockElm)?DeleteAction.remove(blockElm.dom()):DeleteAction.moveToElement(toCefElm)}).orThunk(function(){return Option.some(DeleteAction.moveToElement(toCefElm))})},findCefPosition=function(rootNode,forward,from){return CaretFinder.fromPosition(forward,rootNode,from).bind(function(to){return forward&&NodeType.isContentEditableFalse(to.getNode())?deleteEmptyBlockOrMoveToCef(rootNode,forward,from,to):!1===forward&&NodeType.isContentEditableFalse(to.getNode(!0))?deleteEmptyBlockOrMoveToCef(rootNode,forward,from,to):forward&&CaretUtils.isAfterContentEditableFalse(from)?Option.some(DeleteAction.moveToPosition(to)):!1===forward&&CaretUtils.isBeforeContentEditableFalse(from)?Option.some(DeleteAction.moveToPosition(to)):Option.none()})},getContentEditableBlockAction=function(forward,elm){return forward&&NodeType.isContentEditableFalse(elm.nextSibling)?Option.some(DeleteAction.moveToElement(elm.nextSibling)):!1===forward&&NodeType.isContentEditableFalse(elm.previousSibling)?Option.some(DeleteAction.moveToElement(elm.previousSibling)):Option.none()},getContentEditableAction=function(rootNode,forward,from){return isAtContentEditableBlockCaret(forward,from)?getContentEditableBlockAction(forward,from.getNode(!1===forward)).fold(function(){return findCefPosition(rootNode,forward,from)},Option.some):findCefPosition(rootNode,forward,from)};return{read:function(rootNode,forward,rng){var normalizedRange=CaretUtils.normalizeRange(forward?1:-1,rootNode,rng),from=CaretPosition.fromRangeStart(normalizedRange);return!1===forward&&CaretUtils.isAfterContentEditableFalse(from)?Option.some(DeleteAction.remove(from.getNode(!0))):forward&&CaretUtils.isBeforeContentEditableFalse(from)?Option.some(DeleteAction.remove(from.getNode())):getContentEditableAction(rootNode,forward,from)}}}),define("tinymce.core.delete.DeleteElement",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Options","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.Remove","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.api.search.PredicateFind","ephox.sugar.api.search.Traverse","tinymce.core.caret.CaretCandidate","tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.dom.Empty","tinymce.core.dom.NodeType"],function(Fun,Option,Options,Insert,Remove,Element,Node,PredicateFind,Traverse,CaretCandidate,CaretFinder,CaretPosition,Empty,NodeType){var needsReposition=function(pos,elm){var container=pos.container(),offset=pos.offset();return!1===CaretPosition.isTextPosition(pos)&&container===elm.parentNode&&offset>CaretPosition.before(elm).offset()},reposition=function(elm,pos){return needsReposition(pos,elm)?new CaretPosition(pos.container(),pos.offset()-1):pos},beforeOrStartOf=function(node){return NodeType.isText(node)?new CaretPosition(node,0):CaretPosition.before(node)},afterOrEndOf=function(node){return NodeType.isText(node)?new CaretPosition(node,node.data.length):CaretPosition.after(node)},getPreviousSiblingCaretPosition=function(elm){return CaretCandidate.isCaretCandidate(elm.previousSibling)?Option.some(afterOrEndOf(elm.previousSibling)):elm.previousSibling?CaretFinder.lastPositionIn(elm.previousSibling):Option.none()},getNextSiblingCaretPosition=function(elm){return CaretCandidate.isCaretCandidate(elm.nextSibling)?Option.some(beforeOrStartOf(elm.nextSibling)):elm.nextSibling?CaretFinder.firstPositionIn(elm.nextSibling):Option.none()},findCaretPositionBackwardsFromElm=function(rootElement,elm){var startPosition=CaretPosition.before(elm.previousSibling?elm.previousSibling:elm.parentNode);return CaretFinder.prevPosition(rootElement,startPosition).fold(function(){return CaretFinder.nextPosition(rootElement,CaretPosition.after(elm))},Option.some)},findCaretPositionForwardsFromElm=function(rootElement,elm){return CaretFinder.nextPosition(rootElement,CaretPosition.after(elm)).fold(function(){return CaretFinder.prevPosition(rootElement,CaretPosition.before(elm))},Option.some)},findCaretPositionBackwards=function(rootElement,elm){return getPreviousSiblingCaretPosition(elm).orThunk(function(){return getNextSiblingCaretPosition(elm)}).orThunk(function(){return findCaretPositionBackwardsFromElm(rootElement,elm)})},findCaretPositionForward=function(rootElement,elm){return getNextSiblingCaretPosition(elm).orThunk(function(){return getPreviousSiblingCaretPosition(elm)}).orThunk(function(){return findCaretPositionForwardsFromElm(rootElement,elm)})},findCaretPosition=function(forward,rootElement,elm){return forward?findCaretPositionForward(rootElement,elm):findCaretPositionBackwards(rootElement,elm)},findCaretPosOutsideElmAfterDelete=function(forward,rootElement,elm){return findCaretPosition(forward,rootElement,elm).map(Fun.curry(reposition,elm))},setSelection=function(editor,forward,pos){pos.fold(function(){editor.focus()},function(pos){editor.selection.setRng(pos.toRange(),forward)})},eqRawNode=function(rawNode){return function(elm){return elm.dom()===rawNode}},isBlock=function(editor,elm){return elm&&editor.schema.getBlockElements().hasOwnProperty(Node.name(elm))},paddEmptyBlock=function(elm){if(Empty.isEmpty(elm)){var br=Element.fromHtml('<br data-mce-bogus="1">');return Remove.empty(elm),Insert.append(elm,br),Option.some(CaretPosition.before(br.dom()))}return Option.none()},deleteNormalized=function(elm,afterDeletePosOpt){return Options.liftN([Traverse.prevSibling(elm),Traverse.nextSibling(elm),afterDeletePosOpt],function(prev,next,afterDeletePos){var offset,prevNode=prev.dom(),nextNode=next.dom();return NodeType.isText(prevNode)&&NodeType.isText(nextNode)?(offset=prevNode.data.length,prevNode.appendData(nextNode.data),Remove.remove(next),Remove.remove(elm),afterDeletePos.container()===nextNode?new CaretPosition(prevNode,offset):afterDeletePos):(Remove.remove(elm),afterDeletePos)}).orThunk(function(){return Remove.remove(elm),afterDeletePosOpt})};return{deleteElement:function(editor,forward,elm){var afterDeletePos=findCaretPosOutsideElmAfterDelete(forward,editor.getBody(),elm.dom()),parentBlock=PredicateFind.ancestor(elm,Fun.curry(isBlock,editor),eqRawNode(editor.getBody())),normalizedAfterDeletePos=deleteNormalized(elm,afterDeletePos);parentBlock.bind(paddEmptyBlock).fold(function(){setSelection(editor,forward,normalizedAfterDeletePos)},function(paddPos){setSelection(editor,forward,Option.some(paddPos))})}}}),define("tinymce.core.delete.CefDelete",["ephox.katamari.api.Arr","ephox.sugar.api.dom.Remove","ephox.sugar.api.node.Element","ephox.sugar.api.search.SelectorFilter","tinymce.core.caret.CaretPosition","tinymce.core.delete.CefDeleteAction","tinymce.core.delete.DeleteElement","tinymce.core.delete.DeleteUtils","tinymce.core.dom.NodeType"],function(Arr,Remove,Element,SelectorFilter,CaretPosition,CefDeleteAction,DeleteElement,DeleteUtils,NodeType){var deleteElement=function(editor,forward){return function(element){return DeleteElement.deleteElement(editor,forward,Element.fromDom(element)),!0}},moveToElement=function(editor,forward){return function(element){var pos=forward?CaretPosition.before(element):CaretPosition.after(element);return editor.selection.setRng(pos.toRange()),!0}},moveToPosition=function(editor){return function(pos){return editor.selection.setRng(pos.toRange()),!0}},backspaceDeleteCaret=function(editor,forward){return CefDeleteAction.read(editor.getBody(),forward,editor.selection.getRng()).map(function(deleteAction){return deleteAction.fold(deleteElement(editor,forward),moveToElement(editor,forward),moveToPosition(editor))}).getOr(!1)},deleteOffscreenSelection=function(rootElement){Arr.each(SelectorFilter.descendants(rootElement,".mce-offscreen-selection"),Remove.remove)},backspaceDeleteRange=function(editor,forward){var selectedElement=editor.selection.getNode();return!!NodeType.isContentEditableFalse(selectedElement)&&(deleteOffscreenSelection(Element.fromDom(editor.getBody())),DeleteElement.deleteElement(editor,forward,Element.fromDom(editor.selection.getNode())),DeleteUtils.paddEmptyBody(editor),!0)},getContentEditableRoot=function(root,node){for(;node&&node!==root;){if(NodeType.isContentEditableTrue(node)||NodeType.isContentEditableFalse(node))return node;node=node.parentNode}return null};return{backspaceDelete:function(editor,forward){return editor.selection.isCollapsed()?backspaceDeleteCaret(editor,forward):backspaceDeleteRange(editor,forward)},paddEmptyElement:function(editor){var br,ceRoot=getContentEditableRoot(editor.getBody(),editor.selection.getNode());return NodeType.isContentEditableTrue(ceRoot)&&editor.dom.isBlock(ceRoot)&&editor.dom.isEmpty(ceRoot)&&(br=editor.dom.create("br",{"data-mce-bogus":"1"}),editor.dom.setHTML(ceRoot,""),ceRoot.appendChild(br),editor.selection.setRng(CaretPosition.before(br).toRange())),!0}}}),define("tinymce.core.caret.CaretContainerInline",["ephox.katamari.api.Fun","tinymce.core.dom.NodeType","tinymce.core.text.Zwsp"],function(Fun,NodeType,Zwsp){var isText=NodeType.isText,startsWithCaretContainer=function(node){return isText(node)&&node.data[0]===Zwsp.ZWSP},endsWithCaretContainer=function(node){return isText(node)&&node.data[node.data.length-1]===Zwsp.ZWSP},createZwsp=function(node){return node.ownerDocument.createTextNode(Zwsp.ZWSP)},insertBefore=function(node){if(isText(node.previousSibling))return endsWithCaretContainer(node.previousSibling)?node.previousSibling:(node.previousSibling.appendData(Zwsp.ZWSP),node.previousSibling);if(isText(node))return startsWithCaretContainer(node)?node:(node.insertData(0,Zwsp.ZWSP),node);var newNode=createZwsp(node);return node.parentNode.insertBefore(newNode,node),newNode},insertAfter=function(node){if(isText(node.nextSibling))return startsWithCaretContainer(node.nextSibling)?node.nextSibling:(node.nextSibling.insertData(0,Zwsp.ZWSP),node.nextSibling);if(isText(node))return endsWithCaretContainer(node)?node:(node.appendData(Zwsp.ZWSP),node);var newNode=createZwsp(node);return node.nextSibling?node.parentNode.insertBefore(newNode,node.nextSibling):node.parentNode.appendChild(newNode),newNode},insertInline=function(before,node){return before?insertBefore(node):insertAfter(node)};return{insertInline:insertInline,insertInlineBefore:Fun.curry(insertInline,!0),insertInlineAfter:Fun.curry(insertInline,!1)}}),define("tinymce.core.caret.CaretContainerRemove",["ephox.katamari.api.Arr","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretPosition","tinymce.core.dom.NodeType","tinymce.core.text.Zwsp","tinymce.core.util.Tools"],function(Arr,CaretContainer,CaretPosition,NodeType,Zwsp,Tools){var isElement=NodeType.isElement,isText=NodeType.isText,removeNode=function(node){var parentNode=node.parentNode;parentNode&&parentNode.removeChild(node)},getNodeValue=function(node){try{return node.nodeValue}catch(ex){return""}},setNodeValue=function(node,text){0===text.length?removeNode(node):node.nodeValue=text},trimCount=function(text){var trimmedText=Zwsp.trim(text);return{count:text.length-trimmedText.length,text:trimmedText}},removeUnchanged=function(caretContainer,pos){return remove(caretContainer),pos},removeTextAndReposition=function(caretContainer,pos){var before=trimCount(caretContainer.data.substr(0,pos.offset())),after=trimCount(caretContainer.data.substr(pos.offset())),text=before.text+after.text;return text.length>0?(setNodeValue(caretContainer,text),new CaretPosition(caretContainer,pos.offset()-before.count)):pos},removeElementAndReposition=function(caretContainer,pos){var parentNode=pos.container(),newPosition=Arr.indexOf(parentNode.childNodes,caretContainer).map(function(index){return index<pos.offset()?new CaretPosition(parentNode,pos.offset()-1):pos}).getOr(pos);return remove(caretContainer),newPosition},removeTextCaretContainer=function(caretContainer,pos){return pos.container()===caretContainer?removeTextAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos)},removeElementCaretContainer=function(caretContainer,pos){return pos.container()===caretContainer.parentNode?removeElementAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos)},remove=function(caretContainerNode){if(isElement(caretContainerNode)&&CaretContainer.isCaretContainer(caretContainerNode)&&(CaretContainer.hasContent(caretContainerNode)?caretContainerNode.removeAttribute("data-mce-caret"):removeNode(caretContainerNode)),isText(caretContainerNode)){var text=Zwsp.trim(getNodeValue(caretContainerNode));setNodeValue(caretContainerNode,text)}};return{removeAndReposition:function(container,pos){return CaretPosition.isTextPosition(pos)?removeTextCaretContainer(container,pos):removeElementCaretContainer(container,pos)},remove:remove}}),define("tinymce.core.EditorSettings",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Obj","ephox.katamari.api.Option","ephox.katamari.api.Strings","ephox.katamari.api.Struct","ephox.katamari.api.Type","ephox.sand.api.PlatformDetection","tinymce.core.util.Tools"],function(Arr,Fun,Obj,Option,Strings,Struct,Type,PlatformDetection,Tools){var sectionResult=Struct.immutable("sections","settings"),isTouch=PlatformDetection.detect().deviceType.isTouch(),mobilePlugins=["lists","autolink","autosave"],normalizePlugins=function(plugins){return Type.isArray(plugins)?plugins.join(" "):plugins},filterMobilePlugins=function(plugins){var trimmedPlugins=Arr.map(normalizePlugins(plugins).split(" "),Strings.trim);return Arr.filter(trimmedPlugins,Fun.curry(Arr.contains,mobilePlugins)).join(" ")},extractSections=function(keys,settings){var result=Obj.bifilter(settings,function(value,key){return Arr.contains(keys,key)});return sectionResult(result.t,result.f)},getSection=function(sectionResult,name){var sections=sectionResult.sections();return sections.hasOwnProperty(name)?sections[name]:{}},hasSection=function(sectionResult,name){return sectionResult.sections().hasOwnProperty(name)},getDefaultSettings=function(id,documentBaseUrl,editor){return{id:id,theme:"modern",delta_width:0,delta_height:0,popup_css:"",plugins:"",document_base_url:documentBaseUrl,add_form_submit_trigger:!0,submit_patch:!0,add_unload_trigger:!0,convert_urls:!0,relative_urls:!0,remove_script_host:!0,object_resizing:!0,doctype:"<!DOCTYPE html>",visual:!0,font_size_style_values:"xx-small,x-small,small,medium,large,x-large,xx-large",font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",forced_root_block:"p",hidden_input:!0,padd_empty_editor:!0,render_ui:!0,indentation:"30px",inline_styles:!0,convert_fonts_to_spans:!0,indent:"simple",indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",entity_encoding:"named",url_converter:editor.convertURL,url_converter_scope:editor,ie7_compat:!0}},getExternalPlugins=function(overrideSettings,settings){var userDefinedExternalPlugins=settings.external_plugins?settings.external_plugins:{};return overrideSettings&&overrideSettings.external_plugins?Tools.extend({},overrideSettings.external_plugins,userDefinedExternalPlugins):userDefinedExternalPlugins},combineSettings=function(defaultSettings,defaultOverrideSettings,settings){var sectionResult=extractSections(["mobile"],settings),plugins=sectionResult.settings().plugins;return Tools.extend(defaultSettings,defaultOverrideSettings,sectionResult.settings(),isTouch?getSection(sectionResult,"mobile"):{},{validate:!0,content_editable:sectionResult.settings().inline,external_plugins:getExternalPlugins(defaultOverrideSettings,sectionResult.settings())},isTouch&&plugins&&hasSection(sectionResult,"mobile")?{plugins:filterMobilePlugins(plugins)}:{})};return{getEditorSettings:function(editor,id,documentBaseUrl,defaultOverrideSettings,settings){var defaultSettings=getDefaultSettings(id,documentBaseUrl,editor);return combineSettings(defaultSettings,defaultOverrideSettings,settings)},get:function(editor,name){return Option.from(editor.settings[name])},getString:Fun.curry(function(predicate,editor,name){return Option.from(editor.settings[name]).filter(predicate)},Type.isString),filterMobilePlugins:filterMobilePlugins}}),define("tinymce.core.text.Bidi",[],function(){var strongRtl=/[\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC]/;return{hasStrongRtl:function(text){return strongRtl.test(text)}}}),define("tinymce.core.keyboard.InlineUtils",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Options","ephox.katamari.api.Type","ephox.sugar.api.node.Element","ephox.sugar.api.search.Selectors","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.caret.CaretWalker","tinymce.core.dom.DOMUtils","tinymce.core.dom.NodeType","tinymce.core.EditorSettings","tinymce.core.text.Bidi"],function(Arr,Fun,Option,Options,Type,Element,Selectors,CaretContainer,CaretFinder,CaretPosition,CaretUtils,CaretWalker,DOMUtils,NodeType,EditorSettings,Bidi){var findInlineParents=function(isInlineTarget,rootNode,pos){return Arr.filter(DOMUtils.DOM.getParents(pos.container(),"*",rootNode),isInlineTarget)},normalizePosition=function(forward,pos){var container=pos.container(),offset=pos.offset();return forward?CaretContainer.isCaretContainerInline(container)?NodeType.isText(container.nextSibling)?new CaretPosition(container.nextSibling,0):CaretPosition.after(container):CaretContainer.isBeforeInline(pos)?new CaretPosition(container,offset+1):pos:CaretContainer.isCaretContainerInline(container)?NodeType.isText(container.previousSibling)?new CaretPosition(container.previousSibling,container.previousSibling.data.length):CaretPosition.before(container):CaretContainer.isAfterInline(pos)?new CaretPosition(container,offset-1):pos};return{isInlineTarget:function(editor,elm){var selector=EditorSettings.getString(editor,"inline_boundaries_selector").getOr("a[href],code");return Selectors.is(Element.fromDom(elm),selector)},findRootInline:function(isInlineTarget,rootNode,pos){var parents=findInlineParents(isInlineTarget,rootNode,pos);return Option.from(parents[parents.length-1])},isRtl:function(element){return"rtl"===DOMUtils.DOM.getStyle(element,"direction",!0)||Bidi.hasStrongRtl(element.textContent)},isAtZwsp:function(pos){return CaretContainer.isBeforeInline(pos)||CaretContainer.isAfterInline(pos)},normalizePosition:normalizePosition,normalizeForwards:Fun.curry(normalizePosition,!0),normalizeBackwards:Fun.curry(normalizePosition,!1),hasSameParentBlock:function(rootNode,node1,node2){var block1=CaretUtils.getParentBlock(node1,rootNode),block2=CaretUtils.getParentBlock(node2,rootNode);return block1&&block1===block2}}}),define("tinymce.core.keyboard.BoundaryCaret",["ephox.katamari.api.Option","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretContainerInline","tinymce.core.caret.CaretContainerRemove","tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.dom.NodeType","tinymce.core.keyboard.InlineUtils"],function(Option,CaretContainer,CaretContainerInline,CaretContainerRemove,CaretFinder,CaretPosition,NodeType,InlineUtils){var insertInlinePos=function(pos,before){return NodeType.isText(pos.container())?CaretContainerInline.insertInline(before,pos.container()):CaretContainerInline.insertInline(before,pos.getNode())},isPosCaretContainer=function(pos,caret){var caretNode=caret.get();return caretNode&&pos.container()===caretNode&&CaretContainer.isCaretContainerInline(caretNode)};return{renderCaret:function(caret,location){return location.fold(function(element){CaretContainerRemove.remove(caret.get());var text=CaretContainerInline.insertInlineBefore(element);return caret.set(text),Option.some(new CaretPosition(text,text.length-1))},function(element){return CaretFinder.firstPositionIn(element).map(function(pos){if(isPosCaretContainer(pos,caret))return new CaretPosition(caret.get(),1);CaretContainerRemove.remove(caret.get());var text=insertInlinePos(pos,!0);return caret.set(text),new CaretPosition(text,1)})},function(element){return CaretFinder.lastPositionIn(element).map(function(pos){if(isPosCaretContainer(pos,caret))return new CaretPosition(caret.get(),caret.get().length-1);CaretContainerRemove.remove(caret.get());var text=insertInlinePos(pos,!1);return caret.set(text),new CaretPosition(text,text.length-1)})},function(element){CaretContainerRemove.remove(caret.get());var text=CaretContainerInline.insertInlineAfter(element);return caret.set(text),Option.some(new CaretPosition(text,1))})}}}),define("tinymce.core.util.LazyEvaluator",["ephox.katamari.api.Option"],function(Option){return{evaluateUntil:function(fns,args){for(var i=0;i<fns.length;i++){var result=fns[i].apply(null,args);if(result.isSome())return result}return Option.none()}}}),define("tinymce.core.keyboard.BoundaryLocation",["ephox.katamari.api.Adt","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Options","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.dom.NodeType","tinymce.core.keyboard.InlineUtils","tinymce.core.util.LazyEvaluator"],function(Adt,Fun,Option,Options,CaretContainer,CaretFinder,CaretPosition,CaretUtils,NodeType,InlineUtils,LazyEvaluator){var Location=Adt.generate([{before:["element"]},{start:["element"]},{end:["element"]},{after:["element"]}]),rescope=function(rootNode,node){var parentBlock=CaretUtils.getParentBlock(node,rootNode);return parentBlock||rootNode},before=function(isInlineTarget,rootNode,pos){var nPos=InlineUtils.normalizeForwards(pos),scope=rescope(rootNode,nPos.container());return InlineUtils.findRootInline(isInlineTarget,scope,nPos).fold(function(){return CaretFinder.nextPosition(scope,nPos).bind(Fun.curry(InlineUtils.findRootInline,isInlineTarget,scope)).map(function(inline){return Location.before(inline)})},Option.none)},start=function(isInlineTarget,rootNode,pos){var nPos=InlineUtils.normalizeBackwards(pos);return InlineUtils.findRootInline(isInlineTarget,rootNode,nPos).bind(function(inline){return CaretFinder.prevPosition(inline,nPos).isNone()?Option.some(Location.start(inline)):Option.none()})},end=function(isInlineTarget,rootNode,pos){var nPos=InlineUtils.normalizeForwards(pos);return InlineUtils.findRootInline(isInlineTarget,rootNode,nPos).bind(function(inline){return CaretFinder.nextPosition(inline,nPos).isNone()?Option.some(Location.end(inline)):Option.none()})},after=function(isInlineTarget,rootNode,pos){var nPos=InlineUtils.normalizeBackwards(pos),scope=rescope(rootNode,nPos.container());return InlineUtils.findRootInline(isInlineTarget,scope,nPos).fold(function(){return CaretFinder.prevPosition(scope,nPos).bind(Fun.curry(InlineUtils.findRootInline,isInlineTarget,scope)).map(function(inline){return Location.after(inline)})},Option.none)},isValidLocation=function(location){return!1===InlineUtils.isRtl(getElement(location))},readLocation=function(isInlineTarget,rootNode,pos){return LazyEvaluator.evaluateUntil([before,start,end,after],[isInlineTarget,rootNode,pos]).filter(isValidLocation)},getElement=function(location){return location.fold(Fun.identity,Fun.identity,Fun.identity,Fun.identity)},getName=function(location){return location.fold(Fun.constant("before"),Fun.constant("start"),Fun.constant("end"),Fun.constant("after"))},outside=function(location){return location.fold(Location.before,Location.before,Location.after,Location.after)},isEq=function(location1,location2){return getName(location1)===getName(location2)&&getElement(location1)===getElement(location2)},betweenInlines=function(forward,isInlineTarget,rootNode,from,to,location){return Options.liftN([InlineUtils.findRootInline(isInlineTarget,rootNode,from),InlineUtils.findRootInline(isInlineTarget,rootNode,to)],function(fromInline,toInline){return fromInline!==toInline&&InlineUtils.hasSameParentBlock(rootNode,fromInline,toInline)?Location.after(forward?fromInline:toInline):location}).getOr(location)},skipNoMovement=function(fromLocation,toLocation){return fromLocation.fold(Fun.constant(!0),function(fromLocation){return!isEq(fromLocation,toLocation)})},findLocationTraverse=function(forward,isInlineTarget,rootNode,fromLocation,pos){var from=InlineUtils.normalizePosition(forward,pos);return CaretFinder.fromPosition(forward,rootNode,from).map(Fun.curry(InlineUtils.normalizePosition,forward)).fold(function(){return fromLocation.map(outside)},function(to){return readLocation(isInlineTarget,rootNode,to).map(Fun.curry(betweenInlines,forward,isInlineTarget,rootNode,from,to)).filter(Fun.curry(skipNoMovement,fromLocation))}).filter(isValidLocation)},findLocationSimple=function(forward,location){return forward?location.fold(Fun.compose(Option.some,Location.start),Option.none,Fun.compose(Option.some,Location.after),Option.none):location.fold(Option.none,Fun.compose(Option.some,Location.before),Option.none,Fun.compose(Option.some,Location.end))},findLocation=function(forward,isInlineTarget,rootNode,pos){var from=InlineUtils.normalizePosition(forward,pos),fromLocation=readLocation(isInlineTarget,rootNode,from);return readLocation(isInlineTarget,rootNode,from).bind(Fun.curry(findLocationSimple,forward)).orThunk(function(){return findLocationTraverse(forward,isInlineTarget,rootNode,fromLocation,pos)})};return{readLocation:readLocation,findLocation:findLocation,prevLocation:Fun.curry(findLocation,!1),nextLocation:Fun.curry(findLocation,!0),getElement:getElement,outside:outside,inside:function(location){return location.fold(Location.start,Location.start,Location.end,Location.end)}}}),define("tinymce.core.keyboard.BoundarySelection",["ephox.katamari.api.Arr","ephox.katamari.api.Cell","ephox.katamari.api.Fun","tinymce.core.caret.CaretContainerRemove","tinymce.core.caret.CaretPosition","tinymce.core.keyboard.BoundaryCaret","tinymce.core.keyboard.BoundaryLocation","tinymce.core.keyboard.InlineUtils"],function(Arr,Cell,Fun,CaretContainerRemove,CaretPosition,BoundaryCaret,BoundaryLocation,InlineUtils){var setCaretPosition=function(editor,pos){var rng=editor.dom.createRng();rng.setStart(pos.container(),pos.offset()),rng.setEnd(pos.container(),pos.offset()),editor.selection.setRng(rng)},isFeatureEnabled=function(editor){return!1!==editor.settings.inline_boundaries},setSelected=function(state,elm){state?elm.setAttribute("data-mce-selected","1"):elm.removeAttribute("data-mce-selected","1")},renderCaretLocation=function(editor,caret,location){return BoundaryCaret.renderCaret(caret,location).map(function(pos){return setCaretPosition(editor,pos),location})},findLocation=function(editor,caret,forward){var rootNode=editor.getBody(),from=CaretPosition.fromRangeStart(editor.selection.getRng()),isInlineTarget=Fun.curry(InlineUtils.isInlineTarget,editor);return BoundaryLocation.findLocation(forward,isInlineTarget,rootNode,from).bind(function(location){return renderCaretLocation(editor,caret,location)})},toggleInlines=function(isInlineTarget,dom,elms){var selectedInlines=Arr.filter(dom.select("*[data-mce-selected]"),isInlineTarget),targetInlines=Arr.filter(elms,isInlineTarget);Arr.each(Arr.difference(selectedInlines,targetInlines),Fun.curry(setSelected,!1)),Arr.each(Arr.difference(targetInlines,selectedInlines),Fun.curry(setSelected,!0))},safeRemoveCaretContainer=function(editor,caret){if(editor.selection.isCollapsed()&&!0!==editor.composing&&caret.get()){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());CaretPosition.isTextPosition(pos)&&!1===InlineUtils.isAtZwsp(pos)&&(setCaretPosition(editor,CaretContainerRemove.removeAndReposition(caret.get(),pos)),caret.set(null))}},renderInsideInlineCaret=function(isInlineTarget,editor,caret,elms){if(editor.selection.isCollapsed()){var inlines=Arr.filter(elms,isInlineTarget);Arr.each(inlines,function(inline){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());BoundaryLocation.readLocation(isInlineTarget,editor.getBody(),pos).bind(function(location){return renderCaretLocation(editor,caret,location)})})}};return{move:function(editor,caret,forward){return function(){return!!isFeatureEnabled(editor)&&findLocation(editor,caret,forward).isSome()}},setupSelectedState:function(editor){var caret=new Cell(null),isInlineTarget=Fun.curry(InlineUtils.isInlineTarget,editor);return editor.on("NodeChange",function(e){isFeatureEnabled(editor)&&(toggleInlines(isInlineTarget,editor.dom,e.parents),safeRemoveCaretContainer(editor,caret),renderInsideInlineCaret(isInlineTarget,editor,caret,e.parents))}),caret},setCaretPosition:setCaretPosition}}),define("tinymce.core.delete.InlineBoundaryDelete",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Options","ephox.sugar.api.node.Element","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.delete.DeleteElement","tinymce.core.keyboard.BoundaryCaret","tinymce.core.keyboard.BoundaryLocation","tinymce.core.keyboard.BoundarySelection","tinymce.core.keyboard.InlineUtils"],function(Fun,Option,Options,Element,CaretContainer,CaretFinder,CaretPosition,CaretUtils,DeleteElement,BoundaryCaret,BoundaryLocation,BoundarySelection,InlineUtils){var isFeatureEnabled=function(editor){return!1!==editor.settings.inline_boundaries},rangeFromPositions=function(from,to){var range=document.createRange();return range.setStart(from.container(),from.offset()),range.setEnd(to.container(),to.offset()),range},hasOnlyTwoOrLessPositionsLeft=function(elm){return Options.liftN([CaretFinder.firstPositionIn(elm),CaretFinder.lastPositionIn(elm)],function(firstPos,lastPos){var normalizedFirstPos=InlineUtils.normalizePosition(!0,firstPos),normalizedLastPos=InlineUtils.normalizePosition(!1,lastPos);return CaretFinder.nextPosition(elm,normalizedFirstPos).map(function(pos){return pos.isEqual(normalizedLastPos)}).getOr(!0)}).getOr(!0)},setCaretLocation=function(editor,caret){return function(location){return BoundaryCaret.renderCaret(caret,location).map(function(pos){return BoundarySelection.setCaretPosition(editor,pos),!0}).getOr(!1)}},deleteFromTo=function(editor,caret,from,to){var rootNode=editor.getBody(),isInlineTarget=Fun.curry(InlineUtils.isInlineTarget,editor);editor.undoManager.ignore(function(){editor.selection.setRng(rangeFromPositions(from,to)),editor.execCommand("Delete"),BoundaryLocation.readLocation(isInlineTarget,rootNode,CaretPosition.fromRangeStart(editor.selection.getRng())).map(BoundaryLocation.inside).map(setCaretLocation(editor,caret))}),editor.nodeChanged()},rescope=function(rootNode,node){var parentBlock=CaretUtils.getParentBlock(node,rootNode);return parentBlock||rootNode},backspaceDeleteCollapsed=function(editor,caret,forward,from){var rootNode=rescope(editor.getBody(),from.container()),isInlineTarget=Fun.curry(InlineUtils.isInlineTarget,editor),fromLocation=BoundaryLocation.readLocation(isInlineTarget,rootNode,from);return fromLocation.bind(function(location){return forward?location.fold(Fun.constant(Option.some(BoundaryLocation.inside(location))),Option.none,Fun.constant(Option.some(BoundaryLocation.outside(location))),Option.none):location.fold(Option.none,Fun.constant(Option.some(BoundaryLocation.outside(location))),Option.none,Fun.constant(Option.some(BoundaryLocation.inside(location))))}).map(setCaretLocation(editor,caret)).getOrThunk(function(){var toPosition=CaretFinder.navigate(forward,rootNode,from),toLocation=toPosition.bind(function(pos){return BoundaryLocation.readLocation(isInlineTarget,rootNode,pos)});return fromLocation.isSome()&&toLocation.isSome()?InlineUtils.findRootInline(isInlineTarget,rootNode,from).map(function(elm){return!!hasOnlyTwoOrLessPositionsLeft(elm)&&(DeleteElement.deleteElement(editor,forward,Element.fromDom(elm)),!0)}).getOr(!1):toLocation.bind(function(_){return toPosition.map(function(to){return forward?deleteFromTo(editor,caret,from,to):deleteFromTo(editor,caret,to,from),!0})}).getOr(!1)})};return{backspaceDelete:function(editor,caret,forward){if(editor.selection.isCollapsed()&&isFeatureEnabled(editor)){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return backspaceDeleteCollapsed(editor,caret,forward,from)}return!1}}}),define("tinymce.core.delete.TableDeleteAction",["ephox.katamari.api.Adt","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Options","ephox.katamari.api.Struct","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.api.search.SelectorFilter","ephox.sugar.api.search.SelectorFind"],function(Adt,Arr,Fun,Option,Options,Struct,Compare,Element,SelectorFilter,SelectorFind){var tableCellRng=Struct.immutable("start","end"),tableSelection=Struct.immutable("rng","table","cells"),deleteAction=Adt.generate([{removeTable:["element"]},{emptyCells:["cells"]}]),getClosestCell=function(container,isRoot){return SelectorFind.closest(Element.fromDom(container),"td,th",isRoot)},getClosestTable=function(cell,isRoot){return SelectorFind.ancestor(cell,"table",isRoot)},isExpandedCellRng=function(cellRng){return!1===Compare.eq(cellRng.start(),cellRng.end())},getTableFromCellRng=function(cellRng,isRoot){return getClosestTable(cellRng.start(),isRoot).bind(function(startParentTable){return getClosestTable(cellRng.end(),isRoot).bind(function(endParentTable){return Compare.eq(startParentTable,endParentTable)?Option.some(startParentTable):Option.none()})})},getCellRng=function(rng,isRoot){return Options.liftN([getClosestCell(rng.startContainer,isRoot),getClosestCell(rng.endContainer,isRoot)],tableCellRng).filter(isExpandedCellRng)},getTableSelectionFromCellRng=function(cellRng,isRoot){return getTableFromCellRng(cellRng,isRoot).bind(function(table){var cells=SelectorFilter.descendants(table,"td,th");return tableSelection(cellRng,table,cells)})},getTableSelectionFromRng=function(rootNode,rng){var isRoot=Fun.curry(Compare.eq,rootNode);return getCellRng(rng,isRoot).map(function(cellRng){return getTableSelectionFromCellRng(cellRng,isRoot)})},getCellIndex=function(cellArray,cell){return Arr.findIndex(cellArray,function(x){return Compare.eq(x,cell)})},getSelectedCells=function(tableSelection){return Options.liftN([getCellIndex(tableSelection.cells(),tableSelection.rng().start()),getCellIndex(tableSelection.cells(),tableSelection.rng().end())],function(startIndex,endIndex){return tableSelection.cells().slice(startIndex,endIndex+1)})},getAction=function(tableSelection){return getSelectedCells(tableSelection).bind(function(selected){var cells=tableSelection.cells();return selected.length===cells.length?deleteAction.removeTable(tableSelection.table()):deleteAction.emptyCells(selected)})};return{getActionFromRange:function(rootNode,rng){return getTableSelectionFromRng(rootNode,rng).map(getAction)},getActionFromCells:function(cells){return deleteAction.emptyCells(cells)}}}),define("tinymce.core.delete.TableDelete",["ephox.katamari.api.Adt","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.sugar.api.node.Element","ephox.sugar.api.search.SelectorFilter","tinymce.core.delete.DeleteElement","tinymce.core.delete.TableDeleteAction","tinymce.core.dom.PaddingBr"],function(Adt,Arr,Fun,Element,SelectorFilter,DeleteElement,TableDeleteAction,PaddingBr){var emptyCells=function(editor,cells){return Arr.each(cells,PaddingBr.fillWithPaddingBr),editor.selection.setCursorLocation(cells[0].dom(),0),!0},deleteTableElement=function(editor,table){return DeleteElement.deleteElement(editor,!1,table),!0},handleCellRange=function(editor,rootNode,rng){return TableDeleteAction.getActionFromRange(rootNode,rng).map(function(action){return action.fold(Fun.curry(deleteTableElement,editor),Fun.curry(emptyCells,editor))}).getOr(!1)},deleteRange=function(editor){var rootNode=Element.fromDom(editor.getBody()),rng=editor.selection.getRng(),selectedCells=SelectorFilter.descendants(rootNode,"td[data-mce-selected],th[data-mce-selected]");return 0!==selectedCells.length?emptyCells(editor,selectedCells):handleCellRange(editor,rootNode,rng)};return{backspaceDelete:function(editor){return!editor.selection.isCollapsed()&&deleteRange(editor)}}}),define("tinymce.core.delete.DeleteCommands",["tinymce.core.delete.BlockBoundaryDelete","tinymce.core.delete.BlockRangeDelete","tinymce.core.delete.CefDelete","tinymce.core.delete.DeleteUtils","tinymce.core.delete.InlineBoundaryDelete","tinymce.core.delete.TableDelete"],function(BlockBoundaryDelete,BlockRangeDelete,CefDelete,DeleteUtils,BoundaryDelete,TableDelete){var nativeCommand=function(editor,command){editor.getDoc().execCommand(command,!1,null)};return{deleteCommand:function(editor){CefDelete.backspaceDelete(editor,!1)||BoundaryDelete.backspaceDelete(editor,!1)||BlockBoundaryDelete.backspaceDelete(editor,!1)||TableDelete.backspaceDelete(editor)||BlockRangeDelete.backspaceDelete(editor,!1)||(nativeCommand(editor,"Delete"),DeleteUtils.paddEmptyBody(editor))},forwardDeleteCommand:function(editor){CefDelete.backspaceDelete(editor,!0)||BoundaryDelete.backspaceDelete(editor,!0)||BlockBoundaryDelete.backspaceDelete(editor,!0)||TableDelete.backspaceDelete(editor)||BlockRangeDelete.backspaceDelete(editor,!0)||nativeCommand(editor,"ForwardDelete")}}}),define("tinymce.core.InsertList",["tinymce.core.util.Tools","tinymce.core.caret.CaretWalker","tinymce.core.caret.CaretPosition"],function(Tools,CaretWalker,CaretPosition){var cleanupDomFragment=function(domFragment){var firstChild=domFragment.firstChild,lastChild=domFragment.lastChild;return firstChild&&"META"===firstChild.nodeName&&firstChild.parentNode.removeChild(firstChild),lastChild&&"mce_marker"===lastChild.id&&lastChild.parentNode.removeChild(lastChild),domFragment},toDomFragment=function(dom,serializer,fragment){var html=serializer.serialize(fragment),domFragment=dom.createFragment(html);return cleanupDomFragment(domFragment)},listItems=function(elm){return Tools.grep(elm.childNodes,function(child){return"LI"===child.nodeName})},isEmpty=function(elm){return!elm.firstChild},trimListItems=function(elms){return elms.length>0&&isEmpty(elms[elms.length-1])?elms.slice(0,-1):elms},getParentLi=function(dom,node){var parentBlock=dom.getParent(node,dom.isBlock);return parentBlock&&"LI"===parentBlock.nodeName?parentBlock:null},getSplit=function(parentNode,rng){var beforeRng=rng.cloneRange(),afterRng=rng.cloneRange();return beforeRng.setStartBefore(parentNode),afterRng.setEndAfter(parentNode),[beforeRng.cloneContents(),afterRng.cloneContents()]},findFirstIn=function(node,rootNode){var caretPos=CaretPosition.before(node),newCaretPos=new CaretWalker(rootNode).next(caretPos);return newCaretPos?newCaretPos.toRange():null},findLastOf=function(node,rootNode){var caretPos=CaretPosition.after(node),newCaretPos=new CaretWalker(rootNode).prev(caretPos);return newCaretPos?newCaretPos.toRange():null},insertMiddle=function(target,elms,rootNode,rng){var parts=getSplit(target,rng),parentElm=target.parentNode;return parentElm.insertBefore(parts[0],target),Tools.each(elms,function(li){parentElm.insertBefore(li,target)}),parentElm.insertBefore(parts[1],target),parentElm.removeChild(target),findLastOf(elms[elms.length-1],rootNode)},insertBefore=function(target,elms,rootNode){var parentElm=target.parentNode;return Tools.each(elms,function(elm){parentElm.insertBefore(elm,target)}),findFirstIn(target,rootNode)},insertAfter=function(target,elms,rootNode,dom){return dom.insertAfter(elms.reverse(),target),findLastOf(elms[0],rootNode)};return{isListFragment:function(fragment){var firstChild=fragment.firstChild,lastChild=fragment.lastChild;return firstChild&&"meta"===firstChild.name&&(firstChild=firstChild.next),lastChild&&"mce_marker"===lastChild.attr("id")&&(lastChild=lastChild.prev),!(!firstChild||firstChild!==lastChild||"ul"!==firstChild.name&&"ol"!==firstChild.name)},insertAtCaret:function(serializer,dom,rng,fragment){var domFragment=toDomFragment(dom,serializer,fragment),liTarget=getParentLi(dom,rng.startContainer),liElms=trimListItems(listItems(domFragment.firstChild)),rootNode=dom.getRoot(),isAt=function(location){var caretPos=CaretPosition.fromRangeStart(rng),caretWalker=new CaretWalker(dom.getRoot()),newPos=1===location?caretWalker.prev(caretPos):caretWalker.next(caretPos);return!newPos||getParentLi(dom,newPos.getNode())!==liTarget};return isAt(1)?insertBefore(liTarget,liElms,rootNode):isAt(2)?insertAfter(liTarget,liElms,rootNode,dom):insertMiddle(liTarget,liElms,rootNode,rng)},isParentBlockLi:function(dom,node){return!!getParentLi(dom,node)},trimListItems:trimListItems,listItems:listItems}}),define("tinymce.core.InsertContent",["tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretWalker","tinymce.core.dom.ElementUtils","tinymce.core.dom.NodeType","tinymce.core.dom.RangeNormalizer","tinymce.core.Env","tinymce.core.html.Serializer","tinymce.core.InsertList","tinymce.core.util.Tools"],function(CaretPosition,CaretWalker,ElementUtils,NodeType,RangeNormalizer,Env,Serializer,InsertList,Tools){var isTableCell=NodeType.matchNodeNames("td th"),validInsertion=function(editor,value,parentNode){if("all"===parentNode.getAttribute("data-mce-bogus"))parentNode.parentNode.insertBefore(editor.dom.createFragment(value),parentNode);else{var node=parentNode.firstChild,node2=parentNode.lastChild;!node||node===node2&&"BR"===node.nodeName?editor.dom.setHTML(parentNode,value):editor.selection.setContent(value)}},insertHtmlAtCaret=function(editor,value,details){function isPartOfFragment(node){return!!node.getAttribute("data-mce-fragment")}var parser,serializer,parentNode,rootNode,fragment,args,marker,rng,node,node2,bookmarkHtml,merge,textInlineElements=editor.schema.getTextInlineElements(),selection=editor.selection,dom=editor.dom;/^ | $/.test(value)&&(value=function(html){function hasSiblingText(siblingName){return container[siblingName]&&3==container[siblingName].nodeType}var rng,container,offset;return rng=selection.getRng(!0),container=rng.startContainer,offset=rng.startOffset,3==container.nodeType&&(offset>0?html=html.replace(/^&nbsp;/," "):hasSiblingText("previousSibling")||(html=html.replace(/^ /,"&nbsp;")),offset<container.length?html=html.replace(/&nbsp;(<br>|)$/," "):hasSiblingText("nextSibling")||(html=html.replace(/(&nbsp;| )(<br>|)$/,"&nbsp;"))),html}(value)),parser=editor.parser,merge=details.merge,serializer=new Serializer({validate:editor.settings.validate},editor.schema),bookmarkHtml='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#x200B;</span>',args={content:value,format:"html",selection:!0},editor.fire("BeforeSetContent",args),-1==(value=args.content).indexOf("{$caret}")&&(value+="{$caret}"),value=value.replace(/\{\$caret\}/,bookmarkHtml);var caretElement=(rng=selection.getRng()).startContainer||(rng.parentElement?rng.parentElement():null),body=editor.getBody();caretElement===body&&selection.isCollapsed()&&dom.isBlock(body.firstChild)&&function(node){return node&&!editor.schema.getShortEndedElements()[node.nodeName]}(body.firstChild)&&dom.isEmpty(body.firstChild)&&((rng=dom.createRng()).setStart(body.firstChild,0),rng.setEnd(body.firstChild,0),selection.setRng(rng)),selection.isCollapsed()||(editor.selection.setRng(RangeNormalizer.normalize(editor.selection.getRng())),editor.getDoc().execCommand("Delete",!1,null),function(){var rng,container,offset;container=(rng=selection.getRng(!0)).startContainer,offset=rng.startOffset,3==container.nodeType&&rng.collapsed&&(""===container.data[offset]?(container.deleteData(offset,1),/[\u00a0| ]$/.test(value)||(value+=" ")):""===container.data[offset-1]&&(container.deleteData(offset-1,1),/[\u00a0| ]$/.test(value)||(value=" "+value)))}());var parserArgs={context:(parentNode=selection.getNode()).nodeName.toLowerCase(),data:details.data};if(fragment=parser.parse(value,parserArgs),!0===details.paste&&InsertList.isListFragment(fragment)&&InsertList.isParentBlockLi(dom,parentNode))return rng=InsertList.insertAtCaret(serializer,dom,editor.selection.getRng(!0),fragment),editor.selection.setRng(rng),void editor.fire("SetContent",args);if(function(fragment){for(var node=fragment;node=node.walk();)1===node.type&&node.attr("data-mce-fragment","1")}(fragment),"mce_marker"==(node=fragment.lastChild).attr("id"))for(marker=node,node=node.prev;node;node=node.walk(!0))if(3==node.type||!dom.isBlock(node.name)){editor.schema.isValidChild(node.parent.name,"span")&&node.parent.insert(marker,node,"br"===node.name);break}if(editor._selectionOverrides.showBlockCaretContainer(parentNode),parserArgs.invalid){for(selection.setContent(bookmarkHtml),parentNode=selection.getNode(),rootNode=editor.getBody(),9==parentNode.nodeType?parentNode=node=rootNode:node=parentNode;node!==rootNode;)parentNode=node,node=node.parentNode;value=parentNode==rootNode?rootNode.innerHTML:dom.getOuterHTML(parentNode),value=serializer.serialize(parser.parse(value.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return serializer.serialize(fragment)}))),parentNode==rootNode?dom.setHTML(rootNode,value):dom.setOuterHTML(parentNode,value)}else value=serializer.serialize(fragment),validInsertion(editor,value,parentNode);!function(){if(merge){var root=editor.getBody(),elementUtils=new ElementUtils(dom);Tools.each(dom.select("*[data-mce-fragment]"),function(node){for(var testNode=node.parentNode;testNode&&testNode!=root;testNode=testNode.parentNode)textInlineElements[node.nodeName.toLowerCase()]&&elementUtils.compare(testNode,node)&&dom.remove(node,!0)})}}(),function(marker){var parentEditableFalseElm,parentBlock,nextRng;if(marker){if(selection.scrollIntoView(marker),parentEditableFalseElm=function(node){for(var root=editor.getBody();node&&node!==root;node=node.parentNode)if("false"===editor.dom.getContentEditable(node))return node;return null}(marker))return dom.remove(marker),void selection.select(parentEditableFalseElm);rng=dom.createRng(),(node=marker.previousSibling)&&3==node.nodeType?(rng.setStart(node,node.nodeValue.length),Env.ie||(node2=marker.nextSibling)&&3==node2.nodeType&&(node.appendData(node2.data),node2.parentNode.removeChild(node2))):(rng.setStartBefore(marker),rng.setEndBefore(marker)),parentBlock=dom.getParent(marker,dom.isBlock),dom.remove(marker),parentBlock&&dom.isEmpty(parentBlock)&&(editor.$(parentBlock).empty(),rng.setStart(parentBlock,0),rng.setEnd(parentBlock,0),isTableCell(parentBlock)||isPartOfFragment(parentBlock)||!(nextRng=function(rng){var caretPos=CaretPosition.fromRangeStart(rng);if(caretPos=new CaretWalker(editor.getBody()).next(caretPos))return caretPos.toRange()}(rng))?dom.add(parentBlock,dom.create("br",{"data-mce-bogus":"1"})):(rng=nextRng,dom.remove(parentBlock))),selection.setRng(rng)}}(dom.get("mce_marker")),function(elm){Tools.each(elm.getElementsByTagName("*"),function(elm){elm.removeAttribute("data-mce-fragment")})}(editor.getBody()),editor.fire("SetContent",args),editor.addVisual()},processValue=function(value){var details;return"string"!=typeof value?(details=Tools.extend({paste:value.paste,data:{paste:value.paste}},value),{content:value.content,details:details}):{content:value,details:{}}};return{insertAtCaret:function(editor,value){var result=processValue(value);insertHtmlAtCaret(editor,result.content,result.details)}}}),define("tinymce.core.EditorCommands",["tinymce.core.delete.DeleteCommands","tinymce.core.dom.NodeType","tinymce.core.dom.RangeUtils","tinymce.core.dom.TreeWalker","tinymce.core.Env","tinymce.core.InsertContent","tinymce.core.util.Tools"],function(DeleteCommands,NodeType,RangeUtils,TreeWalker,Env,InsertContent,Tools){var each=Tools.each,extend=Tools.extend,map=Tools.map,inArray=Tools.inArray,explode=Tools.explode,isOldIE=Env.ie&&Env.ie<11,FALSE=!1;return function(editor){function queryCommandState(command){var func;if(!editor.quirks.isHidden()&&!editor.removed){if(command=command.toLowerCase(),func=commands.state[command])return func(command);try{return editor.getDoc().queryCommandState(command)}catch(ex){}return!1}}function addCommands(commandList,type){type=type||"exec",each(commandList,function(callback,command){each(command.toLowerCase().split(","),function(command){commands[type][command]=callback})})}function execNativeCommand(command,ui,value){return void 0===ui&&(ui=FALSE),void 0===value&&(value=null),editor.getDoc().execCommand(command,ui,value)}function isFormatMatch(name){return formatter.match(name)}function toggleFormat(name,value){formatter.toggle(name,value?{value:value}:void 0),editor.nodeChanged()}function storeSelection(type){bookmark=selection.getBookmark(type)}function restoreSelection(){selection.moveToBookmark(bookmark)}var dom,selection,formatter,bookmark,commands={state:{},exec:{},value:{}},settings=editor.settings;editor.on("PreInit",function(){dom=editor.dom,selection=editor.selection,settings=editor.settings,formatter=editor.formatter}),extend(this,{execCommand:function(command,ui,value,args){var func,customCommand,state=0;if(!editor.removed){if(/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command)||args&&args.skip_focus||editor.focus(),(args=editor.fire("BeforeExecCommand",{command:command,ui:ui,value:value})).isDefaultPrevented())return!1;if(customCommand=command.toLowerCase(),func=commands.exec[customCommand])return func(customCommand,ui,value),editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0;if(each(editor.plugins,function(p){if(p.execCommand&&p.execCommand(command,ui,value))return editor.fire("ExecCommand",{command:command,ui:ui,value:value}),state=!0,!1}),state)return state;if(editor.theme&&editor.theme.execCommand&&editor.theme.execCommand(command,ui,value))return editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0;try{state=editor.getDoc().execCommand(command,ui,value)}catch(ex){}return!!state&&(editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0)}},queryCommandState:queryCommandState,queryCommandValue:function(command){var func;if(!editor.quirks.isHidden()&&!editor.removed){if(command=command.toLowerCase(),func=commands.value[command])return func(command);try{return editor.getDoc().queryCommandValue(command)}catch(ex){}}},queryCommandSupported:function(command){if(command=command.toLowerCase(),commands.exec[command])return!0;try{return editor.getDoc().queryCommandSupported(command)}catch(ex){}return!1},addCommands:addCommands,addCommand:function(command,callback,scope){command=command.toLowerCase(),commands.exec[command]=function(command,ui,value,args){return callback.call(scope||editor,ui,value,args)}},addQueryStateHandler:function(command,callback,scope){command=command.toLowerCase(),commands.state[command]=function(){return callback.call(scope||editor)}},addQueryValueHandler:function(command,callback,scope){command=command.toLowerCase(),commands.value[command]=function(){return callback.call(scope||editor)}},hasCustomCommand:function(command){return command=command.toLowerCase(),!!commands.exec[command]}}),addCommands({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){editor.undoManager.add()},"Cut,Copy,Paste":function(command){var failed,doc=editor.getDoc();try{execNativeCommand(command)}catch(ex){failed=!0}if("paste"!==command||doc.queryCommandEnabled(command)||(failed=!0),failed||!doc.queryCommandSupported(command)){var msg=editor.translate("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.");Env.mac&&(msg=msg.replace(/Ctrl\+/g,"+")),editor.notificationManager.open({text:msg,type:"error"})}},unlink:function(){if(selection.isCollapsed()){var elm=editor.dom.getParent(editor.selection.getStart(),"a");elm&&editor.dom.remove(elm,!0)}else formatter.remove("link")},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone":function(command){var align=command.substring(7);"full"==align&&(align="justify"),each("left,center,right,justify".split(","),function(name){align!=name&&formatter.remove("align"+name)}),"none"!=align&&toggleFormat("align"+align)},"InsertUnorderedList,InsertOrderedList":function(command){var listElm,listParent;execNativeCommand(command),(listElm=dom.getParent(selection.getNode(),"ol,ul"))&&(listParent=listElm.parentNode,/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)&&(storeSelection(),dom.split(listParent,listElm),restoreSelection()))},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){toggleFormat(command)},"ForeColor,HiliteColor,FontName":function(command,ui,value){toggleFormat(command,value)},FontSize:function(command,ui,value){var fontClasses,fontSizes;value>=1&&value<=7&&(fontSizes=explode(settings.font_size_style_values),value=(fontClasses=explode(settings.font_size_classes))?fontClasses[value-1]||value:fontSizes[value-1]||value),toggleFormat(command,value)},RemoveFormat:function(command){formatter.remove(command)},mceBlockQuote:function(){toggleFormat("blockquote")},FormatBlock:function(command,ui,value){return toggleFormat(value||"p")},mceCleanup:function(){var bookmark=selection.getBookmark();editor.setContent(editor.getContent({cleanup:!0}),{cleanup:!0}),selection.moveToBookmark(bookmark)},mceRemoveNode:function(command,ui,value){var node=value||selection.getNode();node!=editor.getBody()&&(storeSelection(),editor.dom.remove(node,!0),restoreSelection())},mceSelectNodeDepth:function(command,ui,value){var counter=0;dom.getParent(selection.getNode(),function(node){if(1==node.nodeType&&counter++==value)return selection.select(node),FALSE},editor.getBody())},mceSelectNode:function(command,ui,value){selection.select(value)},mceInsertContent:function(command,ui,value){InsertContent.insertAtCaret(editor,value)},mceInsertRawHTML:function(command,ui,value){selection.setContent("tiny_mce_marker"),editor.setContent(editor.getContent().replace(/tiny_mce_marker/g,function(){return value}))},mceToggleFormat:function(command,ui,value){toggleFormat(value)},mceSetContent:function(command,ui,value){editor.setContent(value)},"Indent,Outdent":function(command){var intentValue,indentUnit,value;intentValue=settings.indentation,indentUnit=/[a-z%]+$/i.exec(intentValue),intentValue=parseInt(intentValue,10),queryCommandState("InsertUnorderedList")||queryCommandState("InsertOrderedList")?execNativeCommand(command):(settings.forced_root_block||dom.getParent(selection.getNode(),dom.isBlock)||formatter.apply("div"),each(selection.getSelectedBlocks(),function(element){if("false"!==dom.getContentEditable(element)&&"LI"!==element.nodeName){var indentStyleName=editor.getParam("indent_use_margin",!1)?"margin":"padding";indentStyleName="TABLE"===element.nodeName?"margin":indentStyleName,indentStyleName+="rtl"==dom.getStyle(element,"direction",!0)?"Right":"Left","outdent"==command?(value=Math.max(0,parseInt(element.style[indentStyleName]||0,10)-intentValue),dom.setStyle(element,indentStyleName,value?value+indentUnit:"")):(value=parseInt(element.style[indentStyleName]||0,10)+intentValue+indentUnit,dom.setStyle(element,indentStyleName,value))}}))},mceRepaint:function(){},InsertHorizontalRule:function(){editor.execCommand("mceInsertContent",!1,"<hr />")},mceToggleVisualAid:function(){editor.hasVisual=!editor.hasVisual,editor.addVisual()},mceReplaceContent:function(command,ui,value){editor.execCommand("mceInsertContent",!1,value.replace(/\{\$selection\}/g,selection.getContent({format:"text"})))},mceInsertLink:function(command,ui,value){var anchor;"string"==typeof value&&(value={href:value}),anchor=dom.getParent(selection.getNode(),"a"),value.href=value.href.replace(" ","%20"),anchor&&value.href||formatter.remove("link"),value.href&&formatter.apply("link",value,anchor)},selectAll:function(){var rng,root=dom.getRoot();if(selection.getRng().setStart){var editingHost=dom.getParent(selection.getStart(),NodeType.isContentEditableTrue);editingHost&&((rng=dom.createRng()).selectNodeContents(editingHost),selection.setRng(rng))}else(rng=selection.getRng()).item||(rng.moveToElementText(root),rng.select())},delete:function(){DeleteCommands.deleteCommand(editor)},forwardDelete:function(){DeleteCommands.forwardDeleteCommand(editor)},mceNewDocument:function(){editor.setContent("")},InsertLineBreak:function(command,ui,value){var brElm,extraBr,marker,evt=value,rng=selection.getRng(!0);new RangeUtils(dom).normalize(rng);var offset=rng.startOffset,container=rng.startContainer;if(1==container.nodeType&&container.hasChildNodes()){var isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&3==container.nodeType?container.nodeValue.length:0}var parentBlock=dom.getParent(container,dom.isBlock),parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():"",containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null,containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"",isControlKey=evt&&evt.ctrlKey;"LI"!=containerBlockName||isControlKey||(parentBlock=containerBlock,parentBlockName=containerBlockName),container&&3==container.nodeType&&offset>=container.nodeValue.length&&(isOldIE||function(){for(var node,walker=new TreeWalker(container,parentBlock),nonEmptyElementsMap=editor.schema.getNonEmptyElements();node=walker.next();)if(nonEmptyElementsMap[node.nodeName.toLowerCase()]||node.length>0)return!0}()||(brElm=dom.create("br"),rng.insertNode(brElm),rng.setStartAfter(brElm),rng.setEndAfter(brElm),extraBr=!0)),brElm=dom.create("br"),rng.insertNode(brElm);var documentMode=dom.doc.documentMode;return isOldIE&&"PRE"==parentBlockName&&(!documentMode||documentMode<8)&&brElm.parentNode.insertBefore(dom.doc.createTextNode("\r"),brElm),marker=dom.create("span",{},"&nbsp;"),brElm.parentNode.insertBefore(marker,brElm),selection.scrollIntoView(marker),dom.remove(marker),extraBr?(rng.setStartBefore(brElm),rng.setEndBefore(brElm)):(rng.setStartAfter(brElm),rng.setEndAfter(brElm)),selection.setRng(rng),editor.undoManager.add(),!0}}),addCommands({"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(command){var name="align"+command.substring(7),nodes=selection.isCollapsed()?[dom.getParent(selection.getNode(),dom.isBlock)]:selection.getSelectedBlocks(),matches=map(nodes,function(node){return!!formatter.matchNode(node,name)});return-1!==inArray(matches,!0)},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){return isFormatMatch(command)},mceBlockQuote:function(){return isFormatMatch("blockquote")},Outdent:function(){var node;if(settings.inline_styles){if((node=dom.getParent(selection.getStart(),dom.isBlock))&&parseInt(node.style.paddingLeft,10)>0)return!0;if((node=dom.getParent(selection.getEnd(),dom.isBlock))&&parseInt(node.style.paddingLeft,10)>0)return!0}return queryCommandState("InsertUnorderedList")||queryCommandState("InsertOrderedList")||!settings.inline_styles&&!!dom.getParent(selection.getNode(),"BLOCKQUOTE")},"InsertUnorderedList,InsertOrderedList":function(command){var list=dom.getParent(selection.getNode(),"ul,ol");return list&&("insertunorderedlist"===command&&"UL"===list.tagName||"insertorderedlist"===command&&"OL"===list.tagName)}},"state"),addCommands({"FontSize,FontName":function(command){var parent,value=0;return(parent=dom.getParent(selection.getNode(),"span"))&&(value="fontsize"==command?parent.style.fontSize:parent.style.fontFamily.replace(/, /g,",").replace(/[\'\"]/g,"").toLowerCase()),value}},"value"),addCommands({Undo:function(){editor.undoManager.undo()},Redo:function(){editor.undoManager.redo()}})}}),define("tinymce.core.util.URI",["global!document","tinymce.core.util.Tools"],function(document,Tools){function URI(url,settings){var baseUri,baseUrl,self=this;if(url=trim(url),settings=self.settings=settings||{},baseUri=settings.base_uri,/^([\w\-]+):([^\/]{2})/i.test(url)||/^\s*#/.test(url))self.source=url;else{var isProtocolRelative=0===url.indexOf("//");0!==url.indexOf("/")||isProtocolRelative||(url=(baseUri?baseUri.protocol||"http":"http")+"://mce_host"+url),/^[\w\-]*:?\/\//.test(url)||(baseUrl=settings.base_uri?settings.base_uri.path:new URI(document.location.href).directory,""===settings.base_uri.protocol?url="//mce_host"+self.toAbsPath(baseUrl,url):(url=/([^#?]*)([#?]?.*)/.exec(url),url=(baseUri&&baseUri.protocol||"http")+"://mce_host"+self.toAbsPath(baseUrl,url[1])+url[2])),url=url.replace(/@@/g,"(mce_at)"),url=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(url),each(queryParts,function(v,i){var part=url[i];part&&(part=part.replace(/\(mce_at\)/g,"@@")),self[v]=part}),baseUri&&(self.protocol||(self.protocol=baseUri.protocol),self.userInfo||(self.userInfo=baseUri.userInfo),self.port||"mce_host"!==self.host||(self.port=baseUri.port),self.host&&"mce_host"!==self.host||(self.host=baseUri.host),self.source=""),isProtocolRelative&&(self.protocol="")}}var each=Tools.each,trim=Tools.trim,queryParts="source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),DEFAULT_PORTS={ftp:21,http:80,https:443,mailto:25};return URI.prototype={setPath:function(path){var self=this;path=/^(.*?)\/?(\w+)?$/.exec(path),self.path=path[0],self.directory=path[1],self.file=path[2],self.source="",self.getURI()},toRelative:function(uri){var output,self=this;if("./"===uri)return uri;if("mce_host"!=(uri=new URI(uri,{base_uri:self})).host&&self.host!=uri.host&&uri.host||self.port!=uri.port||self.protocol!=uri.protocol&&""!==uri.protocol)return uri.getURI();var tu=self.getURI(),uu=uri.getURI();return tu==uu||"/"==tu.charAt(tu.length-1)&&tu.substr(0,tu.length-1)==uu?tu:(output=self.toRelPath(self.path,uri.path),uri.query&&(output+="?"+uri.query),uri.anchor&&(output+="#"+uri.anchor),output)},toAbsolute:function(uri,noHost){return(uri=new URI(uri,{base_uri:this})).getURI(noHost&&this.isSameOrigin(uri))},isSameOrigin:function(uri){if(this.host==uri.host&&this.protocol==uri.protocol){if(this.port==uri.port)return!0;var defaultPort=DEFAULT_PORTS[this.protocol];if(defaultPort&&(this.port||defaultPort)==(uri.port||defaultPort))return!0}return!1},toRelPath:function(base,path){var items,i,l,breakPoint=0,out="";if(base=base.substring(0,base.lastIndexOf("/")),base=base.split("/"),items=path.split("/"),base.length>=items.length)for(i=0,l=base.length;i<l;i++)if(i>=items.length||base[i]!=items[i]){breakPoint=i+1;break}if(base.length<items.length)for(i=0,l=items.length;i<l;i++)if(i>=base.length||base[i]!=items[i]){breakPoint=i+1;break}if(1===breakPoint)return path;for(i=0,l=base.length-(breakPoint-1);i<l;i++)out+="../";for(i=breakPoint-1,l=items.length;i<l;i++)out+=i!=breakPoint-1?"/"+items[i]:items[i];return out},toAbsPath:function(base,path){var i,tr,outPath,nb=0,o=[];for(tr=/\/$/.test(path)?"/":"",base=base.split("/"),path=path.split("/"),each(base,function(k){k&&o.push(k)}),base=o,i=path.length-1,o=[];i>=0;i--)0!==path[i].length&&"."!==path[i]&&(".."!==path[i]?nb>0?nb--:o.push(path[i]):nb++);return i=base.length-nb,0!==(outPath=i<=0?o.reverse().join("/"):base.slice(0,i).join("/")+"/"+o.reverse().join("/")).indexOf("/")&&(outPath="/"+outPath),tr&&outPath.lastIndexOf("/")!==outPath.length-1&&(outPath+=tr),outPath},getURI:function(noProtoHost){var s,self=this;return self.source&&!noProtoHost||(s="",noProtoHost||(self.protocol?s+=self.protocol+"://":s+="//",self.userInfo&&(s+=self.userInfo+"@"),self.host&&(s+=self.host),self.port&&(s+=":"+self.port)),self.path&&(s+=self.path),self.query&&(s+="?"+self.query),self.anchor&&(s+="#"+self.anchor),self.source=s),self.source}},URI.parseDataUri=function(uri){var type,matches;return uri=decodeURIComponent(uri).split(","),(matches=/data:([^;]+)/.exec(uri[0]))&&(type=matches[1]),{type:type,data:uri[1]}},URI.getDocumentBaseUrl=function(loc){var baseUrl;return baseUrl=0!==loc.protocol.indexOf("http")&&"file:"!==loc.protocol?loc.href:loc.protocol+"//"+loc.host+loc.pathname,/^[^:]+:\/\/\/?[^\/]+\//.test(baseUrl)&&(baseUrl=baseUrl.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(baseUrl)||(baseUrl+="/")),baseUrl},URI}),define("tinymce.core.util.Class",["tinymce.core.util.Tools"],function(Tools){function Class(){}var extendClass,initializing,each=Tools.each,extend=Tools.extend;return Class.extend=extendClass=function(prop){function Class(){var i,mixins,mixin,self=this;if(!initializing&&(self.init&&self.init.apply(self,arguments),mixins=self.Mixins))for(i=mixins.length;i--;)(mixin=mixins[i]).init&&mixin.init.apply(self,arguments)}function dummy(){return this}var prototype,name,member,self=this,_super=self.prototype;initializing=!0,prototype=new self,initializing=!1,prop.Mixins&&(each(prop.Mixins,function(mixin){for(var name in mixin)"init"!==name&&(prop[name]=mixin[name])}),_super.Mixins&&(prop.Mixins=_super.Mixins.concat(prop.Mixins))),prop.Methods&&each(prop.Methods.split(","),function(name){prop[name]=dummy}),prop.Properties&&each(prop.Properties.split(","),function(name){var fieldName="_"+name;prop[name]=function(value){var self=this;return void 0!==value?(self[fieldName]=value,self):self[fieldName]}}),prop.Statics&&each(prop.Statics,function(func,name){Class[name]=func}),prop.Defaults&&_super.Defaults&&(prop.Defaults=extend({},_super.Defaults,prop.Defaults));for(name in prop)"function"==typeof(member=prop[name])&&_super[name]?prototype[name]=function(name,fn){return function(){var ret,self=this,tmp=self._super;return self._super=_super[name],ret=fn.apply(self,arguments),self._super=tmp,ret}}(name,member):prototype[name]=member;return Class.prototype=prototype,Class.constructor=Class,Class.extend=extendClass,Class},Class}),define("tinymce.core.util.EventDispatcher",["tinymce.core.util.Tools"],function(Tools){function Dispatcher(settings){function returnFalse(){return!1}function returnTrue(){return!0}function on(name,callback,prepend,extra){var handlers,names,i;if(!1===callback&&(callback=returnFalse),callback)for(callback={func:callback},extra&&Tools.extend(callback,extra),i=(names=name.toLowerCase().split(" ")).length;i--;)name=names[i],(handlers=bindings[name])||(handlers=bindings[name]=[],toggleEvent(name,!0)),prepend?handlers.unshift(callback):handlers.push(callback);return self}function off(name,callback){var i,handlers,bindingName,names,hi;if(name)for(i=(names=name.toLowerCase().split(" ")).length;i--;){if(name=names[i],handlers=bindings[name],!name){for(bindingName in bindings)toggleEvent(bindingName,!1),delete bindings[bindingName];return self}if(handlers){if(callback)for(hi=handlers.length;hi--;)handlers[hi].func===callback&&(handlers=handlers.slice(0,hi).concat(handlers.slice(hi+1)),bindings[name]=handlers);else handlers.length=0;handlers.length||(toggleEvent(name,!1),delete bindings[name])}}else{for(name in bindings)toggleEvent(name,!1);bindings={}}return self}var scope,toggleEvent,self=this,bindings={};scope=(settings=settings||{}).scope||self,toggleEvent=settings.toggleEvent||returnFalse,self.fire=function(name,args){var handlers,i,l,callback;if(name=name.toLowerCase(),args=args||{},args.type=name,args.target||(args.target=scope),args.preventDefault||(args.preventDefault=function(){args.isDefaultPrevented=returnTrue},args.stopPropagation=function(){args.isPropagationStopped=returnTrue},args.stopImmediatePropagation=function(){args.isImmediatePropagationStopped=returnTrue},args.isDefaultPrevented=returnFalse,args.isPropagationStopped=returnFalse,args.isImmediatePropagationStopped=returnFalse),settings.beforeFire&&settings.beforeFire(args),handlers=bindings[name])for(i=0,l=handlers.length;i<l;i++){if((callback=handlers[i]).once&&off(name,callback.func),args.isImmediatePropagationStopped())return args.stopPropagation(),args;if(!1===callback.func.call(scope,args))return args.preventDefault(),args}return args},self.on=on,self.off=off,self.once=function(name,callback,prepend){return on(name,callback,prepend,{once:!0})},self.has=function(name){return name=name.toLowerCase(),!(!bindings[name]||0===bindings[name].length)}}var nativeEvents=Tools.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover draggesture dragdrop drop drag submit compositionstart compositionend compositionupdate touchstart touchmove touchend"," ");return Dispatcher.isNative=function(name){return!!nativeEvents[name.toLowerCase()]},Dispatcher}),define("tinymce.core.util.Observable",["tinymce.core.util.EventDispatcher"],function(EventDispatcher){function getEventDispatcher(obj){return obj._eventDispatcher||(obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function(name,state){EventDispatcher.isNative(name)&&obj.toggleNativeEvent&&obj.toggleNativeEvent(name,state)}})),obj._eventDispatcher}return{fire:function(name,args,bubble){var self=this;if(self.removed&&"remove"!==name)return args;if(args=getEventDispatcher(self).fire(name,args,bubble),!1!==bubble&&self.parent)for(var parent=self.parent();parent&&!args.isPropagationStopped();)parent.fire(name,args,!1),parent=parent.parent();return args},on:function(name,callback,prepend){return getEventDispatcher(this).on(name,callback,prepend)},off:function(name,callback){return getEventDispatcher(this).off(name,callback)},once:function(name,callback){return getEventDispatcher(this).once(name,callback)},hasEventListeners:function(name){return getEventDispatcher(this).has(name)}}}),define("tinymce.core.data.Binding",[],function(){function Binding(settings){this.create=settings.create}return Binding.create=function(model,name){return new Binding({create:function(otherModel,otherName){function fromSelfToOther(e){otherModel.set(otherName,e.value)}var bindings;return otherModel.on("change:"+otherName,function(e){model.set(name,e.value)}),model.on("change:"+name,fromSelfToOther),(bindings=otherModel._bindings)||(bindings=otherModel._bindings=[],otherModel.on("destroy",function(){for(var i=bindings.length;i--;)bindings[i]()})),bindings.push(function(){model.off("change:"+name,fromSelfToOther)}),model.get(name)}})},Binding}),define("tinymce.core.data.ObservableObject",["tinymce.core.data.Binding","tinymce.core.util.Class","tinymce.core.util.Observable","tinymce.core.util.Tools"],function(Binding,Class,Observable,Tools){function isNode(node){return node.nodeType>0}function isEqual(a,b){var k,checked;if(a===b)return!0;if(null===a||null===b)return a===b;if("object"!=typeof a||"object"!=typeof b)return a===b;if(Tools.isArray(b)){if(a.length!==b.length)return!1;for(k=a.length;k--;)if(!isEqual(a[k],b[k]))return!1}if(isNode(a)||isNode(b))return a===b;checked={};for(k in b){if(!isEqual(a[k],b[k]))return!1;checked[k]=!0}for(k in a)if(!checked[k]&&!isEqual(a[k],b[k]))return!1;return!0}return Class.extend({Mixins:[Observable],init:function(data){var name,value;data=data||{};for(name in data)(value=data[name])instanceof Binding&&(data[name]=value.create(this,name));this.data=data},set:function(name,value){var key,args,oldValue=this.data[name];if(value instanceof Binding&&(value=value.create(this,name)),"object"==typeof name){for(key in name)this.set(key,name[key]);return this}return isEqual(oldValue,value)||(this.data[name]=value,args={target:this,name:name,value:value,oldValue:oldValue},this.fire("change:"+name,args),this.fire("change",args)),this},get:function(name){return this.data[name]},has:function(name){return name in this.data},bind:function(name){return Binding.create(this,name)},destroy:function(){this.fire("destroy")}})}),define("tinymce.core.ui.Selector",["tinymce.core.util.Class"],function(Class){"use strict";function unique(array){for(var item,uniqueItems=[],i=array.length;i--;)(item=array[i]).__checked||(uniqueItems.push(item),item.__checked=1);for(i=uniqueItems.length;i--;)delete uniqueItems[i].__checked;return uniqueItems}var Collection,expression=/^([\w\\*]+)?(?:#([\w\-\\]+))?(?:\.([\w\\\.]+))?(?:\[\@?([\w\\]+)([\^\$\*!~]?=)([\w\\]+)\])?(?:\:(.+))?/i,chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,whiteSpace=/^\s*|\s*$/g,Selector=Class.extend({init:function(selector){function compileNameFilter(name){if(name)return name=name.toLowerCase(),function(item){return"*"===name||item.type===name}}function compileIdFilter(id){if(id)return function(item){return item._name===id}}function compileClassesFilter(classes){if(classes)return classes=classes.split("."),function(item){for(var i=classes.length;i--;)if(!item.classes.contains(classes[i]))return!1;return!0}}function compileAttrFilter(name,cmp,check){if(name)return function(item){var value=item[name]?item[name]():"";return cmp?"="===cmp?value===check:"*="===cmp?value.indexOf(check)>=0:"~="===cmp?(" "+value+" ").indexOf(" "+check+" ")>=0:"!="===cmp?value!=check:"^="===cmp?0===value.indexOf(check):"$="===cmp&&value.substr(value.length-check.length)===check:!!check}}function compilePsuedoFilter(name){var notSelectors;if(name)return(name=/(?:not\((.+)\))|(.+)/i.exec(name))[1]?(notSelectors=parseChunks(name[1],[]),function(item){return!match(item,notSelectors)}):(name=name[2],function(item,index,length){return"first"===name?0===index:"last"===name?index===length-1:"even"===name?index%2==0:"odd"===name?index%2==1:!!item[name]&&item[name]()})}function compile(selector,filters,direct){function add(filter){filter&&filters.push(filter)}var parts;return parts=expression.exec(selector.replace(whiteSpace,"")),add(compileNameFilter(parts[1])),add(compileIdFilter(parts[2])),add(compileClassesFilter(parts[3])),add(compileAttrFilter(parts[4],parts[5],parts[6])),add(compilePsuedoFilter(parts[7])),filters.pseudo=!!parts[7],filters.direct=direct,filters}function parseChunks(selector,selectors){var extra,matches,i,parts=[];do{if(chunker.exec(""),(matches=chunker.exec(selector))&&(selector=matches[3],parts.push(matches[1]),matches[2])){extra=matches[3];break}}while(matches);for(extra&&parseChunks(extra,selectors),selector=[],i=0;i<parts.length;i++)">"!=parts[i]&&selector.push(compile(parts[i],[],">"===parts[i-1]));return selectors.push(selector),selectors}var match=this.match;this._selectors=parseChunks(selector,[])},match:function(control,selectors){var i,l,si,sl,selector,fi,fl,filters,index,length,siblings,count,item;for(i=0,l=(selectors=selectors||this._selectors).length;i<l;i++){for(item=control,count=0,si=(sl=(selector=selectors[i]).length)-1;si>=0;si--)for(filters=selector[si];item;){if(filters.pseudo)for(index=length=(siblings=item.parent().items()).length;index--&&siblings[index]!==item;);for(fi=0,fl=filters.length;fi<fl;fi++)if(!filters[fi](item,index,length)){fi=fl+1;break}if(fi===fl){count++;break}if(si===sl-1)break;item=item.parent()}if(count===sl)return!0}return!1},find:function(container){function collect(items,selector,index){var i,l,fi,fl,item,filters=selector[index];for(i=0,l=items.length;i<l;i++){for(item=items[i],fi=0,fl=filters.length;fi<fl;fi++)if(!filters[fi](item,i,l)){fi=fl+1;break}if(fi===fl)index==selector.length-1?matches.push(item):item.items&&collect(item.items(),selector,index+1);else if(filters.direct)return;item.items&&collect(item.items(),selector,index)}}var i,l,matches=[],selectors=this._selectors;if(container.items){for(i=0,l=selectors.length;i<l;i++)collect(container.items(),selectors[i],0);l>1&&(matches=unique(matches))}return Collection||(Collection=Selector.Collection),new Collection(matches)}});return Selector}),define("tinymce.core.ui.Collection",["tinymce.core.util.Tools","tinymce.core.ui.Selector","tinymce.core.util.Class"],function(Tools,Selector,Class){"use strict";var Collection,proto,push=Array.prototype.push,slice=Array.prototype.slice;return proto={length:0,init:function(items){items&&this.add(items)},add:function(items){var self=this;return Tools.isArray(items)?push.apply(self,items):items instanceof Collection?self.add(items.toArray()):push.call(self,items),self},set:function(items){var i,self=this,len=self.length;for(self.length=0,self.add(items),i=self.length;i<len;i++)delete self[i];return self},filter:function(selector){var i,l,item,match,self=this,matches=[];for("string"==typeof selector?(selector=new Selector(selector),match=function(item){return selector.match(item)}):match=selector,i=0,l=self.length;i<l;i++)match(item=self[i])&&matches.push(item);return new Collection(matches)},slice:function(){return new Collection(slice.apply(this,arguments))},eq:function(index){return-1===index?this.slice(index):this.slice(index,+index+1)},each:function(callback){return Tools.each(this,callback),this},toArray:function(){return Tools.toArray(this)},indexOf:function(ctrl){for(var self=this,i=self.length;i--&&self[i]!==ctrl;);return i},reverse:function(){return new Collection(Tools.toArray(this).reverse())},hasClass:function(cls){return!!this[0]&&this[0].classes.contains(cls)},prop:function(name,value){var item,self=this;return void 0!==value?(self.each(function(item){item[name]&&item[name](value)}),self):(item=self[0])&&item[name]?item[name]():void 0},exec:function(name){var self=this,args=Tools.toArray(arguments).slice(1);return self.each(function(item){item[name]&&item[name].apply(item,args)}),self},remove:function(){for(var i=this.length;i--;)this[i].remove();return this},addClass:function(cls){return this.each(function(item){item.classes.add(cls)})},removeClass:function(cls){return this.each(function(item){item.classes.remove(cls)})}},Tools.each("fire on off show hide append prepend before after reflow".split(" "),function(name){proto[name]=function(){var args=Tools.toArray(arguments);return this.each(function(ctrl){name in ctrl&&ctrl[name].apply(ctrl,args)}),this}}),Tools.each("text name disabled active selected checked visible parent value data".split(" "),function(name){proto[name]=function(value){return this.prop(name,value)}}),Collection=Class.extend(proto),Selector.Collection=Collection,Collection}),define("tinymce.core.ui.DomUtils",["tinymce.core.Env","tinymce.core.util.Tools","tinymce.core.dom.DOMUtils"],function(Env,Tools,DOMUtils){"use strict";var count=0,funcs={id:function(){return"mceu_"+count++},create:function(name,attrs,children){var elm=document.createElement(name);return DOMUtils.DOM.setAttribs(elm,attrs),"string"==typeof children?elm.innerHTML=children:Tools.each(children,function(child){child.nodeType&&elm.appendChild(child)}),elm},createFragment:function(html){return DOMUtils.DOM.createFragment(html)},getWindowSize:function(){return DOMUtils.DOM.getViewPort()},getSize:function(elm){var width,height;if(elm.getBoundingClientRect){var rect=elm.getBoundingClientRect();width=Math.max(rect.width||rect.right-rect.left,elm.offsetWidth),height=Math.max(rect.height||rect.bottom-rect.bottom,elm.offsetHeight)}else width=elm.offsetWidth,height=elm.offsetHeight;return{width:width,height:height}},getPos:function(elm,root){return DOMUtils.DOM.getPos(elm,root||funcs.getContainer())},getContainer:function(){return Env.container?Env.container:document.body},getViewPort:function(win){return DOMUtils.DOM.getViewPort(win)},get:function(id){return document.getElementById(id)},addClass:function(elm,cls){return DOMUtils.DOM.addClass(elm,cls)},removeClass:function(elm,cls){return DOMUtils.DOM.removeClass(elm,cls)},hasClass:function(elm,cls){return DOMUtils.DOM.hasClass(elm,cls)},toggleClass:function(elm,cls,state){return DOMUtils.DOM.toggleClass(elm,cls,state)},css:function(elm,name,value){return DOMUtils.DOM.setStyle(elm,name,value)},getRuntimeStyle:function(elm,name){return DOMUtils.DOM.getStyle(elm,name,!0)},on:function(target,name,callback,scope){return DOMUtils.DOM.bind(target,name,callback,scope)},off:function(target,name,callback){return DOMUtils.DOM.unbind(target,name,callback)},fire:function(target,name,args){return DOMUtils.DOM.fire(target,name,args)},innerHtml:function(elm,html){DOMUtils.DOM.setHTML(elm,html)}};return funcs}),define("tinymce.core.ui.BoxUtils",[],function(){"use strict";return{parseBox:function(value){var len;if(value)return"number"==typeof value?(value=value||0,{top:value,left:value,bottom:value,right:value}):(value=value.split(" "),1===(len=value.length)?value[1]=value[2]=value[3]=value[0]:2===len?(value[2]=value[0],value[3]=value[1]):3===len&&(value[3]=value[1]),{top:parseInt(value[0],10)||0,right:parseInt(value[1],10)||0,bottom:parseInt(value[2],10)||0,left:parseInt(value[3],10)||0})},measureBox:function(elm,prefix){function getStyle(name){var defaultView=document.defaultView;return defaultView?(name=name.replace(/[A-Z]/g,function(a){return"-"+a}),defaultView.getComputedStyle(elm,null).getPropertyValue(name)):elm.currentStyle[name]}function getSide(name){var val=parseFloat(getStyle(name),10);return isNaN(val)?0:val}return{top:getSide(prefix+"TopWidth"),right:getSide(prefix+"RightWidth"),bottom:getSide(prefix+"BottomWidth"),left:getSide(prefix+"LeftWidth")}}}}),define("tinymce.core.ui.ClassList",["tinymce.core.util.Tools"],function(Tools){"use strict";function noop(){}function ClassList(onchange){this.cls=[],this.cls._map={},this.onchange=onchange||noop,this.prefix=""}return Tools.extend(ClassList.prototype,{add:function(cls){return cls&&!this.contains(cls)&&(this.cls._map[cls]=!0,this.cls.push(cls),this._change()),this},remove:function(cls){if(this.contains(cls)){for(var i=0;i<this.cls.length&&this.cls[i]!==cls;i++);this.cls.splice(i,1),delete this.cls._map[cls],this._change()}return this},toggle:function(cls,state){var curState=this.contains(cls);return curState!==state&&(curState?this.remove(cls):this.add(cls),this._change()),this},contains:function(cls){return!!this.cls._map[cls]},_change:function(){delete this.clsValue,this.onchange.call(this)}}),ClassList.prototype.toString=function(){var value;if(this.clsValue)return this.clsValue;value="";for(var i=0;i<this.cls.length;i++)i>0&&(value+=" "),value+=this.prefix+this.cls[i];return value},ClassList}),define("tinymce.core.ui.ReflowQueue",["tinymce.core.util.Delay"],function(Delay){var animationFrameRequested,dirtyCtrls={};return{add:function(ctrl){var parent=ctrl.parent();if(parent){if(!parent._layout||parent._layout.isNative())return;dirtyCtrls[parent._id]||(dirtyCtrls[parent._id]=parent),animationFrameRequested||(animationFrameRequested=!0,Delay.requestAnimationFrame(function(){var id,ctrl;animationFrameRequested=!1;for(id in dirtyCtrls)(ctrl=dirtyCtrls[id]).state.get("rendered")&&ctrl.reflow();dirtyCtrls={}},document.body))}},remove:function(ctrl){dirtyCtrls[ctrl._id]&&delete dirtyCtrls[ctrl._id]}}}),define("tinymce.core.ui.Control",["tinymce.core.util.Class","tinymce.core.util.Tools","tinymce.core.util.EventDispatcher","tinymce.core.data.ObservableObject","tinymce.core.ui.Collection","tinymce.core.ui.DomUtils","tinymce.core.dom.DomQuery","tinymce.core.ui.BoxUtils","tinymce.core.ui.ClassList","tinymce.core.ui.ReflowQueue"],function(Class,Tools,EventDispatcher,ObservableObject,Collection,DomUtils,$,BoxUtils,ClassList,ReflowQueue){"use strict";function getEventDispatcher(obj){return obj._eventDispatcher||(obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function(name,state){state&&EventDispatcher.isNative(name)&&(obj._nativeEvents||(obj._nativeEvents={}),obj._nativeEvents[name]=!0,obj.state.get("rendered")&&bindPendingEvents(obj))}})),obj._eventDispatcher}function bindPendingEvents(eventCtrl){function fixWheelEvent(e){e.preventDefault(),"mousewheel"==e.type?(e.deltaY=-.025*e.wheelDelta,e.wheelDeltaX&&(e.deltaX=-.025*e.wheelDeltaX)):(e.deltaX=0,e.deltaY=e.detail),e=eventCtrl.fire("wheel",e)}var i,l,parents,eventRootCtrl,nativeEvents,name;if(nativeEvents=eventCtrl._nativeEvents){for((parents=eventCtrl.parents().toArray()).unshift(eventCtrl),i=0,l=parents.length;!eventRootCtrl&&i<l;i++)eventRootCtrl=parents[i]._eventsRoot;for(eventRootCtrl||(eventRootCtrl=parents[parents.length-1]||eventCtrl),eventCtrl._eventsRoot=eventRootCtrl,l=i,i=0;i<l;i++)parents[i]._eventsRoot=eventRootCtrl;var eventRootDelegates=eventRootCtrl._delegates;eventRootDelegates||(eventRootDelegates=eventRootCtrl._delegates={});for(name in nativeEvents){if(!nativeEvents)return!1;"wheel"!==name||hasWheelEventSupport?("mouseenter"===name||"mouseleave"===name?eventRootCtrl._hasMouseEnter||($(eventRootCtrl.getEl()).on("mouseleave",function(){var ctrl=eventRootCtrl._lastHoverCtrl;ctrl&&(ctrl.fire("mouseleave",{target:ctrl.getEl()}),ctrl.parents().each(function(ctrl){ctrl.fire("mouseleave",{target:ctrl.getEl()})}),eventRootCtrl._lastHoverCtrl=null)}).on("mouseover",function(e){var i,parents,lastParents,ctrl=eventCtrl.getParentCtrl(e.target),lastCtrl=eventRootCtrl._lastHoverCtrl,idx=0;if(ctrl!==lastCtrl){if(eventRootCtrl._lastHoverCtrl=ctrl,(parents=ctrl.parents().toArray().reverse()).push(ctrl),lastCtrl){for((lastParents=lastCtrl.parents().toArray().reverse()).push(lastCtrl),idx=0;idx<lastParents.length&&parents[idx]===lastParents[idx];idx++);for(i=lastParents.length-1;i>=idx;i--)(lastCtrl=lastParents[i]).fire("mouseleave",{target:lastCtrl.getEl()})}for(i=idx;i<parents.length;i++)(ctrl=parents[i]).fire("mouseenter",{target:ctrl.getEl()})}}),eventRootCtrl._hasMouseEnter=1):eventRootDelegates[name]||($(eventRootCtrl.getEl()).on(name,function(e){var control=eventCtrl.getParentCtrl(e.target);control&&control.fire(e.type,e)}),eventRootDelegates[name]=!0),nativeEvents[name]=!1):hasMouseWheelEventSupport?$(eventCtrl.getEl()).on("mousewheel",fixWheelEvent):$(eventCtrl.getEl()).on("DOMMouseScroll",fixWheelEvent)}}}var Control,hasMouseWheelEventSupport="onmousewheel"in document,hasWheelEventSupport=!1,idCounter=0,proto={Statics:{classPrefix:"mce-"},isRtl:function(){return Control.rtl},classPrefix:"mce-",init:function(settings){function applyClasses(classes){var i;for(classes=classes.split(" "),i=0;i<classes.length;i++)self.classes.add(classes[i])}var classes,defaultClasses,self=this;self.settings=settings=Tools.extend({},self.Defaults,settings),self._id=settings.id||"mceu_"+idCounter++,self._aria={role:settings.role},self._elmCache={},self.$=$,self.state=new ObservableObject({visible:!0,active:!1,disabled:!1,value:""}),self.data=new ObservableObject(settings.data),self.classes=new ClassList(function(){self.state.get("rendered")&&(self.getEl().className=this.toString())}),self.classes.prefix=self.classPrefix,(classes=settings.classes)&&(self.Defaults&&(defaultClasses=self.Defaults.classes)&&classes!=defaultClasses&&applyClasses(defaultClasses),applyClasses(classes)),Tools.each("title text name visible disabled active value".split(" "),function(name){name in settings&&self[name](settings[name])}),self.on("click",function(){if(self.disabled())return!1}),self.settings=settings,self.borderBox=BoxUtils.parseBox(settings.border),self.paddingBox=BoxUtils.parseBox(settings.padding),self.marginBox=BoxUtils.parseBox(settings.margin),settings.hidden&&self.hide()},Properties:"parent,name",getContainerElm:function(){return DomUtils.getContainer()},getParentCtrl:function(elm){for(var ctrl,lookup=this.getRoot().controlIdLookup;elm&&lookup&&!(ctrl=lookup[elm.id]);)elm=elm.parentNode;return ctrl},initLayoutRect:function(){var borderBox,layoutRect,width,height,minWidth,minHeight,autoResize,startMinWidth,startMinHeight,initialSize,self=this,settings=self.settings,elm=self.getEl();borderBox=self.borderBox=self.borderBox||BoxUtils.measureBox(elm,"border"),self.paddingBox=self.paddingBox||BoxUtils.measureBox(elm,"padding"),self.marginBox=self.marginBox||BoxUtils.measureBox(elm,"margin"),initialSize=DomUtils.getSize(elm),startMinWidth=settings.minWidth,startMinHeight=settings.minHeight,minWidth=startMinWidth||initialSize.width,minHeight=startMinHeight||initialSize.height,width=settings.width,height=settings.height,autoResize=void 0!==(autoResize=settings.autoResize)?autoResize:!width&&!height,width=width||minWidth,height=height||minHeight;var deltaW=borderBox.left+borderBox.right,deltaH=borderBox.top+borderBox.bottom,maxW=settings.maxWidth||65535,maxH=settings.maxHeight||65535;return self._layoutRect=layoutRect={x:settings.x||0,y:settings.y||0,w:width,h:height,deltaW:deltaW,deltaH:deltaH,contentW:width-deltaW,contentH:height-deltaH,innerW:width-deltaW,innerH:height-deltaH,startMinWidth:startMinWidth||0,startMinHeight:startMinHeight||0,minW:Math.min(minWidth,maxW),minH:Math.min(minHeight,maxH),maxW:maxW,maxH:maxH,autoResize:autoResize,scrollW:0},self._lastLayoutRect={},layoutRect},layoutRect:function(newRect){var lastLayoutRect,size,deltaWidth,deltaHeight,repaintControls,self=this,curRect=self._layoutRect;return curRect||(curRect=self.initLayoutRect()),newRect?(deltaWidth=curRect.deltaW,deltaHeight=curRect.deltaH,void 0!==newRect.x&&(curRect.x=newRect.x),void 0!==newRect.y&&(curRect.y=newRect.y),void 0!==newRect.minW&&(curRect.minW=newRect.minW),void 0!==newRect.minH&&(curRect.minH=newRect.minH),void 0!==(size=newRect.w)&&(size=(size=size<curRect.minW?curRect.minW:size)>curRect.maxW?curRect.maxW:size,curRect.w=size,curRect.innerW=size-deltaWidth),void 0!==(size=newRect.h)&&(size=(size=size<curRect.minH?curRect.minH:size)>curRect.maxH?curRect.maxH:size,curRect.h=size,curRect.innerH=size-deltaHeight),void 0!==(size=newRect.innerW)&&(size=(size=size<curRect.minW-deltaWidth?curRect.minW-deltaWidth:size)>curRect.maxW-deltaWidth?curRect.maxW-deltaWidth:size,curRect.innerW=size,curRect.w=size+deltaWidth),void 0!==(size=newRect.innerH)&&(size=(size=size<curRect.minH-deltaHeight?curRect.minH-deltaHeight:size)>curRect.maxH-deltaHeight?curRect.maxH-deltaHeight:size,curRect.innerH=size,curRect.h=size+deltaHeight),void 0!==newRect.contentW&&(curRect.contentW=newRect.contentW),void 0!==newRect.contentH&&(curRect.contentH=newRect.contentH),(lastLayoutRect=self._lastLayoutRect).x===curRect.x&&lastLayoutRect.y===curRect.y&&lastLayoutRect.w===curRect.w&&lastLayoutRect.h===curRect.h||((repaintControls=Control.repaintControls)&&repaintControls.map&&!repaintControls.map[self._id]&&(repaintControls.push(self),repaintControls.map[self._id]=!0),lastLayoutRect.x=curRect.x,lastLayoutRect.y=curRect.y,lastLayoutRect.w=curRect.w,lastLayoutRect.h=curRect.h),self):curRect},repaint:function(){var style,bodyStyle,bodyElm,rect,borderBox,borderW,borderH,lastRepaintRect,round,value,self=this;round=document.createRange?function(value){return value}:Math.round,style=self.getEl().style,rect=self._layoutRect,lastRepaintRect=self._lastRepaintRect||{},borderW=(borderBox=self.borderBox).left+borderBox.right,borderH=borderBox.top+borderBox.bottom,rect.x!==lastRepaintRect.x&&(style.left=round(rect.x)+"px",lastRepaintRect.x=rect.x),rect.y!==lastRepaintRect.y&&(style.top=round(rect.y)+"px",lastRepaintRect.y=rect.y),rect.w!==lastRepaintRect.w&&(value=round(rect.w-borderW),style.width=(value>=0?value:0)+"px",lastRepaintRect.w=rect.w),rect.h!==lastRepaintRect.h&&(value=round(rect.h-borderH),style.height=(value>=0?value:0)+"px",lastRepaintRect.h=rect.h),self._hasBody&&rect.innerW!==lastRepaintRect.innerW&&(value=round(rect.innerW),(bodyElm=self.getEl("body"))&&((bodyStyle=bodyElm.style).width=(value>=0?value:0)+"px"),lastRepaintRect.innerW=rect.innerW),self._hasBody&&rect.innerH!==lastRepaintRect.innerH&&(value=round(rect.innerH),(bodyElm=bodyElm||self.getEl("body"))&&((bodyStyle=bodyStyle||bodyElm.style).height=(value>=0?value:0)+"px"),lastRepaintRect.innerH=rect.innerH),self._lastRepaintRect=lastRepaintRect,self.fire("repaint",{},!1)},updateLayoutRect:function(){var self=this;self.parent()._lastRect=null,DomUtils.css(self.getEl(),{width:"",height:""}),self._layoutRect=self._lastRepaintRect=self._lastLayoutRect=null,self.initLayoutRect()},on:function(name,callback){var self=this;return getEventDispatcher(self).on(name,function(name){var callback,scope;return"string"!=typeof name?name:function(e){return callback||self.parentsAndSelf().each(function(ctrl){var callbacks=ctrl.settings.callbacks;if(callbacks&&(callback=callbacks[name]))return scope=ctrl,!1}),callback?callback.call(scope,e):(e.action=name,void this.fire("execute",e))}}(callback)),self},off:function(name,callback){return getEventDispatcher(this).off(name,callback),this},fire:function(name,args,bubble){var self=this;if((args=args||{}).control||(args.control=self),args=getEventDispatcher(self).fire(name,args),!1!==bubble&&self.parent)for(var parent=self.parent();parent&&!args.isPropagationStopped();)parent.fire(name,args,!1),parent=parent.parent();return args},hasEventListeners:function(name){return getEventDispatcher(this).has(name)},parents:function(selector){var ctrl,self=this,parents=new Collection;for(ctrl=self.parent();ctrl;ctrl=ctrl.parent())parents.add(ctrl);return selector&&(parents=parents.filter(selector)),parents},parentsAndSelf:function(selector){return new Collection(this).add(this.parents(selector))},next:function(){var parentControls=this.parent().items();return parentControls[parentControls.indexOf(this)+1]},prev:function(){var parentControls=this.parent().items();return parentControls[parentControls.indexOf(this)-1]},innerHtml:function(html){return this.$el.html(html),this},getEl:function(suffix){var id=suffix?this._id+"-"+suffix:this._id;return this._elmCache[id]||(this._elmCache[id]=$("#"+id)[0]),this._elmCache[id]},show:function(){return this.visible(!0)},hide:function(){return this.visible(!1)},focus:function(){try{this.getEl().focus()}catch(ex){}return this},blur:function(){return this.getEl().blur(),this},aria:function(name,value){var self=this,elm=self.getEl(self.ariaTarget);return void 0===value?self._aria[name]:(self._aria[name]=value,self.state.get("rendered")&&elm.setAttribute("role"==name?name:"aria-"+name,value),self)},encode:function(text,translate){return!1!==translate&&(text=this.translate(text)),(text||"").replace(/[&<>"]/g,function(match){return"&#"+match.charCodeAt(0)+";"})},translate:function(text){return Control.translate?Control.translate(text):text},before:function(items){var self=this,parent=self.parent();return parent&&parent.insert(items,parent.items().indexOf(self),!0),self},after:function(items){var self=this,parent=self.parent();return parent&&parent.insert(items,parent.items().indexOf(self)),self},remove:function(){var newItems,i,self=this,elm=self.getEl(),parent=self.parent();if(self.items){var controls=self.items().toArray();for(i=controls.length;i--;)controls[i].remove()}parent&&parent.items&&(newItems=[],parent.items().each(function(item){item!==self&&newItems.push(item)}),parent.items().set(newItems),parent._lastRect=null),self._eventsRoot&&self._eventsRoot==self&&$(elm).off();var lookup=self.getRoot().controlIdLookup;return lookup&&delete lookup[self._id],elm&&elm.parentNode&&elm.parentNode.removeChild(elm),self.state.set("rendered",!1),self.state.destroy(),self.fire("remove"),self},renderBefore:function(elm){return $(elm).before(this.renderHtml()),this.postRender(),this},renderTo:function(elm){return $(elm||this.getContainerElm()).append(this.renderHtml()),this.postRender(),this},preRender:function(){},render:function(){},renderHtml:function(){return'<div id="'+this._id+'" class="'+this.classes+'"></div>'},postRender:function(){var elm,box,parent,name,parentEventsRoot,self=this,settings=self.settings;self.$el=$(self.getEl()),self.state.set("rendered",!0);for(name in settings)0===name.indexOf("on")&&self.on(name.substr(2),settings[name]);if(self._eventsRoot){for(parent=self.parent();!parentEventsRoot&&parent;parent=parent.parent())parentEventsRoot=parent._eventsRoot;if(parentEventsRoot)for(name in parentEventsRoot._nativeEvents)self._nativeEvents[name]=!0}bindPendingEvents(self),settings.style&&(elm=self.getEl())&&(elm.setAttribute("style",settings.style),elm.style.cssText=settings.style),self.settings.border&&(box=self.borderBox,self.$el.css({"border-top-width":box.top,"border-right-width":box.right,"border-bottom-width":box.bottom,"border-left-width":box.left}));var root=self.getRoot();root.controlIdLookup||(root.controlIdLookup={}),root.controlIdLookup[self._id]=self;for(var key in self._aria)self.aria(key,self._aria[key]);!1===self.state.get("visible")&&(self.getEl().style.display="none"),self.bindStates(),self.state.on("change:visible",function(e){var parentCtrl,state=e.value;self.state.get("rendered")&&(self.getEl().style.display=!1===state?"none":"",self.getEl().getBoundingClientRect()),(parentCtrl=self.parent())&&(parentCtrl._lastRect=null),self.fire(state?"show":"hide"),ReflowQueue.add(self)}),self.fire("postrender",{},!1)},bindStates:function(){},scrollIntoView:function(align){var x,y,width,height,parentWidth,parentHeight,elm=this.getEl(),parentElm=elm.parentNode,pos=function(elm,rootElm){var x,y,parent=elm;for(x=y=0;parent&&parent!=rootElm&&parent.nodeType;)x+=parent.offsetLeft||0,y+=parent.offsetTop||0,parent=parent.offsetParent;return{x:x,y:y}}(elm,parentElm);return x=pos.x,y=pos.y,width=elm.offsetWidth,height=elm.offsetHeight,parentWidth=parentElm.clientWidth,parentHeight=parentElm.clientHeight,"end"==align?(x-=parentWidth-width,y-=parentHeight-height):"center"==align&&(x-=parentWidth/2-width/2,y-=parentHeight/2-height/2),parentElm.scrollLeft=x,parentElm.scrollTop=y,this},getRoot:function(){for(var rootControl,ctrl=this,parents=[];ctrl;){if(ctrl.rootControl){rootControl=ctrl.rootControl;break}parents.push(ctrl),rootControl=ctrl,ctrl=ctrl.parent()}rootControl||(rootControl=this);for(var i=parents.length;i--;)parents[i].rootControl=rootControl;return rootControl},reflow:function(){ReflowQueue.remove(this);var parent=this.parent();return parent&&parent._layout&&!parent._layout.isNative()&&parent.reflow(),this}};return Tools.each("text title visible disabled active value".split(" "),function(name){proto[name]=function(value){return 0===arguments.length?this.state.get(name):(void 0!==value&&this.state.set(name,value),this)}}),Control=Class.extend(proto)}),define("tinymce.core.ui.Factory",[],function(){"use strict";var types={};return{add:function(type,typeClass){types[type.toLowerCase()]=typeClass},has:function(type){return!!types[type.toLowerCase()]},create:function(type,settings){var ControlType;if("string"==typeof type?(settings=settings||{}).type=type:type=(settings=type).type,type=type.toLowerCase(),!(ControlType=types[type]))throw new Error("Could not find control by type: "+type);return ControlType=new ControlType(settings),ControlType.type=type,ControlType}}}),define("tinymce.core.ui.KeyboardNavigation",[],function(){"use strict";var hasTabstopData=function(elm){return!!elm.getAttribute("data-mce-tabstop")};return function(settings){function isElement(node){return node&&1===node.nodeType}function getRole(elm){return elm=elm||focusedElement,isElement(elm)?elm.getAttribute("role"):null}function getParentRole(elm){for(var role,parent=elm||focusedElement;parent=parent.parentNode;)if(role=getRole(parent))return role}function getAriaProp(name){var elm=focusedElement;if(isElement(elm))return elm.getAttribute("aria-"+name)}function isTextInputElement(elm){var tagName=elm.tagName.toUpperCase();return"INPUT"==tagName||"TEXTAREA"==tagName||"SELECT"==tagName}function canFocus(elm){return!(!isTextInputElement(elm)||elm.hidden)||(!!hasTabstopData(elm)||!!/^(button|menuitem|checkbox|tab|menuitemcheckbox|option|gridcell|slider)$/.test(getRole(elm)))}function getFocusElements(elm){function collect(elm){if(1==elm.nodeType&&"none"!=elm.style.display&&!elm.disabled){canFocus(elm)&&elements.push(elm);for(var i=0;i<elm.childNodes.length;i++)collect(elm.childNodes[i])}}var elements=[];return collect(elm||root.getEl()),elements}function getNavigationRoot(targetControl){var navigationRoot,controls;(controls=(targetControl=targetControl||focusedControl).parents().toArray()).unshift(targetControl);for(var i=0;i<controls.length&&!(navigationRoot=controls[i]).settings.ariaRoot;i++);return navigationRoot}function moveFocusToIndex(idx,elements){return idx<0?idx=elements.length-1:idx>=elements.length&&(idx=0),elements[idx]&&elements[idx].focus(),idx}function moveFocus(dir,elements){var idx=-1,navigationRoot=getNavigationRoot();elements=elements||getFocusElements(navigationRoot.getEl());for(var i=0;i<elements.length;i++)elements[i]===focusedElement&&(idx=i);idx+=dir,navigationRoot.lastAriaIndex=moveFocusToIndex(idx,elements)}function left(){"tablist"==getParentRole()?moveFocus(-1,getFocusElements(focusedElement.parentNode)):focusedControl.parent().submenu?cancel():moveFocus(-1)}function right(){var role=getRole(),parentRole=getParentRole();"tablist"==parentRole?moveFocus(1,getFocusElements(focusedElement.parentNode)):"menuitem"==role&&"menu"==parentRole&&getAriaProp("haspopup")?enter():moveFocus(1)}function up(){moveFocus(-1)}function down(){var role=getRole(),parentRole=getParentRole();"menuitem"==role&&"menubar"==parentRole?enter():"button"==role&&getAriaProp("haspopup")?enter({key:"down"}):moveFocus(1)}function tab(e){if("tablist"==getParentRole()){var elm=getFocusElements(focusedControl.getEl("body"))[0];elm&&elm.focus()}else moveFocus(e.shiftKey?-1:1)}function cancel(){focusedControl.fire("cancel")}function enter(aria){aria=aria||{},focusedControl.fire("click",{target:focusedElement,aria:aria})}var focusedElement,focusedControl,root=settings.root;try{focusedElement=document.activeElement}catch(ex){focusedElement=document.body}return focusedControl=root.getParentCtrl(focusedElement),root.on("keydown",function(e){function handleNonTabOrEscEvent(e,handler){isTextInputElement(focusedElement)||hasTabstopData(focusedElement)||"slider"!==getRole(focusedElement)&&!1!==handler(e)&&e.preventDefault()}if(!e.isDefaultPrevented())switch(e.keyCode){case 37:handleNonTabOrEscEvent(e,left);break;case 39:handleNonTabOrEscEvent(e,right);break;case 38:handleNonTabOrEscEvent(e,up);break;case 40:handleNonTabOrEscEvent(e,down);break;case 27:cancel();break;case 14:case 13:case 32:handleNonTabOrEscEvent(e,enter);break;case 9:!1!==tab(e)&&e.preventDefault()}}),root.on("focusin",function(e){focusedElement=e.target,focusedControl=e.control}),{focusFirst:function(targetControl){var navigationRoot=getNavigationRoot(targetControl),focusElements=getFocusElements(navigationRoot.getEl());navigationRoot.settings.ariaRemember&&"lastAriaIndex"in navigationRoot?moveFocusToIndex(navigationRoot.lastAriaIndex,focusElements):moveFocusToIndex(0,focusElements)}}}}),define("tinymce.core.ui.Container",["tinymce.core.ui.Control","tinymce.core.ui.Collection","tinymce.core.ui.Selector","tinymce.core.ui.Factory","tinymce.core.ui.KeyboardNavigation","tinymce.core.util.Tools","tinymce.core.dom.DomQuery","tinymce.core.ui.ClassList","tinymce.core.ui.ReflowQueue"],function(Control,Collection,Selector,Factory,KeyboardNavigation,Tools,$,ClassList,ReflowQueue){"use strict";var selectorCache={};return Control.extend({init:function(settings){var self=this;self._super(settings),(settings=self.settings).fixed&&self.state.set("fixed",!0),self._items=new Collection,self.isRtl()&&self.classes.add("rtl"),self.bodyClasses=new ClassList(function(){self.state.get("rendered")&&(self.getEl("body").className=this.toString())}),self.bodyClasses.prefix=self.classPrefix,self.classes.add("container"),self.bodyClasses.add("container-body"),settings.containerCls&&self.classes.add(settings.containerCls),self._layout=Factory.create((settings.layout||"")+"layout"),self.settings.items?self.add(self.settings.items):self.add(self.render()),self._hasBody=!0},items:function(){return this._items},find:function(selector){return(selector=selectorCache[selector]=selectorCache[selector]||new Selector(selector)).find(this)},add:function(items){var self=this;return self.items().add(self.create(items)).parent(self),self},focus:function(keyboard){var focusCtrl,keyboardNav,items,self=this;if(!keyboard||!(keyboardNav=self.keyboardNav||self.parents().eq(-1)[0].keyboardNav))return items=self.find("*"),self.statusbar&&items.add(self.statusbar.items()),items.each(function(ctrl){if(ctrl.settings.autofocus)return focusCtrl=null,!1;ctrl.canFocus&&(focusCtrl=focusCtrl||ctrl)}),focusCtrl&&focusCtrl.focus(),self;keyboardNav.focusFirst(self)},replace:function(oldItem,newItem){for(var ctrlElm,items=this.items(),i=items.length;i--;)if(items[i]===oldItem){items[i]=newItem;break}i>=0&&((ctrlElm=newItem.getEl())&&ctrlElm.parentNode.removeChild(ctrlElm),(ctrlElm=oldItem.getEl())&&ctrlElm.parentNode.removeChild(ctrlElm)),newItem.parent(this)},create:function(items){var settings,self=this,ctrlItems=[];return Tools.isArray(items)||(items=[items]),Tools.each(items,function(item){item&&(item instanceof Control||("string"==typeof item&&(item={type:item}),settings=Tools.extend({},self.settings.defaults,item),item.type=settings.type=settings.type||item.type||self.settings.defaultType||(settings.defaults?settings.defaults.type:null),item=Factory.create(settings)),ctrlItems.push(item))}),ctrlItems},renderNew:function(){var self=this;return self.items().each(function(ctrl,index){var containerElm;ctrl.parent(self),ctrl.state.get("rendered")||((containerElm=self.getEl("body")).hasChildNodes()&&index<=containerElm.childNodes.length-1?$(containerElm.childNodes[index]).before(ctrl.renderHtml()):$(containerElm).append(ctrl.renderHtml()),ctrl.postRender(),ReflowQueue.add(ctrl))}),self._layout.applyClasses(self.items().filter(":visible")),self._lastRect=null,self},append:function(items){return this.add(items).renderNew()},prepend:function(items){var self=this;return self.items().set(self.create(items).concat(self.items().toArray())),self.renderNew()},insert:function(items,index,before){var curItems,beforeItems,afterItems,self=this;return items=self.create(items),curItems=self.items(),!before&&index<curItems.length-1&&(index+=1),index>=0&&index<curItems.length&&(beforeItems=curItems.slice(0,index).toArray(),afterItems=curItems.slice(index).toArray(),curItems.set(beforeItems.concat(items,afterItems))),self.renderNew()},fromJSON:function(data){var self=this;for(var name in data)self.find("#"+name).value(data[name]);return self},toJSON:function(){var data={};return this.find("*").each(function(ctrl){var name=ctrl.name(),value=ctrl.value();name&&void 0!==value&&(data[name]=value)}),data},renderHtml:function(){var self=this,layout=self._layout,role=this.settings.role;return self.preRender(),layout.preRender(self),'<div id="'+self._id+'" class="'+self.classes+'"'+(role?' role="'+this.settings.role+'"':"")+'><div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+(self.settings.html||"")+layout.renderHtml(self)+"</div></div>"},postRender:function(){var box,self=this;return self.items().exec("postRender"),self._super(),self._layout.postRender(self),self.state.set("rendered",!0),self.settings.style&&self.$el.css(self.settings.style),self.settings.border&&(box=self.borderBox,self.$el.css({"border-top-width":box.top,"border-right-width":box.right,"border-bottom-width":box.bottom,"border-left-width":box.left})),self.parent()||(self.keyboardNav=new KeyboardNavigation({root:self})),self},initLayoutRect:function(){var self=this,layoutRect=self._super();return self._layout.recalc(self),layoutRect},recalc:function(){var self=this,rect=self._layoutRect,lastRect=self._lastRect;if(!lastRect||lastRect.w!=rect.w||lastRect.h!=rect.h)return self._layout.recalc(self),rect=self.layoutRect(),self._lastRect={x:rect.x,y:rect.y,w:rect.w,h:rect.h},!0},reflow:function(){var i;if(ReflowQueue.remove(this),this.visible()){for(Control.repaintControls=[],Control.repaintControls.map={},this.recalc(),i=Control.repaintControls.length;i--;)Control.repaintControls[i].repaint();"flow"!==this.settings.layout&&"stack"!==this.settings.layout&&this.repaint(),Control.repaintControls=[]}return this}})}),define("tinymce.core.ui.DragHelper",["tinymce.core.dom.DomQuery"],function($){"use strict";function getDocumentSize(doc){var documentElement,body,scrollWidth,clientWidth,offsetWidth,scrollHeight,clientHeight,offsetHeight,max=Math.max;return documentElement=doc.documentElement,body=doc.body,scrollWidth=max(documentElement.scrollWidth,body.scrollWidth),clientWidth=max(documentElement.clientWidth,body.clientWidth),offsetWidth=max(documentElement.offsetWidth,body.offsetWidth),scrollHeight=max(documentElement.scrollHeight,body.scrollHeight),clientHeight=max(documentElement.clientHeight,body.clientHeight),offsetHeight=max(documentElement.offsetHeight,body.offsetHeight),{width:scrollWidth<offsetWidth?clientWidth:scrollWidth,height:scrollHeight<offsetHeight?clientHeight:scrollHeight}}function updateWithTouchData(e){var keys,i;if(e.changedTouches)for(keys="screenX screenY pageX pageY clientX clientY".split(" "),i=0;i<keys.length;i++)e[keys[i]]=e.changedTouches[0][keys[i]]}return function(id,settings){function getHandleElm(){return doc.getElementById(settings.handle||id)}var $eventOverlay,downButton,start,stop,drag,startX,startY,doc=settings.document||document;settings=settings||{},start=function(e){var handleElm,cursor,docSize=getDocumentSize(doc);updateWithTouchData(e),e.preventDefault(),downButton=e.button,handleElm=getHandleElm(),startX=e.screenX,startY=e.screenY,cursor=window.getComputedStyle?window.getComputedStyle(handleElm,null).getPropertyValue("cursor"):handleElm.runtimeStyle.cursor,$eventOverlay=$("<div></div>").css({position:"absolute",top:0,left:0,width:docSize.width,height:docSize.height,zIndex:2147483647,opacity:1e-4,cursor:cursor}).appendTo(doc.body),$(doc).on("mousemove touchmove",drag).on("mouseup touchend",stop),settings.start(e)},drag=function(e){if(updateWithTouchData(e),e.button!==downButton)return stop(e);e.deltaX=e.screenX-startX,e.deltaY=e.screenY-startY,e.preventDefault(),settings.drag(e)},stop=function(e){updateWithTouchData(e),$(doc).off("mousemove touchmove",drag).off("mouseup touchend",stop),$eventOverlay.remove(),settings.stop&&settings.stop(e)},this.destroy=function(){$(getHandleElm()).off()},$(getHandleElm()).on("mousedown touchstart",start)}}),define("tinymce.core.ui.Scrollable",["tinymce.core.dom.DomQuery","tinymce.core.ui.DragHelper"],function($,DragHelper){"use strict";return{init:function(){var self=this;self.on("repaint",self.renderScroll)},renderScroll:function(){function repaintScroll(){function repaintAxis(axisName,posName,sizeName,contentSizeName,hasScroll,ax){var containerElm,scrollBarElm,scrollThumbElm,containerSize,ratio,rect,posNameLower,sizeNameLower;if(scrollBarElm=self.getEl("scroll"+axisName)){if(posNameLower=posName.toLowerCase(),sizeNameLower=sizeName.toLowerCase(),$(self.getEl("absend")).css(posNameLower,self.layoutRect()[contentSizeName]-1),!hasScroll)return void $(scrollBarElm).css("display","none");$(scrollBarElm).css("display","block"),containerElm=self.getEl("body"),scrollThumbElm=self.getEl("scroll"+axisName+"t"),containerSize=containerElm["client"+sizeName]-2*margin,ratio=(containerSize-=hasScrollH&&hasScrollV?scrollBarElm["client"+ax]:0)/containerElm["scroll"+sizeName],(rect={})[posNameLower]=containerElm["offset"+posName]+margin,rect[sizeNameLower]=containerSize,$(scrollBarElm).css(rect),(rect={})[posNameLower]=containerElm["scroll"+posName]*ratio,rect[sizeNameLower]=containerSize*ratio,$(scrollThumbElm).css(rect)}}var hasScrollH,hasScrollV,bodyElm;bodyElm=self.getEl("body"),hasScrollH=bodyElm.scrollWidth>bodyElm.clientWidth,hasScrollV=bodyElm.scrollHeight>bodyElm.clientHeight,repaintAxis("h","Left","Width","contentW",hasScrollH,"Height"),repaintAxis("v","Top","Height","contentH",hasScrollV,"Width")}var self=this,margin=2;self.settings.autoScroll&&(self._hasScroll||(self._hasScroll=!0,function(){function addScrollAxis(axisName,posName,sizeName,deltaPosName,ax){var scrollStart,axisId=self._id+"-scroll"+axisName,prefix=self.classPrefix;$(self.getEl()).append('<div id="'+axisId+'" class="'+prefix+"scrollbar "+prefix+"scrollbar-"+axisName+'"><div id="'+axisId+'t" class="'+prefix+'scrollbar-thumb"></div></div>'),self.draghelper=new DragHelper(axisId+"t",{start:function(){scrollStart=self.getEl("body")["scroll"+posName],$("#"+axisId).addClass(prefix+"active")},drag:function(e){var ratio,hasScrollH,hasScrollV,containerSize,layoutRect=self.layoutRect();hasScrollH=layoutRect.contentW>layoutRect.innerW,hasScrollV=layoutRect.contentH>layoutRect.innerH,containerSize=self.getEl("body")["client"+sizeName]-2*margin,ratio=(containerSize-=hasScrollH&&hasScrollV?self.getEl("scroll"+axisName)["client"+ax]:0)/self.getEl("body")["scroll"+sizeName],self.getEl("body")["scroll"+posName]=scrollStart+e["delta"+deltaPosName]/ratio},stop:function(){$("#"+axisId).removeClass(prefix+"active")}})}self.classes.add("scroll"),addScrollAxis("v","Top","Height","Y","Width"),addScrollAxis("h","Left","Width","X","Height")}(),self.on("wheel",function(e){var bodyEl=self.getEl("body");bodyEl.scrollLeft+=10*(e.deltaX||0),bodyEl.scrollTop+=10*e.deltaY,repaintScroll()}),$(self.getEl("body")).on("scroll",repaintScroll)),repaintScroll())}}}),define("tinymce.core.ui.Panel",["tinymce.core.ui.Container","tinymce.core.ui.Scrollable"],function(Container,Scrollable){"use strict";return Container.extend({Defaults:{layout:"fit",containerCls:"panel"},Mixins:[Scrollable],renderHtml:function(){var self=this,layout=self._layout,innerHtml=self.settings.html;return self.preRender(),layout.preRender(self),void 0===innerHtml?innerHtml='<div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+layout.renderHtml(self)+"</div>":("function"==typeof innerHtml&&(innerHtml=innerHtml.call(self)),self._hasBody=!1),'<div id="'+self._id+'" class="'+self.classes+'" hidefocus="1" tabindex="-1" role="group">'+(self._preBodyHtml||"")+innerHtml+"</div>"}})}),define("tinymce.core.ui.Movable",["tinymce.core.ui.DomUtils"],function(DomUtils){"use strict";function calculateRelativePosition(ctrl,targetElm,rel){var ctrlElm,pos,x,y,selfW,selfH,targetW,targetH,viewport,size;return viewport=DomUtils.getViewPort(),pos=DomUtils.getPos(targetElm),x=pos.x,y=pos.y,ctrl.state.get("fixed")&&"static"==DomUtils.getRuntimeStyle(document.body,"position")&&(x-=viewport.x,y-=viewport.y),ctrlElm=ctrl.getEl(),size=DomUtils.getSize(ctrlElm),selfW=size.width,selfH=size.height,size=DomUtils.getSize(targetElm),targetW=size.width,targetH=size.height,"b"===(rel=(rel||"").split(""))[0]&&(y+=targetH),"r"===rel[1]&&(x+=targetW),"c"===rel[0]&&(y+=Math.round(targetH/2)),"c"===rel[1]&&(x+=Math.round(targetW/2)),"b"===rel[3]&&(y-=selfH),"r"===rel[4]&&(x-=selfW),"c"===rel[3]&&(y-=Math.round(selfH/2)),"c"===rel[4]&&(x-=Math.round(selfW/2)),{x:x,y:y,w:selfW,h:selfH}}return{testMoveRel:function(elm,rels){for(var viewPortRect=DomUtils.getViewPort(),i=0;i<rels.length;i++){var pos=calculateRelativePosition(this,elm,rels[i]);if(this.state.get("fixed")){if(pos.x>0&&pos.x+pos.w<viewPortRect.w&&pos.y>0&&pos.y+pos.h<viewPortRect.h)return rels[i]}else if(pos.x>viewPortRect.x&&pos.x+pos.w<viewPortRect.w+viewPortRect.x&&pos.y>viewPortRect.y&&pos.y+pos.h<viewPortRect.h+viewPortRect.y)return rels[i]}return rels[0]},moveRel:function(elm,rel){"string"!=typeof rel&&(rel=this.testMoveRel(elm,rel));var pos=calculateRelativePosition(this,elm,rel);return this.moveTo(pos.x,pos.y)},moveBy:function(dx,dy){var self=this,rect=self.layoutRect();return self.moveTo(rect.x+dx,rect.y+dy),self},moveTo:function(x,y){function constrain(value,max,size){return value<0?0:value+size>max&&(value=max-size)<0?0:value}var self=this;if(self.settings.constrainToViewport){var viewPortRect=DomUtils.getViewPort(window),layoutRect=self.layoutRect();x=constrain(x,viewPortRect.w+viewPortRect.x,layoutRect.w),y=constrain(y,viewPortRect.h+viewPortRect.y,layoutRect.h)}return self.state.get("rendered")?self.layoutRect({x:x,y:y}).repaint():(self.settings.x=x,self.settings.y=y),self.fire("move",{x:x,y:y}),self}}}),define("tinymce.core.ui.Resizable",["tinymce.core.ui.DomUtils"],function(DomUtils){"use strict";return{resizeToContent:function(){this._layoutRect.autoResize=!0,this._lastRect=null,this.reflow()},resizeTo:function(w,h){if(w<=1||h<=1){var rect=DomUtils.getWindowSize();w=w<=1?w*rect.w:w,h=h<=1?h*rect.h:h}return this._layoutRect.autoResize=!1,this.layoutRect({minW:w,minH:h,w:w,h:h}).reflow()},resizeBy:function(dw,dh){var self=this,rect=self.layoutRect();return self.resizeTo(rect.w+dw,rect.h+dh)}}}),define("tinymce.core.ui.FloatPanel",["tinymce.core.ui.Panel","tinymce.core.ui.Movable","tinymce.core.ui.Resizable","tinymce.core.ui.DomUtils","tinymce.core.dom.DomQuery","tinymce.core.util.Delay"],function(Panel,Movable,Resizable,DomUtils,$,Delay){"use strict";function isChildOf(ctrl,parent){for(;ctrl;){if(ctrl==parent)return!0;ctrl=ctrl.parent()}}function skipOrHidePanels(e){for(var i=visiblePanels.length;i--;){var panel=visiblePanels[i],clickCtrl=panel.getParentCtrl(e.target);if(panel.settings.autohide){if(clickCtrl&&(isChildOf(clickCtrl,panel)||panel.parent()===clickCtrl))continue;(e=panel.fire("autohide",{target:e.target})).isDefaultPrevented()||panel.hide()}}}function bindDocumentClickHandler(){documentClickHandler||(documentClickHandler=function(e){2!=e.button&&skipOrHidePanels(e)},$(document).on("click touchstart",documentClickHandler))}function bindDocumentScrollHandler(){documentScrollHandler||(documentScrollHandler=function(){var i;for(i=visiblePanels.length;i--;)repositionPanel(visiblePanels[i])},$(window).on("scroll",documentScrollHandler))}function bindWindowResizeHandler(){if(!windowResizeHandler){var docElm=document.documentElement,clientWidth=docElm.clientWidth,clientHeight=docElm.clientHeight;windowResizeHandler=function(){document.all&&clientWidth==docElm.clientWidth&&clientHeight==docElm.clientHeight||(clientWidth=docElm.clientWidth,clientHeight=docElm.clientHeight,FloatPanel.hideAll())},$(window).on("resize",windowResizeHandler)}}function repositionPanel(panel){function toggleFixedChildPanels(fixed,deltaY){for(var parent,i=0;i<visiblePanels.length;i++)if(visiblePanels[i]!=panel)for(parent=visiblePanels[i].parent();parent&&(parent=parent.parent());)parent==panel&&visiblePanels[i].fixed(fixed).moveBy(0,deltaY).repaint()}var scrollY=DomUtils.getViewPort().y;panel.settings.autofix&&(panel.state.get("fixed")?panel._autoFixY>scrollY&&(panel.fixed(!1).layoutRect({y:panel._autoFixY}).repaint(),toggleFixedChildPanels(!1,panel._autoFixY-scrollY)):(panel._autoFixY=panel.layoutRect().y,panel._autoFixY<scrollY&&(panel.fixed(!0).layoutRect({y:0}).repaint(),toggleFixedChildPanels(!0,scrollY-panel._autoFixY))))}function addRemove(add,ctrl){var i,topModal,zIndex=FloatPanel.zIndex||65535;if(add)zOrder.push(ctrl);else for(i=zOrder.length;i--;)zOrder[i]===ctrl&&zOrder.splice(i,1);if(zOrder.length)for(i=0;i<zOrder.length;i++)zOrder[i].modal&&(zIndex++,topModal=zOrder[i]),zOrder[i].getEl().style.zIndex=zIndex,zOrder[i].zIndex=zIndex,zIndex++;var modalBlockEl=$("#"+ctrl.classPrefix+"modal-block",ctrl.getContainerElm())[0];topModal?$(modalBlockEl).css("z-index",topModal.zIndex-1):modalBlockEl&&(modalBlockEl.parentNode.removeChild(modalBlockEl),hasModal=!1),FloatPanel.currentZIndex=zIndex}function removeVisiblePanel(panel){var i;for(i=visiblePanels.length;i--;)visiblePanels[i]===panel&&visiblePanels.splice(i,1);for(i=zOrder.length;i--;)zOrder[i]===panel&&zOrder.splice(i,1)}var documentClickHandler,documentScrollHandler,windowResizeHandler,hasModal,visiblePanels=[],zOrder=[],FloatPanel=Panel.extend({Mixins:[Movable,Resizable],init:function(settings){var self=this;self._super(settings),self._eventsRoot=self,self.classes.add("floatpanel"),settings.autohide&&(bindDocumentClickHandler(),bindWindowResizeHandler(),visiblePanels.push(self)),settings.autofix&&(bindDocumentScrollHandler(),self.on("move",function(){repositionPanel(this)})),self.on("postrender show",function(e){if(e.control==self){var $modalBlockEl,prefix=self.classPrefix;self.modal&&!hasModal&&(($modalBlockEl=$("#"+prefix+"modal-block",self.getContainerElm()))[0]||($modalBlockEl=$('<div id="'+prefix+'modal-block" class="'+prefix+"reset "+prefix+'fade"></div>').appendTo(self.getContainerElm())),Delay.setTimeout(function(){$modalBlockEl.addClass(prefix+"in"),$(self.getEl()).addClass(prefix+"in")}),hasModal=!0),addRemove(!0,self)}}),self.on("show",function(){self.parents().each(function(ctrl){if(ctrl.state.get("fixed"))return self.fixed(!0),!1})}),settings.popover&&(self._preBodyHtml='<div class="'+self.classPrefix+'arrow"></div>',self.classes.add("popover").add("bottom").add(self.isRtl()?"end":"start")),self.aria("label",settings.ariaLabel),self.aria("labelledby",self._id),self.aria("describedby",self.describedBy||self._id+"-none")},fixed:function(state){var self=this;if(self.state.get("fixed")!=state){if(self.state.get("rendered")){var viewport=DomUtils.getViewPort();state?self.layoutRect().y-=viewport.y:self.layoutRect().y+=viewport.y}self.classes.toggle("fixed",state),self.state.set("fixed",state)}return self},show:function(){var i,self=this,state=self._super();for(i=visiblePanels.length;i--&&visiblePanels[i]!==self;);return-1===i&&visiblePanels.push(self),state},hide:function(){return removeVisiblePanel(this),addRemove(!1,this),this._super()},hideAll:function(){FloatPanel.hideAll()},close:function(){var self=this;return self.fire("close").isDefaultPrevented()||(self.remove(),addRemove(!1,self)),self},remove:function(){removeVisiblePanel(this),this._super()},postRender:function(){var self=this;return self.settings.bodyRole&&this.getEl("body").setAttribute("role",self.settings.bodyRole),self._super()}});return FloatPanel.hideAll=function(){for(var i=visiblePanels.length;i--;){var panel=visiblePanels[i];panel&&panel.settings.autohide&&(panel.hide(),visiblePanels.splice(i,1))}},FloatPanel}),define("tinymce.core.ui.Window",["tinymce.core.ui.FloatPanel","tinymce.core.ui.Panel","tinymce.core.ui.DomUtils","tinymce.core.dom.DomQuery","tinymce.core.ui.DragHelper","tinymce.core.ui.BoxUtils","tinymce.core.Env","tinymce.core.util.Delay"],function(FloatPanel,Panel,DomUtils,$,DragHelper,BoxUtils,Env,Delay){"use strict";function toggleFullScreenState(state){var contentValue,viewport=$("meta[name=viewport]")[0];!1!==Env.overrideViewPort&&(viewport||((viewport=document.createElement("meta")).setAttribute("name","viewport"),document.getElementsByTagName("head")[0].appendChild(viewport)),(contentValue=viewport.getAttribute("content"))&&void 0!==oldMetaValue&&(oldMetaValue=contentValue),viewport.setAttribute("content",state?"width=device-width,initial-scale=1.0,user-scalable=0,minimum-scale=1.0,maximum-scale=1.0":oldMetaValue))}function toggleBodyFullScreenClasses(classPrefix,state){checkFullscreenWindows()&&!1===state&&$([document.documentElement,document.body]).removeClass(classPrefix+"fullscreen")}function checkFullscreenWindows(){for(var i=0;i<windows.length;i++)if(windows[i]._fullscreen)return!0;return!1}var windows=[],oldMetaValue="",Window=FloatPanel.extend({modal:!0,Defaults:{border:1,layout:"flex",containerCls:"panel",role:"dialog",callbacks:{submit:function(){this.fire("submit",{data:this.toJSON()})},close:function(){this.close()}}},init:function(settings){var self=this;self._super(settings),self.isRtl()&&self.classes.add("rtl"),self.classes.add("window"),self.bodyClasses.add("window-body"),self.state.set("fixed",!0),settings.buttons&&(self.statusbar=new Panel({layout:"flex",border:"1 0 0 0",spacing:3,padding:10,align:"center",pack:self.isRtl()?"start":"end",defaults:{type:"button"},items:settings.buttons}),self.statusbar.classes.add("foot"),self.statusbar.parent(self)),self.on("click",function(e){var closeClass=self.classPrefix+"close";(DomUtils.hasClass(e.target,closeClass)||DomUtils.hasClass(e.target.parentNode,closeClass))&&self.close()}),self.on("cancel",function(){self.close()}),self.aria("describedby",self.describedBy||self._id+"-none"),self.aria("label",settings.title),self._fullscreen=!1},recalc:function(){var layoutRect,width,x,needsRecalc,self=this,statusbar=self.statusbar;self._fullscreen&&(self.layoutRect(DomUtils.getWindowSize()),self.layoutRect().contentH=self.layoutRect().innerH),self._super(),layoutRect=self.layoutRect(),self.settings.title&&!self._fullscreen&&(width=layoutRect.headerW)>layoutRect.w&&(x=layoutRect.x-Math.max(0,width/2),self.layoutRect({w:width,x:x}),needsRecalc=!0),statusbar&&(statusbar.layoutRect({w:self.layoutRect().innerW}).recalc(),(width=statusbar.layoutRect().minW+layoutRect.deltaW)>layoutRect.w&&(x=layoutRect.x-Math.max(0,width-layoutRect.w),self.layoutRect({w:width,x:x}),needsRecalc=!0)),needsRecalc&&self.recalc()},initLayoutRect:function(){var headEl,self=this,layoutRect=self._super(),deltaH=0;if(self.settings.title&&!self._fullscreen){headEl=self.getEl("head");var size=DomUtils.getSize(headEl);layoutRect.headerW=size.width,layoutRect.headerH=size.height,deltaH+=layoutRect.headerH}self.statusbar&&(deltaH+=self.statusbar.layoutRect().h),layoutRect.deltaH+=deltaH,layoutRect.minH+=deltaH,layoutRect.h+=deltaH;var rect=DomUtils.getWindowSize();return layoutRect.x=self.settings.x||Math.max(0,rect.w/2-layoutRect.w/2),layoutRect.y=self.settings.y||Math.max(0,rect.h/2-layoutRect.h/2),layoutRect},renderHtml:function(){var self=this,layout=self._layout,id=self._id,prefix=self.classPrefix,settings=self.settings,headerHtml="",footerHtml="",html=settings.html;return self.preRender(),layout.preRender(self),settings.title&&(headerHtml='<div id="'+id+'-head" class="'+prefix+'window-head"><div id="'+id+'-title" class="'+prefix+'title">'+self.encode(settings.title)+'</div><div id="'+id+'-dragh" class="'+prefix+'dragh"></div><button type="button" class="'+prefix+'close" aria-hidden="true"><i class="mce-ico mce-i-remove"></i></button></div>'),settings.url&&(html='<iframe src="'+settings.url+'" tabindex="-1"></iframe>'),void 0===html&&(html=layout.renderHtml(self)),self.statusbar&&(footerHtml=self.statusbar.renderHtml()),'<div id="'+id+'" class="'+self.classes+'" hidefocus="1"><div class="'+self.classPrefix+'reset" role="application">'+headerHtml+'<div id="'+id+'-body" class="'+self.bodyClasses+'">'+html+"</div>"+footerHtml+"</div></div>"},fullscreen:function(state){var slowRendering,layoutRect,self=this,documentElement=document.documentElement,prefix=self.classPrefix;if(state!=self._fullscreen)if($(window).on("resize",function(){var time;if(self._fullscreen)if(slowRendering)self._timer||(self._timer=Delay.setTimeout(function(){var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h),self._timer=0},50));else{time=(new Date).getTime();var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h),(new Date).getTime()-time>50&&(slowRendering=!0)}}),layoutRect=self.layoutRect(),self._fullscreen=state,state){self._initial={x:layoutRect.x,y:layoutRect.y,w:layoutRect.w,h:layoutRect.h},self.borderBox=BoxUtils.parseBox("0"),self.getEl("head").style.display="none",layoutRect.deltaH-=layoutRect.headerH+2,$([documentElement,document.body]).addClass(prefix+"fullscreen"),self.classes.add("fullscreen");var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h)}else self.borderBox=BoxUtils.parseBox(self.settings.border),self.getEl("head").style.display="",layoutRect.deltaH+=layoutRect.headerH,$([documentElement,document.body]).removeClass(prefix+"fullscreen"),self.classes.remove("fullscreen"),self.moveTo(self._initial.x,self._initial.y).resizeTo(self._initial.w,self._initial.h);return self.reflow()},postRender:function(){var startPos,self=this;setTimeout(function(){self.classes.add("in"),self.fire("open")},0),self._super(),self.statusbar&&self.statusbar.postRender(),self.focus(),this.dragHelper=new DragHelper(self._id+"-dragh",{start:function(){startPos={x:self.layoutRect().x,y:self.layoutRect().y}},drag:function(e){self.moveTo(startPos.x+e.deltaX,startPos.y+e.deltaY)}}),self.on("submit",function(e){e.isDefaultPrevented()||self.close()}),windows.push(self),toggleFullScreenState(!0)},submit:function(){return this.fire("submit",{data:this.toJSON()})},remove:function(){var i,self=this;for(self.dragHelper.destroy(),self._super(),self.statusbar&&this.statusbar.remove(),toggleBodyFullScreenClasses(self.classPrefix,!1),i=windows.length;i--;)windows[i]===self&&windows.splice(i,1);toggleFullScreenState(windows.length>0)},getContentWindow:function(){var ifr=this.getEl().getElementsByTagName("iframe")[0];return ifr?ifr.contentWindow:null}});return function(){if(!Env.desktop){var lastSize={w:window.innerWidth,h:window.innerHeight};Delay.setInterval(function(){var w=window.innerWidth,h=window.innerHeight;lastSize.w==w&&lastSize.h==h||(lastSize={w:w,h:h},$(window).trigger("resize"))},100)}$(window).on("resize",function(){var i,layoutRect,rect=DomUtils.getWindowSize();for(i=0;i<windows.length;i++)layoutRect=windows[i].layoutRect(),windows[i].moveTo(windows[i].settings.x||Math.max(0,rect.w/2-layoutRect.w/2),windows[i].settings.y||Math.max(0,rect.h/2-layoutRect.h/2))})}(),Window}),define("tinymce.core.ui.MessageBox",["tinymce.core.ui.Window"],function(Window){"use strict";var MessageBox=Window.extend({init:function(settings){settings={border:1,padding:20,layout:"flex",pack:"center",align:"center",containerCls:"panel",autoScroll:!0,buttons:{type:"button",text:"Ok",action:"ok"},items:{type:"label",multiline:!0,maxWidth:500,maxHeight:200}},this._super(settings)},Statics:{OK:1,OK_CANCEL:2,YES_NO:3,YES_NO_CANCEL:4,msgBox:function(settings){function createButton(text,status,primary){return{type:"button",text:text,subtype:primary?"primary":"",onClick:function(e){e.control.parents()[1].close(),callback(status)}}}var buttons,callback=settings.callback||function(){};switch(settings.buttons){case MessageBox.OK_CANCEL:buttons=[createButton("Ok",!0,!0),createButton("Cancel",!1)];break;case MessageBox.YES_NO:case MessageBox.YES_NO_CANCEL:buttons=[createButton("Yes",1,!0),createButton("No",0)],settings.buttons==MessageBox.YES_NO_CANCEL&&buttons.push(createButton("Cancel",-1));break;default:buttons=[createButton("Ok",!0,!0)]}return new Window({padding:20,x:settings.x,y:settings.y,minWidth:300,minHeight:100,layout:"flex",pack:"center",align:"center",buttons:buttons,title:settings.title,role:"alertdialog",items:{type:"label",multiline:!0,maxWidth:500,maxHeight:200,text:settings.text},onPostRender:function(){this.aria("describedby",this.items()[0]._id)},onClose:settings.onClose,onCancel:function(){callback(!1)}}).renderTo(document.body).reflow()},alert:function(settings,callback){return"string"==typeof settings&&(settings={text:settings}),settings.callback=callback,MessageBox.msgBox(settings)},confirm:function(settings,callback){return"string"==typeof settings&&(settings={text:settings}),settings.callback=callback,settings.buttons=MessageBox.OK_CANCEL,MessageBox.msgBox(settings)}}});return MessageBox}),define("tinymce.core.WindowManager",["tinymce.core.ui.Window","tinymce.core.ui.MessageBox"],function(Window,MessageBox){return function(editor){function getTopMostWindow(){if(windows.length)return windows[windows.length-1]}function fireOpenEvent(win){editor.fire("OpenWindow",{win:win})}function fireCloseEvent(win){editor.fire("CloseWindow",{win:win})}var self=this,windows=[];self.windows=windows,editor.on("remove",function(){for(var i=windows.length;i--;)windows[i].close()}),self.open=function(args,params){var win;return editor.editorManager.setActive(editor),args.title=args.title||" ",args.url=args.url||args.file,args.url&&(args.width=parseInt(args.width||320,10),args.height=parseInt(args.height||240,10)),args.body&&(args.items={defaults:args.defaults,type:args.bodyType||"form",items:args.body,data:args.data,callbacks:args.commands}),args.url||args.buttons||(args.buttons=[{text:"Ok",subtype:"primary",onclick:function(){win.find("form")[0].submit()}},{text:"Cancel",onclick:function(){win.close()}}]),win=new Window(args),windows.push(win),win.on("close",function(){for(var i=windows.length;i--;)windows[i]===win&&windows.splice(i,1);windows.length||editor.focus(),fireCloseEvent(win)}),args.data&&win.on("postRender",function(){this.find("*").each(function(ctrl){var name=ctrl.name();name in args.data&&ctrl.value(args.data[name])})}),win.features=args||{},win.params=params||{},1===windows.length&&editor.nodeChanged(),win=win.renderTo().reflow(),fireOpenEvent(win),win},self.alert=function(message,callback,scope){var win;(win=MessageBox.alert(message,function(){callback?callback.call(scope||this):editor.focus()})).on("close",function(){fireCloseEvent(win)}),fireOpenEvent(win)},self.confirm=function(message,callback,scope){var win;(win=MessageBox.confirm(message,function(state){callback.call(scope||this,state)})).on("close",function(){fireCloseEvent(win)}),fireOpenEvent(win)},self.close=function(){getTopMostWindow()&&getTopMostWindow().close()},self.getParams=function(){return getTopMostWindow()?getTopMostWindow().params:null},self.setParams=function(params){getTopMostWindow()&&(getTopMostWindow().params=params)},self.getWindows=function(){return windows}}}),define("ephox.sugar.impl.Style",[],function(){return{isSupported:function(dom){return void 0!==dom.style}}}),defineGlobal("global!window",window),define("ephox.sugar.api.properties.Css",["ephox.katamari.api.Type","ephox.katamari.api.Arr","ephox.katamari.api.Obj","ephox.katamari.api.Option","ephox.sugar.api.properties.Attr","ephox.sugar.api.node.Body","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.impl.Style","ephox.katamari.api.Strings","global!Error","global!console","global!window"],function(Type,Arr,Obj,Option,Attr,Body,Element,Node,Style,Strings,Error,console,window){var internalSet=function(dom,property,value){if(!Type.isString(value))throw console.error("Invalid call to CSS.set. Property ",property,":: Value ",value,":: Element ",dom),new Error("CSS value must be a string: "+value);Style.isSupported(dom)&&dom.style.setProperty(property,value)},internalRemove=function(dom,property){Style.isSupported(dom)&&dom.style.removeProperty(property)},set=function(element,property,value){var dom=element.dom();internalSet(dom,property,value)},getUnsafeProperty=function(dom,property){return Style.isSupported(dom)?dom.style.getPropertyValue(property):""},getRaw=function(element,property){var dom=element.dom(),raw=getUnsafeProperty(dom,property);return Option.from(raw).filter(function(r){return r.length>0})},transferOne=function(source,destination,style){getRaw(source,style).each(function(value){getRaw(destination,style).isNone()&&set(destination,style,value)})};return{copy:function(source,target){var sourceDom=source.dom(),targetDom=target.dom();Style.isSupported(sourceDom)&&Style.isSupported(targetDom)&&(targetDom.style.cssText=sourceDom.style.cssText)},set:set,preserve:function(element,f){var oldStyles=Attr.get(element,"style"),result=f(element);return(void 0===oldStyles?Attr.remove:Attr.set)(element,"style",oldStyles),result},setAll:function(element,css){var dom=element.dom();Obj.each(css,function(v,k){internalSet(dom,k,v)})},setOptions:function(element,css){var dom=element.dom();Obj.each(css,function(v,k){v.fold(function(){internalRemove(dom,k)},function(value){internalSet(dom,k,value)})})},remove:function(element,property){var dom=element.dom();internalRemove(dom,property),Attr.has(element,"style")&&""===Strings.trim(Attr.get(element,"style"))&&Attr.remove(element,"style")},get:function(element,property){var dom=element.dom(),r=window.getComputedStyle(dom).getPropertyValue(property),v=""!==r||Body.inBody(element)?r:getUnsafeProperty(dom,property);return null===v?void 0:v},getRaw:getRaw,isValidValue:function(tag,property,value){var element=Element.fromTag(tag);return set(element,property,value),getRaw(element,property).isSome()},reflow:function(e){return e.dom().offsetWidth},transfer:function(source,destination,styles){Node.isElement(source)&&Node.isElement(destination)&&Arr.each(styles,function(style){transferOne(source,destination,style)})}}}),define("tinymce.core.EditorView",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.api.properties.Css","ephox.sugar.api.search.Traverse"],function(Fun,Option,Compare,Element,Css,Traverse){var getProp=function(propName,elm){return elm.dom()[propName]},getComputedSizeProp=function(propName,elm){return parseInt(Css.get(elm,propName),10)},getClientWidth=Fun.curry(getProp,"clientWidth"),getClientHeight=Fun.curry(getProp,"clientHeight"),getMarginTop=Fun.curry(getComputedSizeProp,"margin-top"),getMarginLeft=Fun.curry(getComputedSizeProp,"margin-left"),getBoundingClientRect=function(elm){return elm.dom().getBoundingClientRect()},isInsideElementContentArea=function(bodyElm,clientX,clientY){var clientWidth=getClientWidth(bodyElm),clientHeight=getClientHeight(bodyElm);return clientX>=0&&clientY>=0&&clientX<=clientWidth&&clientY<=clientHeight},transpose=function(inline,elm,clientX,clientY){var clientRect=getBoundingClientRect(elm);return{x:clientX-(inline?clientRect.left+elm.dom().clientLeft+getMarginLeft(elm):0),y:clientY-(inline?clientRect.top+elm.dom().clientTop+getMarginTop(elm):0)}},fromDomSafe=function(node){return Option.from(node).map(Element.fromDom)};return{isXYInContentArea:function(editor,clientX,clientY){var bodyElm=Element.fromDom(editor.getBody()),targetElm=editor.inline?bodyElm:Traverse.documentElement(bodyElm),transposedPoint=transpose(editor.inline,targetElm,clientX,clientY);return isInsideElementContentArea(targetElm,transposedPoint.x,transposedPoint.y)},isEditorAttachedToDom:function(editor){var rawContainer=editor.inline?editor.getBody():editor.getContentAreaContainer();return fromDomSafe(rawContainer).map(function(container){return Compare.contains(Traverse.owner(container),container)}).getOr(!1)}}}),define("tinymce.core.ui.Tooltip",["tinymce.core.ui.Control","tinymce.core.ui.Movable"],function(Control,Movable){return Control.extend({Mixins:[Movable],Defaults:{classes:"widget tooltip tooltip-n"},renderHtml:function(){var self=this,prefix=self.classPrefix;return'<div id="'+self._id+'" class="'+self.classes+'" role="presentation"><div class="'+prefix+'tooltip-arrow"></div><div class="'+prefix+'tooltip-inner">'+self.encode(self.state.get("text"))+"</div></div>"},bindStates:function(){var self=this;return self.state.on("change:text",function(e){self.getEl().lastChild.innerHTML=self.encode(e.value)}),self._super()},repaint:function(){var style,rect,self=this;style=self.getEl().style,rect=self._layoutRect,style.left=rect.x+"px",style.top=rect.y+"px",style.zIndex=131070}})}),define("tinymce.core.ui.Widget",["tinymce.core.ui.Control","tinymce.core.ui.Tooltip"],function(Control,Tooltip){"use strict";var tooltip,Widget=Control.extend({init:function(settings){var self=this;self._super(settings),settings=self.settings,self.canFocus=!0,settings.tooltip&&!1!==Widget.tooltips&&(self.on("mouseenter",function(e){var tooltip=self.tooltip().moveTo(-65535);if(e.control==self){var rel=tooltip.text(settings.tooltip).show().testMoveRel(self.getEl(),["bc-tc","bc-tl","bc-tr"]);tooltip.classes.toggle("tooltip-n","bc-tc"==rel),tooltip.classes.toggle("tooltip-nw","bc-tl"==rel),tooltip.classes.toggle("tooltip-ne","bc-tr"==rel),tooltip.moveRel(self.getEl(),rel)}else tooltip.hide()}),self.on("mouseleave mousedown click",function(){self.tooltip().hide()})),self.aria("label",settings.ariaLabel||settings.tooltip)},tooltip:function(){return tooltip||(tooltip=new Tooltip({type:"tooltip"})).renderTo(),tooltip},postRender:function(){var self=this,settings=self.settings;self._super(),self.parent()||!settings.width&&!settings.height||(self.initLayoutRect(),self.repaint()),settings.autofocus&&self.focus()},bindStates:function(){function disable(state){self.aria("disabled",state),self.classes.toggle("disabled",state)}function active(state){self.aria("pressed",state),self.classes.toggle("active",state)}var self=this;return self.state.on("change:disabled",function(e){disable(e.value)}),self.state.on("change:active",function(e){active(e.value)}),self.state.get("disabled")&&disable(!0),self.state.get("active")&&active(!0),self._super()},remove:function(){this._super(),tooltip&&(tooltip.remove(),tooltip=null)}});return Widget}),define("tinymce.core.ui.Progress",["tinymce.core.ui.Widget"],function(Widget){"use strict";return Widget.extend({Defaults:{value:0},init:function(settings){var self=this;self._super(settings),self.classes.add("progress"),self.settings.filter||(self.settings.filter=function(value){return Math.round(value)})},renderHtml:function(){var self=this,id=self._id,prefix=this.classPrefix;return'<div id="'+id+'" class="'+self.classes+'"><div class="'+prefix+'bar-container"><div class="'+prefix+'bar"></div></div><div class="'+prefix+'text">0%</div></div>'},postRender:function(){var self=this;return self._super(),self.value(self.settings.value),self},bindStates:function(){function setValue(value){value=self.settings.filter(value),self.getEl().lastChild.innerHTML=value+"%",self.getEl().firstChild.firstChild.style.width=value+"%"}var self=this;return self.state.on("change:value",function(e){setValue(e.value)}),setValue(self.state.get("value")),self._super()}})}),define("tinymce.core.ui.Notification",["tinymce.core.ui.Control","tinymce.core.ui.Movable","tinymce.core.ui.Progress","tinymce.core.util.Delay"],function(Control,Movable,Progress,Delay){var updateLiveRegion=function(ctx,text){ctx.getEl().lastChild.textContent=text+(ctx.progressBar?" "+ctx.progressBar.value()+"%":"")};return Control.extend({Mixins:[Movable],Defaults:{classes:"widget notification"},init:function(settings){var self=this;self._super(settings),self.maxWidth=settings.maxWidth,settings.text&&self.text(settings.text),settings.icon&&(self.icon=settings.icon),settings.color&&(self.color=settings.color),settings.type&&self.classes.add("notification-"+settings.type),settings.timeout&&(settings.timeout<0||settings.timeout>0)&&!settings.closeButton?self.closeButton=!1:(self.classes.add("has-close"),self.closeButton=!0),settings.progressBar&&(self.progressBar=new Progress),self.on("click",function(e){-1!=e.target.className.indexOf(self.classPrefix+"close")&&self.close()})},renderHtml:function(){var self=this,prefix=self.classPrefix,icon="",closeButton="",progressBar="",notificationStyle="";return self.icon&&(icon='<i class="'+prefix+"ico "+prefix+"i-"+self.icon+'"></i>'),notificationStyle=' style="max-width: '+self.maxWidth+"px;"+(self.color?"background-color: "+self.color+';"':'"'),self.closeButton&&(closeButton='<button type="button" class="'+prefix+'close" aria-hidden="true"></button>'),self.progressBar&&(progressBar=self.progressBar.renderHtml()),'<div id="'+self._id+'" class="'+self.classes+'"'+notificationStyle+' role="presentation">'+icon+'<div class="'+prefix+'notification-inner">'+self.state.get("text")+"</div>"+progressBar+closeButton+'<div style="clip: rect(1px, 1px, 1px, 1px);height: 1px;overflow: hidden;position: absolute;width: 1px;" aria-live="assertive" aria-relevant="additions" aria-atomic="true"></div></div>'},postRender:function(){var self=this;return Delay.setTimeout(function(){self.$el.addClass(self.classPrefix+"in"),updateLiveRegion(self,self.state.get("text"))},100),self._super()},bindStates:function(){var self=this;return self.state.on("change:text",function(e){self.getEl().firstChild.innerHTML=e.value,updateLiveRegion(self,e.value)}),self.progressBar&&(self.progressBar.bindStates(),self.progressBar.state.on("change:value",function(e){updateLiveRegion(self,self.state.get("text"))})),self._super()},close:function(){var self=this;return self.fire("close").isDefaultPrevented()||self.remove(),self},repaint:function(){var style,rect,self=this;style=self.getEl().style,rect=self._layoutRect,style.left=rect.x+"px",style.top=rect.y+"px",style.zIndex=65534}})}),define("tinymce.core.NotificationManager",["tinymce.core.EditorView","tinymce.core.ui.DomUtils","tinymce.core.ui.Notification","tinymce.core.util.Delay","tinymce.core.util.Tools"],function(EditorView,DomUtils,Notification,Delay,Tools){return function(editor){function getLastNotification(){if(notifications.length)return notifications[notifications.length-1]}function getEditorContainer(editor){return editor.inline?editor.getElement():editor.getContentAreaContainer()}function prePositionNotifications(){for(var i=0;i<notifications.length;i++)notifications[i].moveTo(0,0)}function positionNotifications(){if(notifications.length>0){var firstItem=notifications.slice(0,1)[0],container=getEditorContainer(editor);if(firstItem.moveRel(container,"tc-tc"),notifications.length>1)for(var i=1;i<notifications.length;i++)notifications[i].moveRel(notifications[i-1].getEl(),"bc-tc")}}function findDuplicateMessage(notificationArray,newNotification){if(!isPlainTextNotification(newNotification))return null;var filteredNotifications=Tools.grep(notificationArray,function(notification){return isSameNotification(newNotification,notification)});return 0===filteredNotifications.length?null:filteredNotifications[0]}function isSameNotification(a,b){return a.type===b.settings.type&&a.text===b.settings.text}function isPlainTextNotification(notification){return!notification.progressBar&&!notification.timeout}var self=this,notifications=[],getContainerWidth=function(){var container=editor.inline?editor.getElement():editor.getContentAreaContainer();return DomUtils.getSize(container).width};self.notifications=notifications,editor.on("remove",function(){for(var i=notifications.length;i--;)notifications[i].close()}),editor.on("ResizeEditor",positionNotifications),editor.on("ResizeWindow",function(){Delay.requestAnimationFrame(function(){prePositionNotifications(),positionNotifications()})}),self.open=function(args){if(!editor.removed&&EditorView.isEditorAttachedToDom(editor)){var notif;editor.editorManager.setActive(editor);var duplicate=findDuplicateMessage(notifications,args);return null===duplicate?(args=Tools.extend(args,{maxWidth:getContainerWidth()}),notif=new Notification(args),notifications.push(notif),args.timeout>0&&(notif.timer=setTimeout(function(){notif.close()},args.timeout)),notif.on("close",function(){var i=notifications.length;for(notif.timer&&editor.getWin().clearTimeout(notif.timer);i--;)notifications[i]===notif&&notifications.splice(i,1);positionNotifications()}),notif.renderTo(),positionNotifications()):notif=duplicate,notif}},self.close=function(){getLastNotification()&&getLastNotification().close()},self.getNotifications=function(){return notifications},editor.on("SkinLoaded",function(){var serviceMessage=editor.settings.service_message;serviceMessage&&editor.notificationManager.open({text:serviceMessage,type:"warning",timeout:0,icon:""})})}}),define("tinymce.core.EditorObservable",["tinymce.core.util.Observable","tinymce.core.dom.DOMUtils","tinymce.core.util.Tools"],function(Observable,DOMUtils,Tools){function getEventTarget(editor,eventName){return"selectionchange"==eventName?editor.getDoc():!editor.inline&&/^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)?editor.getDoc().documentElement:editor.settings.event_root?(editor.eventRoot||(editor.eventRoot=DOM.select(editor.settings.event_root)[0]),editor.eventRoot):editor.getBody()}function bindEventDelegate(editor,eventName){function isListening(editor){return!editor.hidden&&!editor.readonly}var eventRootElm,delegate;if(editor.delegates||(editor.delegates={}),!editor.delegates[eventName]&&!editor.removed)if(eventRootElm=getEventTarget(editor,eventName),editor.settings.event_root){if(customEventRootDelegates||(customEventRootDelegates={},editor.editorManager.on("removeEditor",function(){var name;if(!editor.editorManager.activeEditor&&customEventRootDelegates){for(name in customEventRootDelegates)editor.dom.unbind(getEventTarget(editor,name));customEventRootDelegates=null}})),customEventRootDelegates[eventName])return;delegate=function(e){for(var target=e.target,editors=editor.editorManager.get(),i=editors.length;i--;){var body=editors[i].getBody();(body===target||DOM.isChildOf(target,body))&&isListening(editors[i])&&editors[i].fire(eventName,e)}},customEventRootDelegates[eventName]=delegate,DOM.bind(eventRootElm,eventName,delegate)}else delegate=function(e){isListening(editor)&&editor.fire(eventName,e)},DOM.bind(eventRootElm,eventName,delegate),editor.delegates[eventName]=delegate}var customEventRootDelegates,DOM=DOMUtils.DOM,EditorObservable={bindPendingEventDelegates:function(){var self=this;Tools.each(self._pendingNativeEvents,function(name){bindEventDelegate(self,name)})},toggleNativeEvent:function(name,state){var self=this;"focus"!=name&&"blur"!=name&&(state?self.initialized?bindEventDelegate(self,name):self._pendingNativeEvents?self._pendingNativeEvents.push(name):self._pendingNativeEvents=[name]:self.initialized&&(self.dom.unbind(getEventTarget(self,name),name,self.delegates[name]),delete self.delegates[name]))},unbindAllNativeEvents:function(){var name,self=this;if(self.delegates){for(name in self.delegates)self.dom.unbind(getEventTarget(self,name),name,self.delegates[name]);delete self.delegates}self.inline||(self.getBody().onload=null,self.dom.unbind(self.getWin()),self.dom.unbind(self.getDoc())),self.dom.unbind(self.getBody()),self.dom.unbind(self.getContainer())}};return EditorObservable=Tools.extend({},Observable,EditorObservable)}),define("tinymce.core.Shortcuts",["tinymce.core.util.Tools","tinymce.core.Env"],function(Tools,Env){var each=Tools.each,explode=Tools.explode,keyCodeLookup={f9:120,f10:121,f11:122},modifierNames=Tools.makeMap("alt,ctrl,shift,meta,access");return function(editor){function parseShortcut(pattern){var id,key,shortcut={};each(explode(pattern,"+"),function(value){value in modifierNames?shortcut[value]=!0:/^[0-9]{2,}$/.test(value)?shortcut.keyCode=parseInt(value,10):(shortcut.charCode=value.charCodeAt(0),shortcut.keyCode=keyCodeLookup[value]||value.toUpperCase().charCodeAt(0))}),id=[shortcut.keyCode];for(key in modifierNames)shortcut[key]?id.push(key):shortcut[key]=!1;return shortcut.id=id.join(","),shortcut.access&&(shortcut.alt=!0,Env.mac?shortcut.ctrl=!0:shortcut.shift=!0),shortcut.meta&&(Env.mac?shortcut.meta=!0:(shortcut.ctrl=!0,shortcut.meta=!1)),shortcut}function createShortcut(pattern,desc,cmdFunc,scope){var shortcuts;return shortcuts=Tools.map(explode(pattern,">"),parseShortcut),shortcuts[shortcuts.length-1]=Tools.extend(shortcuts[shortcuts.length-1],{func:cmdFunc,scope:scope||editor}),Tools.extend(shortcuts[0],{desc:editor.translate(desc),subpatterns:shortcuts.slice(1)})}function hasModifier(e){return e.altKey||e.ctrlKey||e.metaKey}function isFunctionKey(e){return"keydown"===e.type&&e.keyCode>=112&&e.keyCode<=123}function matchShortcut(e,shortcut){return!!shortcut&&(shortcut.ctrl==e.ctrlKey&&shortcut.meta==e.metaKey&&(shortcut.alt==e.altKey&&shortcut.shift==e.shiftKey&&(!!(e.keyCode==shortcut.keyCode||e.charCode&&e.charCode==shortcut.charCode)&&(e.preventDefault(),!0))))}function executeShortcutAction(shortcut){return shortcut.func?shortcut.func.call(shortcut.scope):null}var self=this,shortcuts={},pendingPatterns=[];editor.on("keyup keypress keydown",function(e){!hasModifier(e)&&!isFunctionKey(e)||e.isDefaultPrevented()||(each(shortcuts,function(shortcut){if(matchShortcut(e,shortcut))return pendingPatterns=shortcut.subpatterns.slice(0),"keydown"==e.type&&executeShortcutAction(shortcut),!0}),matchShortcut(e,pendingPatterns[0])&&(1===pendingPatterns.length&&"keydown"==e.type&&executeShortcutAction(pendingPatterns[0]),pendingPatterns.shift()))}),self.add=function(pattern,desc,cmdFunc,scope){var cmd;return cmd=cmdFunc,"string"==typeof cmdFunc?cmdFunc=function(){editor.execCommand(cmd,!1,null)}:Tools.isArray(cmd)&&(cmdFunc=function(){editor.execCommand(cmd[0],cmd[1],cmd[2])}),each(explode(Tools.trim(pattern.toLowerCase())),function(pattern){var shortcut=createShortcut(pattern,desc,cmdFunc,scope);shortcuts[shortcut.id]=shortcut}),!0},self.remove=function(pattern){var shortcut=createShortcut(pattern);return!!shortcuts[shortcut.id]&&(delete shortcuts[shortcut.id],!0)}}}),define("tinymce.core.ErrorReporter",["tinymce.core.AddOnManager"],function(AddOnManager){var PluginManager=AddOnManager.PluginManager,resolvePluginName=function(targetUrl,suffix){for(var name in PluginManager.urls)if(PluginManager.urls[name]+"/plugin"+suffix+".js"===targetUrl)return name;return null},pluginUrlToMessage=function(editor,url){var plugin=resolvePluginName(url,editor.suffix);return plugin?"Failed to load plugin: "+plugin+" from url "+url:"Failed to load plugin url: "+url},displayNotification=function(editor,message){editor.notificationManager.open({type:"error",text:message})},displayError=function(editor,message){editor._skinLoaded?displayNotification(editor,message):editor.on("SkinLoaded",function(){displayNotification(editor,message)})};return{pluginLoadError:function(editor,url){displayError(editor,pluginUrlToMessage(editor,url))},uploadError:function(editor,message){displayError(editor,"Failed to upload image: "+message)},displayError:displayError,initError:function(message){var console=window.console;console&&!window.test&&(console.error?console.error.apply(console,arguments):console.log.apply(console,arguments))}}}),define("tinymce.core.caret.CaretContainerInput",["ephox.katamari.api.Fun","ephox.sugar.api.node.Element","ephox.sugar.api.search.SelectorFind","tinymce.core.caret.CaretContainer"],function(Fun,Element,SelectorFind,CaretContainer){var findBlockCaretContainer=function(editor){return SelectorFind.descendant(Element.fromDom(editor.getBody()),"*[data-mce-caret]").fold(Fun.constant(null),function(elm){return elm.dom()})},removeIeControlRect=function(editor){editor.selection.setRng(editor.selection.getRng())},showBlockCaretContainer=function(editor,blockCaretContainer){blockCaretContainer.hasAttribute("data-mce-caret")&&(CaretContainer.showCaretContainerBlock(blockCaretContainer),removeIeControlRect(editor),editor.selection.scrollIntoView(blockCaretContainer))},handleBlockContainer=function(editor,e){var blockCaretContainer=findBlockCaretContainer(editor);if(blockCaretContainer)return"compositionstart"===e.type?(e.preventDefault(),e.stopPropagation(),void showBlockCaretContainer(blockCaretContainer)):void(CaretContainer.hasContent(blockCaretContainer)&&showBlockCaretContainer(editor,blockCaretContainer))};return{setup:function(editor){editor.on("keyup compositionstart",Fun.curry(handleBlockContainer,editor))}}}),define("tinymce.core.file.Uploader",["tinymce.core.util.Promise","tinymce.core.util.Tools","tinymce.core.util.Fun"],function(Promise,Tools,Fun){return function(uploadStatus,settings){function pathJoin(path1,path2){return path1?path1.replace(/\/$/,"")+"/"+path2.replace(/^\//,""):path2}function defaultHandler(blobInfo,success,failure,progress){var xhr,formData;(xhr=new XMLHttpRequest).open("POST",settings.url),xhr.withCredentials=settings.credentials,xhr.upload.onprogress=function(e){progress(e.loaded/e.total*100)},xhr.onerror=function(){failure("Image upload failed due to a XHR Transport error. Code: "+xhr.status)},xhr.onload=function(){var json;xhr.status<200||xhr.status>=300?failure("HTTP Error: "+xhr.status):(json=JSON.parse(xhr.responseText))&&"string"==typeof json.location?success(pathJoin(settings.basePath,json.location)):failure("Invalid JSON: "+xhr.responseText)},(formData=new FormData).append("file",blobInfo.blob(),blobInfo.filename()),xhr.send(formData)}function noUpload(){return new Promise(function(resolve){resolve([])})}function handlerSuccess(blobInfo,url){return{url:url,blobInfo:blobInfo,status:!0}}function handlerFailure(blobInfo,error){return{url:"",blobInfo:blobInfo,status:!1,error:error}}function resolvePending(blobUri,result){Tools.each(pendingPromises[blobUri],function(resolve){resolve(result)}),delete pendingPromises[blobUri]}function uploadBlobInfo(blobInfo,handler,openNotification){return uploadStatus.markPending(blobInfo.blobUri()),new Promise(function(resolve){var notification,progress,noop=function(){};try{var closeNotification=function(){notification&&(notification.close(),progress=noop)};handler(blobInfo,function(url){closeNotification(),uploadStatus.markUploaded(blobInfo.blobUri(),url),resolvePending(blobInfo.blobUri(),handlerSuccess(blobInfo,url)),resolve(handlerSuccess(blobInfo,url))},function(error){closeNotification(),uploadStatus.removeFailed(blobInfo.blobUri()),resolvePending(blobInfo.blobUri(),handlerFailure(blobInfo,error)),resolve(handlerFailure(blobInfo,error))},progress=function(percent){percent<0||percent>100||(notification||(notification=openNotification()),notification.progressBar.value(percent))})}catch(ex){resolve(handlerFailure(blobInfo,ex.message))}})}function isDefaultHandler(handler){return handler===defaultHandler}function pendingUploadBlobInfo(blobInfo){var blobUri=blobInfo.blobUri();return new Promise(function(resolve){pendingPromises[blobUri]=pendingPromises[blobUri]||[],pendingPromises[blobUri].push(resolve)})}function uploadBlobs(blobInfos,openNotification){return blobInfos=Tools.grep(blobInfos,function(blobInfo){return!uploadStatus.isUploaded(blobInfo.blobUri())}),Promise.all(Tools.map(blobInfos,function(blobInfo){return uploadStatus.isPending(blobInfo.blobUri())?pendingUploadBlobInfo(blobInfo):uploadBlobInfo(blobInfo,settings.handler,openNotification)}))}var pendingPromises={};return settings=Tools.extend({credentials:!1,handler:defaultHandler},settings),{upload:function(blobInfos,openNotification){return!settings.url&&isDefaultHandler(settings.handler)?noUpload():uploadBlobs(blobInfos,openNotification)}}}}),define("ephox.sand.api.Window",["ephox.sand.util.Global"],function(Global){return{atob:function(base64){return Global.getOrDie("atob")(base64)},requestAnimationFrame:function(callback){Global.getOrDie("requestAnimationFrame")(callback)}}}),define("tinymce.core.file.Conversions",["ephox.sand.api.Window","tinymce.core.util.Promise"],function(Window,Promise){function blobUriToBlob(url){return new Promise(function(resolve,reject){var rejectWithError=function(){reject("Cannot convert "+url+" to Blob. Resource might not exist or is inaccessible.")};try{var xhr=new XMLHttpRequest;xhr.open("GET",url,!0),xhr.responseType="blob",xhr.onload=function(){200==this.status?resolve(this.response):rejectWithError()},xhr.onerror=rejectWithError,xhr.send()}catch(ex){rejectWithError()}})}function parseDataUri(uri){var type,matches;return uri=decodeURIComponent(uri).split(","),(matches=/data:([^;]+)/.exec(uri[0]))&&(type=matches[1]),{type:type,data:uri[1]}}function dataUriToBlob(uri){return new Promise(function(resolve){var str,arr,i;uri=parseDataUri(uri);try{str=Window.atob(uri.data)}catch(e){return void resolve(new Blob([]))}for(arr=new Uint8Array(str.length),i=0;i<arr.length;i++)arr[i]=str.charCodeAt(i);resolve(new Blob([arr],{type:uri.type}))})}return{uriToBlob:function(url){return 0===url.indexOf("blob:")?blobUriToBlob(url):0===url.indexOf("data:")?dataUriToBlob(url):null},blobToDataUri:function(blob){return new Promise(function(resolve){var reader=new FileReader;reader.onloadend=function(){resolve(reader.result)},reader.readAsDataURL(blob)})},parseDataUri:parseDataUri}}),define("tinymce.core.file.ImageScanner",["tinymce.core.util.Promise","tinymce.core.util.Arr","tinymce.core.util.Fun","tinymce.core.file.Conversions","tinymce.core.Env"],function(Promise,Arr,Fun,Conversions,Env){var count=0,uniqueId=function(prefix){return(prefix||"blobid")+count++},imageToBlobInfo=function(blobCache,img,resolve,reject){var base64,blobInfo;0!==img.src.indexOf("blob:")?(base64=Conversions.parseDataUri(img.src).data,(blobInfo=blobCache.findFirst(function(cachedBlobInfo){return cachedBlobInfo.base64()===base64}))?resolve({image:img,blobInfo:blobInfo}):Conversions.uriToBlob(img.src).then(function(blob){blobInfo=blobCache.create(uniqueId(),blob,base64),blobCache.add(blobInfo),resolve({image:img,blobInfo:blobInfo})},function(err){reject(err)})):(blobInfo=blobCache.getByUri(img.src))?resolve({image:img,blobInfo:blobInfo}):Conversions.uriToBlob(img.src).then(function(blob){Conversions.blobToDataUri(blob).then(function(dataUri){base64=Conversions.parseDataUri(dataUri).data,blobInfo=blobCache.create(uniqueId(),blob,base64),blobCache.add(blobInfo),resolve({image:img,blobInfo:blobInfo})})},function(err){reject(err)})},getAllImages=function(elm){return elm?elm.getElementsByTagName("img"):[]};return function(uploadStatus,blobCache){var cachedPromises={};return{findAll:function(elm,predicate){var images,promises;return predicate||(predicate=Fun.constant(!0)),images=Arr.filter(getAllImages(elm),function(img){var src=img.src;return!!Env.fileApi&&!img.hasAttribute("data-mce-bogus")&&!img.hasAttribute("data-mce-placeholder")&&!(!src||src==Env.transparentSrc)&&(0===src.indexOf("blob:")?!uploadStatus.isUploaded(src):0===src.indexOf("data:")&&predicate(img))}),promises=Arr.map(images,function(img){var newPromise;return cachedPromises[img.src]?new Promise(function(resolve){cachedPromises[img.src].then(function(imageInfo){if("string"==typeof imageInfo)return imageInfo;resolve({image:img,blobInfo:imageInfo.blobInfo})})}):(newPromise=new Promise(function(resolve,reject){imageToBlobInfo(blobCache,img,resolve,reject)}).then(function(result){return delete cachedPromises[result.image.src],result}).catch(function(error){return delete cachedPromises[img.src],error}),cachedPromises[img.src]=newPromise,newPromise)}),Promise.all(promises)}}}}),define("ephox.sand.api.URL",["ephox.sand.util.Global"],function(Global){var url=function(){return Global.getOrDie("URL")};return{createObjectURL:function(blob){return url().createObjectURL(blob)},revokeObjectURL:function(u){url().revokeObjectURL(u)}}}),define("tinymce.core.util.Uuid",[],function(){var count=0,seed=function(){var rnd=function(){return Math.round(4294967295*Math.random()).toString(36)};return"s"+(new Date).getTime().toString(36)+rnd()+rnd()+rnd()};return{uuid:function(prefix){return prefix+count+++seed()}}}),define("tinymce.core.file.BlobCache",["ephox.sand.api.URL","tinymce.core.util.Arr","tinymce.core.util.Fun","tinymce.core.util.Uuid"],function(URL,Arr,Fun,Uuid){return function(){function mimeToExt(mime){return{"image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/png":"png"}[mime.toLowerCase()]||"dat"}function toBlobInfo(o){var id,name;if(!o.blob||!o.base64)throw"blob and base64 representations of the image are required for BlobInfo to be created";return id=o.id||Uuid.uuid("blobid"),name=o.name||id,{id:constant(id),name:constant(name),filename:constant(name+"."+mimeToExt(o.blob.type)),blob:constant(o.blob),base64:constant(o.base64),blobUri:constant(o.blobUri||URL.createObjectURL(o.blob)),uri:constant(o.uri)}}function get(id){return findFirst(function(cachedBlobInfo){return cachedBlobInfo.id()===id})}function findFirst(predicate){return Arr.filter(cache,predicate)[0]}var cache=[],constant=Fun.constant;return{create:function(o,blob,base64,filename){return toBlobInfo("object"==typeof o?o:{id:o,name:filename,blob:blob,base64:base64})},add:function(blobInfo){get(blobInfo.id())||cache.push(blobInfo)},get:get,getByUri:function(blobUri){return findFirst(function(blobInfo){return blobInfo.blobUri()==blobUri})},findFirst:findFirst,removeByUri:function(blobUri){cache=Arr.filter(cache,function(blobInfo){return blobInfo.blobUri()!==blobUri||(URL.revokeObjectURL(blobInfo.blobUri()),!1)})},destroy:function(){Arr.each(cache,function(cachedBlobInfo){URL.revokeObjectURL(cachedBlobInfo.blobUri())}),cache=[]}}}}),define("tinymce.core.file.UploadStatus",[],function(){return function(){function createStatus(status,resultUri){return{status:status,resultUri:resultUri}}function hasBlobUri(blobUri){return blobUri in blobUriStatuses}var PENDING=1,UPLOADED=2,blobUriStatuses={};return{hasBlobUri:hasBlobUri,getResultUri:function(blobUri){var result=blobUriStatuses[blobUri];return result?result.resultUri:null},isPending:function(blobUri){return!!hasBlobUri(blobUri)&&blobUriStatuses[blobUri].status===PENDING},isUploaded:function(blobUri){return!!hasBlobUri(blobUri)&&blobUriStatuses[blobUri].status===UPLOADED},markPending:function(blobUri){blobUriStatuses[blobUri]=createStatus(PENDING,null)},markUploaded:function(blobUri,resultUri){blobUriStatuses[blobUri]=createStatus(UPLOADED,resultUri)},removeFailed:function(blobUri){delete blobUriStatuses[blobUri]},destroy:function(){blobUriStatuses={}}}}}),define("tinymce.core.EditorUpload",["tinymce.core.util.Arr","tinymce.core.file.Uploader","tinymce.core.file.ImageScanner","tinymce.core.file.BlobCache","tinymce.core.file.UploadStatus","tinymce.core.ErrorReporter"],function(Arr,Uploader,ImageScanner,BlobCache,UploadStatus,ErrorReporter){return function(editor){function aliveGuard(callback){return function(result){return editor.selection?callback(result):[]}}function cacheInvalidator(){return"?"+(new Date).getTime()}function replaceString(content,search,replace){var index=0;do{-1!==(index=content.indexOf(search,index))&&(content=content.substring(0,index)+replace+content.substr(index+search.length),index+=replace.length-search.length+1)}while(-1!==index);return content}function replaceImageUrl(content,targetUrl,replacementUrl){return content=replaceString(content,'src="'+targetUrl+'"','src="'+replacementUrl+'"'),content=replaceString(content,'data-mce-src="'+targetUrl+'"','data-mce-src="'+replacementUrl+'"')}function replaceUrlInUndoStack(targetUrl,replacementUrl){Arr.each(editor.undoManager.data,function(level){"fragmented"===level.type?level.fragments=Arr.map(level.fragments,function(fragment){return replaceImageUrl(fragment,targetUrl,replacementUrl)}):level.content=replaceImageUrl(level.content,targetUrl,replacementUrl)})}function openNotification(){return editor.notificationManager.open({text:editor.translate("Image uploading..."),type:"info",timeout:-1,progressBar:!0})}function replaceImageUri(image,resultUri){blobCache.removeByUri(image.src),replaceUrlInUndoStack(image.src,resultUri),editor.$(image).attr({src:settings.images_reuse_filename?resultUri+cacheInvalidator():resultUri,"data-mce-src":editor.convertURL(resultUri,"src")})}function uploadImages(callback){return uploader||(uploader=new Uploader(uploadStatus,{url:settings.images_upload_url,basePath:settings.images_upload_base_path,credentials:settings.images_upload_credentials,handler:settings.images_upload_handler})),scanForImages().then(aliveGuard(function(imageInfos){var blobInfos;return blobInfos=Arr.map(imageInfos,function(imageInfo){return imageInfo.blobInfo}),uploader.upload(blobInfos,openNotification).then(aliveGuard(function(result){var filteredResult=Arr.map(result,function(uploadInfo,index){var image=imageInfos[index].image;return uploadInfo.status&&!1!==editor.settings.images_replace_blob_uris?replaceImageUri(image,uploadInfo.url):uploadInfo.error&&ErrorReporter.uploadError(editor,uploadInfo.error),{element:image,status:uploadInfo.status}});return callback&&callback(filteredResult),filteredResult}))}))}function uploadImagesAuto(callback){if(!1!==settings.automatic_uploads)return uploadImages(callback)}function isValidDataUriImage(imgElm){return!settings.images_dataimg_filter||settings.images_dataimg_filter(imgElm)}function scanForImages(){return imageScanner||(imageScanner=new ImageScanner(uploadStatus,blobCache)),imageScanner.findAll(editor.getBody(),isValidDataUriImage).then(aliveGuard(function(result){return result=Arr.filter(result,function(resultItem){return"string"!=typeof resultItem||(ErrorReporter.displayError(editor,resultItem),!1)}),Arr.each(result,function(resultItem){replaceUrlInUndoStack(resultItem.image.src,resultItem.blobInfo.blobUri()),resultItem.image.src=resultItem.blobInfo.blobUri(),resultItem.image.removeAttribute("data-mce-src")}),result}))}function replaceBlobUris(content){return content.replace(/src="(blob:[^"]+)"/g,function(match,blobUri){var resultUri=uploadStatus.getResultUri(blobUri);if(resultUri)return'src="'+resultUri+'"';var blobInfo=blobCache.getByUri(blobUri);return blobInfo||(blobInfo=Arr.reduce(editor.editorManager.get(),function(result,editor){return result||editor.editorUpload&&editor.editorUpload.blobCache.getByUri(blobUri)},null)),blobInfo?'src="data:'+blobInfo.blob().type+";base64,"+blobInfo.base64()+'"':match})}var uploader,imageScanner,blobCache=new BlobCache,settings=editor.settings,uploadStatus=new UploadStatus;return editor.on("setContent",function(){!1!==editor.settings.automatic_uploads?uploadImagesAuto():scanForImages()}),editor.on("RawSaveContent",function(e){e.content=replaceBlobUris(e.content)}),editor.on("getContent",function(e){e.source_view||"raw"==e.format||(e.content=replaceBlobUris(e.content))}),editor.on("PostRender",function(){editor.parser.addNodeFilter("img",function(images){Arr.each(images,function(img){var src=img.attr("src");if(!blobCache.getByUri(src)){var resultUri=uploadStatus.getResultUri(src);resultUri&&img.attr("src",resultUri)}})})}),{blobCache:blobCache,uploadImages:uploadImages,uploadImagesAuto:uploadImagesAuto,scanForImages:scanForImages,destroy:function(){blobCache.destroy(),uploadStatus.destroy(),imageScanner=uploader=null}}}}),define("tinymce.core.ForceBlocks",["ephox.katamari.api.Fun"],function(Fun){var addRootBlocks=function(editor){var rng,startContainer,startOffset,endContainer,endOffset,rootBlockNode,tempNode,wrapped,restoreSelection,tmpRng,rootNodeName,forcedRootBlock,settings=editor.settings,dom=editor.dom,selection=editor.selection,schema=editor.schema,blockElements=schema.getBlockElements(),node=selection.getStart(),rootNode=editor.getBody();if(forcedRootBlock=settings.forced_root_block,node&&1===node.nodeType&&forcedRootBlock){for(;node&&node!==rootNode;){if(blockElements[node.nodeName])return;node=node.parentNode}if((rng=selection.getRng()).setStart){startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;try{restoreSelection=editor.getDoc().activeElement===rootNode}catch(ex){}}else rng.item&&(node=rng.item(0),(rng=editor.getDoc().body.createTextRange()).moveToElementText(node)),restoreSelection=rng.parentElement().ownerDocument===editor.getDoc(),(tmpRng=rng.duplicate()).collapse(!0),startOffset=-1*tmpRng.move("character",-16777215),tmpRng.collapsed||((tmpRng=rng.duplicate()).collapse(!1),endOffset=-1*tmpRng.move("character",-16777215)-startOffset);for(node=rootNode.firstChild,rootNodeName=rootNode.nodeName.toLowerCase();node;)if((3===node.nodeType||1==node.nodeType&&!blockElements[node.nodeName])&&schema.isValidChild(rootNodeName,forcedRootBlock.toLowerCase())){if(3===node.nodeType&&0===node.nodeValue.length){tempNode=node,node=node.nextSibling,dom.remove(tempNode);continue}rootBlockNode||(rootBlockNode=dom.create(forcedRootBlock,editor.settings.forced_root_block_attrs),node.parentNode.insertBefore(rootBlockNode,node),wrapped=!0),tempNode=node,node=node.nextSibling,rootBlockNode.appendChild(tempNode)}else rootBlockNode=null,node=node.nextSibling;if(wrapped&&restoreSelection){if(rng.setStart)rng.setStart(startContainer,startOffset),rng.setEnd(endContainer,endOffset),selection.setRng(rng);else try{(rng=editor.getDoc().body.createTextRange()).moveToElementText(rootNode),rng.collapse(!0),rng.moveStart("character",startOffset),endOffset>0&&rng.moveEnd("character",endOffset),rng.select()}catch(ex){}editor.nodeChanged()}}};return{setup:function(editor){editor.settings.forced_root_block&&editor.on("NodeChange",Fun.curry(addRootBlocks,editor))}}}),define("tinymce.core.dom.Dimensions",["tinymce.core.util.Arr","tinymce.core.dom.NodeType","tinymce.core.geom.ClientRect"],function(Arr,NodeType,ClientRect){function getClientRects(node){function toArrayWithNode(clientRects){return Arr.map(clientRects,function(clientRect){return clientRect=ClientRect.clone(clientRect),clientRect.node=node,clientRect})}if(Arr.isArray(node))return Arr.reduce(node,function(result,node){return result.concat(getClientRects(node))},[]);if(NodeType.isElement(node))return toArrayWithNode(node.getClientRects());if(NodeType.isText(node)){var rng=node.ownerDocument.createRange();return rng.setStart(node,0),rng.setEnd(node,node.data.length),toArrayWithNode(rng.getClientRects())}}return{getClientRects:getClientRects}}),define("tinymce.core.caret.LineUtils",["tinymce.core.util.Fun","tinymce.core.util.Arr","tinymce.core.dom.NodeType","tinymce.core.dom.Dimensions","tinymce.core.geom.ClientRect","tinymce.core.caret.CaretUtils","tinymce.core.caret.CaretCandidate"],function(Fun,Arr,NodeType,Dimensions,ClientRect,CaretUtils,CaretCandidate){function distanceToRectLeft(clientRect,clientX){return Math.abs(clientRect.left-clientX)}function distanceToRectRight(clientRect,clientX){return Math.abs(clientRect.right-clientX)}function findClosestClientRect(clientRects,clientX){function isInside(clientX,clientRect){return clientX>=clientRect.left&&clientX<=clientRect.right}return Arr.reduce(clientRects,function(oldClientRect,clientRect){var oldDistance,newDistance;return oldDistance=Math.min(distanceToRectLeft(oldClientRect,clientX),distanceToRectRight(oldClientRect,clientX)),newDistance=Math.min(distanceToRectLeft(clientRect,clientX),distanceToRectRight(clientRect,clientX)),isInside(clientX,clientRect)?clientRect:isInside(clientX,oldClientRect)?oldClientRect:newDistance==oldDistance&&isContentEditableFalse(clientRect.node)?clientRect:newDistance<oldDistance?clientRect:oldClientRect})}function walkUntil(direction,rootNode,predicateFn,node){for(;node=findNode(node,direction,CaretCandidate.isEditableCaretCandidate,rootNode);)if(predicateFn(node))return}function findLineNodeRects(rootNode,targetNodeRect){function collect(checkPosFn,node){var lineRects;return lineRects=Arr.filter(Dimensions.getClientRects(node),function(clientRect){return!checkPosFn(clientRect,targetNodeRect)}),clientRects=clientRects.concat(lineRects),0===lineRects.length}var clientRects=[];return clientRects.push(targetNodeRect),walkUntil(-1,rootNode,curry(collect,ClientRect.isAbove),targetNodeRect.node),walkUntil(1,rootNode,curry(collect,ClientRect.isBelow),targetNodeRect.node),clientRects}function getContentEditableFalseChildren(rootNode){return Arr.filter(Arr.toArray(rootNode.getElementsByTagName("*")),isContentEditableFalse)}function caretInfo(clientRect,clientX){return{node:clientRect.node,before:distanceToRectLeft(clientRect,clientX)<distanceToRectRight(clientRect,clientX)}}var isContentEditableFalse=NodeType.isContentEditableFalse,findNode=CaretUtils.findNode,curry=Fun.curry;return{findClosestClientRect:findClosestClientRect,findLineNodeRects:findLineNodeRects,closestCaret:function(rootNode,clientX,clientY){var contentEditableFalseNodeRects,closestNodeRect;return contentEditableFalseNodeRects=Dimensions.getClientRects(getContentEditableFalseChildren(rootNode)),contentEditableFalseNodeRects=Arr.filter(contentEditableFalseNodeRects,function(clientRect){return clientY>=clientRect.top&&clientY<=clientRect.bottom}),(closestNodeRect=findClosestClientRect(contentEditableFalseNodeRects,clientX))&&(closestNodeRect=findClosestClientRect(findLineNodeRects(rootNode,closestNodeRect),clientX))&&isContentEditableFalse(closestNodeRect.node)?caretInfo(closestNodeRect,clientX):null}}}),define("tinymce.core.caret.LineWalker",["tinymce.core.util.Fun","tinymce.core.util.Arr","tinymce.core.dom.Dimensions","tinymce.core.caret.CaretCandidate","tinymce.core.caret.CaretUtils","tinymce.core.caret.CaretWalker","tinymce.core.caret.CaretPosition","tinymce.core.geom.ClientRect"],function(Fun,Arr,Dimensions,CaretCandidate,CaretUtils,CaretWalker,CaretPosition,ClientRect){function findUntil(direction,rootNode,predicateFn,node){for(;node=CaretUtils.findNode(node,direction,CaretCandidate.isEditableCaretCandidate,rootNode);)if(predicateFn(node))return}function walkUntil(direction,isAboveFn,isBeflowFn,rootNode,predicateFn,caretPosition){function add(node){var i,clientRect,clientRects;for(clientRects=Dimensions.getClientRects(node),-1==direction&&(clientRects=clientRects.reverse()),i=0;i<clientRects.length;i++)if(clientRect=clientRects[i],!isBeflowFn(clientRect,targetClientRect)){if(result.length>0&&isAboveFn(clientRect,Arr.last(result))&&line++,clientRect.line=line,predicateFn(clientRect))return!0;result.push(clientRect)}}var node,targetClientRect,line=0,result=[];return(targetClientRect=Arr.last(caretPosition.getClientRects()))?(node=caretPosition.getNode(),add(node),findUntil(direction,rootNode,add,node),result):result}var curry=Fun.curry;return{upUntil:curry(walkUntil,-1,ClientRect.isAbove,ClientRect.isBelow),downUntil:curry(walkUntil,1,ClientRect.isBelow,ClientRect.isAbove),positionsUntil:function(direction,rootNode,predicateFn,node){function getClientRect(caretPosition){return Arr.last(caretPosition.getClientRects())}var walkFn,isBelowFn,isAboveFn,caretPosition,clientRect,targetClientRect,caretWalker=new CaretWalker(rootNode),result=[],line=0;1==direction?(walkFn=caretWalker.next,isBelowFn=ClientRect.isBelow,isAboveFn=ClientRect.isAbove,caretPosition=CaretPosition.after(node)):(walkFn=caretWalker.prev,isBelowFn=ClientRect.isAbove,isAboveFn=ClientRect.isBelow,caretPosition=CaretPosition.before(node)),targetClientRect=getClientRect(caretPosition);do{if(caretPosition.isVisible()&&(clientRect=getClientRect(caretPosition),!isAboveFn(clientRect,targetClientRect))){if(result.length>0&&isBelowFn(clientRect,Arr.last(result))&&line++,clientRect=ClientRect.clone(clientRect),clientRect.position=caretPosition,clientRect.line=line,predicateFn(clientRect))return result;result.push(clientRect)}}while(caretPosition=walkFn(caretPosition));return result},isAboveLine:curry(function(lineNumber,clientRect){return clientRect.line>lineNumber}),isLine:curry(function(lineNumber,clientRect){return clientRect.line===lineNumber})}}),define("tinymce.core.keyboard.CefUtils",["tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.dom.NodeType","tinymce.core.util.Fun"],function(CaretPosition,CaretUtils,NodeType,Fun){var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,showCaret=function(direction,editor,node,before){return editor._selectionOverrides.showCaret(direction,node,before)},getNodeRange=function(node){var rng=node.ownerDocument.createRange();return rng.selectNode(node),rng},renderCaretAtRange=function(editor,range){var caretPosition,ceRoot;return range=CaretUtils.normalizeRange(1,editor.getBody(),range),caretPosition=CaretPosition.fromRangeStart(range),isContentEditableFalse(caretPosition.getNode())?showCaret(1,editor,caretPosition.getNode(),!caretPosition.isAtEnd()):isContentEditableFalse(caretPosition.getNode(!0))?showCaret(1,editor,caretPosition.getNode(!0),!1):(ceRoot=editor.dom.getParent(caretPosition.getNode(),Fun.or(isContentEditableFalse,isContentEditableTrue)),isContentEditableFalse(ceRoot)?showCaret(1,editor,ceRoot,!1):null)};return{showCaret:showCaret,selectNode:function(editor,node){return editor.fire("BeforeObjectSelected",{target:node}).isDefaultPrevented()?null:getNodeRange(node)},renderCaretAtRange:renderCaretAtRange,renderRangeCaret:function(editor,range){return range&&range.collapsed?renderCaretAtRange(editor,range)||range:range}}}),define("tinymce.core.keyboard.CefNavigation",["tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.caret.CaretWalker","tinymce.core.caret.LineUtils","tinymce.core.caret.LineWalker","tinymce.core.dom.NodeType","tinymce.core.dom.RangeUtils","tinymce.core.Env","tinymce.core.keyboard.CefUtils","tinymce.core.util.Arr","tinymce.core.util.Fun"],function(CaretContainer,CaretPosition,CaretUtils,CaretWalker,LineUtils,LineWalker,NodeType,RangeUtils,Env,CefUtils,Arr,Fun){var isContentEditableFalse=NodeType.isContentEditableFalse,getSelectedNode=RangeUtils.getSelectedNode,isAfterContentEditableFalse=CaretUtils.isAfterContentEditableFalse,isBeforeContentEditableFalse=CaretUtils.isBeforeContentEditableFalse,getVisualCaretPosition=function(walkFn,caretPosition){for(;caretPosition=walkFn(caretPosition);)if(caretPosition.isVisible())return caretPosition;return caretPosition},isMoveInsideSameBlock=function(fromCaretPosition,toCaretPosition){var inSameBlock=CaretUtils.isInSameBlock(fromCaretPosition,toCaretPosition);return!(inSameBlock||!NodeType.isBr(fromCaretPosition.getNode()))||inSameBlock},isRangeInCaretContainerBlock=function(range){return CaretContainer.isCaretContainerBlock(range.startContainer)},getNormalizedRangeEndPoint=function(direction,rootNode,range){return range=CaretUtils.normalizeRange(direction,rootNode,range),-1===direction?CaretPosition.fromRangeStart(range):CaretPosition.fromRangeEnd(range)},moveToCeFalseHorizontally=function(direction,editor,getNextPosFn,isBeforeContentEditableFalseFn,range){var node,caretPosition,peekCaretPosition,rangeIsInContainerBlock;return!range.collapsed&&(node=getSelectedNode(range),isContentEditableFalse(node))?CefUtils.showCaret(direction,editor,node,-1===direction):(rangeIsInContainerBlock=isRangeInCaretContainerBlock(range),caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range),isBeforeContentEditableFalseFn(caretPosition)?CefUtils.selectNode(editor,caretPosition.getNode(-1===direction)):(caretPosition=getNextPosFn(caretPosition))?isBeforeContentEditableFalseFn(caretPosition)?CefUtils.showCaret(direction,editor,caretPosition.getNode(-1===direction),1===direction):(peekCaretPosition=getNextPosFn(caretPosition),isBeforeContentEditableFalseFn(peekCaretPosition)&&isMoveInsideSameBlock(caretPosition,peekCaretPosition)?CefUtils.showCaret(direction,editor,peekCaretPosition.getNode(-1===direction),1===direction):rangeIsInContainerBlock?CefUtils.renderRangeCaret(editor,caretPosition.toRange()):null):rangeIsInContainerBlock?range:null)},moveToCeFalseVertically=function(direction,editor,walkerFn,range){var caretPosition,linePositions,nextLinePositions,closestNextLineRect,caretClientRect,clientX,dist1,dist2,contentEditableFalseNode;if(contentEditableFalseNode=getSelectedNode(range),caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range),linePositions=walkerFn(editor.getBody(),LineWalker.isAboveLine(1),caretPosition),nextLinePositions=Arr.filter(linePositions,LineWalker.isLine(1)),caretClientRect=Arr.last(caretPosition.getClientRects()),isBeforeContentEditableFalse(caretPosition)&&(contentEditableFalseNode=caretPosition.getNode()),isAfterContentEditableFalse(caretPosition)&&(contentEditableFalseNode=caretPosition.getNode(!0)),!caretClientRect)return null;if(clientX=caretClientRect.left,(closestNextLineRect=LineUtils.findClosestClientRect(nextLinePositions,clientX))&&isContentEditableFalse(closestNextLineRect.node))return dist1=Math.abs(clientX-closestNextLineRect.left),dist2=Math.abs(clientX-closestNextLineRect.right),CefUtils.showCaret(direction,editor,closestNextLineRect.node,dist1<dist2);if(contentEditableFalseNode){var caretPositions=LineWalker.positionsUntil(direction,editor.getBody(),LineWalker.isAboveLine(1),contentEditableFalseNode);if(closestNextLineRect=LineUtils.findClosestClientRect(Arr.filter(caretPositions,LineWalker.isLine(1)),clientX))return CefUtils.renderRangeCaret(editor,closestNextLineRect.position.toRange());if(closestNextLineRect=Arr.last(Arr.filter(caretPositions,LineWalker.isLine(0))))return CefUtils.renderRangeCaret(editor,closestNextLineRect.position.toRange())}},createTextBlock=function(editor){var textBlock=editor.dom.create(editor.settings.forced_root_block);return(!Env.ie||Env.ie>=11)&&(textBlock.innerHTML='<br data-mce-bogus="1">'),textBlock},exitPreBlock=function(editor,direction,range){var pre,newBlock,caretWalker=new CaretWalker(editor.getBody()),getNextVisualCaretPosition=Fun.curry(getVisualCaretPosition,caretWalker.next),getPrevVisualCaretPosition=Fun.curry(getVisualCaretPosition,caretWalker.prev);if(range.collapsed&&editor.settings.forced_root_block){if(!(pre=editor.dom.getParent(range.startContainer,"PRE")))return;(1===direction?getNextVisualCaretPosition(CaretPosition.fromRangeStart(range)):getPrevVisualCaretPosition(CaretPosition.fromRangeStart(range)))||(newBlock=createTextBlock(editor),1===direction?editor.$(pre).after(newBlock):editor.$(pre).before(newBlock),editor.selection.select(newBlock,!0),editor.selection.collapse())}},getHorizontalRange=function(editor,forward){var newRange,caretWalker=new CaretWalker(editor.getBody()),getNextVisualCaretPosition=Fun.curry(getVisualCaretPosition,caretWalker.next),getPrevVisualCaretPosition=Fun.curry(getVisualCaretPosition,caretWalker.prev),direction=forward?1:-1,getNextPosFn=forward?getNextVisualCaretPosition:getPrevVisualCaretPosition,isBeforeContentEditableFalseFn=forward?isBeforeContentEditableFalse:isAfterContentEditableFalse,range=editor.selection.getRng();return(newRange=moveToCeFalseHorizontally(direction,editor,getNextPosFn,isBeforeContentEditableFalseFn,range))?newRange:(newRange=exitPreBlock(editor,direction,range))||null},getVerticalRange=function(editor,down){var newRange,direction=down?1:-1,walkerFn=down?LineWalker.downUntil:LineWalker.upUntil,range=editor.selection.getRng();return(newRange=moveToCeFalseVertically(direction,editor,walkerFn,range))?newRange:(newRange=exitPreBlock(editor,direction,range))||null};return{moveH:function(editor,forward){return function(){var newRng=getHorizontalRange(editor,forward);return!!newRng&&(editor.selection.setRng(newRng),!0)}},moveV:function(editor,down){return function(){var newRng=getVerticalRange(editor,down);return!!newRng&&(editor.selection.setRng(newRng),!0)}}}}),define("ephox.katamari.api.Merger",["ephox.katamari.api.Type","global!Array","global!Error"],function(Type,Array,Error){var baseMerge=function(merger){return function(){for(var objects=new Array(arguments.length),i=0;i<objects.length;i++)objects[i]=arguments[i];if(0===objects.length)throw new Error("Can't merge zero objects");for(var ret={},j=0;j<objects.length;j++){var curObject=objects[j];for(var key in curObject)curObject.hasOwnProperty(key)&&(ret[key]=merger(ret[key],curObject[key]))}return ret}},deepMerge=baseMerge(function(old,nu){return Type.isObject(old)&&Type.isObject(nu)?deepMerge(old,nu):nu}),merge=baseMerge(function(old,nu){return nu});return{deepMerge:deepMerge,merge:merge}}),define("tinymce.core.keyboard.MatchKeys",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Merger"],function(Arr,Fun,Merger){var defaultPatterns=function(patterns){return Arr.map(patterns,function(pattern){return Merger.merge({shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1,keyCode:0,action:Fun.noop},pattern)})},matchesEvent=function(pattern,evt){return evt.keyCode===pattern.keyCode&&evt.shiftKey===pattern.shiftKey&&evt.altKey===pattern.altKey&&evt.ctrlKey===pattern.ctrlKey&&evt.metaKey===pattern.metaKey},match=function(patterns,evt){return Arr.bind(defaultPatterns(patterns),function(pattern){return matchesEvent(pattern,evt)?[pattern]:[]})};return{match:match,action:function(f){var args=Array.prototype.slice.call(arguments,1);return function(){return f.apply(null,args)}},execute:function(patterns,evt){return Arr.find(match(patterns,evt),function(pattern){return pattern.action()})}}}),define("tinymce.core.keyboard.ArrowKeys",["tinymce.core.keyboard.BoundarySelection","tinymce.core.keyboard.CefNavigation","tinymce.core.keyboard.MatchKeys","tinymce.core.util.VK"],function(BoundarySelection,CefNavigation,MatchKeys,VK){var executeKeydownOverride=function(editor,caret,evt){MatchKeys.execute([{keyCode:VK.RIGHT,action:CefNavigation.moveH(editor,!0)},{keyCode:VK.LEFT,action:CefNavigation.moveH(editor,!1)},{keyCode:VK.UP,action:CefNavigation.moveV(editor,!1)},{keyCode:VK.DOWN,action:CefNavigation.moveV(editor,!0)},{keyCode:VK.RIGHT,action:BoundarySelection.move(editor,caret,!0)},{keyCode:VK.LEFT,action:BoundarySelection.move(editor,caret,!1)}],evt).each(function(_){evt.preventDefault()})};return{setup:function(editor,caret){editor.on("keydown",function(evt){!1===evt.isDefaultPrevented()&&executeKeydownOverride(editor,caret,evt)})}}}),define("tinymce.core.keyboard.DeleteBackspaceKeys",["tinymce.core.delete.BlockBoundaryDelete","tinymce.core.delete.BlockRangeDelete","tinymce.core.delete.CefDelete","tinymce.core.delete.InlineBoundaryDelete","tinymce.core.keyboard.MatchKeys","tinymce.core.util.VK"],function(BlockBoundaryDelete,BlockRangeDelete,CefDelete,InlineBoundaryDelete,MatchKeys,VK){var executeKeydownOverride=function(editor,caret,evt){MatchKeys.execute([{keyCode:VK.BACKSPACE,action:MatchKeys.action(CefDelete.backspaceDelete,editor,!1)},{keyCode:VK.DELETE,action:MatchKeys.action(CefDelete.backspaceDelete,editor,!0)},{keyCode:VK.BACKSPACE,action:MatchKeys.action(InlineBoundaryDelete.backspaceDelete,editor,caret,!1)},{keyCode:VK.DELETE,action:MatchKeys.action(InlineBoundaryDelete.backspaceDelete,editor,caret,!0)},{keyCode:VK.BACKSPACE,action:MatchKeys.action(BlockRangeDelete.backspaceDelete,editor,!1)},{keyCode:VK.DELETE,action:MatchKeys.action(BlockRangeDelete.backspaceDelete,editor,!0)},{keyCode:VK.BACKSPACE,action:MatchKeys.action(BlockBoundaryDelete.backspaceDelete,editor,!1)},{keyCode:VK.DELETE,action:MatchKeys.action(BlockBoundaryDelete.backspaceDelete,editor,!0)}],evt).each(function(_){evt.preventDefault()})},executeKeyupOverride=function(editor,evt){MatchKeys.execute([{keyCode:VK.BACKSPACE,action:MatchKeys.action(CefDelete.paddEmptyElement,editor)},{keyCode:VK.DELETE,action:MatchKeys.action(CefDelete.paddEmptyElement,editor)}],evt)};return{setup:function(editor,caret){editor.on("keydown",function(evt){!1===evt.isDefaultPrevented()&&executeKeydownOverride(editor,caret,evt)}),editor.on("keyup",function(evt){!1===evt.isDefaultPrevented()&&executeKeyupOverride(editor,evt)})}}}),define("tinymce.core.keyboard.InsertNewLine",["tinymce.core.caret.CaretContainer","tinymce.core.dom.NodeType","tinymce.core.dom.RangeUtils","tinymce.core.dom.TreeWalker","tinymce.core.text.Zwsp","tinymce.core.util.Tools"],function(CaretContainer,NodeType,RangeUtils,TreeWalker,Zwsp,Tools){var isEmptyAnchor=function(elm){return elm&&"A"===elm.nodeName&&0===Tools.trim(Zwsp.trim(elm.innerText||elm.textContent)).length},isTableCell=function(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)},hasFirstChild=function(elm,name){return elm.firstChild&&elm.firstChild.nodeName==name},hasParent=function(elm,parentName){return elm&&elm.parentNode&&elm.parentNode.nodeName===parentName},emptyBlock=function(elm){elm.innerHTML='<br data-mce-bogus="1">'},containerAndSiblingName=function(container,nodeName){return container.nodeName===nodeName||container.previousSibling&&container.previousSibling.nodeName===nodeName},isListBlock=function(elm){return elm&&/^(OL|UL|LI)$/.test(elm.nodeName)},isNestedList=function(elm){return isListBlock(elm)&&isListBlock(elm.parentNode)},canSplitBlock=function(dom,node){return node&&dom.isBlock(node)&&!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName)&&!/^(fixed|absolute)/i.test(node.style.position)&&"true"!==dom.getContentEditable(node)},trimInlineElementsOnLeftSideOfBlock=function(dom,nonEmptyElementsMap,block){var i,node=block,firstChilds=[];if(node){for(;node=node.firstChild;){if(dom.isBlock(node))return;1!=node.nodeType||nonEmptyElementsMap[node.nodeName.toLowerCase()]||firstChilds.push(node)}for(i=firstChilds.length;i--;)!(node=firstChilds[i]).hasChildNodes()||node.firstChild==node.lastChild&&""===node.firstChild.nodeValue?dom.remove(node):isEmptyAnchor(node)&&dom.remove(node)}},normalizeZwspOffset=function(start,container,offset){return!1===NodeType.isText(container)?offset:start?1===offset&&container.data.charAt(offset-1)===Zwsp.ZWSP?0:offset:offset===container.data.length-1&&container.data.charAt(offset)===Zwsp.ZWSP?container.data.length:offset},includeZwspInRange=function(rng){var newRng=rng.cloneRange();return newRng.setStart(rng.startContainer,normalizeZwspOffset(!0,rng.startContainer,rng.startOffset)),newRng.setEnd(rng.endContainer,normalizeZwspOffset(!1,rng.endContainer,rng.endOffset)),newRng},firstNonWhiteSpaceNodeSibling=function(node){for(;node;){if(1===node.nodeType||3===node.nodeType&&node.data&&/[\r\n\s]/.test(node.data))return node;node=node.nextSibling}},insertBr=function(editor,evt){editor.execCommand("InsertLineBreak",!1,evt)},trimLeadingLineBreaks=function(node){do{3===node.nodeType&&(node.nodeValue=node.nodeValue.replace(/^[\r\n]+/,"")),node=node.firstChild}while(node)},getEditableRoot=function(dom,node){var parent,editableRoot,root=dom.getRoot();for(parent=node;parent!==root&&"false"!==dom.getContentEditable(parent);)"true"===dom.getContentEditable(parent)&&(editableRoot=parent),parent=parent.parentNode;return parent!==root?editableRoot:root},setForcedBlockAttrs=function(editor,node){var forcedRootBlockName=editor.settings.forced_root_block;forcedRootBlockName&&forcedRootBlockName.toLowerCase()===node.tagName.toLowerCase()&&editor.dom.setAttribs(node,editor.settings.forced_root_block_attrs)},wrapSelfAndSiblingsInDefaultBlock=function(editor,newBlockName,rng,container,offset){var newBlock,parentBlock,startNode,node,next,rootBlockName,blockName=newBlockName||"P",dom=editor.dom,editableRoot=getEditableRoot(dom,container);if(!(parentBlock=dom.getParent(container,dom.isBlock))||!canSplitBlock(dom,parentBlock)){if(parentBlock=parentBlock||editableRoot,rootBlockName=parentBlock==editor.getBody()||isTableCell(parentBlock)?parentBlock.nodeName.toLowerCase():parentBlock.parentNode.nodeName.toLowerCase(),!parentBlock.hasChildNodes())return newBlock=dom.create(blockName),setForcedBlockAttrs(editor,newBlock),parentBlock.appendChild(newBlock),rng.setStart(newBlock,0),rng.setEnd(newBlock,0),newBlock;for(node=container;node.parentNode!=parentBlock;)node=node.parentNode;for(;node&&!dom.isBlock(node);)startNode=node,node=node.previousSibling;if(startNode&&editor.schema.isValidChild(rootBlockName,blockName.toLowerCase())){for(newBlock=dom.create(blockName),setForcedBlockAttrs(editor,newBlock),startNode.parentNode.insertBefore(newBlock,startNode),node=startNode;node&&!dom.isBlock(node);)next=node.nextSibling,newBlock.appendChild(node),node=next;rng.setStart(container,offset),rng.setEnd(container,offset)}}return container},addBrToBlockIfNeeded=function(dom,block){var lastChild;block.normalize(),(lastChild=block.lastChild)&&!/^(left|right)$/gi.test(dom.getStyle(lastChild,"float",!0))||dom.add(block,"br")},getContainerBlock=function(containerBlock){var containerBlockParent=containerBlock.parentNode;return/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)?containerBlockParent:containerBlock},isFirstOrLastLi=function(containerBlock,parentBlock,first){for(var node=containerBlock[first?"firstChild":"lastChild"];node&&1!=node.nodeType;)node=node[first?"nextSibling":"previousSibling"];return node===parentBlock};return{insert:function(editor,evt){function moveToCaretPosition(root){var walker,node,rng,lastNode=root,moveCaretBeforeOnEnterElementsMap=schema.getMoveCaretBeforeOnEnterElements();if(root){if(/^(LI|DT|DD)$/.test(root.nodeName)){var firstChild=firstNonWhiteSpaceNodeSibling(root.firstChild);firstChild&&/^(UL|OL|DL)$/.test(firstChild.nodeName)&&root.insertBefore(dom.doc.createTextNode(""),root.firstChild)}if(rng=dom.createRng(),root.normalize(),root.hasChildNodes()){for(walker=new TreeWalker(root,root);node=walker.current();){if(3==node.nodeType){rng.setStart(node,0),rng.setEnd(node,0);break}if(moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]){rng.setStartBefore(node),rng.setEndBefore(node);break}lastNode=node,node=walker.next()}node||(rng.setStart(lastNode,0),rng.setEnd(lastNode,0))}else"BR"==root.nodeName?root.nextSibling&&dom.isBlock(root.nextSibling)?(rng.setStartBefore(root),rng.setEndBefore(root)):(rng.setStartAfter(root),rng.setEndAfter(root)):(rng.setStart(root,0),rng.setEnd(root,0));selection.setRng(rng),dom.remove(void 0),selection.scrollIntoView(root)}}function createNewBlock(name){var block,clonedNode,caretNode,node=container,textInlineElements=schema.getTextInlineElements();if(name||"TABLE"==parentBlockName||"HR"==parentBlockName?(block=dom.create(name||newBlockName),setForcedBlockAttrs(editor,block)):block=parentBlock.cloneNode(!1),caretNode=block,!1===settings.keep_styles)dom.setAttrib(block,"style",null),dom.setAttrib(block,"class",null);else do{if(textInlineElements[node.nodeName]){if("_mce_caret"==node.id)continue;clonedNode=node.cloneNode(!1),dom.setAttrib(clonedNode,"id",""),block.hasChildNodes()?(clonedNode.appendChild(block.firstChild),block.appendChild(clonedNode)):(caretNode=clonedNode,block.appendChild(clonedNode))}}while((node=node.parentNode)&&node!=editableRoot);return emptyBlock(caretNode),block}function isCaretAtStartOrEndOfBlock(start){var walker,node,name,normalizedOffset;if(normalizedOffset=normalizeZwspOffset(start,container,offset),3==container.nodeType&&(start?normalizedOffset>0:normalizedOffset<container.nodeValue.length))return!1;if(container.parentNode==parentBlock&&isAfterLastNodeInContainer&&!start)return!0;if(start&&1==container.nodeType&&container==parentBlock.firstChild)return!0;if(containerAndSiblingName(container,"TABLE")||containerAndSiblingName(container,"HR"))return isAfterLastNodeInContainer&&!start||!isAfterLastNodeInContainer&&start;for(walker=new TreeWalker(container,parentBlock),3==container.nodeType&&(start&&0===normalizedOffset?walker.prev():start||normalizedOffset!=container.nodeValue.length||walker.next());node=walker.current();){if(1===node.nodeType){if(!node.getAttribute("data-mce-bogus")&&(name=node.nodeName.toLowerCase(),nonEmptyElementsMap[name]&&"br"!==name))return!1}else if(3===node.nodeType&&!/^[ \t\r\n]*$/.test(node.nodeValue))return!1;start?walker.prev():walker.next()}return!0}function insertNewBlockAfter(){newBlock=/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName)&&"HGROUP"!=containerBlockName?createNewBlock(newBlockName):createNewBlock(),settings.end_container_on_empty_block&&canSplitBlock(dom,containerBlock)&&dom.isEmpty(parentBlock)?newBlock=dom.split(containerBlock,parentBlock):dom.insertAfter(newBlock,parentBlock),moveToCaretPosition(newBlock)}var tmpRng,editableRoot,container,offset,parentBlock,shiftKey,newBlock,fragment,containerBlock,parentBlockName,containerBlockName,newBlockName,isAfterLastNodeInContainer,dom=editor.dom,selection=editor.selection,settings=editor.settings,schema=editor.schema,nonEmptyElementsMap=schema.getNonEmptyElements(),rng=editor.selection.getRng();if(new RangeUtils(dom).normalize(rng),container=rng.startContainer,offset=rng.startOffset,newBlockName=(settings.force_p_newlines?"p":"")||settings.forced_root_block,newBlockName=newBlockName?newBlockName.toUpperCase():"",shiftKey=evt.shiftKey,1==container.nodeType&&container.hasChildNodes()&&(isAfterLastNodeInContainer=offset>container.childNodes.length-1,container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&3==container.nodeType?container.nodeValue.length:0),editableRoot=getEditableRoot(dom,container))if(dom.isBlock(editableRoot)||editableRoot==dom.getRoot()){if((newBlockName&&!shiftKey||!newBlockName&&shiftKey)&&(container=wrapSelfAndSiblingsInDefaultBlock(editor,newBlockName,rng,container,offset)),parentBlock=dom.getParent(container,dom.isBlock),containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null,parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():"","LI"!=(containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"")||evt.ctrlKey||(parentBlock=containerBlock,containerBlock=containerBlock.parentNode,parentBlockName=containerBlockName),/^(LI|DT|DD)$/.test(parentBlockName)){if(!newBlockName&&shiftKey)return void insertBr(editor,evt);if(dom.isEmpty(parentBlock))return void(containerBlock!=editor.getBody()&&(isNestedList(containerBlock)&&(newBlockName="LI"),newBlock=newBlockName?createNewBlock(newBlockName):dom.create("BR"),isFirstOrLastLi(containerBlock,parentBlock,!0)&&isFirstOrLastLi(containerBlock,parentBlock,!1)?hasParent(containerBlock,"LI")?dom.insertAfter(newBlock,getContainerBlock(containerBlock)):dom.replace(newBlock,containerBlock):isFirstOrLastLi(containerBlock,parentBlock,!0)?hasParent(containerBlock,"LI")?(dom.insertAfter(newBlock,getContainerBlock(containerBlock)),newBlock.appendChild(dom.doc.createTextNode(" ")),newBlock.appendChild(containerBlock)):containerBlock.parentNode.insertBefore(newBlock,containerBlock):isFirstOrLastLi(containerBlock,parentBlock,!1)?dom.insertAfter(newBlock,getContainerBlock(containerBlock)):(containerBlock=getContainerBlock(containerBlock),(tmpRng=rng.cloneRange()).setStartAfter(parentBlock),tmpRng.setEndAfter(containerBlock),fragment=tmpRng.extractContents(),"LI"===newBlockName&&hasFirstChild(fragment,"LI")?(newBlock=fragment.firstChild,dom.insertAfter(fragment,containerBlock)):(dom.insertAfter(fragment,containerBlock),dom.insertAfter(newBlock,containerBlock))),dom.remove(parentBlock),moveToCaretPosition(newBlock)))}if("PRE"==parentBlockName&&!1!==settings.br_in_pre){if(!shiftKey)return void insertBr(editor,evt)}else if(!newBlockName&&!shiftKey&&"LI"!=parentBlockName||newBlockName&&shiftKey)return void insertBr(editor,evt);newBlockName&&parentBlock===editor.getBody()||(newBlockName=newBlockName||"P",CaretContainer.isCaretContainerBlock(parentBlock)?(newBlock=CaretContainer.showCaretContainerBlock(parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),moveToCaretPosition(newBlock)):isCaretAtStartOrEndOfBlock()?insertNewBlockAfter():isCaretAtStartOrEndOfBlock(!0)?(newBlock=parentBlock.parentNode.insertBefore(createNewBlock(),parentBlock),moveToCaretPosition(containerAndSiblingName(parentBlock,"HR")?newBlock:parentBlock)):((tmpRng=includeZwspInRange(rng).cloneRange()).setEndAfter(parentBlock),fragment=tmpRng.extractContents(),trimLeadingLineBreaks(fragment),newBlock=fragment.firstChild,dom.insertAfter(fragment,parentBlock),trimInlineElementsOnLeftSideOfBlock(dom,nonEmptyElementsMap,newBlock),addBrToBlockIfNeeded(dom,parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),newBlock.normalize(),dom.isEmpty(newBlock)?(dom.remove(newBlock),insertNewBlockAfter()):moveToCaretPosition(newBlock)),dom.setAttrib(newBlock,"id",""),editor.fire("NewBlock",{newBlock:newBlock}))}else newBlockName&&!shiftKey||insertBr(editor,evt)}}}),define("tinymce.core.keyboard.EnterKey",["tinymce.core.keyboard.InsertNewLine","tinymce.core.util.VK"],function(InsertNewLine,VK){var endTypingLevel=function(undoManager){undoManager.typing&&(undoManager.typing=!1,undoManager.add())},handleEnterKeyEvent=function(editor,event){event.isDefaultPrevented()||(event.preventDefault(),endTypingLevel(editor.undoManager),editor.undoManager.transact(function(){!1===editor.selection.isCollapsed()&&editor.execCommand("Delete"),InsertNewLine.insert(editor,event)}))};return{setup:function(editor){editor.on("keydown",function(event){event.keyCode===VK.ENTER&&handleEnterKeyEvent(editor,event)})}}}),define("tinymce.core.keyboard.InsertSpace",["ephox.katamari.api.Fun","tinymce.core.caret.CaretPosition","tinymce.core.dom.NodeType","tinymce.core.keyboard.BoundaryLocation","tinymce.core.keyboard.InlineUtils"],function(Fun,CaretPosition,NodeType,BoundaryLocation,InlineUtils){var isValidInsertPoint=function(location,caretPosition){return isAtStartOrEnd(location)&&NodeType.isText(caretPosition.container())},insertNbspAtPosition=function(editor,caretPosition){var container=caretPosition.container(),offset=caretPosition.offset();container.insertData(offset,""),editor.selection.setCursorLocation(container,offset+1)},insertAtLocation=function(editor,caretPosition,location){return!!isValidInsertPoint(location,caretPosition)&&(insertNbspAtPosition(editor,caretPosition),!0)},insertAtCaret=function(editor){var isInlineTarget=Fun.curry(InlineUtils.isInlineTarget,editor),caretPosition=CaretPosition.fromRangeStart(editor.selection.getRng());return BoundaryLocation.readLocation(isInlineTarget,editor.getBody(),caretPosition).map(Fun.curry(insertAtLocation,editor,caretPosition)).getOr(!1)},isAtStartOrEnd=function(location){return location.fold(Fun.constant(!1),Fun.constant(!0),Fun.constant(!0),Fun.constant(!1))};return{insertAtSelection:function(editor){return!!editor.selection.isCollapsed()&&insertAtCaret(editor)}}}),define("tinymce.core.keyboard.SpaceKey",["tinymce.core.keyboard.InsertSpace","tinymce.core.keyboard.MatchKeys","tinymce.core.util.VK"],function(InsertSpace,MatchKeys,VK){var executeKeydownOverride=function(editor,evt){MatchKeys.execute([{keyCode:VK.SPACEBAR,action:MatchKeys.action(InsertSpace.insertAtSelection,editor)}],evt).each(function(_){evt.preventDefault()})};return{setup:function(editor){editor.on("keydown",function(evt){!1===evt.isDefaultPrevented()&&executeKeydownOverride(editor,evt)})}}}),define("tinymce.core.keyboard.KeyboardOverrides",["tinymce.core.keyboard.ArrowKeys","tinymce.core.keyboard.BoundarySelection","tinymce.core.keyboard.DeleteBackspaceKeys","tinymce.core.keyboard.EnterKey","tinymce.core.keyboard.SpaceKey"],function(ArrowKeys,BoundarySelection,DeleteBackspaceKeys,EnterKey,SpaceKey){return{setup:function(editor){var caret=BoundarySelection.setupSelectedState(editor);ArrowKeys.setup(editor,caret),DeleteBackspaceKeys.setup(editor,caret),EnterKey.setup(editor),SpaceKey.setup(editor)}}}),define("tinymce.core.NodeChange",["tinymce.core.dom.RangeUtils","tinymce.core.Env","tinymce.core.util.Delay"],function(RangeUtils,Env,Delay){return function(editor){function isSameElementPath(startElm){var i,currentPath;if((currentPath=editor.$(startElm).parentsUntil(editor.getBody()).add(startElm)).length===lastPath.length){for(i=currentPath.length;i>=0&&currentPath[i]===lastPath[i];i--);if(-1===i)return lastPath=currentPath,!0}return lastPath=currentPath,!1}var lastRng,lastPath=[];"onselectionchange"in editor.getDoc()||editor.on("NodeChange Click MouseUp KeyUp Focus",function(e){var nativeRng,fakeRng;fakeRng={startContainer:(nativeRng=editor.selection.getRng()).startContainer,startOffset:nativeRng.startOffset,endContainer:nativeRng.endContainer,endOffset:nativeRng.endOffset},"nodechange"!=e.type&&RangeUtils.compareRanges(fakeRng,lastRng)||editor.fire("SelectionChange"),lastRng=fakeRng}),editor.on("contextmenu",function(){editor.fire("SelectionChange")}),editor.on("SelectionChange",function(){var startElm=editor.selection.getStart(!0);!startElm||!Env.range&&editor.selection.isCollapsed()||!isSameElementPath(startElm)&&editor.dom.isChildOf(startElm,editor.getBody())&&editor.nodeChanged({selectionChange:!0})}),editor.on("MouseUp",function(e){e.isDefaultPrevented()||("IMG"==editor.selection.getNode().nodeName?Delay.setEditorTimeout(editor,function(){editor.nodeChanged()}):editor.nodeChanged())}),this.nodeChanged=function(args){var node,parents,root,selection=editor.selection;editor.initialized&&selection&&!editor.settings.disable_nodechange&&!editor.readonly&&(root=editor.getBody(),(node=selection.getStart(!0)||root).ownerDocument==editor.getDoc()&&editor.dom.isChildOf(node,root)||(node=root),parents=[],editor.dom.getParent(node,function(node){if(node===root)return!0;parents.push(node)}),(args=args||{}).element=node,args.parents=parents,editor.fire("NodeChange",args))}}}),define("tinymce.core.caret.FakeCaret",["tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretContainerRemove","tinymce.core.caret.CaretPosition","tinymce.core.dom.DomQuery","tinymce.core.dom.NodeType","tinymce.core.dom.RangeUtils","tinymce.core.geom.ClientRect","tinymce.core.util.Delay"],function(CaretContainer,CaretContainerRemove,CaretPosition,DomQuery,NodeType,RangeUtils,ClientRect,Delay){var isContentEditableFalse=NodeType.isContentEditableFalse,isTableCell=function(node){return node&&/^(TD|TH)$/i.test(node.nodeName)};return function(rootNode,isBlock){function getAbsoluteClientRect(node,before){var docElm,scrollX,scrollY,margin,rootRect,clientRect=ClientRect.collapse(node.getBoundingClientRect(),before);return"BODY"==rootNode.tagName?(docElm=rootNode.ownerDocument.documentElement,scrollX=rootNode.scrollLeft||docElm.scrollLeft,scrollY=rootNode.scrollTop||docElm.scrollTop):(rootRect=rootNode.getBoundingClientRect(),scrollX=rootNode.scrollLeft-rootRect.left,scrollY=rootNode.scrollTop-rootRect.top),clientRect.left+=scrollX,clientRect.right+=scrollX,clientRect.top+=scrollY,clientRect.bottom+=scrollY,clientRect.width=1,(margin=node.offsetWidth-node.clientWidth)>0&&(before&&(margin*=-1),clientRect.left+=margin,clientRect.right+=margin),clientRect}function trimInlineCaretContainers(){var contentEditableFalseNodes,node,sibling,i,data;for(contentEditableFalseNodes=DomQuery("*[contentEditable=false]",rootNode),i=0;i<contentEditableFalseNodes.length;i++)sibling=(node=contentEditableFalseNodes[i]).previousSibling,CaretContainer.endsWithCaretContainer(sibling)&&(1==(data=sibling.data).length?sibling.parentNode.removeChild(sibling):sibling.deleteData(data.length-1,1)),sibling=node.nextSibling,CaretContainer.startsWithCaretContainer(sibling)&&(1==(data=sibling.data).length?sibling.parentNode.removeChild(sibling):sibling.deleteData(0,1));return null}function hide(){trimInlineCaretContainers(),caretContainerNode&&(CaretContainerRemove.remove(caretContainerNode),caretContainerNode=null),$lastVisualCaret&&($lastVisualCaret.remove(),$lastVisualCaret=null),clearInterval(cursorInterval)}function startBlink(){cursorInterval=Delay.setInterval(function(){DomQuery("div.mce-visual-caret",rootNode).toggleClass("mce-visual-caret-hidden")},500)}var cursorInterval,$lastVisualCaret,caretContainerNode;return{show:function(before,node){var clientRect,rng;return hide(),isTableCell(node)?null:isBlock(node)?(caretContainerNode=CaretContainer.insertBlock("p",node,before),clientRect=getAbsoluteClientRect(node,before),DomQuery(caretContainerNode).css("top",clientRect.top),$lastVisualCaret=DomQuery('<div class="mce-visual-caret" data-mce-bogus="all"></div>').css(clientRect).appendTo(rootNode),before&&$lastVisualCaret.addClass("mce-visual-caret-before"),startBlink(),(rng=node.ownerDocument.createRange()).setStart(caretContainerNode,0),rng.setEnd(caretContainerNode,0),rng):(caretContainerNode=CaretContainer.insertInline(node,before),rng=node.ownerDocument.createRange(),isContentEditableFalse(caretContainerNode.nextSibling)?(rng.setStart(caretContainerNode,0),rng.setEnd(caretContainerNode,0)):(rng.setStart(caretContainerNode,1),rng.setEnd(caretContainerNode,1)),rng)},hide:hide,getCss:function(){return".mce-visual-caret {position: absolute;background-color: black;background-color: currentcolor;}.mce-visual-caret-hidden {display: none;}*[data-mce-caret] {position: absolute;left: -1000px;right: auto;top: 0;margin: 0;padding: 0;}"},destroy:function(){Delay.clearInterval(cursorInterval)}}}}),define("tinymce.core.dom.MousePosition",[],function(){var getAbsolutePosition=function(elm){var doc,docElem,win,clientRect;return clientRect=elm.getBoundingClientRect(),doc=elm.ownerDocument,docElem=doc.documentElement,win=doc.defaultView,{top:clientRect.top+win.pageYOffset-docElem.clientTop,left:clientRect.left+win.pageXOffset-docElem.clientLeft}},getBodyPosition=function(editor){return editor.inline?getAbsolutePosition(editor.getBody()):{left:0,top:0}},getScrollPosition=function(editor){var body=editor.getBody();return editor.inline?{left:body.scrollLeft,top:body.scrollTop}:{left:0,top:0}},getBodyScroll=function(editor){var body=editor.getBody(),docElm=editor.getDoc().documentElement,inlineScroll={left:body.scrollLeft,top:body.scrollTop},iframeScroll={left:body.scrollLeft||docElm.scrollLeft,top:body.scrollTop||docElm.scrollTop};return editor.inline?inlineScroll:iframeScroll},getMousePosition=function(editor,event){if(event.target.ownerDocument!==editor.getDoc()){var iframePosition=getAbsolutePosition(editor.getContentAreaContainer()),scrollPosition=getBodyScroll(editor);return{left:event.pageX-iframePosition.left+scrollPosition.left,top:event.pageY-iframePosition.top+scrollPosition.top}}return{left:event.pageX,top:event.pageY}},calculatePosition=function(bodyPosition,scrollPosition,mousePosition){return{pageX:mousePosition.left-bodyPosition.left+scrollPosition.left,pageY:mousePosition.top-bodyPosition.top+scrollPosition.top}};return{calc:function(editor,event){return calculatePosition(getBodyPosition(editor),getScrollPosition(editor),getMousePosition(editor,event))}}}),define("tinymce.core.DragDropOverrides",["tinymce.core.dom.NodeType","tinymce.core.util.Arr","tinymce.core.util.Fun","tinymce.core.util.Delay","tinymce.core.dom.DOMUtils","tinymce.core.dom.MousePosition"],function(NodeType,Arr,Fun,Delay,DOMUtils,MousePosition){var isContentEditableFalse=NodeType.isContentEditableFalse,isContentEditableTrue=NodeType.isContentEditableTrue,isDraggable=function(rootElm,elm){return isContentEditableFalse(elm)&&elm!==rootElm},isValidDropTarget=function(editor,targetElement,dragElement){return targetElement!==dragElement&&!editor.dom.isChildOf(targetElement,dragElement)&&!isContentEditableFalse(targetElement)},cloneElement=function(elm){var cloneElm=elm.cloneNode(!0);return cloneElm.removeAttribute("data-mce-selected"),cloneElm},createGhost=function(editor,elm,width,height){var clonedElm=elm.cloneNode(!0);editor.dom.setStyles(clonedElm,{width:width,height:height}),editor.dom.setAttrib(clonedElm,"data-mce-selected",null);var ghostElm=editor.dom.create("div",{class:"mce-drag-container","data-mce-bogus":"all",unselectable:"on",contenteditable:"false"});return editor.dom.setStyles(ghostElm,{position:"absolute",opacity:.5,overflow:"hidden",border:0,padding:0,margin:0,width:width,height:height}),editor.dom.setStyles(clonedElm,{margin:0,boxSizing:"border-box"}),ghostElm.appendChild(clonedElm),ghostElm},appendGhostToBody=function(ghostElm,bodyElm){ghostElm.parentNode!==bodyElm&&bodyElm.appendChild(ghostElm)},moveGhost=function(ghostElm,position,width,height,maxX,maxY){var overflowX=0,overflowY=0;ghostElm.style.left=position.pageX+"px",ghostElm.style.top=position.pageY+"px",position.pageX+width>maxX&&(overflowX=position.pageX+width-maxX),position.pageY+height>maxY&&(overflowY=position.pageY+height-maxY),ghostElm.style.width=width-overflowX+"px",ghostElm.style.height=height-overflowY+"px"},removeElement=function(elm){elm&&elm.parentNode&&elm.parentNode.removeChild(elm)},isLeftMouseButtonPressed=function(e){return 0===e.button},hasDraggableElement=function(state){return state.element},applyRelPos=function(state,position){return{pageX:position.pageX-state.relX,pageY:position.pageY+5}},start=function(state,editor){return function(e){if(isLeftMouseButtonPressed(e)){var ceElm=Arr.find(editor.dom.getParents(e.target),Fun.or(isContentEditableFalse,isContentEditableTrue));if(isDraggable(editor.getBody(),ceElm)){var elmPos=editor.dom.getPos(ceElm),bodyElm=editor.getBody(),docElm=editor.getDoc().documentElement;state.element=ceElm,state.screenX=e.screenX,state.screenY=e.screenY,state.maxX=(editor.inline?bodyElm.scrollWidth:docElm.offsetWidth)-2,state.maxY=(editor.inline?bodyElm.scrollHeight:docElm.offsetHeight)-2,state.relX=e.pageX-elmPos.x,state.relY=e.pageY-elmPos.y,state.width=ceElm.offsetWidth,state.height=ceElm.offsetHeight,state.ghost=createGhost(editor,ceElm,state.width,state.height)}}}},move=function(state,editor){var throttledPlaceCaretAt=Delay.throttle(function(clientX,clientY){editor._selectionOverrides.hideFakeCaret(),editor.selection.placeCaretAt(clientX,clientY)},0);return function(e){var movement=Math.max(Math.abs(e.screenX-state.screenX),Math.abs(e.screenY-state.screenY));if(hasDraggableElement(state)&&!state.dragging&&movement>10){if(editor.fire("dragstart",{target:state.element}).isDefaultPrevented())return;state.dragging=!0,editor.focus()}if(state.dragging){var targetPos=applyRelPos(state,MousePosition.calc(editor,e));appendGhostToBody(state.ghost,editor.getBody()),moveGhost(state.ghost,targetPos,state.width,state.height,state.maxX,state.maxY),throttledPlaceCaretAt(e.clientX,e.clientY)}}},getRawTarget=function(selection){var startContainer=selection.getSel().getRangeAt(0).startContainer;return 3===startContainer.nodeType?startContainer.parentNode:startContainer},drop=function(state,editor){return function(e){if(state.dragging&&isValidDropTarget(editor,getRawTarget(editor.selection),state.element)){var targetClone=cloneElement(state.element),args=editor.fire("drop",{targetClone:targetClone,clientX:e.clientX,clientY:e.clientY});args.isDefaultPrevented()||(targetClone=args.targetClone,editor.undoManager.transact(function(){removeElement(state.element),editor.insertContent(editor.dom.getOuterHTML(targetClone)),editor._selectionOverrides.hideFakeCaret()}))}removeDragState(state)}},stop=function(state,editor){return function(){removeDragState(state),state.dragging&&editor.fire("dragend")}},removeDragState=function(state){state.dragging=!1,state.element=null,removeElement(state.ghost)},bindFakeDragEvents=function(editor){var pageDom,dragStartHandler,dragHandler,dropHandler,dragEndHandler,rootDocument,state={};pageDom=DOMUtils.DOM,rootDocument=document,dragStartHandler=start(state,editor),dragHandler=move(state,editor),dropHandler=drop(state,editor),dragEndHandler=stop(state,editor),editor.on("mousedown",dragStartHandler),editor.on("mousemove",dragHandler),editor.on("mouseup",dropHandler),pageDom.bind(rootDocument,"mousemove",dragHandler),pageDom.bind(rootDocument,"mouseup",dragEndHandler),editor.on("remove",function(){pageDom.unbind(rootDocument,"mousemove",dragHandler),pageDom.unbind(rootDocument,"mouseup",dragEndHandler)})},blockIeDrop=function(editor){editor.on("drop",function(e){var realTarget=void 0!==e.clientX?editor.getDoc().elementFromPoint(e.clientX,e.clientY):null;(isContentEditableFalse(realTarget)||isContentEditableFalse(editor.dom.getContentEditableParent(realTarget)))&&e.preventDefault()})};return{init:function(editor){bindFakeDragEvents(editor),blockIeDrop(editor)}}}),define("tinymce.core.SelectionOverrides",["ephox.katamari.api.Arr","ephox.sugar.api.dom.Remove","ephox.sugar.api.node.Element","ephox.sugar.api.properties.Attr","ephox.sugar.api.search.SelectorFilter","ephox.sugar.api.search.SelectorFind","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.caret.CaretWalker","tinymce.core.caret.FakeCaret","tinymce.core.caret.LineUtils","tinymce.core.dom.NodeType","tinymce.core.dom.RangePoint","tinymce.core.DragDropOverrides","tinymce.core.EditorView","tinymce.core.Env","tinymce.core.keyboard.CefUtils","tinymce.core.util.Delay","tinymce.core.util.VK"],function(Arr,Remove,Element,Attr,SelectorFilter,SelectorFind,CaretContainer,CaretPosition,CaretUtils,CaretWalker,FakeCaret,LineUtils,NodeType,RangePoint,DragDropOverrides,EditorView,Env,CefUtils,Delay,VK){var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isAfterContentEditableFalse=CaretUtils.isAfterContentEditableFalse,isBeforeContentEditableFalse=CaretUtils.isBeforeContentEditableFalse;return function(editor){function isFakeSelectionElement(elm){return editor.dom.hasClass(elm,"mce-offscreen-selection")}function getRealSelectionElement(){var container=editor.dom.get(realSelectionId);return container?container.getElementsByTagName("*")[0]:container}function setRange(range){range&&editor.selection.setRng(range)}function getRange(){return editor.selection.getRng()}function scrollIntoView(node,alignToTop){editor.selection.scrollIntoView(node,alignToTop)}function showCaret(direction,node,before){return editor.fire("ShowCaret",{target:node,direction:direction,before:before}).isDefaultPrevented()?null:(scrollIntoView(node,-1===direction),fakeCaret.show(before,node))}function getNormalizedRangeEndPoint(direction,range){return range=CaretUtils.normalizeRange(direction,rootNode,range),-1==direction?CaretPosition.fromRangeStart(range):CaretPosition.fromRangeEnd(range)}function isWithinCaretContainer(node){return CaretContainer.isCaretContainer(node)||CaretContainer.startsWithCaretContainer(node)||CaretContainer.endsWithCaretContainer(node)}function isRangeInCaretContainer(rng){return isWithinCaretContainer(rng.startContainer)||isWithinCaretContainer(rng.endContainer)}function setContentEditableSelection(range,forward){var node,$realSelectionContainer,sel,startContainer,startOffset,endOffset,e,caretPosition,targetClone,origTargetClone,$=editor.$,dom=editor.dom;if(!range)return null;if(range.collapsed){if(!isRangeInCaretContainer(range))if(!1===forward){if(caretPosition=getNormalizedRangeEndPoint(-1,range),isContentEditableFalse(caretPosition.getNode(!0)))return showCaret(-1,caretPosition.getNode(!0),!1);if(isContentEditableFalse(caretPosition.getNode()))return showCaret(-1,caretPosition.getNode(),!caretPosition.isAtEnd())}else{if(caretPosition=getNormalizedRangeEndPoint(1,range),isContentEditableFalse(caretPosition.getNode()))return showCaret(1,caretPosition.getNode(),!caretPosition.isAtEnd());if(isContentEditableFalse(caretPosition.getNode(!0)))return showCaret(1,caretPosition.getNode(!0),!1)}return null}return startContainer=range.startContainer,startOffset=range.startOffset,endOffset=range.endOffset,3==startContainer.nodeType&&0==startOffset&&isContentEditableFalse(startContainer.parentNode)&&(startContainer=startContainer.parentNode,startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode),1!=startContainer.nodeType?null:(endOffset==startOffset+1&&(node=startContainer.childNodes[startOffset]),isContentEditableFalse(node)?(targetClone=origTargetClone=node.cloneNode(!0),(e=editor.fire("ObjectSelected",{target:node,targetClone:targetClone})).isDefaultPrevented()?null:($realSelectionContainer=SelectorFind.descendant(Element.fromDom(editor.getBody()),"#"+realSelectionId).fold(function(){return $([])},function(elm){return $([elm.dom()])}),targetClone=e.targetClone,0===$realSelectionContainer.length&&($realSelectionContainer=$('<div data-mce-bogus="all" class="mce-offscreen-selection"></div>').attr("id",realSelectionId)).appendTo(editor.getBody()),range=editor.dom.createRng(),targetClone===origTargetClone&&Env.ie?($realSelectionContainer.empty().append('<p style="font-size: 0" data-mce-bogus="all"></p>').append(targetClone),range.setStartAfter($realSelectionContainer[0].firstChild.firstChild),range.setEndAfter(targetClone)):($realSelectionContainer.empty().append("").append(targetClone).append(""),range.setStart($realSelectionContainer[0].firstChild,1),range.setEnd($realSelectionContainer[0].lastChild,0)),$realSelectionContainer.css({top:dom.getPos(node,editor.getBody()).y}),$realSelectionContainer[0].focus(),(sel=editor.selection.getSel()).removeAllRanges(),sel.addRange(range),Arr.each(SelectorFilter.descendants(Element.fromDom(editor.getBody()),"*[data-mce-selected]"),function(elm){Attr.remove(elm,"data-mce-selected")}),node.setAttribute("data-mce-selected",1),selectedContentEditableNode=node,hideFakeCaret(),range)):null)}function removeContentEditableSelection(){selectedContentEditableNode&&(selectedContentEditableNode.removeAttribute("data-mce-selected"),SelectorFind.descendant(Element.fromDom(editor.getBody()),"#"+realSelectionId).each(Remove.remove),selectedContentEditableNode=null)}function hideFakeCaret(){fakeCaret.hide()}var selectedContentEditableNode,rootNode=editor.getBody(),fakeCaret=new FakeCaret(editor.getBody(),function(node){return editor.dom.isBlock(node)}),realSelectionId="sel-"+editor.dom.uniqueId();return Env.ceFalse&&(function(){function getContentEditableRoot(node){for(var root=editor.getBody();node&&node!=root;){if(isContentEditableTrue(node)||isContentEditableFalse(node))return node;node=node.parentNode}return null}editor.on("mouseup",function(e){var range=getRange();range.collapsed&&EditorView.isXYInContentArea(editor,e.clientX,e.clientY)&&setRange(CefUtils.renderCaretAtRange(editor,range))}),editor.on("click",function(e){var contentEditableRoot;(contentEditableRoot=getContentEditableRoot(e.target))&&(isContentEditableFalse(contentEditableRoot)&&(e.preventDefault(),editor.focus()),isContentEditableTrue(contentEditableRoot)&&editor.dom.isChildOf(contentEditableRoot,editor.selection.getNode())&&removeContentEditableSelection())}),editor.on("blur NewBlock",function(){removeContentEditableSelection(),hideFakeCaret()});var hasNormalCaretPosition=function(elm){var caretWalker=new CaretWalker(elm);if(!elm.firstChild)return!1;var startPos=CaretPosition.before(elm.firstChild),newPos=caretWalker.next(startPos);return newPos&&!isBeforeContentEditableFalse(newPos)&&!isAfterContentEditableFalse(newPos)},isInSameBlock=function(node1,node2){return editor.dom.getParent(node1,editor.dom.isBlock)===editor.dom.getParent(node2,editor.dom.isBlock)},hasBetterMouseTarget=function(targetNode,caretNode){var targetBlock=editor.dom.getParent(targetNode,editor.dom.isBlock),caretBlock=editor.dom.getParent(caretNode,editor.dom.isBlock);return targetBlock&&!isInSameBlock(targetBlock,caretBlock)&&hasNormalCaretPosition(targetBlock)};!function(editor){var moved=!1;editor.on("touchstart",function(){moved=!1}),editor.on("touchmove",function(){moved=!0}),editor.on("touchend",function(e){var contentEditableRoot=getContentEditableRoot(e.target);isContentEditableFalse(contentEditableRoot)&&(moved||(e.preventDefault(),setContentEditableSelection(CefUtils.selectNode(editor,contentEditableRoot))))})}(editor),editor.on("mousedown",function(e){var contentEditableRoot;if(!1!==EditorView.isXYInContentArea(editor,e.clientX,e.clientY))if(contentEditableRoot=getContentEditableRoot(e.target))isContentEditableFalse(contentEditableRoot)?(e.preventDefault(),setContentEditableSelection(CefUtils.selectNode(editor,contentEditableRoot))):(removeContentEditableSelection(),isContentEditableTrue(contentEditableRoot)&&e.shiftKey||RangePoint.isXYWithinRange(e.clientX,e.clientY,editor.selection.getRng())||editor.selection.placeCaretAt(e.clientX,e.clientY));else{removeContentEditableSelection(),hideFakeCaret();var caretInfo=LineUtils.closestCaret(rootNode,e.clientX,e.clientY);caretInfo&&(hasBetterMouseTarget(e.target,caretInfo.node)||(e.preventDefault(),editor.getBody().focus(),setRange(showCaret(1,caretInfo.node,caretInfo.before))))}}),editor.on("keypress",function(e){VK.modifierPressed(e)||(e.keyCode,isContentEditableFalse(editor.selection.getNode())&&e.preventDefault())}),editor.on("getSelectionRange",function(e){var rng=e.range;if(selectedContentEditableNode){if(!selectedContentEditableNode.parentNode)return void(selectedContentEditableNode=null);(rng=rng.cloneRange()).selectNode(selectedContentEditableNode),e.range=rng}}),editor.on("setSelectionRange",function(e){var rng;(rng=setContentEditableSelection(e.range,e.forward))&&(e.range=rng)}),editor.on("AfterSetSelectionRange",function(e){var rng=e.range;isRangeInCaretContainer(rng)||hideFakeCaret(),isFakeSelectionElement(rng.startContainer.parentNode)||removeContentEditableSelection()}),editor.on("focus",function(){Delay.setEditorTimeout(editor,function(){editor.selection.setRng(CefUtils.renderRangeCaret(editor,editor.selection.getRng()))},0)}),editor.on("copy",function(e){var clipboardData=e.clipboardData;if(!e.isDefaultPrevented()&&e.clipboardData&&!Env.ie){var realSelectionElement=getRealSelectionElement();realSelectionElement&&(e.preventDefault(),clipboardData.clearData(),clipboardData.setData("text/html",realSelectionElement.outerHTML),clipboardData.setData("text/plain",realSelectionElement.outerText))}}),DragDropOverrides.init(editor)}(),function(){var styles=editor.contentStyles;styles.push(fakeCaret.getCss()),styles.push(".mce-content-body .mce-offscreen-selection {position: absolute;left: -9999999999px;max-width: 1000000px;}.mce-content-body *[contentEditable=false] {cursor: default;}.mce-content-body *[contentEditable=true] {cursor: text;}")}()),{showCaret:showCaret,showBlockCaretContainer:function(blockCaretContainer){blockCaretContainer.hasAttribute("data-mce-caret")&&(CaretContainer.showCaretContainerBlock(blockCaretContainer),setRange(getRange()),scrollIntoView(blockCaretContainer[0]))},hideFakeCaret:hideFakeCaret,destroy:function(){fakeCaret.destroy(),selectedContentEditableNode=null}}}}),define("tinymce.core.dom.NodePath",["tinymce.core.dom.DOMUtils"],function(DOMUtils){return{create:function(rootNode,targetNode,normalized){for(var path=[];targetNode&&targetNode!=rootNode;targetNode=targetNode.parentNode)path.push(DOMUtils.nodeIndex(targetNode,normalized));return path},resolve:function(rootNode,path){var i,node,children;for(node=rootNode,i=path.length-1;i>=0;i--){if(children=node.childNodes,path[i]>children.length-1)return null;node=children[path[i]]}return node}}}),define("tinymce.core.util.Quirks",["tinymce.core.util.VK","tinymce.core.dom.RangeUtils","tinymce.core.dom.TreeWalker","tinymce.core.dom.NodePath","tinymce.core.html.Node","tinymce.core.html.Entities","tinymce.core.Env","tinymce.core.util.Tools","tinymce.core.util.Delay","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretWalker"],function(VK,RangeUtils,TreeWalker,NodePath,Node,Entities,Env,Tools,Delay,CaretContainer,CaretPosition,CaretWalker){return function(editor){function setEditorCommandState(cmd,state){try{editor.getDoc().execCommand(cmd,!1,state)}catch(ex){}}function getDocumentMode(){var documentMode=editor.getDoc().documentMode;return documentMode||6}function isDefaultPrevented(e){return e.isDefaultPrevented()}function setMceInternalContent(e){var selectionHtml,internalContent;e.dataTransfer&&(editor.selection.isCollapsed()&&"IMG"==e.target.tagName&&selection.select(e.target),(selectionHtml=editor.selection.getContent()).length>0&&(internalContent=mceInternalUrlPrefix+escape(editor.id)+","+escape(selectionHtml),e.dataTransfer.setData(mceInternalDataType,internalContent)))}function getMceInternalContent(e){var internalContent;return e.dataTransfer&&(internalContent=e.dataTransfer.getData(mceInternalDataType))&&internalContent.indexOf(mceInternalUrlPrefix)>=0?(internalContent=internalContent.substr(mceInternalUrlPrefix.length).split(","),{id:unescape(internalContent[0]),html:unescape(internalContent[1])}):null}function insertClipboardContents(content,internal){editor.queryCommandSupported("mceInsertClipboardContent")?editor.execCommand("mceInsertClipboardContent",!1,{content:content,internal:internal}):editor.execCommand("mceInsertContent",!1,content)}function selectAll(){editor.shortcuts.add("meta+a",null,"SelectAll")}function removeHrOnBackspace(){editor.on("keydown",function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(!editor.getBody().getElementsByTagName("hr").length)return;if(selection.isCollapsed()&&0===selection.getRng(!0).startOffset){var node=selection.getNode(),previousSibling=node.previousSibling;if("HR"==node.nodeName)return dom.remove(node),void e.preventDefault();previousSibling&&previousSibling.nodeName&&"hr"===previousSibling.nodeName.toLowerCase()&&(dom.remove(previousSibling),e.preventDefault())}}})}function disableBackspaceIntoATable(){editor.on("keydown",function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE&&selection.isCollapsed()&&0===selection.getRng(!0).startOffset){var previousSibling=selection.getNode().previousSibling;if(previousSibling&&previousSibling.nodeName&&"table"===previousSibling.nodeName.toLowerCase())return e.preventDefault(),!1}})}function bodyHeight(){editor.inline||(editor.contentStyles.push("body {min-height: 150px}"),editor.on("click",function(e){var rng;if("HTML"==e.target.nodeName){if(Env.ie>11)return void editor.getBody().focus();rng=editor.selection.getRng(),editor.getBody().focus(),editor.selection.setRng(rng),editor.selection.normalize(),editor.nodeChanged()}}))}function refreshContentEditable(){}var each=Tools.each,BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE,dom=editor.dom,selection=editor.selection,settings=editor.settings,parser=editor.parser,serializer=editor.serializer,isGecko=Env.gecko,isIE=Env.ie,isWebKit=Env.webkit,mceInternalUrlPrefix="data:text/mce-internal,",mceInternalDataType=isIE?"Text":"URL";return editor.on("keydown",function(e){var rng,container,offset,root,parent;if(!isDefaultPrevented(e)&&e.keyCode==VK.BACKSPACE&&(rng=selection.getRng(),container=rng.startContainer,offset=rng.startOffset,root=dom.getRoot(),parent=container,rng.collapsed&&0===offset)){for(;parent&&parent.parentNode&&parent.parentNode.firstChild==parent&&parent.parentNode!=root;)parent=parent.parentNode;"BLOCKQUOTE"===parent.tagName&&(editor.formatter.toggle("blockquote",null,parent),(rng=dom.createRng()).setStart(container,0),rng.setEnd(container,0),selection.setRng(rng))}}),function(){function serializeRng(rng){var body=dom.create("body"),contents=rng.cloneContents();return body.appendChild(contents),selection.serializer.serialize(body,{format:"html"})}function allContentsSelected(rng){if(!rng.setStart){if(rng.item)return!1;var bodyRng=rng.duplicate();return bodyRng.moveToElementText(editor.getBody()),RangeUtils.compareRanges(rng,bodyRng)}var selection=serializeRng(rng),allRng=dom.createRng();return allRng.selectNode(editor.getBody()),selection===serializeRng(allRng)}editor.on("keydown",function(e){var isCollapsed,body,keyCode=e.keyCode;if(!isDefaultPrevented(e)&&(keyCode==DELETE||keyCode==BACKSPACE)){if(isCollapsed=editor.selection.isCollapsed(),body=editor.getBody(),isCollapsed&&!dom.isEmpty(body))return;if(!isCollapsed&&!allContentsSelected(editor.selection.getRng()))return;e.preventDefault(),editor.setContent(""),body.firstChild&&dom.isBlock(body.firstChild)?editor.selection.setCursorLocation(body.firstChild,0):editor.selection.setCursorLocation(body,0),editor.nodeChanged()}})}(),Env.windowsPhone||editor.on("keyup focusin mouseup",function(e){65==e.keyCode&&VK.metaKeyPressed(e)||("keyup"!==e.type||editor.selection.isCollapsed())&&selection.normalize()},!0),isWebKit&&(editor.settings.content_editable||dom.bind(editor.getDoc(),"mousedown mouseup",function(e){var rng;if(e.target==editor.getDoc().documentElement)if(rng=selection.getRng(),editor.getBody().focus(),"mousedown"==e.type){if(CaretContainer.isCaretContainer(rng.startContainer))return;selection.placeCaretAt(e.clientX,e.clientY)}else selection.setRng(rng)}),editor.on("click",function(e){var target=e.target;/^(IMG|HR)$/.test(target.nodeName)&&"false"!==dom.getContentEditableParent(target)&&(e.preventDefault(),editor.selection.select(target),editor.nodeChanged()),"A"==target.nodeName&&dom.hasClass(target,"mce-item-anchor")&&(e.preventDefault(),selection.select(target))}),settings.forced_root_block&&editor.on("init",function(){setEditorCommandState("DefaultParagraphSeparator",settings.forced_root_block)}),editor.on("init",function(){editor.dom.bind(editor.getBody(),"submit",function(e){e.preventDefault()})}),disableBackspaceIntoATable(),parser.addNodeFilter("br",function(nodes){for(var i=nodes.length;i--;)"Apple-interchange-newline"==nodes[i].attr("class")&&nodes[i].remove()}),Env.iOS?(editor.inline||editor.on("keydown",function(){document.activeElement==document.body&&editor.getWin().focus()}),bodyHeight(),editor.on("click",function(e){var elm=e.target;do{if("A"===elm.tagName)return void e.preventDefault()}while(elm=elm.parentNode)}),editor.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}")):selectAll()),isIE&&Env.ie<11&&(removeHrOnBackspace(),document.body.setAttribute("role","application"),getDocumentMode()>7||(setEditorCommandState("RespectVisibilityInDesign",!0),editor.contentStyles.push(".mceHideBrInPre pre br {display: none}"),dom.addClass(editor.getBody(),"mceHideBrInPre"),parser.addNodeFilter("pre",function(nodes){for(var brNodes,j,brElm,sibling,i=nodes.length;i--;)for(j=(brNodes=nodes[i].getAll("br")).length;j--;)(sibling=(brElm=brNodes[j]).prev)&&3===sibling.type&&"\n"!=sibling.value.charAt(sibling.value-1)?sibling.value+="\n":brElm.parent.insert(new Node("#text",3),brElm,!0).value="\n"}),serializer.addNodeFilter("pre",function(nodes){for(var brNodes,j,sibling,i=nodes.length;i--;)for(j=(brNodes=nodes[i].getAll("br")).length;j--;)(sibling=brNodes[j].prev)&&3==sibling.type&&(sibling.value=sibling.value.replace(/\r?\n$/,""))})),dom.bind(editor.getBody(),"mouseup",function(){var value,node=selection.getNode();"IMG"==node.nodeName&&((value=dom.getStyle(node,"width"))&&(dom.setAttrib(node,"width",value.replace(/[^0-9%]+/g,"")),dom.setStyle(node,"width","")),(value=dom.getStyle(node,"height"))&&(dom.setAttrib(node,"height",value.replace(/[^0-9%]+/g,"")),dom.setStyle(node,"height","")))}),editor.on("keydown",function(e){var rng;isDefaultPrevented(e)||e.keyCode!=BACKSPACE||(rng=editor.getDoc().selection.createRange())&&rng.item&&(e.preventDefault(),editor.undoManager.beforeChange(),dom.remove(rng.item(0)),editor.undoManager.add())}),function(){var emptyBlocksCSS;getDocumentMode()>=10&&(emptyBlocksCSS="",each("p div h1 h2 h3 h4 h5 h6".split(" "),function(name,i){emptyBlocksCSS+=(i>0?",":"")+name+":empty"}),editor.contentStyles.push(emptyBlocksCSS+"{padding-right: 1px !important}"))}(),getDocumentMode()<9&&(parser.addNodeFilter("noscript",function(nodes){for(var node,textNode,i=nodes.length;i--;)(textNode=(node=nodes[i]).firstChild)&&node.attr("data-mce-innertext",textNode.value)}),serializer.addNodeFilter("noscript",function(nodes){for(var node,textNode,value,i=nodes.length;i--;)node=nodes[i],(textNode=nodes[i].firstChild)?textNode.value=Entities.decode(textNode.value):(value=node.attributes.map["data-mce-innertext"])&&(node.attr("data-mce-innertext",null),(textNode=new Node("#text",3)).value=value,textNode.raw=!0,node.append(textNode))})),function(){function rngFromPoint(x,y){var rng=body.createTextRange();try{rng.moveToPoint(x,y)}catch(ex){rng=null}return rng}function selectionChange(e){var pointRng;e.button?(pointRng=rngFromPoint(e.x,e.y))&&(pointRng.compareEndPoints("StartToStart",startRng)>0?pointRng.setEndPoint("StartToStart",startRng):pointRng.setEndPoint("EndToEnd",startRng),pointRng.select()):endSelection()}function endSelection(){var rng=doc.selection.createRange();startRng&&!rng.item&&0===rng.compareEndPoints("StartToEnd",rng)&&startRng.select(),dom.unbind(doc,"mouseup",endSelection),dom.unbind(doc,"mousemove",selectionChange),startRng=started=0}var started,startRng,htmlElm,doc=dom.doc,body=doc.body;doc.documentElement.unselectable=!0,dom.bind(doc,"mousedown contextmenu",function(e){if("HTML"===e.target.nodeName){if(started&&endSelection(),(htmlElm=doc.documentElement).scrollHeight>htmlElm.clientHeight)return;started=1,(startRng=rngFromPoint(e.x,e.y))&&(dom.bind(doc,"mouseup",endSelection),dom.bind(doc,"mousemove",selectionChange),dom.getRoot().focus(),startRng.select())}})}()),Env.ie>=11&&(bodyHeight(),disableBackspaceIntoATable()),Env.ie&&(selectAll(),setEditorCommandState("AutoUrlDetect",!1),editor.on("dragstart",function(e){setMceInternalContent(e)}),editor.on("drop",function(e){if(!isDefaultPrevented(e)){var internalContent=getMceInternalContent(e);if(internalContent&&internalContent.id!=editor.id){e.preventDefault();var rng=RangeUtils.getCaretRangeFromPoint(e.x,e.y,editor.getDoc());selection.setRng(rng),insertClipboardContents(internalContent.html,!0)}}})),isGecko&&(removeHrOnBackspace(),window.Range.prototype.getClientRects||editor.on("mousedown",function(e){if(!isDefaultPrevented(e)&&"HTML"===e.target.nodeName){var body=editor.getBody();body.blur(),Delay.setEditorTimeout(editor,function(){body.focus()})}}),function(){function getAttributeApplyFunction(){var template=dom.getAttribs(selection.getStart().cloneNode(!1));return function(){var target=selection.getStart();target!==editor.getBody()&&(dom.setAttrib(target,"style",null),each(template,function(attr){target.setAttributeNode(attr.cloneNode(!0))}))}}function isSelectionAcrossElements(){return!selection.isCollapsed()&&dom.getParent(selection.getStart(),dom.isBlock)!=dom.getParent(selection.getEnd(),dom.isBlock)}editor.on("keypress",function(e){var applyAttributes;if(!isDefaultPrevented(e)&&(8==e.keyCode||46==e.keyCode)&&isSelectionAcrossElements())return applyAttributes=getAttributeApplyFunction(),editor.getDoc().execCommand("delete",!1,null),applyAttributes(),e.preventDefault(),!1}),dom.bind(editor.getDoc(),"cut",function(e){var applyAttributes;!isDefaultPrevented(e)&&isSelectionAcrossElements()&&(applyAttributes=getAttributeApplyFunction(),Delay.setEditorTimeout(editor,function(){applyAttributes()}))})}(),function(){settings.readonly||editor.on("BeforeExecCommand MouseDown",function(){refreshContentEditable(),setEditorCommandState("StyleWithCSS",!1),setEditorCommandState("enableInlineTableEditing",!1),settings.object_resizing||setEditorCommandState("enableObjectResizing",!1)})}(),function(){function fixLinks(){each(dom.select("a"),function(node){var parentNode=node.parentNode,root=dom.getRoot();if(parentNode.lastChild===node){for(;parentNode&&!dom.isBlock(parentNode);){if(parentNode.parentNode.lastChild!==parentNode||parentNode===root)return;parentNode=parentNode.parentNode}dom.add(parentNode,"br",{"data-mce-bogus":1})}})}editor.on("SetContent ExecCommand",function(e){"setcontent"!=e.type&&"mceInsertLink"!==e.command||fixLinks()})}(),editor.contentStyles.push("img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}"),Env.mac&&editor.on("keydown",function(e){!VK.metaKeyPressed(e)||e.shiftKey||37!=e.keyCode&&39!=e.keyCode||(e.preventDefault(),editor.selection.getSel().modify("move",37==e.keyCode?"backward":"forward","lineboundary"))}),disableBackspaceIntoATable()),{refreshContentEditable:refreshContentEditable,isHidden:function(){var sel;return!isGecko||editor.removed?0:!(sel=editor.selection.getSel())||!sel.rangeCount||0===sel.rangeCount}}}}),define("tinymce.core.init.InitContentBody",["ephox.sugar.api.dom.Insert","ephox.sugar.api.node.Element","ephox.sugar.api.properties.Attr","global!document","global!window","tinymce.core.api.Formatter","tinymce.core.caret.CaretContainerInput","tinymce.core.dom.DOMUtils","tinymce.core.dom.Selection","tinymce.core.dom.Serializer","tinymce.core.EditorUpload","tinymce.core.ErrorReporter","tinymce.core.ForceBlocks","tinymce.core.html.DomParser","tinymce.core.html.Node","tinymce.core.html.Schema","tinymce.core.keyboard.KeyboardOverrides","tinymce.core.NodeChange","tinymce.core.SelectionOverrides","tinymce.core.UndoManager","tinymce.core.util.Delay","tinymce.core.util.Quirks","tinymce.core.util.Tools"],function(Insert,Element,Attr,document,window,Formatter,CaretContainerInput,DOMUtils,Selection,Serializer,EditorUpload,ErrorReporter,ForceBlocks,DomParser,Node,Schema,KeyboardOverrides,NodeChange,SelectionOverrides,UndoManager,Delay,Quirks,Tools){var DOM=DOMUtils.DOM,appendStyle=function(editor,text){var head=Element.fromDom(editor.getDoc().head),tag=Element.fromTag("style");Attr.set(tag,"type","text/css"),Insert.append(tag,Element.fromText(text)),Insert.append(head,tag)},createParser=function(editor){var parser=new DomParser(editor.settings,editor.schema);return parser.addAttributeFilter("src,href,style,tabindex",function(nodes,name){for(var node,value,internalName,i=nodes.length,dom=editor.dom;i--;)if(node=nodes[i],value=node.attr(name),internalName="data-mce-"+name,!node.attributes.map[internalName]){if(0===value.indexOf("data:")||0===value.indexOf("blob:"))continue;"style"===name?((value=dom.serializeStyle(dom.parseStyle(value),node.name)).length||(value=null),node.attr(internalName,value),node.attr(name,value)):"tabindex"===name?(node.attr(internalName,value),node.attr(name,null)):node.attr(internalName,editor.convertURL(value,name,node.name))}}),parser.addNodeFilter("script",function(nodes){for(var node,type,i=nodes.length;i--;)0!==(type=(node=nodes[i]).attr("type")||"no/type").indexOf("mce-")&&node.attr("type","mce-"+type)}),parser.addNodeFilter("#cdata",function(nodes){for(var node,i=nodes.length;i--;)(node=nodes[i]).type=8,node.name="#comment",node.value="[CDATA["+node.value+"]]"}),parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",function(nodes){for(var node,i=nodes.length,nonEmptyElements=editor.schema.getNonEmptyElements();i--;)(node=nodes[i]).isEmpty(nonEmptyElements)&&0===node.getAll("br").length&&(node.append(new Node("br",1)).shortEnded=!0)}),parser},autoFocus=function(editor){editor.settings.auto_focus&&Delay.setEditorTimeout(editor,function(){var focusEditor;(focusEditor=!0===editor.settings.auto_focus?editor:editor.editorManager.get(editor.settings.auto_focus)).destroyed||focusEditor.focus()},100)},initEditor=function(editor){editor.bindPendingEventDelegates(),editor.initialized=!0,editor.fire("init"),editor.focus(!0),editor.nodeChanged({initial:!0}),editor.execCallback("init_instance_callback",editor),autoFocus(editor)},getStyleSheetLoader=function(editor){return editor.inline?DOM.styleSheetLoader:editor.dom.styleSheetLoader};return{initContentBody:function(editor,skipWrite){var body,contentCssText,settings=editor.settings,targetElm=editor.getElement(),doc=editor.getDoc();settings.inline||(editor.getElement().style.visibility=editor.orgVisibility),skipWrite||settings.content_editable||(doc.open(),doc.write(editor.iframeHTML),doc.close()),settings.content_editable&&(editor.on("remove",function(){var bodyEl=this.getBody();DOM.removeClass(bodyEl,"mce-content-body"),DOM.removeClass(bodyEl,"mce-edit-focus"),DOM.setAttrib(bodyEl,"contentEditable",null)}),DOM.addClass(targetElm,"mce-content-body"),editor.contentDocument=doc=settings.content_document||document,editor.contentWindow=settings.content_window||window,editor.bodyElement=targetElm,settings.content_document=settings.content_window=null,settings.root_name=targetElm.nodeName.toLowerCase()),(body=editor.getBody()).disabled=!0,editor.readonly=settings.readonly,editor.readonly||(editor.inline&&"static"===DOM.getStyle(body,"position",!0)&&(body.style.position="relative"),body.contentEditable=editor.getParam("content_editable_state",!0)),body.disabled=!1,editor.editorUpload=new EditorUpload(editor),editor.schema=new Schema(settings),editor.dom=new DOMUtils(doc,{keep_values:!0,url_converter:editor.convertURL,url_converter_scope:editor,hex_colors:settings.force_hex_style_colors,class_filter:settings.class_filter,update_styles:!0,root_element:editor.inline?editor.getBody():null,collect:settings.content_editable,schema:editor.schema,onSetAttrib:function(e){editor.fire("SetAttrib",e)}}),editor.parser=createParser(editor),editor.serializer=new Serializer(settings,editor),editor.selection=new Selection(editor.dom,editor.getWin(),editor.serializer,editor),editor.formatter=new Formatter(editor),editor.undoManager=new UndoManager(editor),editor._nodeChangeDispatcher=new NodeChange(editor),editor._selectionOverrides=new SelectionOverrides(editor),CaretContainerInput.setup(editor),KeyboardOverrides.setup(editor),ForceBlocks.setup(editor),editor.fire("PreInit"),settings.browser_spellcheck||settings.gecko_spellcheck||(doc.body.spellcheck=!1,DOM.setAttrib(body,"spellcheck","false")),editor.quirks=new Quirks(editor),editor.fire("PostRender"),settings.directionality&&(body.dir=settings.directionality),settings.nowrap&&(body.style.whiteSpace="nowrap"),settings.protect&&editor.on("BeforeSetContent",function(e){Tools.each(settings.protect,function(pattern){e.content=e.content.replace(pattern,function(str){return"\x3c!--mce:protected "+escape(str)+"--\x3e"})})}),editor.on("SetContent",function(){editor.addVisual(editor.getBody())}),settings.padd_empty_editor&&editor.on("PostProcess",function(e){e.content=e.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|<br \/>|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/,"")}),editor.load({initial:!0,format:"html"}),editor.startContent=editor.getContent({format:"raw"}),editor.on("compositionstart compositionend",function(e){editor.composing="compositionstart"===e.type}),editor.contentStyles.length>0&&(contentCssText="",Tools.each(editor.contentStyles,function(style){contentCssText+=style+"\r\n"}),editor.dom.addStyle(contentCssText)),getStyleSheetLoader(editor).loadAll(editor.contentCSS,function(_){initEditor(editor)},function(urls){initEditor(editor)}),settings.content_style&&appendStyle(editor,settings.content_style)}}}),define("tinymce.core.PluginManager",["tinymce.core.AddOnManager"],function(AddOnManager){return AddOnManager.PluginManager}),define("tinymce.core.ThemeManager",["tinymce.core.AddOnManager"],function(AddOnManager){return AddOnManager.ThemeManager}),define("tinymce.core.init.Init",["global!document","global!window","tinymce.core.dom.DOMUtils","tinymce.core.Env","tinymce.core.init.InitContentBody","tinymce.core.PluginManager","tinymce.core.ThemeManager","tinymce.core.util.Tools","tinymce.core.util.Uuid"],function(document,window,DOMUtils,Env,InitContentBody,PluginManager,ThemeManager,Tools,Uuid){var DOM=DOMUtils.DOM,initPlugin=function(editor,initializedPlugins,plugin){var pluginUrl,pluginInstance,Plugin=PluginManager.get(plugin);if(pluginUrl=PluginManager.urls[plugin]||editor.documentBaseUrl.replace(/\/$/,""),plugin=Tools.trim(plugin),Plugin&&-1===Tools.inArray(initializedPlugins,plugin)){if(Tools.each(PluginManager.dependencies(plugin),function(dep){initPlugin(editor,initializedPlugins,dep)}),editor.plugins[plugin])return;pluginInstance=new Plugin(editor,pluginUrl,editor.$),editor.plugins[plugin]=pluginInstance,pluginInstance.init&&(pluginInstance.init(editor,pluginUrl),initializedPlugins.push(plugin))}},trimLegacyPrefix=function(name){return name.replace(/^\-/,"")},initPlugins=function(editor){var initializedPlugins=[];Tools.each(editor.settings.plugins.split(/[ ,]/),function(name){initPlugin(editor,initializedPlugins,trimLegacyPrefix(name))})},initTheme=function(editor){var Theme,settings=editor.settings;settings.theme&&("function"!=typeof settings.theme?(settings.theme=trimLegacyPrefix(settings.theme),Theme=ThemeManager.get(settings.theme),editor.theme=new Theme(editor,ThemeManager.urls[settings.theme]),editor.theme.init&&editor.theme.init(editor,ThemeManager.urls[settings.theme]||editor.documentBaseUrl.replace(/\/$/,""),editor.$)):editor.theme=settings.theme)},measueBox=function(editor){var w,h,minHeight,re,o,settings=editor.settings,elm=editor.getElement();return settings.render_ui&&editor.theme&&(editor.orgDisplay=elm.style.display,"function"!=typeof settings.theme?(w=settings.width||DOM.getStyle(elm,"width")||"100%",h=settings.height||DOM.getStyle(elm,"height")||elm.offsetHeight,minHeight=settings.min_height||100,(re=/^[0-9\.]+(|px)$/i).test(""+w)&&(w=Math.max(parseInt(w,10),100)),re.test(""+h)&&(h=Math.max(parseInt(h,10),minHeight)),o=editor.theme.renderUI({targetNode:elm,width:w,height:h,deltaWidth:settings.delta_width,deltaHeight:settings.delta_height}),settings.content_editable||(h=(o.iframeHeight||h)+("number"==typeof h?o.deltaHeight||0:""))<minHeight&&(h=minHeight)):((o=settings.theme(editor,elm)).editorContainer.nodeType&&(o.editorContainer.id=o.editorContainer.id||editor.id+"_parent"),o.iframeContainer.nodeType&&(o.iframeContainer.id=o.iframeContainer.id||editor.id+"_iframecontainer"),h=o.iframeHeight||elm.offsetHeight),editor.editorContainer=o.editorContainer,o.height=h),o},relaxDomain=function(editor,ifr){if(document.domain!==window.location.hostname&&Env.ie&&Env.ie<12){var bodyUuid=Uuid.uuid("mce");editor[bodyUuid]=function(){InitContentBody.initContentBody(editor)};var domainRelaxUrl='javascript:(function(){document.open();document.domain="'+document.domain+'";var ed = window.parent.tinymce.get("'+editor.id+'");document.write(ed.iframeHTML);document.close();ed.'+bodyUuid+"(true);})()";return DOM.setAttrib(ifr,"src",domainRelaxUrl),!0}return!1},createIframe=function(editor,o){var bodyId,bodyClass,settings=editor.settings;editor.iframeHTML=settings.doctype+"<html><head>",settings.document_base_url!=editor.documentBaseUrl&&(editor.iframeHTML+='<base href="'+editor.documentBaseURI.getURI()+'" />'),!Env.caretAfter&&settings.ie7_compat&&(editor.iframeHTML+='<meta http-equiv="X-UA-Compatible" content="IE=7" />'),editor.iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />',-1!=(bodyId=settings.body_id||"tinymce").indexOf("=")&&(bodyId=(bodyId=editor.getParam("body_id","","hash"))[editor.id]||bodyId),-1!=(bodyClass=settings.body_class||"").indexOf("=")&&(bodyClass=(bodyClass=editor.getParam("body_class","","hash"))[editor.id]||""),settings.content_security_policy&&(editor.iframeHTML+='<meta http-equiv="Content-Security-Policy" content="'+settings.content_security_policy+'" />'),editor.iframeHTML+='</head><body id="'+bodyId+'" class="mce-content-body '+bodyClass+'" data-id="'+editor.id+'"><br></body></html>';var ifr=DOM.create("iframe",{id:editor.id+"_ifr",frameBorder:"0",allowTransparency:"true",title:editor.editorManager.translate("Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help"),style:{width:"100%",height:o.height,display:"block"}});ifr.onload=function(){ifr.onload=null,editor.fire("load")};var isDomainRelaxed=relaxDomain(editor,ifr);return editor.contentAreaContainer=o.iframeContainer,editor.iframeElement=ifr,DOM.add(o.iframeContainer,ifr),isDomainRelaxed};return{init:function(editor){var boxInfo,settings=editor.settings,elm=editor.getElement();if(editor.rtl=settings.rtl_ui||editor.editorManager.i18n.rtl,editor.editorManager.i18n.setCode(settings.language),settings.aria_label=settings.aria_label||DOM.getAttrib(elm,"aria-label",editor.getLang("aria.rich_text_area")),editor.fire("ScriptsLoaded"),initTheme(editor),initPlugins(editor),boxInfo=measueBox(editor),settings.content_css&&Tools.each(Tools.explode(settings.content_css),function(u){editor.contentCSS.push(editor.documentBaseURI.toAbsolute(u))}),settings.content_editable)return InitContentBody.initContentBody(editor);var isDomainRelaxed=createIframe(editor,boxInfo);boxInfo.editorContainer&&(DOM.get(boxInfo.editorContainer).style.display=editor.orgDisplay,editor.hidden=DOM.isHidden(boxInfo.editorContainer)),editor.getElement().style.display="none",DOM.setAttrib(editor.id,"aria-hidden",!0),isDomainRelaxed||InitContentBody.initContentBody(editor)}}}),define("tinymce.core.init.Render",["global!window","tinymce.core.dom.DOMUtils","tinymce.core.dom.EventUtils","tinymce.core.dom.ScriptLoader","tinymce.core.Env","tinymce.core.ErrorReporter","tinymce.core.init.Init","tinymce.core.NotificationManager","tinymce.core.PluginManager","tinymce.core.ThemeManager","tinymce.core.util.Tools","tinymce.core.WindowManager"],function(window,DOMUtils,EventUtils,ScriptLoader,Env,ErrorReporter,Init,NotificationManager,PluginManager,ThemeManager,Tools,WindowManager){var DOM=DOMUtils.DOM,loadScripts=function(editor,suffix){var settings=editor.settings,scriptLoader=ScriptLoader.ScriptLoader;if(settings.language&&"en"!=settings.language&&!settings.language_url&&(settings.language_url=editor.editorManager.baseURL+"/langs/"+settings.language+".js"),settings.language_url&&scriptLoader.add(settings.language_url),settings.theme&&"function"!=typeof settings.theme&&"-"!=settings.theme.charAt(0)&&!ThemeManager.urls[settings.theme]){var themeUrl=settings.theme_url;themeUrl=themeUrl?editor.documentBaseURI.toAbsolute(themeUrl):"themes/"+settings.theme+"/theme"+suffix+".js",ThemeManager.load(settings.theme,themeUrl)}Tools.isArray(settings.plugins)&&(settings.plugins=settings.plugins.join(" ")),Tools.each(settings.external_plugins,function(url,name){PluginManager.load(name,url),settings.plugins+=" "+name}),Tools.each(settings.plugins.split(/[ ,]/),function(plugin){if((plugin=Tools.trim(plugin))&&!PluginManager.urls[plugin])if("-"===plugin.charAt(0)){plugin=plugin.substr(1,plugin.length);var dependencies=PluginManager.dependencies(plugin);Tools.each(dependencies,function(dep){var defaultSettings={prefix:"plugins/",resource:dep,suffix:"/plugin"+suffix+".js"};dep=PluginManager.createUrl(defaultSettings,dep),PluginManager.load(dep.resource,dep)})}else PluginManager.load(plugin,{prefix:"plugins/",resource:plugin,suffix:"/plugin"+suffix+".js"})}),scriptLoader.loadQueue(function(){editor.removed||Init.init(editor)},editor,function(urls){ErrorReporter.pluginLoadError(editor,urls[0]),editor.removed||Init.init(editor)})};return{render:function(editor){function readyHandler(){DOM.unbind(window,"ready",readyHandler),editor.render()}var settings=editor.settings,id=editor.id;if(EventUtils.Event.domLoaded){if(editor.getElement()&&Env.contentEditable){settings.inline?editor.inline=!0:(editor.orgVisibility=editor.getElement().style.visibility,editor.getElement().style.visibility="hidden");var form=editor.getElement().form||DOM.getParent(id,"form");form&&(editor.formElement=form,settings.hidden_input&&!/TEXTAREA|INPUT/i.test(editor.getElement().nodeName)&&(DOM.insertAfter(DOM.create("input",{type:"hidden",name:id}),id),editor.hasHiddenInput=!0),editor.formEventDelegate=function(e){editor.fire(e.type,e)},DOM.bind(form,"submit reset",editor.formEventDelegate),editor.on("reset",function(){editor.setContent(editor.startContent,{format:"raw"})}),!settings.submit_patch||form.submit.nodeType||form.submit.length||form._mceOldSubmit||(form._mceOldSubmit=form.submit,form.submit=function(){return editor.editorManager.triggerSave(),editor.setDirty(!1),form._mceOldSubmit(form)})),editor.windowManager=new WindowManager(editor),editor.notificationManager=new NotificationManager(editor),"xml"===settings.encoding&&editor.on("GetContent",function(e){e.save&&(e.content=DOM.encode(e.content))}),settings.add_form_submit_trigger&&editor.on("submit",function(){editor.initialized&&editor.save()}),settings.add_unload_trigger&&(editor._beforeUnload=function(){!editor.initialized||editor.destroyed||editor.isHidden()||editor.save({format:"raw",no_events:!0,set_dirty:!1})},editor.editorManager.on("BeforeUnload",editor._beforeUnload)),editor.editorManager.add(editor),loadScripts(editor,editor.suffix)}}else DOM.bind(window,"ready",readyHandler)}}}),define("tinymce.core.Mode",[],function(){function setEditorCommandState(editor,cmd,state){try{editor.getDoc().execCommand(cmd,!1,state)}catch(ex){}}function clickBlocker(editor){var target,handler;return target=editor.getBody(),handler=function(e){editor.dom.getParents(e.target,"a").length>0&&e.preventDefault()},editor.dom.bind(target,"click",handler),{unbind:function(){editor.dom.unbind(target,"click",handler)}}}function toggleReadOnly(editor,state){editor._clickBlocker&&(editor._clickBlocker.unbind(),editor._clickBlocker=null),state?(editor._clickBlocker=clickBlocker(editor),editor.selection.controlSelection.hideResizeRect(),editor.readonly=!0,editor.getBody().contentEditable=!1):(editor.readonly=!1,editor.getBody().contentEditable=!0,setEditorCommandState(editor,"StyleWithCSS",!1),setEditorCommandState(editor,"enableInlineTableEditing",!1),setEditorCommandState(editor,"enableObjectResizing",!1),editor.focus(),editor.nodeChanged())}return{setMode:function(editor,mode){var currentMode=editor.readonly?"readonly":"design";mode!=currentMode&&(editor.initialized?toggleReadOnly(editor,"readonly"==mode):editor.on("init",function(){toggleReadOnly(editor,"readonly"==mode)}),editor.fire("SwitchMode",{mode:mode}))}}}),define("tinymce.core.ui.Sidebar",[],function(){return{add:function(editor,name,settings){var sidebars=editor.sidebars?editor.sidebars:[];sidebars.push({name:name,settings:settings}),editor.sidebars=sidebars}}}),define("tinymce.core.Editor",["tinymce.core.AddOnManager","tinymce.core.dom.DomQuery","tinymce.core.dom.DOMUtils","tinymce.core.EditorCommands","tinymce.core.EditorObservable","tinymce.core.EditorSettings","tinymce.core.Env","tinymce.core.html.Serializer","tinymce.core.init.Render","tinymce.core.Mode","tinymce.core.Shortcuts","tinymce.core.ui.Sidebar","tinymce.core.util.Tools","tinymce.core.util.URI","tinymce.core.util.Uuid"],function(AddOnManager,DomQuery,DOMUtils,EditorCommands,EditorObservable,EditorSettings,Env,Serializer,Render,Mode,Shortcuts,Sidebar,Tools,URI,Uuid){function Editor(id,settings,editorManager){var documentBaseUrl,baseUri,self=this;documentBaseUrl=self.documentBaseUrl=editorManager.documentBaseURL,baseUri=editorManager.baseURI,settings=EditorSettings.getEditorSettings(self,id,documentBaseUrl,editorManager.defaultSettings,settings),self.settings=settings,AddOnManager.language=settings.language||"en",AddOnManager.languageLoad=settings.language_load,AddOnManager.baseURL=editorManager.baseURL,self.id=id,self.setDirty(!1),self.plugins={},self.documentBaseURI=new URI(settings.document_base_url,{base_uri:baseUri}),self.baseURI=baseUri,self.contentCSS=[],self.contentStyles=[],self.shortcuts=new Shortcuts(self),self.loadedCSS={},self.editorCommands=new EditorCommands(self),self.suffix=editorManager.suffix,self.editorManager=editorManager,self.inline=settings.inline,settings.cache_suffix&&(Env.cacheSuffix=settings.cache_suffix.replace(/^[\?\&]+/,"")),!1===settings.override_viewport&&(Env.overrideViewPort=!1),editorManager.fire("SetupEditor",self),self.execCallback("setup",self),self.$=DomQuery.overrideDefaults(function(){return{context:self.inline?self.getBody():self.getDoc(),element:self.getBody()}})}var DOM=DOMUtils.DOM,extend=Tools.extend,each=Tools.each,trim=Tools.trim,resolve=Tools.resolve,isGecko=Env.gecko,ie=Env.ie;return Editor.prototype={render:function(){Render.render(this)},focus:function(skipFocus){var rng,controlElm,contentEditableHost,self=this,selection=self.selection,contentEditable=self.settings.content_editable,doc=self.getDoc(),body=self.getBody();if(!self.removed){if(!skipFocus){if((rng=selection.getRng()).item&&(controlElm=rng.item(0)),self.quirks.refreshContentEditable(),contentEditableHost=function(node){return self.dom.getParent(node,function(node){return"true"===self.dom.getContentEditable(node)})}(selection.getNode()),self.$.contains(body,contentEditableHost))return contentEditableHost.focus(),selection.normalize(),void self.editorManager.setActive(self);if(contentEditable||(Env.opera||self.getBody().focus(),self.getWin().focus()),isGecko||contentEditable){if(body.setActive)try{body.setActive()}catch(ex){body.focus()}else self.inline&&document.activeElement!==body&&self.selection.setRng(self.lastRng),body.focus();contentEditable&&selection.normalize()}controlElm&&controlElm.ownerDocument==doc&&((rng=doc.body.createControlRange()).addElement(controlElm),rng.select())}self.editorManager.setActive(self)}},execCallback:function(name){var scope,self=this,callback=self.settings[name];if(callback)return self.callbackLookup&&(scope=self.callbackLookup[name])&&(callback=scope.func,scope=scope.scope),"string"==typeof callback&&(scope=(scope=callback.replace(/\.\w+$/,""))?resolve(scope):0,callback=resolve(callback),self.callbackLookup=self.callbackLookup||{},self.callbackLookup[name]={func:callback,scope:scope}),callback.apply(scope||self,Array.prototype.slice.call(arguments,1))},translate:function(text){if(text&&Tools.is(text,"string")){var lang=this.settings.language||"en",i18n=this.editorManager.i18n;text=i18n.data[lang+"."+text]||text.replace(/\{\#([^\}]+)\}/g,function(a,b){return i18n.data[lang+"."+b]||"{#"+b+"}"})}return this.editorManager.translate(text)},getLang:function(name,defaultVal){return this.editorManager.i18n.data[(this.settings.language||"en")+"."+name]||(void 0!==defaultVal?defaultVal:"{#"+name+"}")},getParam:function(name,defaultVal,type){var output,value=name in this.settings?this.settings[name]:defaultVal;return"hash"===type?(output={},"string"==typeof value?each(value.indexOf("=")>0?value.split(/[;,](?![^=;,]*(?:[;,]|$))/):value.split(","),function(value){(value=value.split("=")).length>1?output[trim(value[0])]=trim(value[1]):output[trim(value[0])]=trim(value)}):output=value,output):value},nodeChanged:function(args){this._nodeChangeDispatcher.nodeChanged(args)},addButton:function(name,settings){var self=this;settings.cmd&&(settings.onclick=function(){self.execCommand(settings.cmd)}),settings.text||settings.icon||(settings.icon=name),self.buttons=self.buttons||{},settings.tooltip=settings.tooltip||settings.title,self.buttons[name]=settings},addSidebar:function(name,settings){return Sidebar.add(this,name,settings)},addMenuItem:function(name,settings){var self=this;settings.cmd&&(settings.onclick=function(){self.execCommand(settings.cmd)}),self.menuItems=self.menuItems||{},self.menuItems[name]=settings},addContextToolbar:function(predicate,items){var selector,self=this;self.contextToolbars=self.contextToolbars||[],"string"==typeof predicate&&(selector=predicate,predicate=function(elm){return self.dom.is(elm,selector)}),self.contextToolbars.push({id:Uuid.uuid("mcet"),predicate:predicate,items:items})},addCommand:function(name,callback,scope){this.editorCommands.addCommand(name,callback,scope)},addQueryStateHandler:function(name,callback,scope){this.editorCommands.addQueryStateHandler(name,callback,scope)},addQueryValueHandler:function(name,callback,scope){this.editorCommands.addQueryValueHandler(name,callback,scope)},addShortcut:function(pattern,desc,cmdFunc,scope){this.shortcuts.add(pattern,desc,cmdFunc,scope)},execCommand:function(cmd,ui,value,args){return this.editorCommands.execCommand(cmd,ui,value,args)},queryCommandState:function(cmd){return this.editorCommands.queryCommandState(cmd)},queryCommandValue:function(cmd){return this.editorCommands.queryCommandValue(cmd)},queryCommandSupported:function(cmd){return this.editorCommands.queryCommandSupported(cmd)},show:function(){var self=this;self.hidden&&(self.hidden=!1,self.inline?self.getBody().contentEditable=!0:(DOM.show(self.getContainer()),DOM.hide(self.id)),self.load(),self.fire("show"))},hide:function(){var self=this,doc=self.getDoc();self.hidden||(ie&&doc&&!self.inline&&doc.execCommand("SelectAll"),self.save(),self.inline?(self.getBody().contentEditable=!1,self==self.editorManager.focusedEditor&&(self.editorManager.focusedEditor=null)):(DOM.hide(self.getContainer()),DOM.setStyle(self.id,"display",self.orgDisplay)),self.hidden=!0,self.fire("hide"))},isHidden:function(){return!!this.hidden},setProgressState:function(state,time){this.fire("ProgressState",{state:state,time:time})},load:function(args){var html,self=this,elm=self.getElement();return self.removed?"":elm?(args=args||{},args.load=!0,html=self.setContent(void 0!==elm.value?elm.value:elm.innerHTML,args),args.element=elm,args.no_events||self.fire("LoadContent",args),args.element=elm=null,html):void 0},save:function(args){var html,form,self=this,elm=self.getElement();if(elm&&self.initialized&&!self.removed)return args=args||{},args.save=!0,args.element=elm,html=args.content=self.getContent(args),args.no_events||self.fire("SaveContent",args),"raw"==args.format&&self.fire("RawSaveContent",args),html=args.content,/TEXTAREA|INPUT/i.test(elm.nodeName)?elm.value=html:(self.inline||(elm.innerHTML=html),(form=DOM.getParent(self.id,"form"))&&each(form.elements,function(elm){if(elm.name==self.id)return elm.value=html,!1})),args.element=elm=null,!1!==args.set_dirty&&self.setDirty(!1),html},setContent:function(content,args){var forcedRootBlockName,padd,self=this,body=self.getBody();return args=args||{},args.format=args.format||"html",args.set=!0,args.content=content,args.no_events||self.fire("BeforeSetContent",args),0===(content=args.content).length||/^\s+$/.test(content)?(padd=ie&&ie<11?"":'<br data-mce-bogus="1">',"TABLE"==body.nodeName?content="<tr><td>"+padd+"</td></tr>":/^(UL|OL)$/.test(body.nodeName)&&(content="<li>"+padd+"</li>"),(forcedRootBlockName=self.settings.forced_root_block)&&self.schema.isValidChild(body.nodeName.toLowerCase(),forcedRootBlockName.toLowerCase())?(content=padd,content=self.dom.createHTML(forcedRootBlockName,self.settings.forced_root_block_attrs,content)):ie||content||(content='<br data-mce-bogus="1">'),self.dom.setHTML(body,content),self.fire("SetContent",args)):("raw"!==args.format&&(content=new Serializer({validate:self.validate},self.schema).serialize(self.parser.parse(content,{isRootContent:!0}))),args.content=trim(content),self.dom.setHTML(body,args.content),args.no_events||self.fire("SetContent",args)),args.content},getContent:function(args){var content,self=this,body=self.getBody();return self.removed?"":(args=args||{},args.format=args.format||"html",args.get=!0,args.getInner=!0,args.no_events||self.fire("BeforeGetContent",args),content="raw"==args.format?Tools.trim(self.serializer.getTrimmedContent()):"text"==args.format?body.innerText||body.textContent:self.serializer.serialize(body,args),"text"!=args.format?args.content=trim(content):args.content=content,args.no_events||self.fire("GetContent",args),args.content)},insertContent:function(content,args){args&&(content=extend({content:content},args)),this.execCommand("mceInsertContent",!1,content)},isDirty:function(){return!this.isNotDirty},setDirty:function(state){var oldState=!this.isNotDirty;this.isNotDirty=!state,state&&state!=oldState&&this.fire("dirty")},setMode:function(mode){Mode.setMode(this,mode)},getContainer:function(){var self=this;return self.container||(self.container=DOM.get(self.editorContainer||self.id+"_parent")),self.container},getContentAreaContainer:function(){return this.contentAreaContainer},getElement:function(){return this.targetElm||(this.targetElm=DOM.get(this.id)),this.targetElm},getWin:function(){var elm,self=this;return self.contentWindow||(elm=self.iframeElement)&&(self.contentWindow=elm.contentWindow),self.contentWindow},getDoc:function(){var win,self=this;return self.contentDocument||(win=self.getWin())&&(self.contentDocument=win.document),self.contentDocument},getBody:function(){var doc=this.getDoc();return this.bodyElement||(doc?doc.body:null)},convertURL:function(url,name,elm){var self=this,settings=self.settings;return settings.urlconverter_callback?self.execCallback("urlconverter_callback",url,elm,!0,name):!settings.convert_urls||elm&&"LINK"==elm.nodeName||0===url.indexOf("file:")||0===url.length?url:settings.relative_urls?self.documentBaseURI.toRelative(url):url=self.documentBaseURI.toAbsolute(url,settings.remove_script_host)},addVisual:function(elm){var cls,self=this,settings=self.settings,dom=self.dom;elm=elm||self.getBody(),void 0===self.hasVisual&&(self.hasVisual=settings.visual),each(dom.select("table,a",elm),function(elm){var value;switch(elm.nodeName){case"TABLE":return cls=settings.visual_table_class||"mce-item-table",void((value=dom.getAttrib(elm,"border"))&&"0"!=value||!self.hasVisual?dom.removeClass(elm,cls):dom.addClass(elm,cls));case"A":return void(dom.getAttrib(elm,"href",!1)||(value=dom.getAttrib(elm,"name")||elm.id,cls=settings.visual_anchor_class||"mce-item-anchor",value&&self.hasVisual?dom.addClass(elm,cls):dom.removeClass(elm,cls)))}}),self.fire("VisualAid",{element:elm,hasVisual:self.hasVisual})},remove:function(){var self=this;self.removed||(self.save(),self.removed=1,self.unbindAllNativeEvents(),self.hasHiddenInput&&DOM.remove(self.getElement().nextSibling),self.inline||(ie&&ie<10&&self.getDoc().execCommand("SelectAll",!1,null),DOM.setStyle(self.id,"display",self.orgDisplay),self.getBody().onload=null),self.fire("remove"),self.editorManager.remove(self),DOM.remove(self.getContainer()),self._selectionOverrides.destroy(),self.editorUpload.destroy(),self.destroy())},destroy:function(automatic){var form,self=this;self.destroyed||(automatic||self.removed?(automatic||(self.editorManager.off("beforeunload",self._beforeUnload),self.theme&&self.theme.destroy&&self.theme.destroy(),self.selection.destroy(),self.dom.destroy()),(form=self.formElement)&&(form._mceOldSubmit&&(form.submit=form._mceOldSubmit,form._mceOldSubmit=null),DOM.unbind(form,"submit reset",self.formEventDelegate)),self.contentAreaContainer=self.formElement=self.container=self.editorContainer=null,self.bodyElement=self.contentDocument=self.contentWindow=null,self.iframeElement=self.targetElm=null,self.selection&&(self.selection=self.selection.win=self.selection.dom=self.selection.dom.doc=null),self.destroyed=1):self.remove())},uploadImages:function(callback){return this.editorUpload.uploadImages(callback)},_scanForImages:function(){return this.editorUpload.scanForImages()}},extend(Editor.prototype,EditorObservable),Editor}),define("tinymce.core.util.I18n",["tinymce.core.util.Tools"],function(Tools){"use strict";var data={},code="en";return{setCode:function(newCode){newCode&&(code=newCode,this.rtl=!!this.data[newCode]&&"rtl"===this.data[newCode]._dir)},getCode:function(){return code},rtl:!1,add:function(code,items){var langData=data[code];langData||(data[code]=langData={});for(var name in items)langData[name]=items[name];this.setCode(code)},translate:function(text){function toString(obj){return Tools.is(obj,"function")?Object.prototype.toString.call(obj):isEmpty(obj)?"":""+obj}function isEmpty(text){return""===text||null===text||Tools.is(text,"undefined")}function getLangData(text){return text=toString(text),Tools.hasOwn(langData,text)?toString(langData[text]):text}var langData=data[code]||{};if(isEmpty(text))return"";if(Tools.is(text,"object")&&Tools.hasOwn(text,"raw"))return toString(text.raw);if(Tools.is(text,"array")){var values=text.slice(1);text=getLangData(text[0]).replace(/\{([0-9]+)\}/g,function($1,$2){return Tools.hasOwn(values,$2)?toString(values[$2]):$1})}return getLangData(text).replace(/{context:\w+}$/,"")},data:data}}),define("tinymce.core.FocusManager",["tinymce.core.dom.DOMUtils","tinymce.core.util.Delay","tinymce.core.Env"],function(DOMUtils,Delay,Env){function FocusManager(editorManager){function getActiveElement(){try{return document.activeElement}catch(ex){return document.body}}function createBookmark(dom,rng){if(rng&&rng.startContainer){if(!dom.isChildOf(rng.startContainer,dom.getRoot())||!dom.isChildOf(rng.endContainer,dom.getRoot()))return;return{startContainer:rng.startContainer,startOffset:rng.startOffset,endContainer:rng.endContainer,endOffset:rng.endOffset}}return rng}function bookmarkToRng(editor,bookmark){var rng;return bookmark.startContainer?((rng=editor.getDoc().createRange()).setStart(bookmark.startContainer,bookmark.startOffset),rng.setEnd(bookmark.endContainer,bookmark.endOffset)):rng=bookmark,rng}editorManager.on("AddEditor",function(e){var editor=e.editor;editor.on("init",function(){(editor.inline||Env.ie)&&("onbeforedeactivate"in document&&Env.ie<9?editor.dom.bind(editor.getBody(),"beforedeactivate",function(e){if(e.target==editor.getBody())try{editor.lastRng=editor.selection.getRng()}catch(ex){}}):editor.on("nodechange mouseup keyup",function(e){var node=getActiveElement();"nodechange"==e.type&&e.selectionChange||(node&&node.id==editor.id+"_ifr"&&(node=editor.getBody()),editor.dom.isChildOf(node,editor.getBody())&&(editor.lastRng=editor.selection.getRng()))}))}),editor.on("setcontent",function(){editor.lastRng=null}),editor.on("mousedown",function(){editor.selection.lastFocusBookmark=null}),editor.on("focusin",function(){var lastRng,focusedEditor=editorManager.focusedEditor;editor.selection.lastFocusBookmark&&(lastRng=bookmarkToRng(editor,editor.selection.lastFocusBookmark),editor.selection.lastFocusBookmark=null,editor.selection.setRng(lastRng)),focusedEditor!=editor&&(focusedEditor&&focusedEditor.fire("blur",{focusedEditor:editor}),editorManager.setActive(editor),editorManager.focusedEditor=editor,editor.fire("focus",{blurredEditor:focusedEditor}),editor.focus(!0)),editor.lastRng=null}),editor.on("focusout",function(){Delay.setEditorTimeout(editor,function(){var focusedEditor=editorManager.focusedEditor;isUIElement(editor,getActiveElement())||focusedEditor!=editor||(editor.fire("blur",{focusedEditor:null}),editorManager.focusedEditor=null,editor.selection&&(editor.selection.lastFocusBookmark=null))})}),documentFocusInHandler||(documentFocusInHandler=function(e){var target,activeEditor=editorManager.activeEditor;target=e.target,activeEditor&&target.ownerDocument===document&&(activeEditor.selection&&target!==activeEditor.getBody()&&isElementOursideInlineEditor(editor,target)&&(activeEditor.selection.lastFocusBookmark=createBookmark(activeEditor.dom,activeEditor.lastRng)),target===document.body||isUIElement(activeEditor,target)||editorManager.focusedEditor!==activeEditor||(activeEditor.fire("blur",{focusedEditor:null}),editorManager.focusedEditor=null))},DOM.bind(document,"focusin",documentFocusInHandler)),editor.inline&&!documentMouseUpHandler&&(documentMouseUpHandler=function(e){var activeEditor=editorManager.activeEditor,dom=activeEditor.dom;if(activeEditor.inline&&dom&&!dom.isChildOf(e.target,activeEditor.getBody())){var rng=activeEditor.selection.getRng();rng.collapsed||(activeEditor.lastRng=rng)}},DOM.bind(document,"mouseup",documentMouseUpHandler))}),editorManager.on("RemoveEditor",function(e){editorManager.focusedEditor==e.editor&&(editorManager.focusedEditor=null),editorManager.activeEditor||(DOM.unbind(document,"selectionchange",selectionChangeHandler),DOM.unbind(document,"focusin",documentFocusInHandler),DOM.unbind(document,"mouseup",documentMouseUpHandler),selectionChangeHandler=documentFocusInHandler=documentMouseUpHandler=null)})}var selectionChangeHandler,documentFocusInHandler,documentMouseUpHandler,DOM=DOMUtils.DOM,isUIElement=function(editor,elm){var customSelector=editor?editor.settings.custom_ui_selector:"";return null!==DOM.getParent(elm,function(elm){return FocusManager.isEditorUIElement(elm)||!!customSelector&&editor.dom.is(elm,customSelector)})},isInlineEditor=function(editor){return!0===editor.inline},isElementOursideInlineEditor=function(editor,target){return!1===isInlineEditor(editor)||!1===editor.dom.isChildOf(target,editor.getBody())};return FocusManager.isEditorUIElement=function(elm){return-1!==elm.className.toString().indexOf("mce-")},FocusManager._isUIElement=isUIElement,FocusManager}),define("tinymce.core.LegacyInput",["tinymce.core.util.Tools"],function(Tools){var each=Tools.each,explode=Tools.explode;return{register:function(EditorManager){EditorManager.on("AddEditor",function(e){var editor=e.editor;editor.on("preInit",function(){function replaceWithSpan(node,styles){each(styles,function(value,name){value&&dom.setStyle(node,name,value)}),dom.rename(node,"span")}var filters,fontSizes,dom,settings=editor.settings;settings.inline_styles&&(fontSizes=explode(settings.font_size_legacy_values),filters={font:function(dom,node){replaceWithSpan(node,{backgroundColor:node.style.backgroundColor,color:node.color,fontFamily:node.face,fontSize:fontSizes[parseInt(node.size,10)-1]})},u:function(dom,node){"html4"===editor.settings.schema&&replaceWithSpan(node,{textDecoration:"underline"})},strike:function(dom,node){replaceWithSpan(node,{textDecoration:"line-through"})}},editor.on("PreProcess SetContent",function(e){dom=editor.dom,settings.convert_fonts_to_spans&&each(dom.select("font,u,strike",e.node),function(node){filters[node.nodeName.toLowerCase()](dom,node)})}))})})}}}),define("tinymce.core.EditorManager",["ephox.katamari.api.Arr","ephox.katamari.api.Type","tinymce.core.AddOnManager","tinymce.core.dom.DomQuery","tinymce.core.dom.DOMUtils","tinymce.core.Editor","tinymce.core.Env","tinymce.core.ErrorReporter","tinymce.core.FocusManager","tinymce.core.LegacyInput","tinymce.core.util.I18n","tinymce.core.util.Observable","tinymce.core.util.Promise","tinymce.core.util.Tools","tinymce.core.util.URI"],function(Arr,Type,AddOnManager,DomQuery,DOMUtils,Editor,Env,ErrorReporter,FocusManager,LegacyInput,I18n,Observable,Promise,Tools,URI){function globalEventDelegate(e){each(EditorManager.get(),function(editor){"scroll"===e.type?editor.fire("ScrollWindow",e):editor.fire("ResizeWindow",e)})}function toggleGlobalEvents(state){state!==boundGlobalEvents&&(state?DomQuery(window).on("resize scroll",globalEventDelegate):DomQuery(window).off("resize scroll",globalEventDelegate),boundGlobalEvents=state)}function removeEditorFromList(targetEditor){var oldEditors=editors;delete legacyEditors[targetEditor.id];for(var i=0;i<legacyEditors.length;i++)if(legacyEditors[i]===targetEditor){legacyEditors.splice(i,1);break}return editors=Arr.filter(editors,function(editor){return targetEditor!==editor}),EditorManager.activeEditor===targetEditor&&(EditorManager.activeEditor=editors.length>0?editors[0]:null),EditorManager.focusedEditor===targetEditor&&(EditorManager.focusedEditor=null),oldEditors.length!==editors.length}function purgeDestroyedEditor(editor){return editor&&editor.initialized&&!(editor.getContainer()||editor.getBody()).parentNode&&(removeEditorFromList(editor),editor.unbindAllNativeEvents(),editor.destroy(!0),editor.removed=!0,editor=null),editor}var beforeUnloadDelegate,EditorManager,DOM=DOMUtils.DOM,explode=Tools.explode,each=Tools.each,extend=Tools.extend,instanceCounter=0,boundGlobalEvents=!1,legacyEditors=[],editors=[];return EditorManager={$:DomQuery,majorVersion:"4",minorVersion:"6.6",releaseDate:"2017-08-30",editors:legacyEditors,i18n:I18n,activeEditor:null,settings:{},setup:function(){var baseURL,documentBaseURL,preInit,src,self=this,suffix="";if(documentBaseURL=URI.getDocumentBaseUrl(document.location),/^[^:]+:\/\/\/?[^\/]+\//.test(documentBaseURL)&&(documentBaseURL=documentBaseURL.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(documentBaseURL)||(documentBaseURL+="/")),preInit=window.tinymce||window.tinyMCEPreInit)baseURL=preInit.base||preInit.baseURL,suffix=preInit.suffix;else{for(var scripts=document.getElementsByTagName("script"),i=0;i<scripts.length;i++){var srcScript=(src=scripts[i].src).substring(src.lastIndexOf("/"));if(/tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(src)){-1!=srcScript.indexOf(".min")&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/"));break}}!baseURL&&document.currentScript&&(-1!=(src=document.currentScript.src).indexOf(".min")&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/")))}self.baseURL=new URI(documentBaseURL).toAbsolute(baseURL),self.documentBaseURL=documentBaseURL,self.baseURI=new URI(self.baseURL),self.suffix=suffix,self.focusManager=new FocusManager(self)},overrideDefaults:function(defaultSettings){var baseUrl,suffix;(baseUrl=defaultSettings.base_url)&&(this.baseURL=new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\/+$/,"")),this.baseURI=new URI(this.baseURL)),suffix=defaultSettings.suffix,defaultSettings.suffix&&(this.suffix=suffix),this.defaultSettings=defaultSettings;var pluginBaseUrls=defaultSettings.plugin_base_urls;for(var name in pluginBaseUrls)AddOnManager.PluginManager.urls[name]=pluginBaseUrls[name]},init:function(settings){function isInvalidInlineTarget(settings,elm){return settings.inline&&elm.tagName.toLowerCase()in invalidInlineTargets}function createId(elm){var id=elm.id;return id||(id=(id=elm.name)&&!DOM.get(id)?elm.name:DOM.uniqueId(),elm.setAttribute("id",id)),id}function execCallback(name){var callback=settings[name];if(callback)return callback.apply(self,Array.prototype.slice.call(arguments,2))}function hasClass(elm,className){return className.constructor===RegExp?className.test(elm.className):DOM.hasClass(elm,className)}function findTargets(settings){var l,targets=[];if(Env.ie&&Env.ie<11)return ErrorReporter.initError("TinyMCE does not support the browser you are using. For a list of supported browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/"),[];if(settings.types)return each(settings.types,function(type){targets=targets.concat(DOM.select(type.selector))}),targets;if(settings.selector)return DOM.select(settings.selector);if(settings.target)return[settings.target];switch(settings.mode){case"exact":(l=settings.elements||"").length>0&&each(explode(l),function(id){var elm;(elm=DOM.get(id))?targets.push(elm):each(document.forms,function(f){each(f.elements,function(e){e.name===id&&(id="mce_editor_"+instanceCounter++,DOM.setAttrib(e,"id",id),targets.push(e))})})});break;case"textareas":case"specific_textareas":each(DOM.select("textarea"),function(elm){settings.editor_deselector&&hasClass(elm,settings.editor_deselector)||settings.editor_selector&&!hasClass(elm,settings.editor_selector)||targets.push(elm)})}return targets}function initEditors(){function createEditor(id,settings,targetElm){var editor=new Editor(id,settings,self);editors.push(editor),editor.on("init",function(){++initCount===targets.length&&provideResults(editors)}),editor.targetElm=editor.targetElm||targetElm,editor.render()}var targets,initCount=0,editors=[];DOM.unbind(window,"ready",initEditors),execCallback("onpageload"),targets=DomQuery.unique(findTargets(settings)),settings.types?each(settings.types,function(type){Tools.each(targets,function(elm){return!DOM.is(elm,type.selector)||(createEditor(createId(elm),extend({},settings,type),elm),!1)})}):(Tools.each(targets,function(elm){purgeDestroyedEditor(self.get(elm.id))}),0===(targets=Tools.grep(targets,function(elm){return!self.get(elm.id)})).length?provideResults([]):each(targets,function(elm){isInvalidInlineTarget(settings,elm)?ErrorReporter.initError("Could not initialize inline editor on invalid inline target element",elm):createEditor(createId(elm),settings,elm)}))}var result,invalidInlineTargets,self=this;invalidInlineTargets=Tools.makeMap("area base basefont br col frame hr img input isindex link meta param embed source wbr track colgroup option tbody tfoot thead tr script noscript style textarea video audio iframe object menu"," ");var provideResults=function(editors){result=editors};return self.settings=settings,DOM.bind(window,"ready",initEditors),new Promise(function(resolve){result?resolve(result):provideResults=function(editors){resolve(editors)}})},get:function(id){return 0===arguments.length?editors.slice(0):Type.isString(id)?Arr.find(editors,function(editor){return editor.id===id}).getOr(null):Type.isNumber(id)&&editors[id]?editors[id]:null},add:function(editor){var self=this;return legacyEditors[editor.id]===editor?editor:(null===self.get(editor.id)&&(legacyEditors[editor.id]=editor,legacyEditors.push(editor),editors.push(editor)),toggleGlobalEvents(!0),self.activeEditor=editor,self.fire("AddEditor",{editor:editor}),beforeUnloadDelegate||(beforeUnloadDelegate=function(){self.fire("BeforeUnload")},DOM.bind(window,"beforeunload",beforeUnloadDelegate)),editor)},createEditor:function(id,settings){return this.add(new Editor(id,settings,this))},remove:function(selector){var i,editor,self=this;if(selector)return Type.isString(selector)?(selector=selector.selector||selector,void each(DOM.select(selector),function(elm){(editor=self.get(elm.id))&&self.remove(editor)})):(editor=selector,Type.isNull(self.get(editor.id))?null:(removeEditorFromList(editor)&&self.fire("RemoveEditor",{editor:editor}),0===editors.length&&DOM.unbind(window,"beforeunload",beforeUnloadDelegate),editor.remove(),toggleGlobalEvents(editors.length>0),editor));for(i=editors.length-1;i>=0;i--)self.remove(editors[i])},execCommand:function(cmd,ui,value){var self=this,editor=self.get(value);switch(cmd){case"mceAddEditor":return self.get(value)||new Editor(value,self.settings,self).render(),!0;case"mceRemoveEditor":return editor&&editor.remove(),!0;case"mceToggleEditor":return editor?(editor.isHidden()?editor.show():editor.hide(),!0):(self.execCommand("mceAddEditor",0,value),!0)}return!!self.activeEditor&&self.activeEditor.execCommand(cmd,ui,value)},triggerSave:function(){each(editors,function(editor){editor.save()})},addI18n:function(code,items){I18n.add(code,items)},translate:function(text){return I18n.translate(text)},setActive:function(editor){var activeEditor=this.activeEditor;this.activeEditor!=editor&&(activeEditor&&activeEditor.fire("deactivate",{relatedTarget:editor}),editor.fire("activate",{relatedTarget:activeEditor})),this.activeEditor=editor}},extend(EditorManager,Observable),EditorManager.setup(),LegacyInput.register(EditorManager),EditorManager}),define("tinymce.core.util.XHR",["tinymce.core.util.Observable","tinymce.core.util.Tools"],function(Observable,Tools){var XHR={send:function(settings){function ready(){!settings.async||4==xhr.readyState||count++>1e4?(settings.success&&count<1e4&&200==xhr.status?settings.success.call(settings.success_scope,""+xhr.responseText,xhr,settings):settings.error&&settings.error.call(settings.error_scope,count>1e4?"TIMED_OUT":"GENERAL",xhr,settings),xhr=null):setTimeout(ready,10)}var xhr,count=0;if(settings.scope=settings.scope||this,settings.success_scope=settings.success_scope||settings.scope,settings.error_scope=settings.error_scope||settings.scope,settings.async=!1!==settings.async,settings.data=settings.data||"",XHR.fire("beforeInitialize",{settings:settings}),xhr=new XMLHttpRequest){if(xhr.overrideMimeType&&xhr.overrideMimeType(settings.content_type),xhr.open(settings.type||(settings.data?"POST":"GET"),settings.url,settings.async),settings.crossDomain&&(xhr.withCredentials=!0),settings.content_type&&xhr.setRequestHeader("Content-Type",settings.content_type),settings.requestheaders&&Tools.each(settings.requestheaders,function(header){xhr.setRequestHeader(header.key,header.value)}),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),(xhr=XHR.fire("beforeSend",{xhr:xhr,settings:settings}).xhr).send(settings.data),!settings.async)return ready();setTimeout(ready,10)}}};return Tools.extend(XHR,Observable),XHR}),define("tinymce.core.util.JSON",[],function(){function serialize(o,quote){var i,v,t,name;if(quote=quote||'"',null===o)return"null";if("string"==(t=typeof o))return v="\bb\tt\nn\ff\rr\"\"''\\\\",quote+o.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g,function(a,b){return'"'===quote&&"'"===a?a:(i=v.indexOf(b))+1?"\\"+v.charAt(i+1):(a=b.charCodeAt().toString(16),"\\u"+"0000".substring(a.length)+a)})+quote;if("object"==t){if(o.hasOwnProperty&&"[object Array]"===Object.prototype.toString.call(o)){for(i=0,v="[";i<o.length;i++)v+=(i>0?",":"")+serialize(o[i],quote);return v+"]"}v="{";for(name in o)o.hasOwnProperty(name)&&(v+="function"!=typeof o[name]?(v.length>1?","+quote:quote)+name+quote+":"+serialize(o[name],quote):"");return v+"}"}return""+o}return{serialize:serialize,parse:function(text){try{return window[String.fromCharCode(101)+"val"]("("+text+")")}catch(ex){}}}}),define("tinymce.core.util.JSONRequest",["tinymce.core.util.JSON","tinymce.core.util.XHR","tinymce.core.util.Tools"],function(JSON,XHR,Tools){function JSONRequest(settings){this.settings=extend({},settings),this.count=0}var extend=Tools.extend;return JSONRequest.sendRPC=function(o){return(new JSONRequest).send(o)},JSONRequest.prototype={send:function(args){var ecb=args.error,scb=args.success;(args=extend(this.settings,args)).success=function(c,x){void 0===(c=JSON.parse(c))&&(c={error:"JSON Parse error."}),c.error?ecb.call(args.error_scope||args.scope,c.error,x):scb.call(args.success_scope||args.scope,c.result)},args.error=function(ty,x){ecb&&ecb.call(args.error_scope||args.scope,ty,x)},args.data=JSON.serialize({id:args.id||"c"+this.count++,method:args.method,params:args.params}),args.content_type="application/json",XHR.send(args)}},JSONRequest}),define("tinymce.core.util.JSONP",["tinymce.core.dom.DOMUtils"],function(DOMUtils){return{callbacks:{},count:0,send:function(settings){var self=this,dom=DOMUtils.DOM,count=void 0!==settings.count?settings.count:self.count,id="tinymce_jsonp_"+count;self.callbacks[count]=function(json){dom.remove(id),delete self.callbacks[count],settings.callback(json)},dom.add(dom.doc.body,"script",{id:id,src:settings.url,type:"text/javascript"}),self.count++}}}),define("tinymce.core.util.LocalStorage",[],function(){function updateKeys(){keys=[];for(var key in items)keys.push(key);LocalStorage.length=keys.length}function save(){var value,data="";if(hasOldIEDataSupport){for(var key in items)value=items[key],data+=(data?",":"")+key.length.toString(32)+","+key+","+value.length.toString(32)+","+value;storageElm.setAttribute(userDataKey,data);try{storageElm.save(userDataKey)}catch(ex){}updateKeys()}}var LocalStorage,storageElm,items,keys,userDataKey,hasOldIEDataSupport;try{if(window.localStorage)return localStorage}catch(ex){}return userDataKey="tinymce",storageElm=document.documentElement,(hasOldIEDataSupport=!!storageElm.addBehavior)&&storageElm.addBehavior("#default#userData"),LocalStorage={key:function(index){return keys[index]},getItem:function(key){return key in items?items[key]:null},setItem:function(key,value){items[key]=""+value,save()},removeItem:function(key){delete items[key],save()},clear:function(){items={},save()}},function(){function next(end){var value,nextPos;return-1===(nextPos=void 0!==end?pos+end:data.indexOf(",",pos))||nextPos>data.length?null:(value=data.substring(pos,nextPos),pos=nextPos+1,value)}var key,data,value,pos=0;if(items={},hasOldIEDataSupport){storageElm.load(userDataKey),data=storageElm.getAttribute(userDataKey)||"";do{var offset=next();if(null===offset)break;if(null!==(key=next(parseInt(offset,32)||0))){if(null===(offset=next()))break;value=next(parseInt(offset,32)||0),key&&(items[key]=value)}}while(null!==key);updateKeys()}}(),LocalStorage}),define("tinymce.core.util.Color",[],function(){var min=Math.min,max=Math.max,round=Math.round;return function(value){function rgb2hsv(r,g,b){var h,s,v,d,minRGB,maxRGB;return h=0,s=0,v=0,r/=255,g/=255,b/=255,minRGB=min(r,min(g,b)),maxRGB=max(r,max(g,b)),minRGB==maxRGB?(v=minRGB,{h:0,s:0,v:100*v}):(d=r==minRGB?g-b:b==minRGB?r-g:b-r,h=r==minRGB?3:b==minRGB?1:5,h=60*(h-d/(maxRGB-minRGB)),s=(maxRGB-minRGB)/maxRGB,v=maxRGB,{h:round(h),s:round(100*s),v:round(100*v)})}function hsvToRgb(hue,saturation,brightness){var side,chroma,x,match;if(hue=(parseInt(hue,10)||0)%360,saturation=parseInt(saturation,10)/100,brightness=parseInt(brightness,10)/100,saturation=max(0,min(saturation,1)),brightness=max(0,min(brightness,1)),0!==saturation){switch(side=hue/60,chroma=brightness*saturation,x=chroma*(1-Math.abs(side%2-1)),match=brightness-chroma,Math.floor(side)){case 0:r=chroma,g=x,b=0;break;case 1:r=x,g=chroma,b=0;break;case 2:r=0,g=chroma,b=x;break;case 3:r=0,g=x,b=chroma;break;case 4:r=x,g=0,b=chroma;break;case 5:r=chroma,g=0,b=x;break;default:r=g=b=0}r=round(255*(r+match)),g=round(255*(g+match)),b=round(255*(b+match))}else r=g=b=round(255*brightness)}function parse(value){var matches;return"object"==typeof value?"r"in value?(r=value.r,g=value.g,b=value.b):"v"in value&&hsvToRgb(value.h,value.s,value.v):(matches=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(value))?(r=parseInt(matches[1],10),g=parseInt(matches[2],10),b=parseInt(matches[3],10)):(matches=/#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value))?(r=parseInt(matches[1],16),g=parseInt(matches[2],16),b=parseInt(matches[3],16)):(matches=/#([0-F])([0-F])([0-F])/gi.exec(value))&&(r=parseInt(matches[1]+matches[1],16),g=parseInt(matches[2]+matches[2],16),b=parseInt(matches[3]+matches[3],16)),r=r<0?0:r>255?255:r,g=g<0?0:g>255?255:g,b=b<0?0:b>255?255:b,self}var self=this,r=0,g=0,b=0;value&&parse(value),self.toRgb=function(){return{r:r,g:g,b:b}},self.toHsv=function(){return rgb2hsv(r,g,b)},self.toHex=function(){function hex(val){return(val=parseInt(val,10).toString(16)).length>1?val:"0"+val}return"#"+hex(r)+hex(g)+hex(b)},self.parse=parse}}),define("tinymce.core.ui.Layout",["tinymce.core.util.Class","tinymce.core.util.Tools"],function(Class,Tools){"use strict";return Class.extend({Defaults:{firstControlClass:"first",lastControlClass:"last"},init:function(settings){this.settings=Tools.extend({},this.Defaults,settings)},preRender:function(container){container.bodyClasses.add(this.settings.containerClass)},applyClasses:function(items){var firstClass,lastClass,firstItem,lastItem,settings=this.settings;firstClass=settings.firstControlClass,lastClass=settings.lastControlClass,items.each(function(item){item.classes.remove(firstClass).remove(lastClass).add(settings.controlClass),item.visible()&&(firstItem||(firstItem=item),lastItem=item)}),firstItem&&firstItem.classes.add(firstClass),lastItem&&lastItem.classes.add(lastClass)},renderHtml:function(container){var html="";return this.applyClasses(container.items()),container.items().each(function(item){html+=item.renderHtml()}),html},recalc:function(){},postRender:function(){},isNative:function(){return!1}})}),define("tinymce.core.ui.AbsoluteLayout",["tinymce.core.ui.Layout"],function(Layout){"use strict";return Layout.extend({Defaults:{containerClass:"abs-layout",controlClass:"abs-layout-item"},recalc:function(container){container.items().filter(":visible").each(function(ctrl){var settings=ctrl.settings;ctrl.layoutRect({x:settings.x,y:settings.y,w:settings.w,h:settings.h}),ctrl.recalc&&ctrl.recalc()})},renderHtml:function(container){return'<div id="'+container._id+'-absend" class="'+container.classPrefix+'abs-end"></div>'+this._super(container)}})}),define("tinymce.core.ui.Button",["tinymce.core.ui.Widget"],function(Widget){"use strict";return Widget.extend({Defaults:{classes:"widget btn",role:"button"},init:function(settings){var size,self=this;self._super(settings),settings=self.settings,size=self.settings.size,self.on("click mousedown",function(e){e.preventDefault()}),self.on("touchstart",function(e){self.fire("click",e),e.preventDefault()}),settings.subtype&&self.classes.add(settings.subtype),size&&self.classes.add("btn-"+size),settings.icon&&self.icon(settings.icon)},icon:function(icon){return arguments.length?(this.state.set("icon",icon),this):this.state.get("icon")},repaint:function(){var btnStyle,btnElm=this.getEl().firstChild;btnElm&&((btnStyle=btnElm.style).width=btnStyle.height="100%"),this._super()},renderHtml:function(){var image,self=this,id=self._id,prefix=self.classPrefix,icon=self.state.get("icon"),text=self.state.get("text"),textHtml="";return(image=self.settings.image)?(icon="none","string"!=typeof image&&(image=window.getSelection?image[0]:image[1]),image=" style=\"background-image: url('"+image+"')\""):image="",text&&(self.classes.add("btn-has-text"),textHtml='<span class="'+prefix+'txt">'+self.encode(text)+"</span>"),icon=icon?prefix+"ico "+prefix+"i-"+icon:"",'<div id="'+id+'" class="'+self.classes+'" tabindex="-1"><button id="'+id+'-button" role="presentation" type="button" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+textHtml+"</button></div>"},bindStates:function(){function setButtonText(text){var $span=$("span."+textCls,self.getEl());text?($span[0]||($("button:first",self.getEl()).append('<span class="'+textCls+'"></span>'),$span=$("span."+textCls,self.getEl())),$span.html(self.encode(text))):$span.remove(),self.classes.toggle("btn-has-text",!!text)}var self=this,$=self.$,textCls=self.classPrefix+"txt";return self.state.on("change:text",function(e){setButtonText(e.value)}),self.state.on("change:icon",function(e){var icon=e.value,prefix=self.classPrefix;self.settings.icon=icon,icon=icon?prefix+"ico "+prefix+"i-"+self.settings.icon:"";var btnElm=self.getEl().firstChild,iconElm=btnElm.getElementsByTagName("i")[0];icon?(iconElm&&iconElm==btnElm.firstChild||(iconElm=document.createElement("i"),btnElm.insertBefore(iconElm,btnElm.firstChild)),iconElm.className=icon):iconElm&&btnElm.removeChild(iconElm),setButtonText(self.state.get("text"))}),self._super()}})}),define("tinymce.core.ui.ButtonGroup",["tinymce.core.ui.Container"],function(Container){"use strict";return Container.extend({Defaults:{defaultType:"button",role:"group"},renderHtml:function(){var self=this,layout=self._layout;return self.classes.add("btn-group"),self.preRender(),layout.preRender(self),'<div id="'+self._id+'" class="'+self.classes+'"><div id="'+self._id+'-body">'+(self.settings.html||"")+layout.renderHtml(self)+"</div></div>"}})}),define("tinymce.core.ui.Checkbox",["tinymce.core.ui.Widget"],function(Widget){"use strict";return Widget.extend({Defaults:{classes:"checkbox",role:"checkbox",checked:!1},init:function(settings){var self=this;self._super(settings),self.on("click mousedown",function(e){e.preventDefault()}),self.on("click",function(e){e.preventDefault(),self.disabled()||self.checked(!self.checked())}),self.checked(self.settings.checked)},checked:function(state){return arguments.length?(this.state.set("checked",state),this):this.state.get("checked")},value:function(state){return arguments.length?this.checked(state):this.checked()},renderHtml:function(){var self=this,id=self._id,prefix=self.classPrefix;return'<div id="'+id+'" class="'+self.classes+'" unselectable="on" aria-labelledby="'+id+'-al" tabindex="-1"><i class="'+prefix+"ico "+prefix+'i-checkbox"></i><span id="'+id+'-al" class="'+prefix+'label">'+self.encode(self.state.get("text"))+"</span></div>"},bindStates:function(){function checked(state){self.classes.toggle("checked",state),self.aria("checked",state)}var self=this;return self.state.on("change:text",function(e){self.getEl("al").firstChild.data=self.translate(e.value)}),self.state.on("change:checked change:value",function(e){self.fire("change"),checked(e.value)}),self.state.on("change:icon",function(e){var icon=e.value,prefix=self.classPrefix;if(void 0===icon)return self.settings.icon;self.settings.icon=icon,icon=icon?prefix+"ico "+prefix+"i-"+self.settings.icon:"";var btnElm=self.getEl().firstChild,iconElm=btnElm.getElementsByTagName("i")[0];icon?(iconElm&&iconElm==btnElm.firstChild||(iconElm=document.createElement("i"),btnElm.insertBefore(iconElm,btnElm.firstChild)),iconElm.className=icon):iconElm&&btnElm.removeChild(iconElm)}),self.state.get("checked")&&checked(!0),self._super()}})}),define("tinymce.core.ui.ComboBox",["tinymce.core.ui.Widget","tinymce.core.ui.Factory","tinymce.core.ui.DomUtils","tinymce.core.dom.DomQuery","tinymce.core.util.VK","tinymce.core.util.Tools"],function(Widget,Factory,DomUtils,$,VK,Tools){"use strict";return Widget.extend({init:function(settings){var self=this;self._super(settings),settings=self.settings,self.classes.add("combobox"),self.subinput=!0,self.ariaTarget="inp",settings.menu=settings.menu||settings.values,settings.menu&&(settings.icon="caret"),self.on("click",function(e){var elm=e.target,root=self.getEl();if($.contains(root,elm)||elm==root)for(;elm&&elm!=root;)elm.id&&-1!=elm.id.indexOf("-open")&&(self.fire("action"),settings.menu&&(self.showMenu(),e.aria&&self.menu.items()[0].focus())),elm=elm.parentNode}),self.on("keydown",function(e){var rootControl;13==e.keyCode&&"INPUT"===e.target.nodeName&&(e.preventDefault(),self.parents().reverse().each(function(ctrl){if(ctrl.toJSON)return rootControl=ctrl,!1}),self.fire("submit",{data:rootControl.toJSON()}))}),self.on("keyup",function(e){if("INPUT"==e.target.nodeName){var oldValue=self.state.get("value"),newValue=e.target.value;newValue!==oldValue&&(self.state.set("value",newValue),self.fire("autocomplete",e))}}),self.on("mouseover",function(e){var tooltip=self.tooltip().moveTo(-65535);if(self.statusLevel()&&-1!==e.target.className.indexOf(self.classPrefix+"status")){var statusMessage=self.statusMessage()||"Ok",rel=tooltip.text(statusMessage).show().testMoveRel(e.target,["bc-tc","bc-tl","bc-tr"]);tooltip.classes.toggle("tooltip-n","bc-tc"==rel),tooltip.classes.toggle("tooltip-nw","bc-tl"==rel),tooltip.classes.toggle("tooltip-ne","bc-tr"==rel),tooltip.moveRel(e.target,rel)}})},statusLevel:function(value){return arguments.length>0&&this.state.set("statusLevel",value),this.state.get("statusLevel")},statusMessage:function(value){return arguments.length>0&&this.state.set("statusMessage",value),this.state.get("statusMessage")},showMenu:function(){var menu,self=this,settings=self.settings;self.menu||((menu=settings.menu||[]).length?menu={type:"menu",items:menu}:menu.type=menu.type||"menu",self.menu=Factory.create(menu).parent(self).renderTo(self.getContainerElm()),self.fire("createmenu"),self.menu.reflow(),self.menu.on("cancel",function(e){e.control===self.menu&&self.focus()}),self.menu.on("show hide",function(e){e.control.items().each(function(ctrl){ctrl.active(ctrl.value()==self.value())})}).fire("show"),self.menu.on("select",function(e){self.value(e.control.value())}),self.on("focusin",function(e){"INPUT"==e.target.tagName.toUpperCase()&&self.menu.hide()}),self.aria("expanded",!0)),self.menu.show(),self.menu.layoutRect({w:self.layoutRect().w}),self.menu.moveRel(self.getEl(),self.isRtl()?["br-tr","tr-br"]:["bl-tl","tl-bl"])},focus:function(){this.getEl("inp").focus()},repaint:function(){var width,lineHeight,self=this,elm=self.getEl(),openElm=self.getEl("open"),rect=self.layoutRect(),innerPadding=0,inputElm=elm.firstChild;self.statusLevel()&&"none"!==self.statusLevel()&&(innerPadding=parseInt(DomUtils.getRuntimeStyle(inputElm,"padding-right"),10)-parseInt(DomUtils.getRuntimeStyle(inputElm,"padding-left"),10)),width=openElm?rect.w-DomUtils.getSize(openElm).width-10:rect.w-10;var doc=document;return doc.all&&(!doc.documentMode||doc.documentMode<=8)&&(lineHeight=self.layoutRect().h-2+"px"),$(inputElm).css({width:width-innerPadding,lineHeight:lineHeight}),self._super(),self},postRender:function(){var self=this;return $(this.getEl("inp")).on("change",function(e){self.state.set("value",e.target.value),self.fire("change",e)}),self._super()},renderHtml:function(){var icon,text,self=this,id=self._id,settings=self.settings,prefix=self.classPrefix,value=self.state.get("value")||"",openBtnHtml="",extraAttrs="",statusHtml="";return"spellcheck"in settings&&(extraAttrs+=' spellcheck="'+settings.spellcheck+'"'),settings.maxLength&&(extraAttrs+=' maxlength="'+settings.maxLength+'"'),settings.size&&(extraAttrs+=' size="'+settings.size+'"'),settings.subtype&&(extraAttrs+=' type="'+settings.subtype+'"'),statusHtml='<i id="'+id+'-status" class="mce-status mce-ico" style="display: none"></i>',self.disabled()&&(extraAttrs+=' disabled="disabled"'),(icon=settings.icon)&&"caret"!=icon&&(icon=prefix+"ico "+prefix+"i-"+settings.icon),text=self.state.get("text"),(icon||text)&&(openBtnHtml='<div id="'+id+'-open" class="'+prefix+"btn "+prefix+'open" tabIndex="-1" role="button"><button id="'+id+'-action" type="button" hidefocus="1" tabindex="-1">'+("caret"!=icon?'<i class="'+icon+'"></i>':'<i class="'+prefix+'caret"></i>')+(text?(icon?" ":"")+text:"")+"</button></div>",self.classes.add("has-open")),'<div id="'+id+'" class="'+self.classes+'"><input id="'+id+'-inp" class="'+prefix+'textbox" value="'+self.encode(value,!1)+'" hidefocus="1"'+extraAttrs+' placeholder="'+self.encode(settings.placeholder)+'" />'+statusHtml+openBtnHtml+"</div>"},value:function(value){return arguments.length?(this.state.set("value",value),this):(this.state.get("rendered")&&this.state.set("value",this.getEl("inp").value),this.state.get("value"))},showAutoComplete:function(items,term){var self=this;if(0!==items.length){var insert=function(value,title){return function(){self.fire("selectitem",{title:title,value:value})}};self.menu?self.menu.items().remove():self.menu=Factory.create({type:"menu",classes:"combobox-menu",layout:"flow"}).parent(self).renderTo(),Tools.each(items,function(item){self.menu.add({text:item.title,url:item.previewUrl,match:term,classes:"menu-item-ellipsis",onclick:insert(item.value,item.title)})}),self.menu.renderNew(),self.hideMenu(),self.menu.on("cancel",function(e){e.control.parent()===self.menu&&(e.stopPropagation(),self.focus(),self.hideMenu())}),self.menu.on("select",function(){self.focus()});var maxW=self.layoutRect().w;self.menu.layoutRect({w:maxW,minW:0,maxW:maxW}),self.menu.reflow(),self.menu.show(),self.menu.moveRel(self.getEl(),self.isRtl()?["br-tr","tr-br"]:["bl-tl","tl-bl"])}else self.hideMenu()},hideMenu:function(){this.menu&&this.menu.hide()},bindStates:function(){var self=this;self.state.on("change:value",function(e){self.getEl("inp").value!=e.value&&(self.getEl("inp").value=e.value)}),self.state.on("change:disabled",function(e){self.getEl("inp").disabled=e.value}),self.state.on("change:statusLevel",function(e){var statusIconElm=self.getEl("status"),prefix=self.classPrefix,value=e.value;DomUtils.css(statusIconElm,"display","none"===value?"none":""),DomUtils.toggleClass(statusIconElm,prefix+"i-checkmark","ok"===value),DomUtils.toggleClass(statusIconElm,prefix+"i-warning","warn"===value),DomUtils.toggleClass(statusIconElm,prefix+"i-error","error"===value),self.classes.toggle("has-status","none"!==value),self.repaint()}),DomUtils.on(self.getEl("status"),"mouseleave",function(){self.tooltip().hide()}),self.on("cancel",function(e){self.menu&&self.menu.visible()&&(e.stopPropagation(),self.hideMenu())});var focusIdx=function(idx,menu){menu&&menu.items().length>0&&menu.items().eq(idx)[0].focus()};return self.on("keydown",function(e){var keyCode=e.keyCode;"INPUT"===e.target.nodeName&&(keyCode===VK.DOWN?(e.preventDefault(),self.fire("autocomplete"),focusIdx(0,self.menu)):keyCode===VK.UP&&(e.preventDefault(),focusIdx(-1,self.menu)))}),self._super()},remove:function(){$(this.getEl("inp")).off(),this.menu&&this.menu.remove(),this._super()}})}),define("tinymce.core.ui.ColorBox",["tinymce.core.ui.ComboBox"],function(ComboBox){"use strict";return ComboBox.extend({init:function(settings){var self=this;settings.spellcheck=!1,settings.onaction&&(settings.icon="none"),self._super(settings),self.classes.add("colorbox"),self.on("change keyup postrender",function(){self.repaintColor(self.value())})},repaintColor:function(value){var openElm=this.getEl("open"),elm=openElm?openElm.getElementsByTagName("i")[0]:null;if(elm)try{elm.style.background=value}catch(ex){}},bindStates:function(){var self=this;return self.state.on("change:value",function(e){self.state.get("rendered")&&self.repaintColor(e.value)}),self._super()}})}),define("tinymce.core.ui.PanelButton",["tinymce.core.ui.Button","tinymce.core.ui.FloatPanel"],function(Button,FloatPanel){"use strict";return Button.extend({showPanel:function(){var self=this,settings=self.settings;if(self.active(!0),self.panel)self.panel.show();else{var panelSettings=settings.panel;panelSettings.type&&(panelSettings={layout:"grid",items:panelSettings}),panelSettings.role=panelSettings.role||"dialog",panelSettings.popover=!0,panelSettings.autohide=!0,panelSettings.ariaRoot=!0,self.panel=new FloatPanel(panelSettings).on("hide",function(){self.active(!1)}).on("cancel",function(e){e.stopPropagation(),self.focus(),self.hidePanel()}).parent(self).renderTo(self.getContainerElm()),self.panel.fire("show"),self.panel.reflow()}var rel=self.panel.testMoveRel(self.getEl(),settings.popoverAlign||(self.isRtl()?["bc-tc","bc-tl","bc-tr"]:["bc-tc","bc-tr","bc-tl"]));self.panel.classes.toggle("start","bc-tl"===rel),self.panel.classes.toggle("end","bc-tr"===rel),self.panel.moveRel(self.getEl(),rel)},hidePanel:function(){var self=this;self.panel&&self.panel.hide()},postRender:function(){var self=this;return self.aria("haspopup",!0),self.on("click",function(e){e.control===self&&(self.panel&&self.panel.visible()?self.hidePanel():(self.showPanel(),self.panel.focus(!!e.aria)))}),self._super()},remove:function(){return this.panel&&(this.panel.remove(),this.panel=null),this._super()}})}),define("tinymce.core.ui.ColorButton",["tinymce.core.ui.PanelButton","tinymce.core.dom.DOMUtils"],function(PanelButton,DomUtils){"use strict";var DOM=DomUtils.DOM;return PanelButton.extend({init:function(settings){this._super(settings),this.classes.add("colorbutton")},color:function(color){return color?(this._color=color,this.getEl("preview").style.backgroundColor=color,this):this._color},resetColor:function(){return this._color=null,this.getEl("preview").style.backgroundColor=null,this},renderHtml:function(){var self=this,id=self._id,prefix=self.classPrefix,text=self.state.get("text"),icon=self.settings.icon?prefix+"ico "+prefix+"i-"+self.settings.icon:"",image=self.settings.image?" style=\"background-image: url('"+self.settings.image+"')\"":"",textHtml="";return text&&(self.classes.add("btn-has-text"),textHtml='<span class="'+prefix+'txt">'+self.encode(text)+"</span>"),'<div id="'+id+'" class="'+self.classes+'" role="button" tabindex="-1" aria-haspopup="true"><button role="presentation" hidefocus="1" type="button" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+'<span id="'+id+'-preview" class="'+prefix+'preview"></span>'+textHtml+'</button><button type="button" class="'+prefix+'open" hidefocus="1" tabindex="-1"> <i class="'+prefix+'caret"></i></button></div>'},postRender:function(){var self=this,onClickHandler=self.settings.onclick;return self.on("click",function(e){e.aria&&"down"==e.aria.key||e.control!=self||DOM.getParent(e.target,"."+self.classPrefix+"open")||(e.stopImmediatePropagation(),onClickHandler.call(self,e))}),delete self.settings.onclick,self._super()}})}),define("tinymce.core.ui.ColorPicker",["tinymce.core.ui.Widget","tinymce.core.ui.DragHelper","tinymce.core.ui.DomUtils","tinymce.core.util.Color"],function(Widget,DragHelper,DomUtils,Color){"use strict";return Widget.extend({Defaults:{classes:"widget colorpicker"},init:function(settings){this._super(settings)},postRender:function(){function getPos(elm,event){var x,y,pos=DomUtils.getPos(elm);return x=event.pageX-pos.x,y=event.pageY-pos.y,x=Math.max(0,Math.min(x/elm.clientWidth,1)),y=Math.max(0,Math.min(y/elm.clientHeight,1)),{x:x,y:y}}function updateColor(hsv,hueUpdate){var hue=(360-hsv.h)/360;DomUtils.css(huePointElm,{top:100*hue+"%"}),hueUpdate||DomUtils.css(svPointElm,{left:hsv.s+"%",top:100-hsv.v+"%"}),svRootElm.style.background=new Color({s:100,v:100,h:hsv.h}).toHex(),self.color().parse({s:hsv.s,v:hsv.v,h:hsv.h})}function updateSaturationAndValue(e){var pos;pos=getPos(svRootElm,e),hsv.s=100*pos.x,hsv.v=100*(1-pos.y),updateColor(hsv),self.fire("change")}function updateHue(e){var pos;pos=getPos(hueRootElm,e),(hsv=color.toHsv()).h=360*(1-pos.y),updateColor(hsv,!0),self.fire("change")}var hsv,hueRootElm,huePointElm,svRootElm,svPointElm,self=this,color=self.color();hueRootElm=self.getEl("h"),huePointElm=self.getEl("hp"),svRootElm=self.getEl("sv"),svPointElm=self.getEl("svp"),self._repaint=function(){updateColor(hsv=color.toHsv())},self._super(),self._svdraghelper=new DragHelper(self._id+"-sv",{start:updateSaturationAndValue,drag:updateSaturationAndValue}),self._hdraghelper=new DragHelper(self._id+"-h",{start:updateHue,drag:updateHue}),self._repaint()},rgb:function(){return this.color().toRgb()},value:function(value){var self=this;if(!arguments.length)return self.color().toHex();self.color().parse(value),self._rendered&&self._repaint()},color:function(){return this._color||(this._color=new Color),this._color},renderHtml:function(){var hueHtml,self=this,id=self._id,prefix=self.classPrefix,stops="#ff0000,#ff0080,#ff00ff,#8000ff,#0000ff,#0080ff,#00ffff,#00ff80,#00ff00,#80ff00,#ffff00,#ff8000,#ff0000";return hueHtml='<div id="'+id+'-h" class="'+prefix+'colorpicker-h" style="'+("background: -ms-linear-gradient(top,"+stops+");background: linear-gradient(to bottom,"+stops+");")+'">'+function(){var i,l,gradientPrefix,stopsList,html="";for(gradientPrefix="filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=",i=0,l=(stopsList=stops.split(",")).length-1;i<l;i++)html+='<div class="'+prefix+'colorpicker-h-chunk" style="height:'+100/l+"%;"+gradientPrefix+stopsList[i]+",endColorstr="+stopsList[i+1]+");-ms-"+gradientPrefix+stopsList[i]+",endColorstr="+stopsList[i+1]+')"></div>';return html}()+'<div id="'+id+'-hp" class="'+prefix+'colorpicker-h-marker"></div></div>','<div id="'+id+'" class="'+self.classes+'"><div id="'+id+'-sv" class="'+prefix+'colorpicker-sv"><div class="'+prefix+'colorpicker-overlay1"><div class="'+prefix+'colorpicker-overlay2"><div id="'+id+'-svp" class="'+prefix+'colorpicker-selector1"><div class="'+prefix+'colorpicker-selector2"></div></div></div></div></div>'+hueHtml+"</div>"}})}),define("tinymce.core.ui.Path",["tinymce.core.ui.Widget"],function(Widget){"use strict";return Widget.extend({init:function(settings){var self=this;settings.delimiter||(settings.delimiter=""),self._super(settings),self.classes.add("path"),self.canFocus=!0,self.on("click",function(e){var index;(index=e.target.getAttribute("data-index"))&&self.fire("select",{value:self.row()[index],index:index})}),self.row(self.settings.row)},focus:function(){var self=this;return self.getEl().firstChild.focus(),self},row:function(row){return arguments.length?(this.state.set("row",row),this):this.state.get("row")},renderHtml:function(){var self=this;return'<div id="'+self._id+'" class="'+self.classes+'">'+self._getDataPathHtml(self.state.get("row"))+"</div>"},bindStates:function(){var self=this;return self.state.on("change:row",function(e){self.innerHtml(self._getDataPathHtml(e.value))}),self._super()},_getDataPathHtml:function(data){var i,l,self=this,parts=data||[],html="",prefix=self.classPrefix;for(i=0,l=parts.length;i<l;i++)html+=(i>0?'<div class="'+prefix+'divider" aria-hidden="true"> '+self.settings.delimiter+" </div>":"")+'<div role="button" class="'+prefix+"path-item"+(i==l-1?" "+prefix+"last":"")+'" data-index="'+i+'" tabindex="-1" id="'+self._id+"-"+i+'" aria-level="'+(i+1)+'">'+parts[i].name+"</div>";return html||(html='<div class="'+prefix+'path-item"></div>'),html}})}),define("tinymce.core.ui.ElementPath",["tinymce.core.ui.Path"],function(Path){return Path.extend({postRender:function(){function isHidden(elm){if(1===elm.nodeType){if("BR"==elm.nodeName||elm.getAttribute("data-mce-bogus"))return!0;if("bookmark"===elm.getAttribute("data-mce-type"))return!0}return!1}var self=this,editor=self.settings.editor;return!1!==editor.settings.elementpath&&(self.on("select",function(e){editor.focus(),editor.selection.select(this.row()[e.index].element),editor.nodeChanged()}),editor.on("nodeChange",function(e){for(var outParents=[],parents=e.parents,i=parents.length;i--;)if(1==parents[i].nodeType&&!isHidden(parents[i])){var args=editor.fire("ResolveName",{name:parents[i].nodeName.toLowerCase(),target:parents[i]});if(args.isDefaultPrevented()||outParents.push({name:args.name,element:parents[i]}),args.isPropagationStopped())break}self.row(outParents)})),self._super()}})}),define("tinymce.core.ui.FormItem",["tinymce.core.ui.Container"],function(Container){"use strict";return Container.extend({Defaults:{layout:"flex",align:"center",defaults:{flex:1}},renderHtml:function(){var self=this,layout=self._layout,prefix=self.classPrefix;return self.classes.add("formitem"),layout.preRender(self),'<div id="'+self._id+'" class="'+self.classes+'" hidefocus="1" tabindex="-1">'+(self.settings.title?'<div id="'+self._id+'-title" class="'+prefix+'title">'+self.settings.title+"</div>":"")+'<div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+(self.settings.html||"")+layout.renderHtml(self)+"</div></div>"}})}),define("tinymce.core.ui.Form",["tinymce.core.ui.Container","tinymce.core.ui.FormItem","tinymce.core.util.Tools"],function(Container,FormItem,Tools){"use strict";return Container.extend({Defaults:{containerCls:"form",layout:"flex",direction:"column",align:"stretch",flex:1,padding:20,labelGap:30,spacing:10,callbacks:{submit:function(){this.submit()}}},preRender:function(){var self=this,items=self.items();self.settings.formItemDefaults||(self.settings.formItemDefaults={layout:"flex",autoResize:"overflow",defaults:{flex:1}}),items.each(function(ctrl){var formItem,label=ctrl.settings.label;label&&((formItem=new FormItem(Tools.extend({items:{type:"label",id:ctrl._id+"-l",text:label,flex:0,forId:ctrl._id,disabled:ctrl.disabled()}},self.settings.formItemDefaults))).type="formitem",ctrl.aria("labelledby",ctrl._id+"-l"),void 0===ctrl.settings.flex&&(ctrl.settings.flex=1),self.replace(ctrl,formItem),formItem.add(ctrl))})},submit:function(){return this.fire("submit",{data:this.toJSON()})},postRender:function(){var self=this;self._super(),self.fromJSON(self.settings.data)},bindStates:function(){function recalcLabels(){var i,labelGap,maxLabelWidth=0,labels=[];if(!1!==self.settings.labelGapCalc)for(("children"==self.settings.labelGapCalc?self.find("formitem"):self.items()).filter("formitem").each(function(item){var labelCtrl=item.items()[0],labelWidth=labelCtrl.getEl().clientWidth;maxLabelWidth=labelWidth>maxLabelWidth?labelWidth:maxLabelWidth,labels.push(labelCtrl)}),labelGap=self.settings.labelGap||0,i=labels.length;i--;)labels[i].settings.minWidth=maxLabelWidth+labelGap}var self=this;self._super(),self.on("show",recalcLabels),recalcLabels()}})}),define("tinymce.core.ui.FieldSet",["tinymce.core.ui.Form"],function(Form){"use strict";return Form.extend({Defaults:{containerCls:"fieldset",layout:"flex",direction:"column",align:"stretch",flex:1,padding:"25 15 5 15",labelGap:30,spacing:10,border:1},renderHtml:function(){var self=this,layout=self._layout,prefix=self.classPrefix;return self.preRender(),layout.preRender(self),'<fieldset id="'+self._id+'" class="'+self.classes+'" hidefocus="1" tabindex="-1">'+(self.settings.title?'<legend id="'+self._id+'-title" class="'+prefix+'fieldset-title">'+self.settings.title+"</legend>":"")+'<div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+(self.settings.html||"")+layout.renderHtml(self)+"</div></fieldset>"}})}),define("tinymce.core.content.LinkTargets",["ephox.sugar.api.node.Element","ephox.sugar.api.search.SelectorFilter","tinymce.core.dom.DOMUtils","tinymce.core.dom.NodeType","tinymce.core.util.Arr","tinymce.core.util.Fun","tinymce.core.util.Tools","tinymce.core.util.Uuid"],function(Element,SelectorFilter,DOMUtils,NodeType,Arr,Fun,Tools,Uuid){var trim=Tools.trim,create=function(type,title,url,level,attach){return{type:type,title:title,url:url,level:level,attach:attach}},isChildOfContentEditableTrue=function(node){for(;node=node.parentNode;){var value=node.contentEditable;if(value&&"inherit"!==value)return NodeType.isContentEditableTrue(node)}return!1},select=function(selector,root){return Arr.map(SelectorFilter.descendants(Element.fromDom(root),selector),function(element){return element.dom()})},getElementText=function(elm){return elm.innerText||elm.textContent},getOrGenerateId=function(elm){return elm.id?elm.id:Uuid.uuid("h")},isAnchor=function(elm){return elm&&"A"===elm.nodeName&&(elm.id||elm.name)},isValidAnchor=function(elm){return isAnchor(elm)&&isEditable(elm)},isHeader=function(elm){return elm&&/^(H[1-6])$/.test(elm.nodeName)},isEditable=function(elm){return isChildOfContentEditableTrue(elm)&&!NodeType.isContentEditableFalse(elm)},isValidHeader=function(elm){return isHeader(elm)&&isEditable(elm)},getLevel=function(elm){return isHeader(elm)?parseInt(elm.nodeName.substr(1),10):0},headerTarget=function(elm){var headerId=getOrGenerateId(elm);return create("header",getElementText(elm),"#"+headerId,getLevel(elm),function(){elm.id=headerId})},anchorTarget=function(elm){var anchorId=elm.id||elm.name,anchorText=getElementText(elm);return create("anchor",anchorText||"#"+anchorId,"#"+anchorId,0,Fun.noop)},getHeaderTargets=function(elms){return Arr.map(Arr.filter(elms,isValidHeader),headerTarget)},getAnchorTargets=function(elms){return Arr.map(Arr.filter(elms,isValidAnchor),anchorTarget)},getTargetElements=function(elm){return select("h1,h2,h3,h4,h5,h6,a:not([href])",elm)},hasTitle=function(target){return trim(target.title).length>0};return{find:function(elm){var elms=getTargetElements(elm);return Arr.filter(getHeaderTargets(elms).concat(getAnchorTargets(elms)),hasTitle)}}}),define("tinymce.core.ui.FilePicker",["global!window","tinymce.core.content.LinkTargets","tinymce.core.EditorManager","tinymce.core.ui.ComboBox","tinymce.core.util.Arr","tinymce.core.util.Fun","tinymce.core.util.Tools"],function(window,LinkTargets,EditorManager,ComboBox,Arr,Fun,Tools){"use strict";var getActiveEditor=function(){return window.tinymce?window.tinymce.activeEditor:EditorManager.activeEditor},history={},toMenuItem=function(target){return{title:target.title,value:{title:{raw:target.title},url:target.url,attach:target.attach}}},toMenuItems=function(targets){return Tools.map(targets,toMenuItem)},staticMenuItem=function(title,url){return{title:title,value:{title:title,url:url,attach:Fun.noop}}},isUniqueUrl=function(url,targets){return!Arr.find(targets,function(target){return target.url===url})},getSetting=function(editorSettings,name,defaultValue){var value=name in editorSettings?editorSettings[name]:defaultValue;return!1===value?null:value},createMenuItems=function(term,targets,fileType,editorSettings){var separator={title:"-"},fromHistoryMenuItems=function(history){var uniqueHistory=Arr.filter(history[fileType],function(url){return isUniqueUrl(url,targets)});return Tools.map(uniqueHistory,function(url){return{title:url,value:{title:url,url:url,attach:Fun.noop}}})},fromMenuItems=function(type){var filteredTargets=Arr.filter(targets,function(target){return target.type==type});return toMenuItems(filteredTargets)};return!1===editorSettings.typeahead_urls?[]:"file"===fileType?function(items){return Arr.reduce(items,function(a,b){return 0===a.length||0===b.length?a.concat(b):a.concat(separator,b)},[])}([filterByQuery(term,fromHistoryMenuItems(history)),filterByQuery(term,fromMenuItems("header")),filterByQuery(term,function(){var anchorMenuItems=fromMenuItems("anchor"),topAnchor=getSetting(editorSettings,"anchor_top","#top"),bottomAchor=getSetting(editorSettings,"anchor_bottom","#bottom");return null!==topAnchor&&anchorMenuItems.unshift(staticMenuItem("<top>",topAnchor)),null!==bottomAchor&&anchorMenuItems.push(staticMenuItem("<bottom>",bottomAchor)),anchorMenuItems}())]):filterByQuery(term,fromHistoryMenuItems(history))},addToHistory=function(url,fileType){var items=history[fileType];/^https?/.test(url)&&(items?-1===Arr.indexOf(items,url)&&(history[fileType]=items.slice(0,5).concat(url)):history[fileType]=[url])},filterByQuery=function(term,menuItems){var lowerCaseTerm=term.toLowerCase(),result=Tools.grep(menuItems,function(item){return-1!==item.title.toLowerCase().indexOf(lowerCaseTerm)});return 1===result.length&&result[0].title===term?[]:result},getTitle=function(linkDetails){var title=linkDetails.title;return title.raw?title.raw:title},setupAutoCompleteHandler=function(ctrl,editorSettings,bodyElm,fileType){var autocomplete=function(term){var linkTargets=LinkTargets.find(bodyElm),menuItems=createMenuItems(term,linkTargets,fileType,editorSettings);ctrl.showAutoComplete(menuItems,term)};ctrl.on("autocomplete",function(){autocomplete(ctrl.value())}),ctrl.on("selectitem",function(e){var linkDetails=e.value;ctrl.value(linkDetails.url);var title=getTitle(linkDetails);"image"===fileType?ctrl.fire("change",{meta:{alt:title,attach:linkDetails.attach}}):ctrl.fire("change",{meta:{text:title,attach:linkDetails.attach}}),ctrl.focus()}),ctrl.on("click",function(e){0===ctrl.value().length&&"INPUT"===e.target.nodeName&&autocomplete("")}),ctrl.on("PostRender",function(){ctrl.getRoot().on("submit",function(e){e.isDefaultPrevented()||addToHistory(ctrl.value(),fileType)})})},statusToUiState=function(result){var status=result.status,message=result.message;return"valid"===status?{status:"ok",message:message}:"unknown"===status?{status:"warn",message:message}:"invalid"===status?{status:"warn",message:message}:{status:"none",message:""}},setupLinkValidatorHandler=function(ctrl,editorSettings,fileType){var validatorHandler=editorSettings.filepicker_validator_handler;if(validatorHandler){var validateUrl=function(url){0!==url.length?validatorHandler({url:url,type:fileType},function(result){var uiState=statusToUiState(result);ctrl.statusMessage(uiState.message),ctrl.statusLevel(uiState.status)}):ctrl.statusLevel("none")};ctrl.state.on("change:value",function(e){validateUrl(e.value)})}};return ComboBox.extend({init:function(settings){var actionCallback,fileBrowserCallback,fileBrowserCallbackTypes,self=this,editor=getActiveEditor(),editorSettings=editor.settings,fileType=settings.filetype;settings.spellcheck=!1,(fileBrowserCallbackTypes=editorSettings.file_picker_types||editorSettings.file_browser_callback_types)&&(fileBrowserCallbackTypes=Tools.makeMap(fileBrowserCallbackTypes,/[, ]/)),fileBrowserCallbackTypes&&!fileBrowserCallbackTypes[fileType]||(!(fileBrowserCallback=editorSettings.file_picker_callback)||fileBrowserCallbackTypes&&!fileBrowserCallbackTypes[fileType]?!(fileBrowserCallback=editorSettings.file_browser_callback)||fileBrowserCallbackTypes&&!fileBrowserCallbackTypes[fileType]||(actionCallback=function(){fileBrowserCallback(self.getEl("inp").id,self.value(),fileType,window)}):actionCallback=function(){var meta=self.fire("beforecall").meta;meta=Tools.extend({filetype:fileType},meta),fileBrowserCallback.call(editor,function(value,meta){self.value(value).fire("change",{meta:meta})},self.value(),meta)}),actionCallback&&(settings.icon="browse",settings.onaction=actionCallback),self._super(settings),setupAutoCompleteHandler(self,editorSettings,editor.getBody(),fileType),setupLinkValidatorHandler(self,editorSettings,fileType)}})}),define("tinymce.core.ui.FitLayout",["tinymce.core.ui.AbsoluteLayout"],function(AbsoluteLayout){"use strict";return AbsoluteLayout.extend({recalc:function(container){var contLayoutRect=container.layoutRect(),paddingBox=container.paddingBox;container.items().filter(":visible").each(function(ctrl){ctrl.layoutRect({x:paddingBox.left,y:paddingBox.top,w:contLayoutRect.innerW-paddingBox.right-paddingBox.left,h:contLayoutRect.innerH-paddingBox.top-paddingBox.bottom}),ctrl.recalc&&ctrl.recalc()})}})}),define("tinymce.core.ui.FlexLayout",["tinymce.core.ui.AbsoluteLayout"],function(AbsoluteLayout){"use strict";return AbsoluteLayout.extend({recalc:function(container){var i,l,items,contLayoutRect,contPaddingBox,contSettings,align,pack,spacing,totalFlex,availableSpace,direction,ctrl,ctrlLayoutRect,flex,size,maxSize,ratio,rect,pos,maxAlignEndPos,sizeName,minSizeName,posName,maxSizeName,beforeName,innerSizeName,deltaSizeName,contentSizeName,alignAxisName,alignInnerSizeName,alignSizeName,alignMinSizeName,alignBeforeName,alignAfterName,alignDeltaSizeName,alignContentSizeName,maxSizeItems=[],max=Math.max,min=Math.min;for(items=container.items().filter(":visible"),contLayoutRect=container.layoutRect(),contPaddingBox=container.paddingBox,contSettings=container.settings,direction=container.isRtl()?contSettings.direction||"row-reversed":contSettings.direction,align=contSettings.align,pack=container.isRtl()?contSettings.pack||"end":contSettings.pack,spacing=contSettings.spacing||0,"row-reversed"!=direction&&"column-reverse"!=direction||(items=items.set(items.toArray().reverse()),direction=direction.split("-")[0]),"column"==direction?(posName="y",sizeName="h",minSizeName="minH",maxSizeName="maxH",innerSizeName="innerH",beforeName="top",deltaSizeName="deltaH",contentSizeName="contentH",alignBeforeName="left",alignSizeName="w",alignAxisName="x",alignInnerSizeName="innerW",alignMinSizeName="minW",alignAfterName="right",alignDeltaSizeName="deltaW",alignContentSizeName="contentW"):(posName="x",sizeName="w",minSizeName="minW",maxSizeName="maxW",innerSizeName="innerW",beforeName="left",deltaSizeName="deltaW",contentSizeName="contentW",alignBeforeName="top",alignSizeName="h",alignAxisName="y",alignInnerSizeName="innerH",alignMinSizeName="minH",alignAfterName="bottom",alignDeltaSizeName="deltaH",alignContentSizeName="contentH"),availableSpace=contLayoutRect[innerSizeName]-contPaddingBox[beforeName]-contPaddingBox[beforeName],maxAlignEndPos=totalFlex=0,i=0,l=items.length;i<l;i++)ctrlLayoutRect=(ctrl=items[i]).layoutRect(),flex=ctrl.settings.flex,availableSpace-=i<l-1?spacing:0,flex>0&&(totalFlex+=flex,ctrlLayoutRect[maxSizeName]&&maxSizeItems.push(ctrl),ctrlLayoutRect.flex=flex),availableSpace-=ctrlLayoutRect[minSizeName],(size=contPaddingBox[alignBeforeName]+ctrlLayoutRect[alignMinSizeName]+contPaddingBox[alignAfterName])>maxAlignEndPos&&(maxAlignEndPos=size);if(rect={},rect[minSizeName]=availableSpace<0?contLayoutRect[minSizeName]-availableSpace+contLayoutRect[deltaSizeName]:contLayoutRect[innerSizeName]-availableSpace+contLayoutRect[deltaSizeName],rect[alignMinSizeName]=maxAlignEndPos+contLayoutRect[alignDeltaSizeName],rect[contentSizeName]=contLayoutRect[innerSizeName]-availableSpace,rect[alignContentSizeName]=maxAlignEndPos,rect.minW=min(rect.minW,contLayoutRect.maxW),rect.minH=min(rect.minH,contLayoutRect.maxH),rect.minW=max(rect.minW,contLayoutRect.startMinWidth),rect.minH=max(rect.minH,contLayoutRect.startMinHeight),!contLayoutRect.autoResize||rect.minW==contLayoutRect.minW&&rect.minH==contLayoutRect.minH){for(ratio=availableSpace/totalFlex,i=0,l=maxSizeItems.length;i<l;i++)maxSize=(ctrlLayoutRect=(ctrl=maxSizeItems[i]).layoutRect())[maxSizeName],(size=ctrlLayoutRect[minSizeName]+ctrlLayoutRect.flex*ratio)>maxSize?(availableSpace-=ctrlLayoutRect[maxSizeName]-ctrlLayoutRect[minSizeName],totalFlex-=ctrlLayoutRect.flex,ctrlLayoutRect.flex=0,ctrlLayoutRect.maxFlexSize=maxSize):ctrlLayoutRect.maxFlexSize=0;for(ratio=availableSpace/totalFlex,pos=contPaddingBox[beforeName],rect={},0===totalFlex&&("end"==pack?pos=availableSpace+contPaddingBox[beforeName]:"center"==pack?(pos=Math.round(contLayoutRect[innerSizeName]/2-(contLayoutRect[innerSizeName]-availableSpace)/2)+contPaddingBox[beforeName])<0&&(pos=contPaddingBox[beforeName]):"justify"==pack&&(pos=contPaddingBox[beforeName],spacing=Math.floor(availableSpace/(items.length-1)))),rect[alignAxisName]=contPaddingBox[alignBeforeName],i=0,l=items.length;i<l;i++)size=(ctrlLayoutRect=(ctrl=items[i]).layoutRect()).maxFlexSize||ctrlLayoutRect[minSizeName],"center"===align?rect[alignAxisName]=Math.round(contLayoutRect[alignInnerSizeName]/2-ctrlLayoutRect[alignSizeName]/2):"stretch"===align?(rect[alignSizeName]=max(ctrlLayoutRect[alignMinSizeName]||0,contLayoutRect[alignInnerSizeName]-contPaddingBox[alignBeforeName]-contPaddingBox[alignAfterName]),rect[alignAxisName]=contPaddingBox[alignBeforeName]):"end"===align&&(rect[alignAxisName]=contLayoutRect[alignInnerSizeName]-ctrlLayoutRect[alignSizeName]-contPaddingBox.top),ctrlLayoutRect.flex>0&&(size+=ctrlLayoutRect.flex*ratio),rect[sizeName]=size,rect[posName]=pos,ctrl.layoutRect(rect),ctrl.recalc&&ctrl.recalc(),pos+=size+spacing}else if(rect.w=rect.minW,rect.h=rect.minH,container.layoutRect(rect),this.recalc(container),null===container._lastRect){var parentCtrl=container.parent();parentCtrl&&(parentCtrl._lastRect=null,parentCtrl.recalc())}}})}),define("tinymce.core.ui.FlowLayout",["tinymce.core.ui.Layout"],function(Layout){return Layout.extend({Defaults:{containerClass:"flow-layout",controlClass:"flow-layout-item",endClass:"break"},recalc:function(container){container.items().filter(":visible").each(function(ctrl){ctrl.recalc&&ctrl.recalc()})},isNative:function(){return!0}})}),define("tinymce.core.fmt.FontInfo",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","tinymce.core.dom.DOMUtils"],function(Fun,Option,Element,Node,DOMUtils){var getSpecifiedFontProp=function(propName,rootElm,elm){for(;elm!==rootElm;){if(elm.style[propName]){var foundStyle=elm.style[propName];return""!==foundStyle?Option.some(foundStyle):Option.none()}elm=elm.parentNode}return Option.none()},getComputedFontProp=function(propName,elm){return Option.from(DOMUtils.DOM.getStyle(elm,propName,!0))},getFontProp=function(propName){return function(rootElm,elm){return Option.from(elm).map(Element.fromDom).filter(Node.isElement).bind(function(element){return getSpecifiedFontProp(propName,rootElm,element.dom()).or(getComputedFontProp(propName,element.dom()))}).getOr("")}};return{getFontSize:getFontProp("fontSize"),getFontFamily:Fun.compose(function(fontFamily){return fontFamily.replace(/[\'\"]/g,"").replace(/,\s+/g,",")},getFontProp("fontFamily")),toPt:function(fontSize){return/[0-9.]+px$/.test(fontSize)?Math.round(72*parseInt(fontSize,10)/96)+"pt":fontSize}}}),define("tinymce.core.ui.FormatControls",["ephox.katamari.api.Fun","ephox.sugar.api.node.Element","ephox.sugar.api.search.SelectorFind","tinymce.core.dom.DOMUtils","tinymce.core.EditorManager","tinymce.core.Env","tinymce.core.fmt.FontInfo","tinymce.core.ui.Control","tinymce.core.ui.FloatPanel","tinymce.core.ui.Widget","tinymce.core.util.Arr","tinymce.core.util.Tools"],function(Fun,Element,SelectorFind,DOMUtils,EditorManager,Env,FontInfo,Control,FloatPanel,Widget,Arr,Tools){function setupContainer(editor){editor.settings.ui_container&&(Env.container=SelectorFind.descendant(Element.fromDom(document.body),editor.settings.ui_container).fold(Fun.constant(null),function(elm){return elm.dom()}))}function setupRtlMode(editor){editor.on("ScriptsLoaded",function(){editor.rtl&&(Control.rtl=!0)})}function registerControls(editor){function createListBoxChangeHandler(items,formatName){return function(){var self=this;editor.on("nodeChange",function(e){var formatter=editor.formatter,value=null;each(e.parents,function(node){if(each(items,function(item){if(formatName?formatter.matchNode(node,formatName,{value:item.value})&&(value=item.value):formatter.matchNode(node,item.value)&&(value=item.value),value)return!1}),value)return!1}),self.value(value)})}}function createFontNameListBoxChangeHandler(items){return function(){var self=this,getFirstFont=function(fontFamily){return fontFamily?fontFamily.split(",")[0]:""};editor.on("init nodeChange",function(e){var fontFamily,value=null;fontFamily=FontInfo.getFontFamily(editor.getBody(),e.element),each(items,function(item){item.value.toLowerCase()===fontFamily.toLowerCase()&&(value=item.value)}),each(items,function(item){value||getFirstFont(item.value).toLowerCase()!==getFirstFont(fontFamily).toLowerCase()||(value=item.value)}),self.value(value),!value&&fontFamily&&self.text(getFirstFont(fontFamily))})}}function createFontSizeListBoxChangeHandler(items){return function(){var self=this;editor.on("init nodeChange",function(e){var px,pt,value=null;px=FontInfo.getFontSize(editor.getBody(),e.element),pt=FontInfo.toPt(px),each(items,function(item){item.value===px?value=px:item.value===pt&&(value=pt)}),self.value(value),value||self.text(pt)})}}function createFormats(formats){for(var i=(formats=formats.replace(/;$/,"").split(";")).length;i--;)formats[i]=formats[i].split("=");return formats}function initOnPostRender(name){return function(){var self=this;editor.formatter?editor.formatter.formatChanged(name,function(state){self.active(state)}):editor.on("init",function(){editor.formatter.formatChanged(name,function(state){self.active(state)})})}}function toggleUndoRedoState(type){return function(){function checkState(){var typeFn="redo"==type?"hasRedo":"hasUndo";return!!editor.undoManager&&editor.undoManager[typeFn]()}var self=this;self.disabled(!checkState()),editor.on("Undo Redo AddUndo TypingUndo ClearUndos SwitchMode",function(){self.disabled(editor.readonly||!checkState())})}}function toggleFormat(fmt){fmt.control&&(fmt=fmt.control.value()),fmt&&editor.execCommand("mceToggleFormat",!1,fmt)}function hideMenuObjects(menu){var count=menu.length;return Tools.each(menu,function(item){item.menu&&(item.hidden=0===hideMenuObjects(item.menu));var formatName=item.format;formatName&&(item.hidden=!editor.formatter.canApply(formatName)),item.hidden&&count--}),count}function hideFormatMenuItems(menu){var count=menu.items().length;return menu.items().each(function(item){item.menu&&item.visible(hideFormatMenuItems(item.menu)>0),!item.menu&&item.settings.menu&&item.visible(hideMenuObjects(item.settings.menu)>0);var formatName=item.settings.format;formatName&&item.visible(editor.formatter.canApply(formatName)),item.visible()||count--}),count}var formatMenu;formatMenu=function(){function createMenu(formats){var menu=[];if(formats)return each(formats,function(format){var menuItem={text:format.title,icon:format.icon};if(format.items)menuItem.menu=createMenu(format.items);else{var formatName=format.format||"custom"+count++;format.format||(format.name=formatName,newFormats.push(format)),menuItem.format=formatName,menuItem.cmd=format.cmd}menu.push(menuItem)}),menu}var count=0,newFormats=[],defaultStyleFormats=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}];return editor.on("init",function(){each(newFormats,function(format){editor.formatter.register(format.name,format)})}),{type:"menu",items:createMenu(editor.settings.style_formats_merge?editor.settings.style_formats?defaultStyleFormats.concat(editor.settings.style_formats):defaultStyleFormats:editor.settings.style_formats||defaultStyleFormats),onPostRender:function(e){editor.fire("renderFormatsMenu",{control:e.control})},itemDefaults:{preview:!0,textStyle:function(){if(this.settings.format)return editor.formatter.getCssText(this.settings.format)},onPostRender:function(){var self=this;self.parent().on("show",function(){var formatName,command;(formatName=self.settings.format)&&(self.disabled(!editor.formatter.canApply(formatName)),self.active(editor.formatter.match(formatName))),(command=self.settings.cmd)&&self.active(editor.queryCommandState(command))})},onclick:function(){this.settings.format&&toggleFormat(this.settings.format),this.settings.cmd&&editor.execCommand(this.settings.cmd)}}}}(),each({bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",subscript:"Subscript",superscript:"Superscript"},function(text,name){editor.addButton(name,{tooltip:text,onPostRender:initOnPostRender(name),onclick:function(){toggleFormat(name)}})}),each({outdent:["Decrease indent","Outdent"],indent:["Increase indent","Indent"],cut:["Cut","Cut"],copy:["Copy","Copy"],paste:["Paste","Paste"],help:["Help","mceHelp"],selectall:["Select all","SelectAll"],removeformat:["Clear formatting","RemoveFormat"],visualaid:["Visual aids","mceToggleVisualAid"],newdocument:["New document","mceNewDocument"]},function(item,name){editor.addButton(name,{tooltip:item[0],cmd:item[1]})}),each({blockquote:["Blockquote","mceBlockQuote"],subscript:["Subscript","Subscript"],superscript:["Superscript","Superscript"],alignleft:["Align left","JustifyLeft"],aligncenter:["Align center","JustifyCenter"],alignright:["Align right","JustifyRight"],alignjustify:["Justify","JustifyFull"],alignnone:["No alignment","JustifyNone"]},function(item,name){editor.addButton(name,{tooltip:item[0],cmd:item[1],onPostRender:initOnPostRender(name)})});var trimMenuItems=function(menuItems){var outputMenuItems=menuItems;return outputMenuItems.length>0&&"-"===outputMenuItems[0].text&&(outputMenuItems=outputMenuItems.slice(1)),outputMenuItems.length>0&&"-"===outputMenuItems[outputMenuItems.length-1].text&&(outputMenuItems=outputMenuItems.slice(0,outputMenuItems.length-1)),outputMenuItems},createCustomMenuItems=function(names){var items,nameList;if("string"==typeof names)nameList=names.split(" ");else if(Tools.isArray(names))return flatten(Tools.map(names,createCustomMenuItems));return items=Tools.grep(nameList,function(name){return"|"===name||name in editor.menuItems}),Tools.map(items,function(name){return"|"===name?{text:"-"}:editor.menuItems[name]})},createContextMenuItems=function(context){var outputMenuItems=[{text:"-"}],menuItems=Tools.grep(editor.menuItems,function(menuItem){return menuItem.context===context});return Tools.each(menuItems,function(menuItem){"before"==menuItem.separator&&outputMenuItems.push({text:"|"}),menuItem.prependToContext?outputMenuItems.unshift(menuItem):outputMenuItems.push(menuItem),"after"==menuItem.separator&&outputMenuItems.push({text:"|"})}),outputMenuItems},createInsertMenu=function(editorSettings){return trimMenuItems(editorSettings.insert_button_items?createCustomMenuItems(editorSettings.insert_button_items):createContextMenuItems("insert"))};editor.addButton("undo",{tooltip:"Undo",onPostRender:toggleUndoRedoState("undo"),cmd:"undo"}),editor.addButton("redo",{tooltip:"Redo",onPostRender:toggleUndoRedoState("redo"),cmd:"redo"}),editor.addMenuItem("newdocument",{text:"New document",icon:"newdocument",cmd:"mceNewDocument"}),editor.addMenuItem("undo",{text:"Undo",icon:"undo",shortcut:"Meta+Z",onPostRender:toggleUndoRedoState("undo"),cmd:"undo"}),editor.addMenuItem("redo",{text:"Redo",icon:"redo",shortcut:"Meta+Y",onPostRender:toggleUndoRedoState("redo"),cmd:"redo"}),editor.addMenuItem("visualaid",{text:"Visual aids",selectable:!0,onPostRender:function(){var self=this;editor.on("VisualAid",function(e){self.active(e.hasVisual)}),self.active(editor.hasVisual)},cmd:"mceToggleVisualAid"}),editor.addButton("remove",{tooltip:"Remove",icon:"remove",cmd:"Delete"}),editor.addButton("insert",{type:"menubutton",icon:"insert",menu:[],oncreatemenu:function(){this.menu.add(createInsertMenu(editor.settings)),this.menu.renderNew()}}),each({cut:["Cut","Cut","Meta+X"],copy:["Copy","Copy","Meta+C"],paste:["Paste","Paste","Meta+V"],selectall:["Select all","SelectAll","Meta+A"],bold:["Bold","Bold","Meta+B"],italic:["Italic","Italic","Meta+I"],underline:["Underline","Underline","Meta+U"],strikethrough:["Strikethrough","Strikethrough"],subscript:["Subscript","Subscript"],superscript:["Superscript","Superscript"],removeformat:["Clear formatting","RemoveFormat"]},function(item,name){editor.addMenuItem(name,{text:item[0],icon:name,shortcut:item[2],cmd:item[1]})}),editor.on("mousedown",function(){FloatPanel.hideAll()}),editor.addButton("styleselect",{type:"menubutton",text:"Formats",menu:formatMenu,onShowMenu:function(){editor.settings.style_formats_autohide&&hideFormatMenuItems(this.menu)}}),editor.addButton("formatselect",function(){var items=[],blocks=createFormats(editor.settings.block_formats||"Paragraph=p;Heading 1=h1;Heading 2=h2;Heading 3=h3;Heading 4=h4;Heading 5=h5;Heading 6=h6;Preformatted=pre");return each(blocks,function(block){items.push({text:block[0],value:block[1],textStyle:function(){return editor.formatter.getCssText(block[1])}})}),{type:"listbox",text:blocks[0][0],values:items,fixedWidth:!0,onselect:toggleFormat,onPostRender:createListBoxChangeHandler(items)}}),editor.addButton("fontselect",function(){var items=[],fonts=createFormats(editor.settings.font_formats||"Andale Mono=andale mono,monospace;Arial=arial,helvetica,sans-serif;Arial Black=arial black,sans-serif;Book Antiqua=book antiqua,palatino,serif;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier,monospace;Georgia=georgia,palatino,serif;Helvetica=helvetica,arial,sans-serif;Impact=impact,sans-serif;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco,monospace;Times New Roman=times new roman,times,serif;Trebuchet MS=trebuchet ms,geneva,sans-serif;Verdana=verdana,geneva,sans-serif;Webdings=webdings;Wingdings=wingdings,zapf dingbats");return each(fonts,function(font){items.push({text:{raw:font[0]},value:font[1],textStyle:-1==font[1].indexOf("dings")?"font-family:"+font[1]:""})}),{type:"listbox",text:"Font Family",tooltip:"Font Family",values:items,fixedWidth:!0,onPostRender:createFontNameListBoxChangeHandler(items),onselect:function(e){e.control.settings.value&&editor.execCommand("FontName",!1,e.control.settings.value)}}}),editor.addButton("fontsizeselect",function(){var items=[],fontsizeFormats=editor.settings.fontsize_formats||"8pt 10pt 12pt 14pt 18pt 24pt 36pt";return each(fontsizeFormats.split(" "),function(item){var text=item,value=item,values=item.split("=");values.length>1&&(text=values[0],value=values[1]),items.push({text:text,value:value})}),{type:"listbox",text:"Font Sizes",tooltip:"Font Sizes",values:items,fixedWidth:!0,onPostRender:createFontSizeListBoxChangeHandler(items),onclick:function(e){e.control.settings.value&&editor.execCommand("FontSize",!1,e.control.settings.value)}}}),editor.addMenuItem("formats",{text:"Formats",menu:formatMenu})}var each=Tools.each,flatten=function(ar){return Arr.reduce(ar,function(result,item){return result.concat(item)},[])};return EditorManager.on("AddEditor",function(e){var editor=e.editor;setupRtlMode(editor),registerControls(editor),setupContainer(editor)}),Control.translate=function(text){return EditorManager.translate(text)},Widget.tooltips=!Env.iOS,{}}),define("tinymce.core.ui.GridLayout",["tinymce.core.ui.AbsoluteLayout"],function(AbsoluteLayout){"use strict";return AbsoluteLayout.extend({recalc:function(container){var settings,rows,cols,items,contLayoutRect,width,height,rect,ctrlLayoutRect,ctrl,x,y,posX,posY,ctrlSettings,contPaddingBox,align,spacingH,spacingV,alignH,alignV,maxX,maxY,ctrlMinWidth,ctrlMinHeight,availableWidth,availableHeight,reverseRows,idx,colWidths=[],rowHeights=[];settings=container.settings,items=container.items().filter(":visible"),contLayoutRect=container.layoutRect(),cols=settings.columns||Math.ceil(Math.sqrt(items.length)),rows=Math.ceil(items.length/cols),spacingH=settings.spacingH||settings.spacing||0,spacingV=settings.spacingV||settings.spacing||0,alignH=settings.alignH||settings.align,alignV=settings.alignV||settings.align,contPaddingBox=container.paddingBox,reverseRows="reverseRows"in settings?settings.reverseRows:container.isRtl(),alignH&&"string"==typeof alignH&&(alignH=[alignH]),alignV&&"string"==typeof alignV&&(alignV=[alignV]);for(x=0;x<cols;x++)colWidths.push(0);for(y=0;y<rows;y++)rowHeights.push(0);for(y=0;y<rows;y++)for(x=0;x<cols&&(ctrl=items[y*cols+x]);x++)ctrlMinWidth=(ctrlLayoutRect=ctrl.layoutRect()).minW,ctrlMinHeight=ctrlLayoutRect.minH,colWidths[x]=ctrlMinWidth>colWidths[x]?ctrlMinWidth:colWidths[x],rowHeights[y]=ctrlMinHeight>rowHeights[y]?ctrlMinHeight:rowHeights[y];for(availableWidth=contLayoutRect.innerW-contPaddingBox.left-contPaddingBox.right,maxX=0,x=0;x<cols;x++)maxX+=colWidths[x]+(x>0?spacingH:0),availableWidth-=(x>0?spacingH:0)+colWidths[x];for(availableHeight=contLayoutRect.innerH-contPaddingBox.top-contPaddingBox.bottom,maxY=0,y=0;y<rows;y++)maxY+=rowHeights[y]+(y>0?spacingV:0),availableHeight-=(y>0?spacingV:0)+rowHeights[y];if(maxX+=contPaddingBox.left+contPaddingBox.right,maxY+=contPaddingBox.top+contPaddingBox.bottom,rect={},rect.minW=maxX+(contLayoutRect.w-contLayoutRect.innerW),rect.minH=maxY+(contLayoutRect.h-contLayoutRect.innerH),rect.contentW=rect.minW-contLayoutRect.deltaW,rect.contentH=rect.minH-contLayoutRect.deltaH,rect.minW=Math.min(rect.minW,contLayoutRect.maxW),rect.minH=Math.min(rect.minH,contLayoutRect.maxH),rect.minW=Math.max(rect.minW,contLayoutRect.startMinWidth),rect.minH=Math.max(rect.minH,contLayoutRect.startMinHeight),!contLayoutRect.autoResize||rect.minW==contLayoutRect.minW&&rect.minH==contLayoutRect.minH){contLayoutRect.autoResize&&((rect=container.layoutRect(rect)).contentW=rect.minW-contLayoutRect.deltaW,rect.contentH=rect.minH-contLayoutRect.deltaH);var flexV;flexV="start"==settings.packV?0:availableHeight>0?Math.floor(availableHeight/rows):0;var totalFlex=0,flexWidths=settings.flexWidths;if(flexWidths)for(x=0;x<flexWidths.length;x++)totalFlex+=flexWidths[x];else totalFlex=cols;var ratio=availableWidth/totalFlex;for(x=0;x<cols;x++)colWidths[x]+=flexWidths?flexWidths[x]*ratio:ratio;for(posY=contPaddingBox.top,y=0;y<rows;y++){for(posX=contPaddingBox.left,height=rowHeights[y]+flexV,x=0;x<cols&&(idx=reverseRows?y*cols+cols-1-x:y*cols+x,ctrl=items[idx]);x++)ctrlSettings=ctrl.settings,ctrlLayoutRect=ctrl.layoutRect(),width=Math.max(colWidths[x],ctrlLayoutRect.startMinWidth),ctrlLayoutRect.x=posX,ctrlLayoutRect.y=posY,"center"==(align=ctrlSettings.alignH||(alignH?alignH[x]||alignH[0]:null))?ctrlLayoutRect.x=posX+width/2-ctrlLayoutRect.w/2:"right"==align?ctrlLayoutRect.x=posX+width-ctrlLayoutRect.w:"stretch"==align&&(ctrlLayoutRect.w=width),"center"==(align=ctrlSettings.alignV||(alignV?alignV[x]||alignV[0]:null))?ctrlLayoutRect.y=posY+height/2-ctrlLayoutRect.h/2:"bottom"==align?ctrlLayoutRect.y=posY+height-ctrlLayoutRect.h:"stretch"==align&&(ctrlLayoutRect.h=height),ctrl.layoutRect(ctrlLayoutRect),posX+=width+spacingH,ctrl.recalc&&ctrl.recalc();posY+=height+spacingV}}else if(rect.w=rect.minW,rect.h=rect.minH,container.layoutRect(rect),this.recalc(container),null===container._lastRect){var parentCtrl=container.parent();parentCtrl&&(parentCtrl._lastRect=null,parentCtrl.recalc())}}})}),define("tinymce.core.ui.Iframe",["tinymce.core.ui.Widget","tinymce.core.util.Delay"],function(Widget,Delay){"use strict";return Widget.extend({renderHtml:function(){var self=this;return self.classes.add("iframe"),self.canFocus=!1,'<iframe id="'+self._id+'" class="'+self.classes+'" tabindex="-1" src="'+(self.settings.url||"javascript:''")+'" frameborder="0"></iframe>'},src:function(src){this.getEl().src=src},html:function(html,callback){var self=this,body=this.getEl().contentWindow.document.body;return body?(body.innerHTML=html,callback&&callback()):Delay.setTimeout(function(){self.html(html)}),this}})}),define("tinymce.core.ui.InfoBox",["tinymce.core.ui.Widget"],function(Widget){"use strict";return Widget.extend({init:function(settings){var self=this;self._super(settings),self.classes.add("widget").add("infobox"),self.canFocus=!1},severity:function(level){this.classes.remove("error"),this.classes.remove("warning"),this.classes.remove("success"),this.classes.add(level)},help:function(state){this.state.set("help",state)},renderHtml:function(){var self=this,prefix=self.classPrefix;return'<div id="'+self._id+'" class="'+self.classes+'"><div id="'+self._id+'-body">'+self.encode(self.state.get("text"))+'<button role="button" tabindex="-1"><i class="'+prefix+"ico "+prefix+'i-help"></i></button></div></div>'},bindStates:function(){var self=this;return self.state.on("change:text",function(e){self.getEl("body").firstChild.data=self.encode(e.value),self.state.get("rendered")&&self.updateLayoutRect()}),self.state.on("change:help",function(e){self.classes.toggle("has-help",e.value),self.state.get("rendered")&&self.updateLayoutRect()}),self._super()}})}),define("tinymce.core.ui.Label",["tinymce.core.ui.Widget","tinymce.core.ui.DomUtils"],function(Widget,DomUtils){"use strict";return Widget.extend({init:function(settings){var self=this;self._super(settings),self.classes.add("widget").add("label"),self.canFocus=!1,settings.multiline&&self.classes.add("autoscroll"),settings.strong&&self.classes.add("strong")},initLayoutRect:function(){var self=this,layoutRect=self._super();return self.settings.multiline&&(DomUtils.getSize(self.getEl()).width>layoutRect.maxW&&(layoutRect.minW=layoutRect.maxW,self.classes.add("multiline")),self.getEl().style.width=layoutRect.minW+"px",layoutRect.startMinH=layoutRect.h=layoutRect.minH=Math.min(layoutRect.maxH,DomUtils.getSize(self.getEl()).height)),layoutRect},repaint:function(){var self=this;return self.settings.multiline||(self.getEl().style.lineHeight=self.layoutRect().h+"px"),self._super()},severity:function(level){this.classes.remove("error"),this.classes.remove("warning"),this.classes.remove("success"),this.classes.add(level)},renderHtml:function(){var targetCtrl,forName,self=this,forId=self.settings.forId,text=self.settings.html?self.settings.html:self.encode(self.state.get("text"));return!forId&&(forName=self.settings.forName)&&(targetCtrl=self.getRoot().find("#"+forName)[0])&&(forId=targetCtrl._id),forId?'<label id="'+self._id+'" class="'+self.classes+'"'+(forId?' for="'+forId+'"':"")+">"+text+"</label>":'<span id="'+self._id+'" class="'+self.classes+'">'+text+"</span>"},bindStates:function(){var self=this;return self.state.on("change:text",function(e){self.innerHtml(self.encode(e.value)),self.state.get("rendered")&&self.updateLayoutRect()}),self._super()}})}),define("tinymce.core.ui.Toolbar",["tinymce.core.ui.Container"],function(Container){"use strict";return Container.extend({Defaults:{role:"toolbar",layout:"flow"},init:function(settings){var self=this;self._super(settings),self.classes.add("toolbar")},postRender:function(){var self=this;return self.items().each(function(ctrl){ctrl.classes.add("toolbar-item")}),self._super()}})}),define("tinymce.core.ui.MenuBar",["tinymce.core.ui.Toolbar"],function(Toolbar){"use strict";return Toolbar.extend({Defaults:{role:"menubar",containerCls:"menubar",ariaRoot:!0,defaults:{type:"menubutton"}}})}),define("tinymce.core.ui.MenuButton",["tinymce.core.ui.Button","tinymce.core.ui.Factory","tinymce.core.ui.MenuBar"],function(Button,Factory,MenuBar){"use strict";function isChildOf(node,parent){for(;node;){if(parent===node)return!0;node=node.parentNode}return!1}var MenuButton=Button.extend({init:function(settings){var self=this;self._renderOpen=!0,self._super(settings),settings=self.settings,self.classes.add("menubtn"),settings.fixedWidth&&self.classes.add("fixed-width"),self.aria("haspopup",!0),self.state.set("menu",settings.menu||self.render())},showMenu:function(toggle){var menu,self=this;if(self.menu&&self.menu.visible()&&!1!==toggle)return self.hideMenu();self.menu||((menu=self.state.get("menu")||[]).length?menu={type:"menu",items:menu}:menu.type=menu.type||"menu",menu.renderTo?self.menu=menu.parent(self).show().renderTo():self.menu=Factory.create(menu).parent(self).renderTo(),self.fire("createmenu"),self.menu.reflow(),self.menu.on("cancel",function(e){e.control.parent()===self.menu&&(e.stopPropagation(),self.focus(),self.hideMenu())}),self.menu.on("select",function(){self.focus()}),self.menu.on("show hide",function(e){e.control==self.menu&&self.activeMenu("show"==e.type),self.aria("expanded","show"==e.type)}).fire("show")),self.menu.show(),self.menu.layoutRect({w:self.layoutRect().w}),self.menu.moveRel(self.getEl(),self.isRtl()?["br-tr","tr-br"]:["bl-tl","tl-bl"]),self.fire("showmenu")},hideMenu:function(){var self=this;self.menu&&(self.menu.items().each(function(item){item.hideMenu&&item.hideMenu()}),self.menu.hide())},activeMenu:function(state){this.classes.toggle("active",state)},renderHtml:function(){var image,self=this,id=self._id,prefix=self.classPrefix,icon=self.settings.icon,text=self.state.get("text"),textHtml="";return(image=self.settings.image)?(icon="none","string"!=typeof image&&(image=window.getSelection?image[0]:image[1]),image=" style=\"background-image: url('"+image+"')\""):image="",text&&(self.classes.add("btn-has-text"),textHtml='<span class="'+prefix+'txt">'+self.encode(text)+"</span>"),icon=self.settings.icon?prefix+"ico "+prefix+"i-"+icon:"",self.aria("role",self.parent()instanceof MenuBar?"menuitem":"button"),'<div id="'+id+'" class="'+self.classes+'" tabindex="-1" aria-labelledby="'+id+'"><button id="'+id+'-open" role="presentation" type="button" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+textHtml+' <i class="'+prefix+'caret"></i></button></div>'},postRender:function(){var self=this;return self.on("click",function(e){e.control===self&&isChildOf(e.target,self.getEl())&&(self.focus(),self.showMenu(!e.aria),e.aria&&self.menu.items().filter(":visible")[0].focus())}),self.on("mouseenter",function(e){var hasVisibleSiblingMenu,overCtrl=e.control,parent=self.parent();overCtrl&&parent&&overCtrl instanceof MenuButton&&overCtrl.parent()==parent&&(parent.items().filter("MenuButton").each(function(ctrl){ctrl.hideMenu&&ctrl!=overCtrl&&(ctrl.menu&&ctrl.menu.visible()&&(hasVisibleSiblingMenu=!0),ctrl.hideMenu())}),hasVisibleSiblingMenu&&(overCtrl.focus(),overCtrl.showMenu()))}),self._super()},bindStates:function(){var self=this;return self.state.on("change:menu",function(){self.menu&&self.menu.remove(),self.menu=null}),self._super()},remove:function(){this._super(),this.menu&&this.menu.remove()}});return MenuButton}),define("tinymce.core.ui.MenuItem",["tinymce.core.ui.Widget","tinymce.core.ui.Factory","tinymce.core.Env","tinymce.core.util.Delay"],function(Widget,Factory,Env,Delay){"use strict";return Widget.extend({Defaults:{border:0,role:"menuitem"},init:function(settings){var text,self=this;self._super(settings),settings=self.settings,self.classes.add("menu-item"),settings.menu&&self.classes.add("menu-item-expand"),settings.preview&&self.classes.add("menu-item-preview"),"-"!==(text=self.state.get("text"))&&"|"!==text||(self.classes.add("menu-item-sep"),self.aria("role","separator"),self.state.set("text","-")),settings.selectable&&(self.aria("role","menuitemcheckbox"),self.classes.add("menu-item-checkbox"),settings.icon="selected"),settings.preview||settings.selectable||self.classes.add("menu-item-normal"),self.on("mousedown",function(e){e.preventDefault()}),settings.menu&&!settings.ariaHideMenu&&self.aria("haspopup",!0)},hasMenus:function(){return!!this.settings.menu},showMenu:function(){var menu,self=this,settings=self.settings,parent=self.parent();if(parent.items().each(function(ctrl){ctrl!==self&&ctrl.hideMenu()}),settings.menu){(menu=self.menu)?menu.show():((menu=settings.menu).length?menu={type:"menu",items:menu}:menu.type=menu.type||"menu",parent.settings.itemDefaults&&(menu.itemDefaults=parent.settings.itemDefaults),(menu=self.menu=Factory.create(menu).parent(self).renderTo()).reflow(),menu.on("cancel",function(e){e.stopPropagation(),self.focus(),menu.hide()}),menu.on("show hide",function(e){e.control.items&&e.control.items().each(function(ctrl){ctrl.active(ctrl.settings.selected)})}).fire("show"),menu.on("hide",function(e){e.control===menu&&self.classes.remove("selected")}),menu.submenu=!0),menu._parentMenu=parent,menu.classes.add("menu-sub");var rel=menu.testMoveRel(self.getEl(),self.isRtl()?["tl-tr","bl-br","tr-tl","br-bl"]:["tr-tl","br-bl","tl-tr","bl-br"]);menu.moveRel(self.getEl(),rel),menu.rel=rel,rel="menu-sub-"+rel,menu.classes.remove(menu._lastRel).add(rel),menu._lastRel=rel,self.classes.add("selected"),self.aria("expanded",!0)}},hideMenu:function(){var self=this;return self.menu&&(self.menu.items().each(function(item){item.hideMenu&&item.hideMenu()}),self.menu.hide(),self.aria("expanded",!1)),self},renderHtml:function(){function escapeRegExp(str){return str.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function markMatches(text){var match=settings.match||"";return match?text.replace(new RegExp(escapeRegExp(match),"gi"),function(match){return"!mce~match["+match+"]mce~match!"}):text}function boldMatches(text){return text.replace(new RegExp(escapeRegExp("!mce~match["),"g"),"<b>").replace(new RegExp(escapeRegExp("]mce~match!"),"g"),"</b>")}var self=this,id=self._id,settings=self.settings,prefix=self.classPrefix,text=self.state.get("text"),icon=self.settings.icon,image="",shortcut=settings.shortcut,url=self.encode(settings.url),iconHtml="";return icon&&self.parent().classes.add("menu-has-icons"),settings.image&&(image=" style=\"background-image: url('"+settings.image+"')\""),shortcut&&(shortcut=function(shortcut){var i,value,replace={};for(replace=Env.mac?{alt:"&#x2325;",ctrl:"&#x2318;",shift:"&#x21E7;",meta:"&#x2318;"}:{meta:"Ctrl"},shortcut=shortcut.split("+"),i=0;i<shortcut.length;i++)(value=replace[shortcut[i].toLowerCase()])&&(shortcut[i]=value);return shortcut.join("+")}(shortcut)),icon=prefix+"ico "+prefix+"i-"+(self.settings.icon||"none"),iconHtml="-"!==text?'<i class="'+icon+'"'+image+"></i>":"",text=boldMatches(self.encode(markMatches(text))),url=boldMatches(self.encode(markMatches(url))),'<div id="'+id+'" class="'+self.classes+'" tabindex="-1">'+iconHtml+("-"!==text?'<span id="'+id+'-text" class="'+prefix+'text">'+text+"</span>":"")+(shortcut?'<div id="'+id+'-shortcut" class="'+prefix+'menu-shortcut">'+shortcut+"</div>":"")+(settings.menu?'<div class="'+prefix+'caret"></div>':"")+(url?'<div class="'+prefix+'menu-item-link">'+url+"</div>":"")+"</div>"},postRender:function(){var self=this,settings=self.settings,textStyle=settings.textStyle;if("function"==typeof textStyle&&(textStyle=textStyle.call(this)),textStyle){var textElm=self.getEl("text");textElm&&textElm.setAttribute("style",textStyle)}return self.on("mouseenter click",function(e){e.control===self&&(settings.menu||"click"!==e.type?(self.showMenu(),e.aria&&self.menu.focus(!0)):(self.fire("select"),Delay.requestAnimationFrame(function(){self.parent().hideAll()})))}),self._super(),self},hover:function(){var self=this;return self.parent().items().each(function(ctrl){ctrl.classes.remove("selected")}),self.classes.toggle("selected",!0),self},active:function(state){return void 0!==state&&this.aria("checked",state),this._super(state)},remove:function(){this._super(),this.menu&&this.menu.remove()}})}),define("tinymce.core.ui.Throbber",["tinymce.core.dom.DomQuery","tinymce.core.ui.Control","tinymce.core.util.Delay"],function($,Control,Delay){"use strict";return function(elm,inline){var state,timer,self=this,classPrefix=Control.classPrefix;self.show=function(time,callback){function render(){state&&($(elm).append('<div class="'+classPrefix+"throbber"+(inline?" "+classPrefix+"throbber-inline":"")+'"></div>'),callback&&callback())}return self.hide(),state=!0,time?timer=Delay.setTimeout(render,time):render(),self},self.hide=function(){var child=elm.lastChild;return Delay.clearTimeout(timer),child&&-1!=child.className.indexOf("throbber")&&child.parentNode.removeChild(child),state=!1,self}}}),define("tinymce.core.ui.Menu",["tinymce.core.ui.FloatPanel","tinymce.core.ui.MenuItem","tinymce.core.ui.Throbber","tinymce.core.util.Tools"],function(FloatPanel,MenuItem,Throbber,Tools){"use strict";return FloatPanel.extend({Defaults:{defaultType:"menuitem",border:1,layout:"stack",role:"application",bodyRole:"menu",ariaRoot:!0},init:function(settings){var self=this;if(settings.autohide=!0,settings.constrainToViewport=!0,"function"==typeof settings.items&&(settings.itemsFactory=settings.items,settings.items=[]),settings.itemDefaults)for(var items=settings.items,i=items.length;i--;)items[i]=Tools.extend({},settings.itemDefaults,items[i]);self._super(settings),self.classes.add("menu")},repaint:function(){return this.classes.toggle("menu-align",!0),this._super(),this.getEl().style.height="",this.getEl("body").style.height="",this},cancel:function(){var self=this;self.hideAll(),self.fire("select")},load:function(){function hideThrobber(){self.throbber&&(self.throbber.hide(),self.throbber=null)}var time,self=this;self.settings.itemsFactory&&(self.throbber||(self.throbber=new Throbber(self.getEl("body"),!0),0===self.items().length?(self.throbber.show(),self.fire("loading")):self.throbber.show(100,function(){self.items().remove(),self.fire("loading")}),self.on("hide close",hideThrobber)),self.requestTime=time=(new Date).getTime(),self.settings.itemsFactory(function(items){0!==items.length?self.requestTime===time&&(self.getEl().style.width="",self.getEl("body").style.width="",hideThrobber(),self.items().remove(),self.getEl("body").innerHTML="",self.add(items),self.renderNew(),self.fire("loaded")):self.hide()}))},hideAll:function(){var self=this;return this.find("menuitem").exec("hideMenu"),self._super()},preRender:function(){var self=this;return self.items().each(function(ctrl){var settings=ctrl.settings;if(settings.icon||settings.image||settings.selectable)return self._hasIcons=!0,!1}),self.settings.itemsFactory&&self.on("postrender",function(){self.settings.itemsFactory&&self.load()}),self._super()}})}),define("tinymce.core.ui.ListBox",["tinymce.core.ui.MenuButton","tinymce.core.ui.Menu"],function(MenuButton,Menu){"use strict";return MenuButton.extend({init:function(settings){function setSelected(menuValues){for(var i=0;i<menuValues.length;i++){if(selected=menuValues[i].selected||settings.value===menuValues[i].value)return selectedText=selectedText||menuValues[i].text,self.state.set("value",menuValues[i].value),!0;if(menuValues[i].menu&&setSelected(menuValues[i].menu))return!0}}var values,selected,selectedText,lastItemCtrl,self=this;self._super(settings),settings=self.settings,self._values=values=settings.values,values&&(void 0!==settings.value&&setSelected(values),!selected&&values.length>0&&(selectedText=values[0].text,self.state.set("value",values[0].value)),self.state.set("menu",values)),self.state.set("text",settings.text||selectedText),self.classes.add("listbox"),self.on("select",function(e){var ctrl=e.control;lastItemCtrl&&(e.lastControl=lastItemCtrl),settings.multiple?ctrl.active(!ctrl.active()):self.value(e.control.value()),lastItemCtrl=ctrl})},bindStates:function(){function activateMenuItemsByValue(menu,value){menu instanceof Menu&&menu.items().each(function(ctrl){ctrl.hasMenus()||ctrl.active(ctrl.value()===value)})}function getSelectedItem(menuValues,value){var selectedItem;if(menuValues)for(var i=0;i<menuValues.length;i++){if(menuValues[i].value===value)return menuValues[i];if(menuValues[i].menu&&(selectedItem=getSelectedItem(menuValues[i].menu,value)))return selectedItem}}var self=this;return self.on("show",function(e){activateMenuItemsByValue(e.control,self.value())}),self.state.on("change:value",function(e){var selectedItem=getSelectedItem(self.state.get("menu"),e.value);selectedItem?self.text(selectedItem.text):self.text(self.settings.text)}),self._super()}})}),define("tinymce.core.ui.Radio",["tinymce.core.ui.Checkbox"],function(Checkbox){"use strict";return Checkbox.extend({Defaults:{classes:"radio",role:"radio"}})}),define("tinymce.core.ui.ResizeHandle",["tinymce.core.ui.Widget","tinymce.core.ui.DragHelper"],function(Widget,DragHelper){"use strict";return Widget.extend({renderHtml:function(){var self=this,prefix=self.classPrefix;return self.classes.add("resizehandle"),"both"==self.settings.direction&&self.classes.add("resizehandle-both"),self.canFocus=!1,'<div id="'+self._id+'" class="'+self.classes+'"><i class="'+prefix+"ico "+prefix+'i-resize"></i></div>'},postRender:function(){var self=this;self._super(),self.resizeDragHelper=new DragHelper(this._id,{start:function(){self.fire("ResizeStart")},drag:function(e){"both"!=self.settings.direction&&(e.deltaX=0),self.fire("Resize",e)},stop:function(){self.fire("ResizeEnd")}})},remove:function(){return this.resizeDragHelper&&this.resizeDragHelper.destroy(),this._super()}})}),define("tinymce.core.ui.SelectBox",["tinymce.core.ui.Widget"],function(Widget){"use strict";function createOptions(options){var strOptions="";if(options)for(var i=0;i<options.length;i++)strOptions+='<option value="'+options[i]+'">'+options[i]+"</option>";return strOptions}return Widget.extend({Defaults:{classes:"selectbox",role:"selectbox",options:[]},init:function(settings){var self=this;self._super(settings),self.settings.size&&(self.size=self.settings.size),self.settings.options&&(self._options=self.settings.options),self.on("keydown",function(e){var rootControl;13==e.keyCode&&(e.preventDefault(),self.parents().reverse().each(function(ctrl){if(ctrl.toJSON)return rootControl=ctrl,!1}),self.fire("submit",{data:rootControl.toJSON()}))})},options:function(state){return arguments.length?(this.state.set("options",state),this):this.state.get("options")},renderHtml:function(){var options,self=this,size="";return options=createOptions(self._options),self.size&&(size=' size = "'+self.size+'"'),'<select id="'+self._id+'" class="'+self.classes+'"'+size+">"+options+"</select>"},bindStates:function(){var self=this;return self.state.on("change:options",function(e){self.getEl().innerHTML=createOptions(e.value)}),self._super()}})}),define("tinymce.core.ui.Slider",["tinymce.core.ui.Widget","tinymce.core.ui.DragHelper","tinymce.core.ui.DomUtils"],function(Widget,DragHelper,DomUtils){"use strict";function constrain(value,minVal,maxVal){return value<minVal&&(value=minVal),value>maxVal&&(value=maxVal),value}function setAriaProp(el,name,value){el.setAttribute("aria-"+name,value)}function updateSliderHandle(ctrl,value){var shortSizeName,sizeName,stylePosName,styleValue,handleEl;"v"==ctrl.settings.orientation?(stylePosName="top",sizeName="height",shortSizeName="h"):(stylePosName="left",sizeName="width",shortSizeName="w"),handleEl=ctrl.getEl("handle"),styleValue=((ctrl.layoutRect()[shortSizeName]||100)-DomUtils.getSize(handleEl)[sizeName])*((value-ctrl._minValue)/(ctrl._maxValue-ctrl._minValue))+"px",handleEl.style[stylePosName]=styleValue,handleEl.style.height=ctrl.layoutRect().h+"px",setAriaProp(handleEl,"valuenow",value),setAriaProp(handleEl,"valuetext",""+ctrl.settings.previewFilter(value)),setAriaProp(handleEl,"valuemin",ctrl._minValue),setAriaProp(handleEl,"valuemax",ctrl._maxValue)}return Widget.extend({init:function(settings){var self=this;settings.previewFilter||(settings.previewFilter=function(value){return Math.round(100*value)/100}),self._super(settings),self.classes.add("slider"),"v"==settings.orientation&&self.classes.add("vertical"),self._minValue=settings.minValue||0,self._maxValue=settings.maxValue||100,self._initValue=self.state.get("value")},renderHtml:function(){var self=this,id=self._id,prefix=self.classPrefix;return'<div id="'+id+'" class="'+self.classes+'"><div id="'+id+'-handle" class="'+prefix+'slider-handle" role="slider" tabindex="-1"></div></div>'},reset:function(){this.value(this._initValue).repaint()},postRender:function(){function toFraction(min,max,val){return(val+min)/(max-min)}function fromFraction(min,max,val){return val*(max-min)-min}var minValue,maxValue,screenCordName,stylePosName,sizeName,shortSizeName,self=this;minValue=self._minValue,maxValue=self._maxValue,"v"==self.settings.orientation?(screenCordName="screenY",stylePosName="top",sizeName="height",shortSizeName="h"):(screenCordName="screenX",stylePosName="left",sizeName="width",shortSizeName="w"),self._super(),function(minValue,maxValue){function alter(delta){var value;value=self.value(),value=constrain(value=fromFraction(minValue,maxValue,toFraction(minValue,maxValue,value)+.05*delta),minValue,maxValue),self.value(value),self.fire("dragstart",{value:value}),self.fire("drag",{value:value}),self.fire("dragend",{value:value})}self.on("keydown",function(e){switch(e.keyCode){case 37:case 38:alter(-1);break;case 39:case 40:alter(1)}})}(minValue,maxValue,self.getEl("handle")),function(minValue,maxValue,handleEl){var startPos,startHandlePos,maxHandlePos,handlePos,value;self._dragHelper=new DragHelper(self._id,{handle:self._id+"-handle",start:function(e){startPos=e[screenCordName],startHandlePos=parseInt(self.getEl("handle").style[stylePosName],10),maxHandlePos=(self.layoutRect()[shortSizeName]||100)-DomUtils.getSize(handleEl)[sizeName],self.fire("dragstart",{value:value})},drag:function(e){var delta=e[screenCordName]-startPos;handlePos=constrain(startHandlePos+delta,0,maxHandlePos),handleEl.style[stylePosName]=handlePos+"px",value=minValue+handlePos/maxHandlePos*(maxValue-minValue),self.value(value),self.tooltip().text(""+self.settings.previewFilter(value)).show().moveRel(handleEl,"bc tc"),self.fire("drag",{value:value})},stop:function(){self.tooltip().hide(),self.fire("dragend",{value:value})}})}(minValue,maxValue,self.getEl("handle"))},repaint:function(){this._super(),updateSliderHandle(this,this.value())},bindStates:function(){var self=this;return self.state.on("change:value",function(e){updateSliderHandle(self,e.value)}),self._super()}})}),define("tinymce.core.ui.Spacer",["tinymce.core.ui.Widget"],function(Widget){"use strict";return Widget.extend({renderHtml:function(){var self=this;return self.classes.add("spacer"),self.canFocus=!1,'<div id="'+self._id+'" class="'+self.classes+'"></div>'}})}),define("tinymce.core.ui.SplitButton",["tinymce.core.ui.MenuButton","tinymce.core.ui.DomUtils","tinymce.core.dom.DomQuery"],function(MenuButton,DomUtils,$){return MenuButton.extend({Defaults:{classes:"widget btn splitbtn",role:"button"},repaint:function(){var mainButtonElm,menuButtonElm,self=this,elm=self.getEl(),rect=self.layoutRect();return self._super(),mainButtonElm=elm.firstChild,menuButtonElm=elm.lastChild,$(mainButtonElm).css({width:rect.w-DomUtils.getSize(menuButtonElm).width,height:rect.h-2}),$(menuButtonElm).css({height:rect.h-2}),self},activeMenu:function(state){var self=this;$(self.getEl().lastChild).toggleClass(self.classPrefix+"active",state)},renderHtml:function(){var image,self=this,id=self._id,prefix=self.classPrefix,icon=self.state.get("icon"),text=self.state.get("text"),textHtml="";return(image=self.settings.image)?(icon="none","string"!=typeof image&&(image=window.getSelection?image[0]:image[1]),image=" style=\"background-image: url('"+image+"')\""):image="",icon=self.settings.icon?prefix+"ico "+prefix+"i-"+icon:"",text&&(self.classes.add("btn-has-text"),textHtml='<span class="'+prefix+'txt">'+self.encode(text)+"</span>"),'<div id="'+id+'" class="'+self.classes+'" role="button" tabindex="-1"><button type="button" hidefocus="1" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+textHtml+'</button><button type="button" class="'+prefix+'open" hidefocus="1" tabindex="-1">'+(self._menuBtnText?(icon?"":"")+self._menuBtnText:"")+' <i class="'+prefix+'caret"></i></button></div>'},postRender:function(){var self=this,onClickHandler=self.settings.onclick;return self.on("click",function(e){var node=e.target;if(e.control==this)for(;node;){if(e.aria&&"down"!=e.aria.key||"BUTTON"==node.nodeName&&-1==node.className.indexOf("open"))return e.stopImmediatePropagation(),void(onClickHandler&&onClickHandler.call(this,e));node=node.parentNode}}),delete self.settings.onclick,self._super()}})}),define("tinymce.core.ui.StackLayout",["tinymce.core.ui.FlowLayout"],function(FlowLayout){"use strict";return FlowLayout.extend({Defaults:{containerClass:"stack-layout",controlClass:"stack-layout-item",endClass:"break"},isNative:function(){return!0}})}),define("tinymce.core.ui.TabPanel",["tinymce.core.ui.Panel","tinymce.core.dom.DomQuery","tinymce.core.ui.DomUtils"],function(Panel,$,DomUtils){"use strict";return Panel.extend({Defaults:{layout:"absolute",defaults:{type:"panel"}},activateTab:function(idx){var activeTabElm;this.activeTabId&&(activeTabElm=this.getEl(this.activeTabId),$(activeTabElm).removeClass(this.classPrefix+"active"),activeTabElm.setAttribute("aria-selected","false")),this.activeTabId="t"+idx,(activeTabElm=this.getEl("t"+idx)).setAttribute("aria-selected","true"),$(activeTabElm).addClass(this.classPrefix+"active"),this.items()[idx].show().fire("showtab"),this.reflow(),this.items().each(function(item,i){idx!=i&&item.hide()})},renderHtml:function(){var self=this,layout=self._layout,tabsHtml="",prefix=self.classPrefix;return self.preRender(),layout.preRender(self),self.items().each(function(ctrl,i){var id=self._id+"-t"+i;ctrl.aria("role","tabpanel"),ctrl.aria("labelledby",id),tabsHtml+='<div id="'+id+'" class="'+prefix+'tab" unselectable="on" role="tab" aria-controls="'+ctrl._id+'" aria-selected="false" tabIndex="-1">'+self.encode(ctrl.settings.title)+"</div>"}),'<div id="'+self._id+'" class="'+self.classes+'" hidefocus="1" tabindex="-1"><div id="'+self._id+'-head" class="'+prefix+'tabs" role="tablist">'+tabsHtml+'</div><div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+layout.renderHtml(self)+"</div></div>"},postRender:function(){var self=this;self._super(),self.settings.activeTab=self.settings.activeTab||0,self.activateTab(self.settings.activeTab),this.on("click",function(e){var targetParent=e.target.parentNode;if(targetParent&&targetParent.id==self._id+"-head")for(var i=targetParent.childNodes.length;i--;)targetParent.childNodes[i]==e.target&&self.activateTab(i)})},initLayoutRect:function(){var rect,minW,minH,self=this;minW=DomUtils.getSize(self.getEl("head")).width,minW=minW<0?0:minW,minH=0,self.items().each(function(item){minW=Math.max(minW,item.layoutRect().minW),minH=Math.max(minH,item.layoutRect().minH)}),self.items().each(function(ctrl){ctrl.settings.x=0,ctrl.settings.y=0,ctrl.settings.w=minW,ctrl.settings.h=minH,ctrl.layoutRect({x:0,y:0,w:minW,h:minH})});var headH=DomUtils.getSize(self.getEl("head")).height;return self.settings.minWidth=minW,self.settings.minHeight=minH+headH,rect=self._super(),rect.deltaH+=headH,rect.innerH=rect.h-rect.deltaH,rect}})}),define("tinymce.core.ui.TextBox",["tinymce.core.ui.Widget","tinymce.core.util.Tools","tinymce.core.ui.DomUtils"],function(Widget,Tools,DomUtils){return Widget.extend({init:function(settings){var self=this;self._super(settings),self.classes.add("textbox"),settings.multiline?self.classes.add("multiline"):(self.on("keydown",function(e){var rootControl;13==e.keyCode&&(e.preventDefault(),self.parents().reverse().each(function(ctrl){if(ctrl.toJSON)return rootControl=ctrl,!1}),self.fire("submit",{data:rootControl.toJSON()}))}),self.on("keyup",function(e){self.state.set("value",e.target.value)}))},repaint:function(){var style,rect,borderBox,borderW,lastRepaintRect,self=this,borderH=0;style=self.getEl().style,rect=self._layoutRect,lastRepaintRect=self._lastRepaintRect||{};var doc=document;return!self.settings.multiline&&doc.all&&(!doc.documentMode||doc.documentMode<=8)&&(style.lineHeight=rect.h-borderH+"px"),borderBox=self.borderBox,borderW=borderBox.left+borderBox.right+8,borderH=borderBox.top+borderBox.bottom+(self.settings.multiline?8:0),rect.x!==lastRepaintRect.x&&(style.left=rect.x+"px",lastRepaintRect.x=rect.x),rect.y!==lastRepaintRect.y&&(style.top=rect.y+"px",lastRepaintRect.y=rect.y),rect.w!==lastRepaintRect.w&&(style.width=rect.w-borderW+"px",lastRepaintRect.w=rect.w),rect.h!==lastRepaintRect.h&&(style.height=rect.h-borderH+"px",lastRepaintRect.h=rect.h),self._lastRepaintRect=lastRepaintRect,self.fire("repaint",{},!1),self},renderHtml:function(){var attrs,elm,self=this,settings=self.settings;return attrs={id:self._id,hidefocus:"1"},Tools.each(["rows","spellcheck","maxLength","size","readonly","min","max","step","list","pattern","placeholder","required","multiple"],function(name){attrs[name]=settings[name]}),self.disabled()&&(attrs.disabled="disabled"),settings.subtype&&(attrs.type=settings.subtype),elm=DomUtils.create(settings.multiline?"textarea":"input",attrs),elm.value=self.state.get("value"),elm.className=self.classes,elm.outerHTML},value:function(value){return arguments.length?(this.state.set("value",value),this):(this.state.get("rendered")&&this.state.set("value",this.getEl().value),this.state.get("value"))},postRender:function(){var self=this;self.getEl().value=self.state.get("value"),self._super(),self.$el.on("change",function(e){self.state.set("value",e.target.value),self.fire("change",e)})},bindStates:function(){var self=this;return self.state.on("change:value",function(e){self.getEl().value!=e.value&&(self.getEl().value=e.value)}),self.state.on("change:disabled",function(e){self.getEl().disabled=e.value}),self._super()},remove:function(){this.$el.off(),this._super()}})}),defineGlobal("global!RegExp",RegExp),define("tinymce.core.ui.DropZone",["tinymce.core.ui.Widget","tinymce.core.util.Tools","tinymce.core.ui.DomUtils","global!RegExp"],function(Widget,Tools,DomUtils,RegExp){return Widget.extend({init:function(settings){var self=this;settings=Tools.extend({height:100,text:"Drop an image here",multiple:!1,accept:null},settings),self._super(settings),self.classes.add("dropzone"),settings.multiple&&self.classes.add("multiple")},renderHtml:function(){var attrs,elm,self=this,cfg=self.settings;return attrs={id:self._id,hidefocus:"1"},elm=DomUtils.create("div",attrs,"<span>"+cfg.text+"</span>"),cfg.height&&DomUtils.css(elm,"height",cfg.height+"px"),cfg.width&&DomUtils.css(elm,"width",cfg.width+"px"),elm.className=self.classes,elm.outerHTML},postRender:function(){var self=this,toggleDragClass=function(e){e.preventDefault(),self.classes.toggle("dragenter"),self.getEl().className=self.classes},filter=function(files){var accept=self.settings.accept;if("string"!=typeof accept)return files;var re=new RegExp("("+accept.split(/\s*,\s*/).join("|")+")$","i");return Tools.grep(files,function(file){return re.test(file.name)})};self._super(),self.$el.on("dragover",function(e){e.preventDefault()}),self.$el.on("dragenter",toggleDragClass),self.$el.on("dragleave",toggleDragClass),self.$el.on("drop",function(e){if(e.preventDefault(),!self.state.get("disabled")){var files=filter(e.dataTransfer.files);self.value=function(){return files.length?self.settings.multiple?files:files[0]:null},files.length&&self.fire("change",e)}})},remove:function(){this.$el.off(),this._super()}})}),define("tinymce.core.ui.BrowseButton",["tinymce.core.ui.Button","tinymce.core.util.Tools","tinymce.core.ui.DomUtils","tinymce.core.dom.DomQuery","global!RegExp"],function(Button,Tools,DomUtils,$,RegExp){return Button.extend({init:function(settings){var self=this;settings=Tools.extend({text:"Browse...",multiple:!1,accept:null},settings),self._super(settings),self.classes.add("browsebutton"),settings.multiple&&self.classes.add("multiple")},postRender:function(){var self=this,input=DomUtils.create("input",{type:"file",id:self._id+"-browse",accept:self.settings.accept});self._super(),$(input).on("change",function(e){var files=e.target.files;self.value=function(){return files.length?self.settings.multiple?files:files[0]:null},e.preventDefault(),files.length&&self.fire("change",e)}),$(input).on("click",function(e){e.stopPropagation()}),$(self.getEl("button")).on("click",function(e){e.stopPropagation(),input.click()}),self.getEl().appendChild(input)},remove:function(){$(this.getEl("button")).off(),$(this.getEl("input")).off(),this._super()}})}),define("tinymce.core.ui.Api",["tinymce.core.ui.Selector","tinymce.core.ui.Collection","tinymce.core.ui.ReflowQueue","tinymce.core.ui.Control","tinymce.core.ui.Factory","tinymce.core.ui.KeyboardNavigation","tinymce.core.ui.Container","tinymce.core.ui.DragHelper","tinymce.core.ui.Scrollable","tinymce.core.ui.Panel","tinymce.core.ui.Movable","tinymce.core.ui.Resizable","tinymce.core.ui.FloatPanel","tinymce.core.ui.Window","tinymce.core.ui.MessageBox","tinymce.core.ui.Tooltip","tinymce.core.ui.Widget","tinymce.core.ui.Progress","tinymce.core.ui.Notification","tinymce.core.ui.Layout","tinymce.core.ui.AbsoluteLayout","tinymce.core.ui.Button","tinymce.core.ui.ButtonGroup","tinymce.core.ui.Checkbox","tinymce.core.ui.ComboBox","tinymce.core.ui.ColorBox","tinymce.core.ui.PanelButton","tinymce.core.ui.ColorButton","tinymce.core.ui.ColorPicker","tinymce.core.ui.Path","tinymce.core.ui.ElementPath","tinymce.core.ui.FormItem","tinymce.core.ui.Form","tinymce.core.ui.FieldSet","tinymce.core.ui.FilePicker","tinymce.core.ui.FitLayout","tinymce.core.ui.FlexLayout","tinymce.core.ui.FlowLayout","tinymce.core.ui.FormatControls","tinymce.core.ui.GridLayout","tinymce.core.ui.Iframe","tinymce.core.ui.InfoBox","tinymce.core.ui.Label","tinymce.core.ui.Toolbar","tinymce.core.ui.MenuBar","tinymce.core.ui.MenuButton","tinymce.core.ui.MenuItem","tinymce.core.ui.Throbber","tinymce.core.ui.Menu","tinymce.core.ui.ListBox","tinymce.core.ui.Radio","tinymce.core.ui.ResizeHandle","tinymce.core.ui.SelectBox","tinymce.core.ui.Slider","tinymce.core.ui.Spacer","tinymce.core.ui.SplitButton","tinymce.core.ui.StackLayout","tinymce.core.ui.TabPanel","tinymce.core.ui.TextBox","tinymce.core.ui.DropZone","tinymce.core.ui.BrowseButton"],function(Selector,Collection,ReflowQueue,Control,Factory,KeyboardNavigation,Container,DragHelper,Scrollable,Panel,Movable,Resizable,FloatPanel,Window,MessageBox,Tooltip,Widget,Progress,Notification,Layout,AbsoluteLayout,Button,ButtonGroup,Checkbox,ComboBox,ColorBox,PanelButton,ColorButton,ColorPicker,Path,ElementPath,FormItem,Form,FieldSet,FilePicker,FitLayout,FlexLayout,FlowLayout,FormatControls,GridLayout,Iframe,InfoBox,Label,Toolbar,MenuBar,MenuButton,MenuItem,Throbber,Menu,ListBox,Radio,ResizeHandle,SelectBox,Slider,Spacer,SplitButton,StackLayout,TabPanel,TextBox,DropZone,BrowseButton){"use strict";var registerToFactory=function(id,ref){Factory.add(id.split(".").pop(),ref)},expose=function(target,id,ref){var i,fragments;for(fragments=id.split(/[.\/]/),i=0;i<fragments.length-1;++i)void 0===target[fragments[i]]&&(target[fragments[i]]={}),target=target[fragments[i]];target[fragments[fragments.length-1]]=ref,registerToFactory(id,ref)},Api={appendTo:function(target){expose(target,"ui.Selector",Selector),expose(target,"ui.Collection",Collection),expose(target,"ui.ReflowQueue",ReflowQueue),expose(target,"ui.Control",Control),expose(target,"ui.Factory",Factory),expose(target,"ui.KeyboardNavigation",KeyboardNavigation),expose(target,"ui.Container",Container),expose(target,"ui.DragHelper",DragHelper),expose(target,"ui.Scrollable",Scrollable),expose(target,"ui.Panel",Panel),expose(target,"ui.Movable",Movable),expose(target,"ui.Resizable",Resizable),expose(target,"ui.FloatPanel",FloatPanel),expose(target,"ui.Window",Window),expose(target,"ui.MessageBox",MessageBox),expose(target,"ui.Tooltip",Tooltip),expose(target,"ui.Widget",Widget),expose(target,"ui.Progress",Progress),expose(target,"ui.Notification",Notification),expose(target,"ui.Layout",Layout),expose(target,"ui.AbsoluteLayout",AbsoluteLayout),expose(target,"ui.Button",Button),expose(target,"ui.ButtonGroup",ButtonGroup),expose(target,"ui.Checkbox",Checkbox),expose(target,"ui.ComboBox",ComboBox),expose(target,"ui.ColorBox",ColorBox),expose(target,"ui.PanelButton",PanelButton),expose(target,"ui.ColorButton",ColorButton),expose(target,"ui.ColorPicker",ColorPicker),expose(target,"ui.Path",Path),expose(target,"ui.ElementPath",ElementPath),expose(target,"ui.FormItem",FormItem),expose(target,"ui.Form",Form),expose(target,"ui.FieldSet",FieldSet),expose(target,"ui.FilePicker",FilePicker),expose(target,"ui.FitLayout",FitLayout),expose(target,"ui.FlexLayout",FlexLayout),expose(target,"ui.FlowLayout",FlowLayout),expose(target,"ui.FormatControls",FormatControls),expose(target,"ui.GridLayout",GridLayout),expose(target,"ui.Iframe",Iframe),expose(target,"ui.InfoBox",InfoBox),expose(target,"ui.Label",Label),expose(target,"ui.Toolbar",Toolbar),expose(target,"ui.MenuBar",MenuBar),expose(target,"ui.MenuButton",MenuButton),expose(target,"ui.MenuItem",MenuItem),expose(target,"ui.Throbber",Throbber),expose(target,"ui.Menu",Menu),expose(target,"ui.ListBox",ListBox),expose(target,"ui.Radio",Radio),expose(target,"ui.ResizeHandle",ResizeHandle),expose(target,"ui.SelectBox",SelectBox),expose(target,"ui.Slider",Slider),expose(target,"ui.Spacer",Spacer),expose(target,"ui.SplitButton",SplitButton),expose(target,"ui.StackLayout",StackLayout),expose(target,"ui.TabPanel",TabPanel),expose(target,"ui.TextBox",TextBox),expose(target,"ui.DropZone",DropZone),expose(target,"ui.BrowseButton",BrowseButton),expose(target,"ui.Api",Api)}};return Api}),define("tinymce.core.api.Tinymce",["tinymce.core.api.Formatter","tinymce.core.geom.Rect","tinymce.core.util.Promise","tinymce.core.util.Delay","tinymce.core.Env","tinymce.core.dom.EventUtils","tinymce.core.dom.Sizzle","tinymce.core.util.Tools","tinymce.core.dom.DomQuery","tinymce.core.html.Styles","tinymce.core.dom.TreeWalker","tinymce.core.html.Entities","tinymce.core.dom.DOMUtils","tinymce.core.dom.ScriptLoader","tinymce.core.AddOnManager","tinymce.core.dom.RangeUtils","tinymce.core.html.Node","tinymce.core.html.Schema","tinymce.core.html.SaxParser","tinymce.core.html.DomParser","tinymce.core.html.Writer","tinymce.core.html.Serializer","tinymce.core.dom.Serializer","tinymce.core.util.VK","tinymce.core.dom.ControlSelection","tinymce.core.dom.BookmarkManager","tinymce.core.dom.Selection","tinymce.core.UndoManager","tinymce.core.EditorCommands","tinymce.core.util.URI","tinymce.core.util.Class","tinymce.core.util.EventDispatcher","tinymce.core.util.Observable","tinymce.core.WindowManager","tinymce.core.NotificationManager","tinymce.core.EditorObservable","tinymce.core.Shortcuts","tinymce.core.Editor","tinymce.core.util.I18n","tinymce.core.FocusManager","tinymce.core.EditorManager","tinymce.core.util.XHR","tinymce.core.util.JSON","tinymce.core.util.JSONRequest","tinymce.core.util.JSONP","tinymce.core.util.LocalStorage","tinymce.core.util.Color","tinymce.core.ui.Api"],function(Formatter,Rect,Promise,Delay,Env,EventUtils,Sizzle,Tools,DomQuery,Styles,TreeWalker,Entities,DOMUtils,ScriptLoader,AddOnManager,RangeUtils,Node,Schema,SaxParser,DomParser,Writer,HtmlSerializer,DomSerializer,VK,ControlSelection,BookmarkManager,Selection,UndoManager,EditorCommands,URI,Class,EventDispatcher,Observable,WindowManager,NotificationManager,EditorObservable,Shortcuts,Editor,I18n,FocusManager,EditorManager,XHR,JSON,JSONRequest,JSONP,LocalStorage,Color,UiApi){var tinymce=EditorManager,publicApi={geom:{Rect:Rect},util:{Promise:Promise,Delay:Delay,Tools:Tools,VK:VK,URI:URI,Class:Class,EventDispatcher:EventDispatcher,Observable:Observable,I18n:I18n,XHR:XHR,JSON:JSON,JSONRequest:JSONRequest,JSONP:JSONP,LocalStorage:LocalStorage,Color:Color},dom:{EventUtils:EventUtils,Sizzle:Sizzle,DomQuery:DomQuery,TreeWalker:TreeWalker,DOMUtils:DOMUtils,ScriptLoader:ScriptLoader,RangeUtils:RangeUtils,Serializer:DomSerializer,ControlSelection:ControlSelection,BookmarkManager:BookmarkManager,Selection:Selection,Event:EventUtils.Event},html:{Styles:Styles,Entities:Entities,Node:Node,Schema:Schema,SaxParser:SaxParser,DomParser:DomParser,Writer:Writer,Serializer:HtmlSerializer},Env:Env,AddOnManager:AddOnManager,Formatter:Formatter,UndoManager:UndoManager,EditorCommands:EditorCommands,WindowManager:WindowManager,NotificationManager:NotificationManager,EditorObservable:EditorObservable,Shortcuts:Shortcuts,Editor:Editor,FocusManager:FocusManager,EditorManager:EditorManager,DOM:DOMUtils.DOM,ScriptLoader:ScriptLoader.ScriptLoader,PluginManager:AddOnManager.PluginManager,ThemeManager:AddOnManager.ThemeManager,trim:Tools.trim,isArray:Tools.isArray,is:Tools.is,toArray:Tools.toArray,makeMap:Tools.makeMap,each:Tools.each,map:Tools.map,grep:Tools.grep,inArray:Tools.inArray,extend:Tools.extend,create:Tools.create,walk:Tools.walk,createNS:Tools.createNS,resolve:Tools.resolve,explode:Tools.explode,_addCacheSuffix:Tools._addCacheSuffix,isOpera:Env.opera,isWebKit:Env.webkit,isIE:Env.ie,isGecko:Env.gecko,isMac:Env.mac};return tinymce=Tools.extend(tinymce,publicApi),UiApi.appendTo(tinymce),tinymce}),define("tinymce.core.api.Main",["ephox.katamari.api.Fun","tinymce.core.api.Tinymce"],function(Fun,Tinymce){var context=this||window,exportToModuleLoaders=function(tinymce){"function"!=typeof context.define||context.define.amd||(context.define("ephox/tinymce",[],Fun.constant(tinymce)),context.define("tinymce.core.EditorManager",[],Fun.constant(tinymce))),"object"==typeof module&&(module.exports=tinymce)},exportToWindowGlobal=function(tinymce){window.tinymce=tinymce,window.tinyMCE=tinymce};return function(){return exportToWindowGlobal(Tinymce),exportToModuleLoaders(Tinymce),Tinymce}}),dem("tinymce.core.api.Main")()}(),function(){var Dropzone,Emitter,ExifRestore,camelize,contentLoaded,detectVerticalSquash,drawImageIOSFix,noop,without,slice=[].slice,extend1=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;noop=function(){},Emitter=function(){function Emitter(){}return Emitter.prototype.addEventListener=Emitter.prototype.on,Emitter.prototype.on=function(event,fn){return this._callbacks=this._callbacks||{},this._callbacks[event]||(this._callbacks[event]=[]),this._callbacks[event].push(fn),this},Emitter.prototype.emit=function(){var args,callbacks,event,j,len;if(event=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],this._callbacks=this._callbacks||{},callbacks=this._callbacks[event])for(j=0,len=callbacks.length;j<len;j++)callbacks[j].apply(this,args);return this},Emitter.prototype.removeListener=Emitter.prototype.off,Emitter.prototype.removeAllListeners=Emitter.prototype.off,Emitter.prototype.removeEventListener=Emitter.prototype.off,Emitter.prototype.off=function(event,fn){var callbacks,i,j,len;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(!(callbacks=this._callbacks[event]))return this;if(1===arguments.length)return delete this._callbacks[event],this;for(i=j=0,len=callbacks.length;j<len;i=++j)if(callbacks[i]===fn){callbacks.splice(i,1);break}return this},Emitter}(),(Dropzone=function(superClass){function Dropzone(element1,options){var elementOptions,fallback,ref;if(this.element=element1,this.version=Dropzone.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(Dropzone.instances.push(this),this.element.dropzone=this,elementOptions=null!=(ref=Dropzone.optionsForElement(this.element))?ref:{},this.options=extend({},this.defaultOptions,elementOptions,null!=options?options:{}),this.options.forceFallback||!Dropzone.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),null!=this.options.renameFilename&&(this.options.renameFile=function(_this){return function(file){return _this.options.renameFilename.call(_this,file.name,file)}}(this)),this.options.method=this.options.method.toUpperCase(),(fallback=this.getExistingFallback())&&fallback.parentNode&&fallback.parentNode.removeChild(fallback),!1!==this.options.previewsContainer&&(this.options.previewsContainer?this.previewsContainer=Dropzone.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(!0===this.options.clickable?this.clickableElements=[this.element]:this.clickableElements=Dropzone.getElements(this.options.clickable,"clickable")),this.init()}var extend,resolveOption;return extend1(Dropzone,Emitter),Dropzone.prototype.Emitter=Emitter,Dropzone.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","addedfiles","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],Dropzone.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,timeout:3e4,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,thumbnailMethod:"crop",resizeWidth:null,resizeHeight:null,resizeMimeType:null,resizeQuality:.8,resizeMethod:"contain",filesizeBase:1e3,maxFiles:null,params:{},headers:null,clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,hiddenInputContainer:"body",capture:null,renameFilename:null,renameFile:null,forceFallback:!1,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",dictFileSizeUnits:{tb:"TB",gb:"GB",mb:"MB",kb:"KB",b:"b"},init:function(){return noop},accept:function(file,done){return done()},fallback:function(){var child,j,len,messageElement,ref,span;for(this.element.className=this.element.className+" dz-browser-not-supported",j=0,len=(ref=this.element.getElementsByTagName("div")).length;j<len;j++)child=ref[j],/(^| )dz-message($| )/.test(child.className)&&(messageElement=child,child.className="dz-message");return messageElement||(messageElement=Dropzone.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(messageElement)),(span=messageElement.getElementsByTagName("span")[0])&&(null!=span.textContent?span.textContent=this.options.dictFallbackMessage:null!=span.innerText&&(span.innerText=this.options.dictFallbackMessage)),this.element.appendChild(this.getFallbackForm())},resize:function(file,width,height,resizeMethod){var info,srcRatio,trgRatio;if(info={srcX:0,srcY:0,srcWidth:file.width,srcHeight:file.height},srcRatio=file.width/file.height,null==width&&null==height?(width=info.srcWidth,height=info.srcHeight):null==width?width=height*srcRatio:null==height&&(height=width/srcRatio),width=Math.min(width,info.srcWidth),height=Math.min(height,info.srcHeight),trgRatio=width/height,info.srcWidth>width||info.srcHeight>height)if("crop"===resizeMethod)srcRatio>trgRatio?(info.srcHeight=file.height,info.srcWidth=info.srcHeight*trgRatio):(info.srcWidth=file.width,info.srcHeight=info.srcWidth/trgRatio);else{if("contain"!==resizeMethod)throw new Error("Unknown resizeMethod '"+resizeMethod+"'");srcRatio>trgRatio?height=width/srcRatio:width=height*srcRatio}return info.srcX=(file.width-info.srcWidth)/2,info.srcY=(file.height-info.srcHeight)/2,info.trgWidth=width,info.trgHeight=height,info},transformFile:function(file,done){return(this.options.resizeWidth||this.options.resizeHeight)&&file.type.match(/image.*/)?this.resizeImage(file,this.options.resizeWidth,this.options.resizeHeight,this.options.resizeMethod,done):done(file)},previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>',drop:function(e){return this.element.classList.remove("dz-drag-hover")},dragstart:noop,dragend:function(e){return this.element.classList.remove("dz-drag-hover")},dragenter:function(e){return this.element.classList.add("dz-drag-hover")},dragover:function(e){return this.element.classList.add("dz-drag-hover")},dragleave:function(e){return this.element.classList.remove("dz-drag-hover")},paste:noop,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(file){var j,k,l,len,len1,len2,ref,ref1,ref2,removeFileEvent,removeLink,results;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(file.previewElement=Dropzone.createElement(this.options.previewTemplate.trim()),file.previewTemplate=file.previewElement,this.previewsContainer.appendChild(file.previewElement),j=0,len=(ref=file.previewElement.querySelectorAll("[data-dz-name]")).length;j<len;j++)ref[j].textContent=file.name;for(k=0,len1=(ref1=file.previewElement.querySelectorAll("[data-dz-size]")).length;k<len1;k++)ref1[k].innerHTML=this.filesize(file.size);for(this.options.addRemoveLinks&&(file._removeLink=Dropzone.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),file.previewElement.appendChild(file._removeLink)),removeFileEvent=function(_this){return function(e){return e.preventDefault(),e.stopPropagation(),file.status===Dropzone.UPLOADING?Dropzone.confirm(_this.options.dictCancelUploadConfirmation,function(){return _this.removeFile(file)}):_this.options.dictRemoveFileConfirmation?Dropzone.confirm(_this.options.dictRemoveFileConfirmation,function(){return _this.removeFile(file)}):_this.removeFile(file)}}(this),results=[],l=0,len2=(ref2=file.previewElement.querySelectorAll("[data-dz-remove]")).length;l<len2;l++)removeLink=ref2[l],results.push(removeLink.addEventListener("click",removeFileEvent));return results}},removedfile:function(file){var ref;return file.previewElement&&null!=(ref=file.previewElement)&&ref.parentNode.removeChild(file.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(file,dataUrl){var j,len,ref,thumbnailElement;if(file.previewElement){for(file.previewElement.classList.remove("dz-file-preview"),j=0,len=(ref=file.previewElement.querySelectorAll("[data-dz-thumbnail]")).length;j<len;j++)(thumbnailElement=ref[j]).alt=file.name,thumbnailElement.src=dataUrl;return setTimeout(function(){return file.previewElement.classList.add("dz-image-preview")},1)}},error:function(file,message){var j,len,node,ref,results;if(file.previewElement){for(file.previewElement.classList.add("dz-error"),"String"!=typeof message&&message.error&&(message=message.error),results=[],j=0,len=(ref=file.previewElement.querySelectorAll("[data-dz-errormessage]")).length;j<len;j++)node=ref[j],results.push(node.textContent=message);return results}},errormultiple:noop,processing:function(file){if(file.previewElement&&(file.previewElement.classList.add("dz-processing"),file._removeLink))return file._removeLink.textContent=this.options.dictCancelUpload},processingmultiple:noop,uploadprogress:function(file,progress,bytesSent){var j,len,node,ref,results;if(file.previewElement){for(results=[],j=0,len=(ref=file.previewElement.querySelectorAll("[data-dz-uploadprogress]")).length;j<len;j++)"PROGRESS"===(node=ref[j]).nodeName?results.push(node.value=progress):results.push(node.style.width=progress+"%");return results}},totaluploadprogress:noop,sending:noop,sendingmultiple:noop,success:function(file){if(file.previewElement)return file.previewElement.classList.add("dz-success")},successmultiple:noop,canceled:function(file){return this.emit("error",file,"Upload canceled.")},canceledmultiple:noop,complete:function(file){if(file._removeLink&&(file._removeLink.textContent=this.options.dictRemoveFile),file.previewElement)return file.previewElement.classList.add("dz-complete")},completemultiple:noop,maxfilesexceeded:noop,maxfilesreached:noop,queuecomplete:noop,addedfiles:noop},extend=function(){var j,key,len,object,objects,target,val;for(target=arguments[0],j=0,len=(objects=2<=arguments.length?slice.call(arguments,1):[]).length;j<len;j++){object=objects[j];for(key in object)val=object[key],target[key]=val}return target},Dropzone.prototype.getAcceptedFiles=function(){var file,j,len,ref,results;for(results=[],j=0,len=(ref=this.files).length;j<len;j++)(file=ref[j]).accepted&&results.push(file);return results},Dropzone.prototype.getRejectedFiles=function(){var file,j,len,ref,results;for(results=[],j=0,len=(ref=this.files).length;j<len;j++)(file=ref[j]).accepted||results.push(file);return results},Dropzone.prototype.getFilesWithStatus=function(status){var file,j,len,ref,results;for(results=[],j=0,len=(ref=this.files).length;j<len;j++)(file=ref[j]).status===status&&results.push(file);return results},Dropzone.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(Dropzone.QUEUED)},Dropzone.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(Dropzone.UPLOADING)},Dropzone.prototype.getAddedFiles=function(){return this.getFilesWithStatus(Dropzone.ADDED)},Dropzone.prototype.getActiveFiles=function(){var file,j,len,ref,results;for(results=[],j=0,len=(ref=this.files).length;j<len;j++)(file=ref[j]).status!==Dropzone.UPLOADING&&file.status!==Dropzone.QUEUED||results.push(file);return results},Dropzone.prototype.init=function(){var eventName,j,len,noPropagation,ref,ref1,setupHiddenFileInput;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(Dropzone.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(setupHiddenFileInput=function(_this){return function(){return _this.hiddenFileInput&&_this.hiddenFileInput.parentNode.removeChild(_this.hiddenFileInput),_this.hiddenFileInput=document.createElement("input"),_this.hiddenFileInput.setAttribute("type","file"),(null==_this.options.maxFiles||_this.options.maxFiles>1)&&_this.hiddenFileInput.setAttribute("multiple","multiple"),_this.hiddenFileInput.className="dz-hidden-input",null!=_this.options.acceptedFiles&&_this.hiddenFileInput.setAttribute("accept",_this.options.acceptedFiles),null!=_this.options.capture&&_this.hiddenFileInput.setAttribute("capture",_this.options.capture),_this.hiddenFileInput.style.visibility="hidden",_this.hiddenFileInput.style.position="absolute",_this.hiddenFileInput.style.top="0",_this.hiddenFileInput.style.left="0",_this.hiddenFileInput.style.height="0",_this.hiddenFileInput.style.width="0",document.querySelector(_this.options.hiddenInputContainer).appendChild(_this.hiddenFileInput),_this.hiddenFileInput.addEventListener("change",function(){var file,files,j,len;if((files=_this.hiddenFileInput.files).length)for(j=0,len=files.length;j<len;j++)file=files[j],_this.addFile(file);return _this.emit("addedfiles",files),setupHiddenFileInput()})}}(this))(),this.URL=null!=(ref=window.URL)?ref:window.webkitURL,j=0,len=(ref1=this.events).length;j<len;j++)eventName=ref1[j],this.on(eventName,this.options[eventName]);return this.on("uploadprogress",function(_this){return function(){return _this.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(_this){return function(){return _this.updateTotalUploadProgress()}}(this)),this.on("canceled",function(_this){return function(file){return _this.emit("complete",file)}}(this)),this.on("complete",function(_this){return function(file){if(0===_this.getAddedFiles().length&&0===_this.getUploadingFiles().length&&0===_this.getQueuedFiles().length)return setTimeout(function(){return _this.emit("queuecomplete")},0)}}(this)),noPropagation=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(_this){return function(e){return _this.emit("dragstart",e)}}(this),dragenter:function(_this){return function(e){return noPropagation(e),_this.emit("dragenter",e)}}(this),dragover:function(_this){return function(e){var efct;try{efct=e.dataTransfer.effectAllowed}catch(undefined){}return e.dataTransfer.dropEffect="move"===efct||"linkMove"===efct?"move":"copy",noPropagation(e),_this.emit("dragover",e)}}(this),dragleave:function(_this){return function(e){return _this.emit("dragleave",e)}}(this),drop:function(_this){return function(e){return noPropagation(e),_this.drop(e)}}(this),dragend:function(_this){return function(e){return _this.emit("dragend",e)}}(this)}}],this.clickableElements.forEach(function(_this){return function(clickableElement){return _this.listeners.push({element:clickableElement,events:{click:function(evt){return(clickableElement!==_this.element||evt.target===_this.element||Dropzone.elementInside(evt.target,_this.element.querySelector(".dz-message")))&&_this.hiddenFileInput.click(),!0}}})}}(this)),this.enable(),this.options.init.call(this)},Dropzone.prototype.destroy=function(){var ref;return this.disable(),this.removeAllFiles(!0),(null!=(ref=this.hiddenFileInput)?ref.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,Dropzone.instances.splice(Dropzone.instances.indexOf(this),1)},Dropzone.prototype.updateTotalUploadProgress=function(){var file,j,len,ref,totalBytes,totalBytesSent,totalUploadProgress;if(totalBytesSent=0,totalBytes=0,this.getActiveFiles().length){for(j=0,len=(ref=this.getActiveFiles()).length;j<len;j++)totalBytesSent+=(file=ref[j]).upload.bytesSent,totalBytes+=file.upload.total;totalUploadProgress=100*totalBytesSent/totalBytes}else totalUploadProgress=100;return this.emit("totaluploadprogress",totalUploadProgress,totalBytes,totalBytesSent)},Dropzone.prototype._getParamName=function(n){return"function"==typeof this.options.paramName?this.options.paramName(n):this.options.paramName+(this.options.uploadMultiple?"["+n+"]":"")},Dropzone.prototype._renameFile=function(file){return"function"!=typeof this.options.renameFile?file.name:this.options.renameFile(file)},Dropzone.prototype.getFallbackForm=function(){var existingFallback,fields,fieldsString,form;return(existingFallback=this.getExistingFallback())?existingFallback:(fieldsString='<div class="dz-fallback">',this.options.dictFallbackText&&(fieldsString+="<p>"+this.options.dictFallbackText+"</p>"),fieldsString+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',fields=Dropzone.createElement(fieldsString),"FORM"!==this.element.tagName?(form=Dropzone.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>')).appendChild(fields):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=form?form:fields)},Dropzone.prototype.getExistingFallback=function(){var fallback,getFallback,j,len,ref,tagName;for(getFallback=function(elements){var el,j,len;for(j=0,len=elements.length;j<len;j++)if(el=elements[j],/(^| )fallback($| )/.test(el.className))return el},j=0,len=(ref=["div","form"]).length;j<len;j++)if(tagName=ref[j],fallback=getFallback(this.element.getElementsByTagName(tagName)))return fallback},Dropzone.prototype.setupEventListeners=function(){var elementListeners,event,j,len,listener,ref,results;for(results=[],j=0,len=(ref=this.listeners).length;j<len;j++)elementListeners=ref[j],results.push(function(){var ref1,results1;ref1=elementListeners.events,results1=[];for(event in ref1)listener=ref1[event],results1.push(elementListeners.element.addEventListener(event,listener,!1));return results1}());return results},Dropzone.prototype.removeEventListeners=function(){var elementListeners,event,j,len,listener,ref,results;for(results=[],j=0,len=(ref=this.listeners).length;j<len;j++)elementListeners=ref[j],results.push(function(){var ref1,results1;ref1=elementListeners.events,results1=[];for(event in ref1)listener=ref1[event],results1.push(elementListeners.element.removeEventListener(event,listener,!1));return results1}());return results},Dropzone.prototype.disable=function(){var file,j,len,ref,results;for(this.clickableElements.forEach(function(element){return element.classList.remove("dz-clickable")}),this.removeEventListeners(),results=[],j=0,len=(ref=this.files).length;j<len;j++)file=ref[j],results.push(this.cancelUpload(file));return results},Dropzone.prototype.enable=function(){return this.clickableElements.forEach(function(element){return element.classList.add("dz-clickable")}),this.setupEventListeners()},Dropzone.prototype.filesize=function(size){var cutoff,i,j,len,selectedSize,selectedUnit,unit,units;if(selectedSize=0,selectedUnit="b",size>0){for(i=j=0,len=(units=["tb","gb","mb","kb","b"]).length;j<len;i=++j)if(unit=units[i],cutoff=Math.pow(this.options.filesizeBase,4-i)/10,size>=cutoff){selectedSize=size/Math.pow(this.options.filesizeBase,4-i),selectedUnit=unit;break}selectedSize=Math.round(10*selectedSize)/10}return"<strong>"+selectedSize+"</strong> "+this.options.dictFileSizeUnits[selectedUnit]},Dropzone.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},Dropzone.prototype.drop=function(e){var files,items;e.dataTransfer&&(this.emit("drop",e),files=e.dataTransfer.files,this.emit("addedfiles",files),files.length&&((items=e.dataTransfer.items)&&items.length&&null!=items[0].webkitGetAsEntry?this._addFilesFromItems(items):this.handleFiles(files)))},Dropzone.prototype.paste=function(e){var items,ref;if(null!=(null!=e&&null!=(ref=e.clipboardData)?ref.items:void 0))return this.emit("paste",e),(items=e.clipboardData.items).length?this._addFilesFromItems(items):void 0},Dropzone.prototype.handleFiles=function(files){var file,j,len,results;for(results=[],j=0,len=files.length;j<len;j++)file=files[j],results.push(this.addFile(file));return results},Dropzone.prototype._addFilesFromItems=function(items){var entry,item,j,len,results;for(results=[],j=0,len=items.length;j<len;j++)null!=(item=items[j]).webkitGetAsEntry&&(entry=item.webkitGetAsEntry())?entry.isFile?results.push(this.addFile(item.getAsFile())):entry.isDirectory?results.push(this._addFilesFromDirectory(entry,entry.name)):results.push(void 0):null!=item.getAsFile&&(null==item.kind||"file"===item.kind)?results.push(this.addFile(item.getAsFile())):results.push(void 0);return results},Dropzone.prototype._addFilesFromDirectory=function(directory,path){var dirReader,errorHandler,readEntries;return dirReader=directory.createReader(),errorHandler=function(error){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(error):void 0},(readEntries=function(_this){return function(){return dirReader.readEntries(function(entries){var entry,j,len;if(entries.length>0){for(j=0,len=entries.length;j<len;j++)(entry=entries[j]).isFile?entry.file(function(file){if(!_this.options.ignoreHiddenFiles||"."!==file.name.substring(0,1))return file.fullPath=path+"/"+file.name,_this.addFile(file)}):entry.isDirectory&&_this._addFilesFromDirectory(entry,path+"/"+entry.name);readEntries()}return null},errorHandler)}}(this))()},Dropzone.prototype.accept=function(file,done){return file.size>1024*this.options.maxFilesize*1024?done(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(file.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):Dropzone.isValidFile(file,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(done(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",file)):this.options.accept.call(this,file,done):done(this.options.dictInvalidFileType)},Dropzone.prototype.addFile=function(file){return file.upload={progress:0,total:file.size,bytesSent:0,filename:this._renameFile(file)},this.files.push(file),file.status=Dropzone.ADDED,this.emit("addedfile",file),this._enqueueThumbnail(file),this.accept(file,function(_this){return function(error){return error?(file.accepted=!1,_this._errorProcessing([file],error)):(file.accepted=!0,_this.options.autoQueue&&_this.enqueueFile(file)),_this._updateMaxFilesReachedClass()}}(this))},Dropzone.prototype.enqueueFiles=function(files){var file,j,len;for(j=0,len=files.length;j<len;j++)file=files[j],this.enqueueFile(file);return null},Dropzone.prototype.enqueueFile=function(file){if(file.status!==Dropzone.ADDED||!0!==file.accepted)throw new Error("This file can't be queued because it has already been processed or was rejected.");if(file.status=Dropzone.QUEUED,this.options.autoProcessQueue)return setTimeout(function(_this){return function(){return _this.processQueue()}}(this),0)},Dropzone.prototype._thumbnailQueue=[],Dropzone.prototype._processingThumbnail=!1,Dropzone.prototype._enqueueThumbnail=function(file){if(this.options.createImageThumbnails&&file.type.match(/image.*/)&&file.size<=1024*this.options.maxThumbnailFilesize*1024)return this._thumbnailQueue.push(file),setTimeout(function(_this){return function(){return _this._processThumbnailQueue()}}(this),0)},Dropzone.prototype._processThumbnailQueue=function(){var file;if(!this._processingThumbnail&&0!==this._thumbnailQueue.length)return this._processingThumbnail=!0,file=this._thumbnailQueue.shift(),this.createThumbnail(file,this.options.thumbnailWidth,this.options.thumbnailHeight,this.options.thumbnailMethod,!0,function(_this){return function(dataUrl){return _this.emit("thumbnail",file,dataUrl),_this._processingThumbnail=!1,_this._processThumbnailQueue()}}(this))},Dropzone.prototype.removeFile=function(file){if(file.status===Dropzone.UPLOADING&&this.cancelUpload(file),this.files=without(this.files,file),this.emit("removedfile",file),0===this.files.length)return this.emit("reset")},Dropzone.prototype.removeAllFiles=function(cancelIfNecessary){var file,j,len,ref;for(null==cancelIfNecessary&&(cancelIfNecessary=!1),j=0,len=(ref=this.files.slice()).length;j<len;j++)((file=ref[j]).status!==Dropzone.UPLOADING||cancelIfNecessary)&&this.removeFile(file);return null},Dropzone.prototype.resizeImage=function(file,width,height,resizeMethod,callback){return this.createThumbnail(file,width,height,resizeMethod,!1,function(_this){return function(dataUrl,canvas){var resizeMimeType,resizedDataURL;return null===canvas?callback(file):(null==(resizeMimeType=_this.options.resizeMimeType)&&(resizeMimeType=file.type),resizedDataURL=canvas.toDataURL(resizeMimeType,_this.options.resizeQuality),"image/jpeg"!==resizeMimeType&&"image/jpg"!==resizeMimeType||(resizedDataURL=ExifRestore.restore(file.dataURL,resizedDataURL)),callback(Dropzone.dataURItoBlob(resizedDataURL)))}}(this))},Dropzone.prototype.createThumbnail=function(file,width,height,resizeMethod,fixOrientation,callback){var fileReader;return fileReader=new FileReader,fileReader.onload=function(_this){return function(){file.dataURL=fileReader.result;if("image/svg+xml"!==file.type)return _this.createThumbnailFromUrl(file,width,height,resizeMethod,fixOrientation,callback);null!=callback&&callback(fileReader.result)}}(this),fileReader.readAsDataURL(file)},Dropzone.prototype.createThumbnailFromUrl=function(file,width,height,resizeMethod,fixOrientation,callback,crossOrigin){var img;return img=document.createElement("img"),crossOrigin&&(img.crossOrigin=crossOrigin),img.onload=function(_this){return function(){var loadExif;return loadExif=function(callback){return callback(1)},"undefined"!=typeof EXIF&&null!==EXIF&&fixOrientation&&(loadExif=function(callback){return EXIF.getData(img,function(){return callback(EXIF.getTag(this,"Orientation"))})}),loadExif(function(orientation){var canvas,ctx,ref,ref1,ref2,ref3,resizeInfo,thumbnail;switch(file.width=img.width,file.height=img.height,resizeInfo=_this.options.resize.call(_this,file,width,height,resizeMethod),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),canvas.width=resizeInfo.trgWidth,canvas.height=resizeInfo.trgHeight,orientation>4&&(canvas.width=resizeInfo.trgHeight,canvas.height=resizeInfo.trgWidth),orientation){case 2:ctx.translate(canvas.width,0),ctx.scale(-1,1);break;case 3:ctx.translate(canvas.width,canvas.height),ctx.rotate(Math.PI);break;case 4:ctx.translate(0,canvas.height),ctx.scale(1,-1);break;case 5:ctx.rotate(.5*Math.PI),ctx.scale(1,-1);break;case 6:ctx.rotate(.5*Math.PI),ctx.translate(0,-canvas.height);break;case 7:ctx.rotate(.5*Math.PI),ctx.translate(canvas.width,-canvas.height),ctx.scale(-1,1);break;case 8:ctx.rotate(-.5*Math.PI),ctx.translate(-canvas.width,0)}if(drawImageIOSFix(ctx,img,null!=(ref=resizeInfo.srcX)?ref:0,null!=(ref1=resizeInfo.srcY)?ref1:0,resizeInfo.srcWidth,resizeInfo.srcHeight,null!=(ref2=resizeInfo.trgX)?ref2:0,null!=(ref3=resizeInfo.trgY)?ref3:0,resizeInfo.trgWidth,resizeInfo.trgHeight),thumbnail=canvas.toDataURL("image/png"),null!=callback)return callback(thumbnail,canvas)})}}(this),null!=callback&&(img.onerror=callback),img.src=file.dataURL},Dropzone.prototype.processQueue=function(){var i,parallelUploads,processingLength,queuedFiles;if(parallelUploads=this.options.parallelUploads,processingLength=this.getUploadingFiles().length,i=processingLength,!(processingLength>=parallelUploads)&&(queuedFiles=this.getQueuedFiles()).length>0){if(this.options.uploadMultiple)return this.processFiles(queuedFiles.slice(0,parallelUploads-processingLength));for(;i<parallelUploads;){if(!queuedFiles.length)return;this.processFile(queuedFiles.shift()),i++}}},Dropzone.prototype.processFile=function(file){return this.processFiles([file])},Dropzone.prototype.processFiles=function(files){var file,j,len;for(j=0,len=files.length;j<len;j++)(file=files[j]).processing=!0,file.status=Dropzone.UPLOADING,this.emit("processing",file);return this.options.uploadMultiple&&this.emit("processingmultiple",files),this.uploadFiles(files)},Dropzone.prototype._getFilesWithXhr=function(xhr){var file;return function(){var j,len,ref,results;for(results=[],j=0,len=(ref=this.files).length;j<len;j++)(file=ref[j]).xhr===xhr&&results.push(file);return results}.call(this)},Dropzone.prototype.cancelUpload=function(file){var groupedFile,groupedFiles,j,k,len,len1,ref;if(file.status===Dropzone.UPLOADING){for(j=0,len=(groupedFiles=this._getFilesWithXhr(file.xhr)).length;j<len;j++)(groupedFile=groupedFiles[j]).status=Dropzone.CANCELED;for(file.xhr.abort(),k=0,len1=groupedFiles.length;k<len1;k++)groupedFile=groupedFiles[k],this.emit("canceled",groupedFile);this.options.uploadMultiple&&this.emit("canceledmultiple",groupedFiles)}else(ref=file.status)!==Dropzone.ADDED&&ref!==Dropzone.QUEUED||(file.status=Dropzone.CANCELED,this.emit("canceled",file),this.options.uploadMultiple&&this.emit("canceledmultiple",[file]));if(this.options.autoProcessQueue)return this.processQueue()},resolveOption=function(){var args,option;return option=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],"function"==typeof option?option.apply(this,args):option},Dropzone.prototype.uploadFile=function(file){return this.uploadFiles([file])},Dropzone.prototype.uploadFiles=function(files){var doneCounter,doneFunction,file,formData,handleError,headerName,headerValue,headers,i,input,inputName,inputType,j,k,key,l,len,len1,len2,len3,m,method,o,option,ref,ref1,ref2,ref3,ref4,ref5,response,results,updateProgress,url,value,xhr;for(xhr=new XMLHttpRequest,j=0,len=files.length;j<len;j++)(file=files[j]).xhr=xhr;method=resolveOption(this.options.method,files),url=resolveOption(this.options.url,files),xhr.open(method,url,!0),xhr.timeout=resolveOption(this.options.timeout,files),xhr.withCredentials=!!this.options.withCredentials,response=null,handleError=function(_this){return function(){var k,len1,results;for(results=[],k=0,len1=files.length;k<len1;k++)file=files[k],results.push(_this._errorProcessing(files,response||_this.options.dictResponseError.replace("{{statusCode}}",xhr.status),xhr));return results}}(this),updateProgress=function(_this){return function(e){var allFilesFinished,k,l,len1,len2,len3,m,progress,results;if(null!=e)for(progress=100*e.loaded/e.total,k=0,len1=files.length;k<len1;k++)(file=files[k]).upload.progress=progress,file.upload.total=e.total,file.upload.bytesSent=e.loaded;else{for(allFilesFinished=!0,progress=100,l=0,len2=files.length;l<len2;l++)100===(file=files[l]).upload.progress&&file.upload.bytesSent===file.upload.total||(allFilesFinished=!1),file.upload.progress=progress,file.upload.bytesSent=file.upload.total;if(allFilesFinished)return}for(results=[],m=0,len3=files.length;m<len3;m++)file=files[m],results.push(_this.emit("uploadprogress",file,progress,file.upload.bytesSent));return results}}(this),xhr.onload=function(_this){return function(e){var ref;if(files[0].status!==Dropzone.CANCELED&&4===xhr.readyState){if("arraybuffer"!==xhr.responseType&&"blob"!==xhr.responseType&&(response=xhr.responseText,xhr.getResponseHeader("content-type")&&~xhr.getResponseHeader("content-type").indexOf("application/json")))try{response=JSON.parse(response)}catch(error1){e=error1,response="Invalid JSON response from server."}return updateProgress(),200<=(ref=xhr.status)&&ref<300?_this._finished(files,response,e):handleError()}}}(this),xhr.onerror=function(){if(files[0].status!==Dropzone.CANCELED)return handleError()},(null!=(ref=xhr.upload)?ref:xhr).onprogress=updateProgress,headers={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&extend(headers,this.options.headers);for(headerName in headers)(headerValue=headers[headerName])&&xhr.setRequestHeader(headerName,headerValue);if(formData=new FormData,this.options.params){ref1=this.options.params;for(key in ref1)value=ref1[key],formData.append(key,value)}for(k=0,len1=files.length;k<len1;k++)file=files[k],this.emit("sending",file,xhr,formData);if(this.options.uploadMultiple&&this.emit("sendingmultiple",files,xhr,formData),"FORM"===this.element.tagName)for(l=0,len2=(ref2=this.element.querySelectorAll("input, textarea, select, button")).length;l<len2;l++)if(input=ref2[l],inputName=input.getAttribute("name"),inputType=input.getAttribute("type"),"SELECT"===input.tagName&&input.hasAttribute("multiple"))for(m=0,len3=(ref3=input.options).length;m<len3;m++)(option=ref3[m]).selected&&formData.append(inputName,option.value);else(!inputType||"checkbox"!==(ref4=inputType.toLowerCase())&&"radio"!==ref4||input.checked)&&formData.append(inputName,input.value);for(doneCounter=0,results=[],i=o=0,ref5=files.length-1;0<=ref5?o<=ref5:o>=ref5;i=0<=ref5?++o:--o)doneFunction=function(_this){return function(file,paramName,fileName){return function(transformedFile){if(formData.append(paramName,transformedFile,fileName),++doneCounter===files.length)return _this.submitRequest(xhr,formData,files)}}}(this),results.push(this.options.transformFile.call(this,files[i],doneFunction(files[i],this._getParamName(i),files[i].upload.filename)));return results},Dropzone.prototype.submitRequest=function(xhr,formData,files){return xhr.send(formData)},Dropzone.prototype._finished=function(files,responseText,e){var file,j,len;for(j=0,len=files.length;j<len;j++)(file=files[j]).status=Dropzone.SUCCESS,this.emit("success",file,responseText,e),this.emit("complete",file);if(this.options.uploadMultiple&&(this.emit("successmultiple",files,responseText,e),this.emit("completemultiple",files)),this.options.autoProcessQueue)return this.processQueue()},Dropzone.prototype._errorProcessing=function(files,message,xhr){var file,j,len;for(j=0,len=files.length;j<len;j++)(file=files[j]).status=Dropzone.ERROR,this.emit("error",file,message,xhr),this.emit("complete",file);if(this.options.uploadMultiple&&(this.emit("errormultiple",files,message,xhr),this.emit("completemultiple",files)),this.options.autoProcessQueue)return this.processQueue()},Dropzone}()).version="5.1.1",Dropzone.options={},Dropzone.optionsForElement=function(element){return element.getAttribute("id")?Dropzone.options[camelize(element.getAttribute("id"))]:void 0},Dropzone.instances=[],Dropzone.forElement=function(element){if("string"==typeof element&&(element=document.querySelector(element)),null==(null!=element?element.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return element.dropzone},Dropzone.autoDiscover=!0,Dropzone.discover=function(){var checkElements,dropzone,dropzones,j,len,results;for(document.querySelectorAll?dropzones=document.querySelectorAll(".dropzone"):(dropzones=[],(checkElements=function(elements){var el,j,len,results;for(results=[],j=0,len=elements.length;j<len;j++)el=elements[j],/(^| )dropzone($| )/.test(el.className)?results.push(dropzones.push(el)):results.push(void 0);return results})(document.getElementsByTagName("div")),checkElements(document.getElementsByTagName("form"))),results=[],j=0,len=dropzones.length;j<len;j++)dropzone=dropzones[j],!1!==Dropzone.optionsForElement(dropzone)?results.push(new Dropzone(dropzone)):results.push(void 0);return results},Dropzone.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],Dropzone.isBrowserSupported=function(){var capableBrowser,j,len,ref;if(capableBrowser=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(j=0,len=(ref=Dropzone.blacklistedBrowsers).length;j<len;j++)ref[j].test(navigator.userAgent)&&(capableBrowser=!1);else capableBrowser=!1;else capableBrowser=!1;return capableBrowser},Dropzone.dataURItoBlob=function(dataURI){var ab,byteString,i,ia,j,mimeString,ref;for(byteString=atob(dataURI.split(",")[1]),mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0],ab=new ArrayBuffer(byteString.length),ia=new Uint8Array(ab),i=j=0,ref=byteString.length;0<=ref?j<=ref:j>=ref;i=0<=ref?++j:--j)ia[i]=byteString.charCodeAt(i);return new Blob([ab],{type:mimeString})},without=function(list,rejectedItem){var item,j,len,results;for(results=[],j=0,len=list.length;j<len;j++)(item=list[j])!==rejectedItem&&results.push(item);return results},camelize=function(str){return str.replace(/[\-_](\w)/g,function(match){return match.charAt(1).toUpperCase()})},Dropzone.createElement=function(string){var div;return div=document.createElement("div"),div.innerHTML=string,div.childNodes[0]},Dropzone.elementInside=function(element,container){if(element===container)return!0;for(;element=element.parentNode;)if(element===container)return!0;return!1},Dropzone.getElement=function(el,name){var element;if("string"==typeof el?element=document.querySelector(el):null!=el.nodeType&&(element=el),null==element)throw new Error("Invalid `"+name+"` option provided. Please provide a CSS selector or a plain HTML element.");return element},Dropzone.getElements=function(els,name){var el,elements,j,k,len,len1,ref;if(els instanceof Array){elements=[];try{for(j=0,len=els.length;j<len;j++)el=els[j],elements.push(this.getElement(el,name))}catch(error1){error1,elements=null}}else if("string"==typeof els)for(elements=[],k=0,len1=(ref=document.querySelectorAll(els)).length;k<len1;k++)el=ref[k],elements.push(el);else null!=els.nodeType&&(elements=[els]);if(null==elements||!elements.length)throw new Error("Invalid `"+name+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return elements},Dropzone.confirm=function(question,accepted,rejected){return window.confirm(question)?accepted():null!=rejected?rejected():void 0},Dropzone.isValidFile=function(file,acceptedFiles){var baseMimeType,j,len,mimeType,validType;if(!acceptedFiles)return!0;for(acceptedFiles=acceptedFiles.split(","),baseMimeType=(mimeType=file.type).replace(/\/.*$/,""),j=0,len=acceptedFiles.length;j<len;j++)if(validType=acceptedFiles[j],"."===(validType=validType.trim()).charAt(0)){if(-1!==file.name.toLowerCase().indexOf(validType.toLowerCase(),file.name.length-validType.length))return!0}else if(/\/\*$/.test(validType)){if(baseMimeType===validType.replace(/\/.*$/,""))return!0}else if(mimeType===validType)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(options){return this.each(function(){return new Dropzone(this,options)})}),"undefined"!=typeof module&&null!==module?module.exports=Dropzone:window.Dropzone=Dropzone,Dropzone.ADDED="added",Dropzone.QUEUED="queued",Dropzone.ACCEPTED=Dropzone.QUEUED,Dropzone.UPLOADING="uploading",Dropzone.PROCESSING=Dropzone.UPLOADING,Dropzone.CANCELED="canceled",Dropzone.ERROR="error",Dropzone.SUCCESS="success",detectVerticalSquash=function(img){var canvas,ctx,data,ey,ih,py,ratio,sy;for(img.naturalWidth,ih=img.naturalHeight,(canvas=document.createElement("canvas")).width=1,canvas.height=ih,(ctx=canvas.getContext("2d")).drawImage(img,0,0),data=ctx.getImageData(1,0,1,ih).data,sy=0,ey=ih,py=ih;py>sy;)0===data[4*(py-1)+3]?ey=py:sy=py,py=ey+sy>>1;return 0===(ratio=py/ih)?1:ratio},drawImageIOSFix=function(ctx,img,sx,sy,sw,sh,dx,dy,dw,dh){var vertSquashRatio;return vertSquashRatio=detectVerticalSquash(img),ctx.drawImage(img,sx,sy,sw,sh,dx,dy,dw,dh/vertSquashRatio)},ExifRestore=function(){function ExifRestore(){}return ExifRestore.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ExifRestore.encode64=function(input){var chr1,chr2,chr3,enc1,enc2,enc3,enc4,i,output;for(output="",chr1=void 0,chr2=void 0,chr3="",enc1=void 0,enc2=void 0,enc3=void 0,enc4="",i=0;;)if(chr1=input[i++],chr2=input[i++],chr3=input[i++],enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+this.KEY_STR.charAt(enc1)+this.KEY_STR.charAt(enc2)+this.KEY_STR.charAt(enc3)+this.KEY_STR.charAt(enc4),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="",!(i<input.length))break;return output},ExifRestore.restore=function(origFileBase64,resizedFileBase64){var image,rawImage,segments;return origFileBase64.match("data:image/jpeg;base64,")?(rawImage=this.decode64(origFileBase64.replace("data:image/jpeg;base64,","")),segments=this.slice2Segments(rawImage),image=this.exifManipulation(resizedFileBase64,segments),"data:image/jpeg;base64,"+this.encode64(image)):resizedFileBase64},ExifRestore.exifManipulation=function(resizedFileBase64,segments){var exifArray,newImageArray;return exifArray=this.getExifArray(segments),newImageArray=this.insertExif(resizedFileBase64,exifArray),new Uint8Array(newImageArray)},ExifRestore.getExifArray=function(segments){var seg,x;for(seg=void 0,x=0;x<segments.length;){if(255===(seg=segments[x])[0]&225===seg[1])return seg;x++}return[]},ExifRestore.insertExif=function(resizedFileBase64,exifArray){var array,ato,buf,imageData,mae,separatePoint;return imageData=resizedFileBase64.replace("data:image/jpeg;base64,",""),buf=this.decode64(imageData),separatePoint=buf.indexOf(255,3),mae=buf.slice(0,separatePoint),ato=buf.slice(separatePoint),array=mae,array=array.concat(exifArray),array=array.concat(ato)},ExifRestore.slice2Segments=function(rawImageArray){var endPoint,head,seg,segments;for(head=0,segments=[];;){if(255===rawImageArray[head]&218===rawImageArray[head+1])break;if(255===rawImageArray[head]&216===rawImageArray[head+1]?head+=2:(endPoint=head+(256*rawImageArray[head+2]+rawImageArray[head+3])+2,seg=rawImageArray.slice(head,endPoint),segments.push(seg),head=endPoint),head>rawImageArray.length)break}return segments},ExifRestore.decode64=function(input){var buf,chr1,chr2,chr3,enc1,enc2,enc3,enc4,i;for("",chr1=void 0,chr2=void 0,chr3="",enc1=void 0,enc2=void 0,enc3=void 0,enc4="",i=0,buf=[],/[^A-Za-z0-9\+\/\=]/g.exec(input)&&console.warning("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");;)if(enc1=this.KEY_STR.indexOf(input.charAt(i++)),enc2=this.KEY_STR.indexOf(input.charAt(i++)),enc3=this.KEY_STR.indexOf(input.charAt(i++)),enc4=this.KEY_STR.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,buf.push(chr1),64!==enc3&&buf.push(chr2),64!==enc4&&buf.push(chr3),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="",!(i<input.length))break;return buf},ExifRestore}(),contentLoaded=function(win,fn){var add,doc,done,init,poll,pre,rem,root,top;if(done=!1,top=!0,doc=win.document,root=doc.documentElement,add=doc.addEventListener?"addEventListener":"attachEvent",rem=doc.addEventListener?"removeEventListener":"detachEvent",pre=doc.addEventListener?"":"on",init=function(e){if("readystatechange"!==e.type||"complete"===doc.readyState)return("load"===e.type?win:doc)[rem](pre+e.type,init,!1),!done&&(done=!0)?fn.call(win,e.type||e):void 0},poll=function(){try{root.doScroll("left")}catch(error1){return error1,void setTimeout(poll,50)}return init("poll")},"complete"!==doc.readyState){if(doc.createEventObject&&root.doScroll){try{top=!win.frameElement}catch(undefined){}top&&poll()}return doc[add](pre+"DOMContentLoaded",init,!1),doc[add](pre+"readystatechange",init,!1),win[add](pre+"load",init,!1)}},Dropzone._autoDiscoverFunction=function(){if(Dropzone.autoDiscover)return Dropzone.discover()},contentLoaded(window,Dropzone._autoDiscoverFunction)}.call(this);