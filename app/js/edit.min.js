/*! elabftw 1.7.1 https://www.elabftw.net */

$(document).ready(function(){function doneTyping(){quickSave(type,id)}document.title=$("#entityInfos").data("title");var type=$("#entityInfos").data("type"),id=$("#entityInfos").data("id"),confirmText=$("#entityInfos").data("confirm"),controller="app/controllers/ExperimentsController.php",location="experiments.php";"experiments"!=type&&(controller="app/controllers/DatabaseController.php",location="database.php");var Entity={destroy:function(){confirm(confirmText)&&("items"===type&&(controller="app/controllers/EntityController.php"),$.post(controller,{destroy:!0,id:id}).done(function(data){data.res?(notif(data.msg,"ok"),window.location.replace(location)):notif(data.msg,"ko")}))}},Tag={controller:"app/controllers/EntityController.php",create:function(e){var keynum;if(e.which&&(keynum=e.which),13===keynum){var tag=$("#createTagInput").val();$.post(this.controller,{createTag:!0,tag:tag,id:id,type:type}).done(function(){$("#tags_div").load(location+"?mode=edit&id="+id+" #tags_div"),$("#createTagInput").val("")})}},destroy:function(tag){confirm(confirmText)&&$.post(this.controller,{destroyTag:!0,type:type,id:id,tag_id:tag}).done(function(){$("#tags_div").load(location+"?mode=edit&id="+id+" #tags_div")})}},Step={controller:"app/controllers/ExperimentsController.php",create:function(e){var keynum;e.which&&(keynum=e.which),13==keynum&&(body=decodeURIComponent($("#stepinput").val()),body.length>0&&$.post(this.controller,{createStep:!0,id:id,body:body}).done(function(){$("#steps_div").load("experiments.php?mode=edit&id="+id+" #steps_div"),$("#stepinput").val("")}))},finish:function(stepId){$.post(this.controller,{finishStep:!0,id:id,stepId:stepId}).done(function(){$("#steps_div").load("experiments.php?mode=edit&id="+id+" #steps_div"),$("#stepinput").val("")})},destroy:function(stepId){confirm(confirmText)&&$.post(this.controller,{destroyStep:!0,id:id,stepId:stepId}).done(function(data){data.res?(notif(data.msg,"ok"),$("#steps_div").load("experiments.php?mode=edit&id="+id+" #steps_div")):notif(data.msg,"ko")})}},Link={controller:"app/controllers/ExperimentsController.php",create:function(e){var keynum;e.which&&(keynum=e.which),13==keynum&&(link=decodeURIComponent($("#linkinput").val()),link.length>0&&(link=parseInt(link,10),isNaN(link)||$.post(this.controller,{createLink:!0,id:id,linkId:link}).done(function(){$("#links_div").load("experiments.php?mode=edit&id="+id+" #links_div"),$("#linkinput").val("")})))},destroy:function(link){confirm(confirmText)&&$.post(this.controller,{destroyLink:!0,id:id,linkId:link}).done(function(data){data.res?(notif(data.msg,"ok"),$("#links_div").load("experiments.php?mode=edit&id="+id+" #links_div")):notif(data.msg,"ko")})}};$(document).on("click",".entityDestroy",function(){Entity.destroy()}),$(document).on("click",".tagDestroy",function(){Tag.destroy($(this).data("tagid"))}),$(document).on("click",".stepDestroy",function(){Step.destroy($(this).data("stepid"))}),$(document).on("click",".linkDestroy",function(){Link.destroy($(this).data("linkid"))}),$(document).on("change","#visibility_select",function(){var visibility=$(this).val();$.post("app/controllers/ExperimentsController.php",{updateVisibility:!0,id:id,visibility:visibility}).done(function(data){data.res?notif(data.msg,"ok"):notif(data.msg,"ko")})}),$(document).on("change","#category_select",function(){var categoryId=$(this).val();$.post("app/controllers/EntityController.php",{updateCategory:!0,id:id,type:type,categoryId:categoryId}).done(function(data){data.res?(notif(data.msg,"ok"),$("#main_section").css("border",null),css="6px solid #"+data.color,$("#main_section").css("border-left",css)):notif(data.msg,"ko")})});var typingTimer;key($("#shortcuts").data("create"),function(){location.href=controller+"?create=true"}),key($("#shortcuts").data("submit"),function(){document.forms.main_form.submit()}),$(document).on("click",".inserter",function(){var imgLink="<img src='app/download.php?f="+$(this).data("link")+"' />";tinymce.activeEditor.execCommand("mceInsertContent",!1,imgLink)}),$(document).on("click",".show-hide",function(){var elem;(elem="doodle"===$(this).data("type")?$(".canvasDiv"):$("#chem_editor")).is(":hidden")?($(this).html("-"),$(this).addClass("button-neutral")):($(this).html("+"),$(this).removeClass("button-neutral")),elem.toggle()}),$(".thumbnail").on("mouseover",".editable",function(){makeEditableFileComment($(this).data("type"),$(this).data("id"))}),$(document).on("keypress","#createTagInput",function(e){Tag.create(e)});var cache={};$("#createTagInput").autocomplete({source:function(request,response){var term=request.term;term in cache?response(cache[term]):$.getJSON("app/controllers/EntityController.php?tag=1&type="+type+"&id="+id,request,function(data,status,xhr){cache[term]=data,response(data)})}}),"experiments"===type&&($("#stepinput").keypress(function(e){Step.create(e)}),$(document).on("click","input[type=checkbox]",function(){Step.finish($(this).data("stepid"))}),$("#linkinput").keypress(function(e){Link.create(e)}),$("#linkinput").autocomplete({source:function(request,response){var term=request.term;term in cache?response(cache[term]):$.getJSON("app/controllers/ExperimentsController.php",request,function(data,status,xhr){cache[term]=data,response(data)})}})),$("#datepicker").datepicker({dateFormat:"yymmdd"}),$("#title_input").focus(function(){$(this).val()===$("#entityInfos").data("untitled")&&$("#title_input").val("")}),Star={controller:"app/controllers/DatabaseController.php",update:function(rating){$.post(this.controller,{rating:rating,id:id}).done(function(data){data.res?notif(data.msg,"ok"):notif(data.msg,"ko")})}},$("input.star").rating(),$(".star").click(function(){Star.update($(this).data("rating").current[0].innerText)}),tinymce.init({mode:"specific_textareas",editor_selector:"mceditable",content_css:"app/css/tinymce.css",plugins:"table textcolor searchreplace code fullscreen insertdatetime paste charmap lists advlist save image imagetools link pagebreak mention codesample",pagebreak_separator:"<pagebreak>",toolbar1:"undo redo | bold italic underline | fontsizeselect | alignleft aligncenter alignright alignjustify | superscript subscript | bullist numlist outdent indent | forecolor backcolor | charmap | codesample | image link | save",removed_menuitems:"newdocument",codesample_languages:[{text:"Bash",value:"bash"},{text:"C",value:"c"},{text:"C++",value:"cpp"},{text:"CSS",value:"css"},{text:"Fortran",value:"fortran"},{text:"Go",value:"go"},{text:"HTML/XML",value:"markup"},{text:"Java",value:"java"},{text:"JavaScript",value:"javascript"},{text:"Julia",value:"julia"},{text:"Latex",value:"latex"},{text:"Makefile",value:"makefile"},{text:"Matlab",value:"matlab"},{text:"Perl",value:"perl"},{text:"Python",value:"python"},{text:"R",value:"r"},{text:"Ruby",value:"ruby"}],save_onsavecallback:function(){quickSave(type,id)},setup:function(editor){editor.addShortcut("ctrl+shift+d","add date at cursor",function(){addDateOnCursor()}),editor.on("keydown",function(event){clearTimeout(typingTimer)}),editor.on("keyup",function(event){clearTimeout(typingTimer),typingTimer=setTimeout(doneTyping,7e3)})},mentions:{delimiter:["#","$"],source:function(query,process,delimiter){var url="app/controllers/EntityController.php?mention=1&term="+query;"#"===delimiter&&$.getJSON(url,function(data,status,xhr){process(data)}),"$"===delimiter&&(url+="&userFilter=1",$.getJSON(url,function(data,status,xhr){process(data)}))}},language:$("#entityInfos").data("lang"),style_formats_merge:!0,style_formats:[{title:"Image Left",selector:"img",styles:{float:"left",margin:"0 10px 0 10px"}},{title:"Image Right",selector:"img",styles:{float:"right",margin:"0 0 10px 10px"}}]})});