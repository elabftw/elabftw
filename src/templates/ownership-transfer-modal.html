{# Modal for ownership transfer #}
<div class='modal fade' id='ownerModal' tabindex='-1' role='dialog' aria-labelledby='ownerModalLabel'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title' id='ownerModalLabel'>{{ 'Transfer ownership'|trans }}</h5>
        <button type='button' class='close' data-dismiss='modal' aria-label='{{ 'Close'|trans }}'>
          <span aria-hidden='true'>&times;</span>
        </button>
      </div>
      <div class='modal-body'>
        {# SELECT TEAM #}
        <label for='team_select'>{{ 'Select a team'|trans }}</label>
        <select required name='team_id' class='form-control' id='team_select' data-action='change-team' autocomplete='off'>
          <option selected disabled value=''>{{ 'Select a team'|trans }}</option>
          {% for team in teamsArr %}
            <option value='{{ team.id }}'>{{ team.name }}</option>
          {% endfor %}
        </select>
        {# SELECT USER #}
        <label for='source_owner'>{{ 'Current owner'|trans }}</label>
        <input type="password" disabled hidden />
        <div class="d-flex align-items-center gap-2">
          {# CURRENT Owner #}
          <input type='text' id='source_owner' disabled value='{{ Entity.entityData.fullname }}' class='form-control'/>
          <div id="autocompleteAnchorDiv_sourceOwnerInput"></div>
          <i class="fas fa-caret-right fa-fw mx-2"></i>
          {# TARGET user #}
          {# this exists so Firefox doesn't process the Search user field as password. No idea why it would do it in the first place though... #}
          {# and autocomplete='off' doesn't work #}
          <label hidden for='target_owner'>{{ 'Search user'|trans }}</label>
          <select class='form-control' id='target_owner' name='owner'>
            {% for user in usersArr %}
              {% set teamIds = [] %}
              {% for team in user.teams|jsonDecode %}
                {% set teamIds = teamIds|merge([team.id]) %}
              {% endfor %}
              <option
                value='{{ user.userid }}' data-teams='{{ teamIds|join(',') }}' {{ user.userid == App.Users.userid ? 'selected' }}> {{ user.fullname }}
              </option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class='modal-footer'>
        <button type='button' class='btn btn-secondary' data-dismiss='modal'>{{ 'Close'|trans }}</button>
        {% if App.Request.getScriptName|split('/')|last == 'admin.php' %}
          <button type='button' class='btn btn-primary' data-action='run-action-selected' data-what='updateowner' data-dismiss='modal'>{{ 'Transfer ownership'|trans }}</button>
        {% else %}
          <button type='button' class='btn btn-primary' data-action='transfer-ownership' data-dismiss='modal'>{{ 'Transfer ownership'|trans }}</button>
        {% endif %}
      </div>
    </div>
  </div>
</div>
