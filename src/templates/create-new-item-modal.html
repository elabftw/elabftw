{# Modal window for creating a new entity #}
{# requires: entityPage + {experiments,resources}CategoriesArr #}

<div class='modal fade' id='createModal_{{ entityPage }}' tabindex='-1' role='dialog' aria-labelledby='createModalLabel'>
  <div class='modal-dialog modal-lg' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title' id='createModalLabel'>{{ 'Create a new entry'|trans }}</h5>
        <button type='button' class='close' data-dismiss='modal' aria-label='{{ 'Close'|trans }}'>
          <span aria-hidden='true'>&times;</span>
        </button>
      </div>
      <form id='createNewForm' aria-label='{{ 'Create a new entry'|trans }}'>
        <div class='modal-body mb-3'>
          <div class='mb-2'>
            <h6><label for='createNewFormTitle'>{{ 'Enter a title'|trans }}</label></h6>
            <input name='title' placeholder='{{ 'Type a descriptive title...'|trans }}' required class='form-control' type='text' id='createNewFormTitle' />
            {# this hidden button is there to validate the form with enter and not have a tplid #}
            <button hidden type='submit' data-action='create-entity' data-type='{{ Entity.entityType.value }}'></button>
          </div>
          <hr>
          <h6>{{ 'Select a template'|trans }}</h6>
          <p class='smallgray'>Une phrase qui explique</p>
            {% set btnId = 'createNewTemplates_' ~ entityPage %}
            <div class='d-flex flex-row justify-content-between mb-2'>
              {% set scopeTarget = entityPage == 'database' ? 'scope_items_types' : 'scope_experiments_templates' %}
              {% include 'scope-button.html' with {'btnId': btnId, 'reload': btnId ~ ',tplCreateNewDiv_' ~ entityPage, 'target': scopeTarget} %}
            </div>

            {# if we're creating item from compounds page or chem-editor page, use 'create-resource-from-compound' action. #}
            {# set action = (scriptName == 'compounds.php' or scriptName == 'chem-editor.php') ? actionName : 'create-entity-ask-title' #}
            <div class='d-flex text-nowrap flex-wrap'>
              <a class='btn btn-ghost m-1' href='#' data-action='filter-category' data-target='tplCreateNewTable_{{ entityPage }}' data-catid='-1'>
                <span class='round-spot round-spot-ghost mr-1'></span>{{ 'No category'|trans }}
              </a>
              {% set categoryArr = entityPage == 'experiments' ? App.experimentsCategoryArr : App.itemsCategoryArr %}
              {% for category in categoryArr %}
                <a class='btn btn-ghost m-1' href='#' data-action='filter-category' data-target='tplCreateNewTable_{{ entityPage }}' data-type='{{ entityPage }}' data-catid='{{ category.id }}'>
                  <span class='round-spot mr-1' style='background-color: #{{ category.color }};'></span>{{ category.title }}
                </a>
              {% endfor %}
              <button type='button' class='btn btn-ghost my-1 ml-auto' hidden data-action='reset-filter-category' data-target='tplCreateNewTable_{{ entityPage }}'>
                {{ 'Reset filters'|trans }}
              </button>
            </div>

            <input type='text' aria-label='{{ 'Filter'|trans }}' placeholder='{{ 'Search a template...'|trans }}' data-filter-target='tplCreateNewTable_{{ entityPage }}' data-target-type='tr' class='form-control form-inline my-1'>
            <div id='tplCreateNewDiv_{{ entityPage }}' class='vertically-limited'>
              {% if templatesArr|length == 0 %}
                {{ 'No templates found.'|trans }}
              {% else %}
                <table class='table' aria-describedby='createModalLabel_{{ entityPage }}' data-table-sort='true'>
                  <thead>
                    <tr>
                      <th scope='col'>{{ 'Title'|trans }}</th>
                      <th scope='col'>{{ 'Owner'|trans }}</th>
                      <th class='no-sort'></th>
                    </tr>
                  </thead>
                  <tbody id='tplCreateNewTable_{{ entityPage }}'>
                  {% set label = entityPage == 'database' ? 'Create resource from template'|trans : 'Create experiment from template'|trans %}
                  {% for template in templatesArr %}
                    <tr data-catid='{{ template.category|default('-1') }}'>
                      <td data-label='{{ 'Title'|trans }}'>
                        {% if template.category_title %}
                        <span class='catstat-btn category-btn mr-2' title='{{ 'Filter category'|trans }}' data-action='filter-category' data-target='tplCreateNewTable_{{ entityPage }}' data-catid='{{ template.category }}' style='--bg: #{{ template.category_color|default('bdbdbd') }}'>{{ template.category_title }}</span>
                        {% endif %}
                        {% if template.status %}
                          <span class='catstat-btn status-btn mr-2' style='--bg: #{{ template.status_color|default('bdbdbd') }}'>{{ template.status_title }}</span>
                        {% endif %}
                        {{ template.title }}
                      </td>
                      <td data-label='{{ 'Owner'|trans }}'>{{ template.fullname }}</td>
                      <td data-label='{{ 'Actions'|trans }}'>
                        <div class='d-flex flex-nowrap'>
                          <button type='submit' class='btn btn-primary mr-1' data-action='create-entity' title='{{ label }}' data-type='{{ entityPage }}' data-tplid='{{ template.id }}' ><i class='fas fa-file-circle-plus color-white'></i></button>
                          <a href='{{ Entity.entityType.toTemplatePage() }}?mode=view&id={{ template.id }}' class='btn btn-ghost' title='{{ 'View template'|trans }}' aria-label='{{ 'View template'|trans }}'>
                            <i class='fas fa-eye fa-fw'></i>
                          </a>
                        </div>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% endif %}
          </div>
        </div>
        <div class='modal-footer d-flex'>
          {% set templatesPage = Entity.entityType.toTemplatePage()|default(entityPage == 'database' ? 'resources-templates.php' : 'templates.php') %}
          <a href='{{ templatesPage }}' class='btn btn-ghost'><i class='fas fa-cogs mr-1'></i>{{ 'Manage templates'|trans }}</a>
          <div class='ml-auto'>
            <button type='button' class='btn btn-ghost' data-dismiss='modal'>{{ 'Cancel'|trans }}</button>
            <button type='button' data-action='create-entity' data-type='{{ Entity.entityType.value }}' data-has-title='1' data-form-id='createNewForm' class='btn btn-primary'>{{ 'Create without template'|trans }}</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
{# end modal #}
