/*! elabftw 03-01-2016 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";var b=0,c='<div class="ui-colorpicker ui-colorpicker-dialog ui-dialog ui-widget ui-widget-content ui-corner-all" style="display: none;"></div>',d='<div class="ui-colorpicker ui-colorpicker-inline ui-dialog ui-widget ui-widget-content ui-corner-all"></div>',e='<div class="ui-colorpicker ui-colorpicker-inline"></div>',f=function(a){var b=Math.round(a).toString(16);return 1===b.length&&(b="0"+b),b.toLowerCase()},g=function(b){var c,d;return d=/^#?([a-fA-F0-9]{1,6})$/.exec(b),d?(c=parseInt(d[1],16),new a.colorpicker.Color((c>>16&255)/255,(c>>8&255)/255,(255&c)/255)):new a.colorpicker.Color},h=function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(b.sort(function(a,b){return a.pos[1]===b.pos[1]?a.pos[0]-b.pos[0]:a.pos[1]-b.pos[1]}),g=0,h=0,a.each(b,function(a,b){g=Math.max(g,b.pos[0]+b.pos[2]),h=Math.max(h,b.pos[1]+b.pos[3])}),d=[],e=0;g>e;++e)d.push([]);for(j=[],i=[],a.each(b,function(a,b){for(e=0;e<b.pos[2];e+=1)i[b.pos[0]+e]=!0;for(f=0;f<b.pos[3];f+=1)j[b.pos[1]+f]=!0}),m="",l=b[k=0],f=0;h>f;++f){for(m+="<tr>",e=0;g>e;)if("undefined"!=typeof l&&e===l.pos[0]&&f===l.pos[1]){for(m+=c(l,e,f),o=0;o<l.pos[3];o+=1)for(n=0;n<l.pos[2];n+=1)d[e+n][f+o]=!0;e+=l.pos[2],l=b[++k]}else{for(p=0,q=!1;g>e&&void 0===d[e][f]&&(void 0===l||f<l.pos[1]||f===l.pos[1]&&e<l.pos[0]);)i[e]===!0&&(p+=1),q=!0,e+=1;p>0?m+='<td colspan="'+p+'"></td>':q||(e+=1)}m+="</tr>"}return'<table cellspacing="0" cellpadding="0" border="0"><tbody>'+m+"</tbody></table>"};return a.colorpicker=new function(){this.regional={"":{ok:"OK",cancel:"Cancel",none:"None",button:"Color",title:"Pick a color",transparent:"Transparent",hsvH:"H",hsvS:"S",hsvV:"V",rgbR:"R",rgbG:"G",rgbB:"B",labL:"L",labA:"a",labB:"b",hslH:"H",hslS:"S",hslL:"L",cmykC:"C",cmykM:"M",cmykY:"Y",cmykK:"K",alphaA:"A"}},this.swatchesNames={html:"HTML"},this.swatches={html:[{name:"black",r:0,g:0,b:0},{name:"dimgray",r:.4117647058823529,g:.4117647058823529,b:.4117647058823529},{name:"gray",r:.5019607843137255,g:.5019607843137255,b:.5019607843137255},{name:"darkgray",r:.6627450980392157,g:.6627450980392157,b:.6627450980392157},{name:"silver",r:.7529411764705882,g:.7529411764705882,b:.7529411764705882},{name:"lightgrey",r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},{name:"gainsboro",r:.8627450980392157,g:.8627450980392157,b:.8627450980392157},{name:"whitesmoke",r:.9607843137254902,g:.9607843137254902,b:.9607843137254902},{name:"white",r:1,g:1,b:1},{name:"rosybrown",r:.7372549019607844,g:.5607843137254902,b:.5607843137254902},{name:"indianred",r:.803921568627451,g:.3607843137254902,b:.3607843137254902},{name:"brown",r:.6470588235294118,g:.16470588235294117,b:.16470588235294117},{name:"firebrick",r:.6980392156862745,g:.13333333333333333,b:.13333333333333333},{name:"lightcoral",r:.9411764705882353,g:.5019607843137255,b:.5019607843137255},{name:"maroon",r:.5019607843137255,g:0,b:0},{name:"darkred",r:.5450980392156862,g:0,b:0},{name:"red",r:1,g:0,b:0},{name:"snow",r:1,g:.9803921568627451,b:.9803921568627451},{name:"salmon",r:.9803921568627451,g:.5019607843137255,b:.4470588235294118},{name:"mistyrose",r:1,g:.8941176470588236,b:.8823529411764706},{name:"tomato",r:1,g:.38823529411764707,b:.2784313725490196},{name:"darksalmon",r:.9137254901960784,g:.5882352941176471,b:.47843137254901963},{name:"orangered",r:1,g:.27058823529411763,b:0},{name:"coral",r:1,g:.4980392156862745,b:.3137254901960784},{name:"lightsalmon",r:1,g:.6274509803921569,b:.47843137254901963},{name:"sienna",r:.6274509803921569,g:.3215686274509804,b:.17647058823529413},{name:"seashell",r:1,g:.9607843137254902,b:.9333333333333333},{name:"chocolate",r:.8235294117647058,g:.4117647058823529,b:.11764705882352941},{name:"saddlebrown",r:.5450980392156862,g:.27058823529411763,b:.07450980392156863},{name:"sandybrown",r:.9568627450980393,g:.6431372549019608,b:.3764705882352941},{name:"peachpuff",r:1,g:.8549019607843137,b:.7254901960784313},{name:"peru",r:.803921568627451,g:.5215686274509804,b:.24705882352941178},{name:"linen",r:.9803921568627451,g:.9411764705882353,b:.9019607843137255},{name:"darkorange",r:1,g:.5490196078431373,b:0},{name:"bisque",r:1,g:.8941176470588236,b:.7686274509803922},{name:"burlywood",r:.8705882352941177,g:.7215686274509804,b:.5294117647058824},{name:"tan",r:.8235294117647058,g:.7058823529411765,b:.5490196078431373},{name:"antiquewhite",r:.9803921568627451,g:.9215686274509803,b:.8431372549019608},{name:"navajowhite",r:1,g:.8705882352941177,b:.6784313725490196},{name:"blanchedalmond",r:1,g:.9215686274509803,b:.803921568627451},{name:"papayawhip",r:1,g:.9372549019607843,b:.8352941176470589},{name:"orange",r:1,g:.6470588235294118,b:0},{name:"moccasin",r:1,g:.8941176470588236,b:.7098039215686275},{name:"wheat",r:.9607843137254902,g:.8705882352941177,b:.7019607843137254},{name:"oldlace",r:.9921568627450981,g:.9607843137254902,b:.9019607843137255},{name:"floralwhite",r:1,g:.9803921568627451,b:.9411764705882353},{name:"goldenrod",r:.8549019607843137,g:.6470588235294118,b:.12549019607843137},{name:"darkgoldenrod",r:.7215686274509804,g:.5254901960784314,b:.043137254901960784},{name:"cornsilk",r:1,g:.9725490196078431,b:.8627450980392157},{name:"gold",r:1,g:.8431372549019608,b:0},{name:"palegoldenrod",r:.9333333333333333,g:.9098039215686274,b:.6666666666666666},{name:"khaki",r:.9411764705882353,g:.9019607843137255,b:.5490196078431373},{name:"lemonchiffon",r:1,g:.9803921568627451,b:.803921568627451},{name:"darkkhaki",r:.7411764705882353,g:.7176470588235294,b:.4196078431372549},{name:"beige",r:.9607843137254902,g:.9607843137254902,b:.8627450980392157},{name:"lightgoldenrodyellow",r:.9803921568627451,g:.9803921568627451,b:.8235294117647058},{name:"olive",r:.5019607843137255,g:.5019607843137255,b:0},{name:"yellow",r:1,g:1,b:0},{name:"lightyellow",r:1,g:1,b:.8784313725490196},{name:"ivory",r:1,g:1,b:.9411764705882353},{name:"olivedrab",r:.4196078431372549,g:.5568627450980392,b:.13725490196078433},{name:"yellowgreen",r:.6039215686274509,g:.803921568627451,b:.19607843137254902},{name:"darkolivegreen",r:.3333333333333333,g:.4196078431372549,b:.1843137254901961},{name:"greenyellow",r:.6784313725490196,g:1,b:.1843137254901961},{name:"lawngreen",r:.48627450980392156,g:.9882352941176471,b:0},{name:"chartreuse",r:.4980392156862745,g:1,b:0},{name:"darkseagreen",r:.5607843137254902,g:.7372549019607844,b:.5607843137254902},{name:"forestgreen",r:.13333333333333333,g:.5450980392156862,b:.13333333333333333},{name:"limegreen",r:.19607843137254902,g:.803921568627451,b:.19607843137254902},{name:"lightgreen",r:.5647058823529412,g:.9333333333333333,b:.5647058823529412},{name:"palegreen",r:.596078431372549,g:.984313725490196,b:.596078431372549},{name:"darkgreen",r:0,g:.39215686274509803,b:0},{name:"green",r:0,g:.5019607843137255,b:0},{name:"lime",r:0,g:1,b:0},{name:"honeydew",r:.9411764705882353,g:1,b:.9411764705882353},{name:"mediumseagreen",r:.23529411764705882,g:.7019607843137254,b:.44313725490196076},{name:"seagreen",r:.1803921568627451,g:.5450980392156862,b:.3411764705882353},{name:"springgreen",r:0,g:1,b:.4980392156862745},{name:"mintcream",r:.9607843137254902,g:1,b:.9803921568627451},{name:"mediumspringgreen",r:0,g:.9803921568627451,b:.6039215686274509},{name:"mediumaquamarine",r:.4,g:.803921568627451,b:.6666666666666666},{name:"aquamarine",r:.4980392156862745,g:1,b:.8313725490196079},{name:"turquoise",r:.25098039215686274,g:.8784313725490196,b:.8156862745098039},{name:"lightseagreen",r:.12549019607843137,g:.6980392156862745,b:.6666666666666666},{name:"mediumturquoise",r:.2823529411764706,g:.8196078431372549,b:.8},{name:"darkslategray",r:.1843137254901961,g:.30980392156862746,b:.30980392156862746},{name:"paleturquoise",r:.6862745098039216,g:.9333333333333333,b:.9333333333333333},{name:"teal",r:0,g:.5019607843137255,b:.5019607843137255},{name:"darkcyan",r:0,g:.5450980392156862,b:.5450980392156862},{name:"darkturquoise",r:0,g:.807843137254902,b:.8196078431372549},{name:"aqua",r:0,g:1,b:1},{name:"cyan",r:0,g:1,b:1},{name:"lightcyan",r:.8784313725490196,g:1,b:1},{name:"azure",r:.9411764705882353,g:1,b:1},{name:"cadetblue",r:.37254901960784315,g:.6196078431372549,b:.6274509803921569},{name:"powderblue",r:.6901960784313725,g:.8784313725490196,b:.9019607843137255},{name:"lightblue",r:.6784313725490196,g:.8470588235294118,b:.9019607843137255},{name:"deepskyblue",r:0,g:.7490196078431373,b:1},{name:"skyblue",r:.5294117647058824,g:.807843137254902,b:.9215686274509803},{name:"lightskyblue",r:.5294117647058824,g:.807843137254902,b:.9803921568627451},{name:"steelblue",r:.27450980392156865,g:.5098039215686274,b:.7058823529411765},{name:"aliceblue",r:.9411764705882353,g:.9725490196078431,b:1},{name:"dodgerblue",r:.11764705882352941,g:.5647058823529412,b:1},{name:"slategray",r:.4392156862745098,g:.5019607843137255,b:.5647058823529412},{name:"lightslategray",r:.4666666666666667,g:.5333333333333333,b:.6},{name:"lightsteelblue",r:.6901960784313725,g:.7686274509803922,b:.8705882352941177},{name:"cornflowerblue",r:.39215686274509803,g:.5843137254901961,b:.9294117647058824},{name:"royalblue",r:.2549019607843137,g:.4117647058823529,b:.8823529411764706},{name:"midnightblue",r:.09803921568627451,g:.09803921568627451,b:.4392156862745098},{name:"lavender",r:.9019607843137255,g:.9019607843137255,b:.9803921568627451},{name:"navy",r:0,g:0,b:.5019607843137255},{name:"darkblue",r:0,g:0,b:.5450980392156862},{name:"mediumblue",r:0,g:0,b:.803921568627451},{name:"blue",r:0,g:0,b:1},{name:"ghostwhite",r:.9725490196078431,g:.9725490196078431,b:1},{name:"darkslateblue",r:.2823529411764706,g:.23921568627450981,b:.5450980392156862},{name:"slateblue",r:.41568627450980394,g:.35294117647058826,b:.803921568627451},{name:"mediumslateblue",r:.4823529411764706,g:.40784313725490196,b:.9333333333333333},{name:"mediumpurple",r:.5764705882352941,g:.4392156862745098,b:.8588235294117647},{name:"blueviolet",r:.5411764705882353,g:.16862745098039217,b:.8862745098039215},{name:"indigo",r:.29411764705882354,g:0,b:.5098039215686274},{name:"darkorchid",r:.6,g:.19607843137254902,b:.8},{name:"darkviolet",r:.5803921568627451,g:0,b:.8274509803921568},{name:"mediumorchid",r:.7294117647058823,g:.3333333333333333,b:.8274509803921568},{name:"thistle",r:.8470588235294118,g:.7490196078431373,b:.8470588235294118},{name:"plum",r:.8666666666666667,g:.6274509803921569,b:.8666666666666667},{name:"violet",r:.9333333333333333,g:.5098039215686274,b:.9333333333333333},{name:"purple",r:.5019607843137255,g:0,b:.5019607843137255},{name:"darkmagenta",r:.5450980392156862,g:0,b:.5450980392156862},{name:"magenta",r:1,g:0,b:1},{name:"fuchsia",r:1,g:0,b:1},{name:"orchid",r:.8549019607843137,g:.4392156862745098,b:.8392156862745098},{name:"mediumvioletred",r:.7803921568627451,g:.08235294117647059,b:.5215686274509804},{name:"deeppink",r:1,g:.0784313725490196,b:.5764705882352941},{name:"hotpink",r:1,g:.4117647058823529,b:.7058823529411765},{name:"palevioletred",r:.8588235294117647,g:.4392156862745098,b:.5764705882352941},{name:"lavenderblush",r:1,g:.9411764705882353,b:.9607843137254902},{name:"crimson",r:.8627450980392157,g:.0784313725490196,b:.23529411764705882},{name:"pink",r:1,g:.7529411764705882,b:.796078431372549},{name:"lightpink",r:1,g:.7137254901960784,b:.7568627450980392}]},this.writers={"#HEX":function(a,b){return b._formatColor("#rxgxbx",a)},"#HEX3":function(b,c){var d=a.colorpicker.writers.HEX3(b);return d===!1?!1:"#"+d},HEX:function(a,b){return b._formatColor("rxgxbx",a)},HEX3:function(a,b){var c=a.getRGB(),d=Math.round(255*c.r),e=Math.round(255*c.g),f=Math.round(255*c.b);return d>>>4===(d&=15)&&e>>>4===(e&=15)&&f>>>4===(f&=15)?d.toString(16)+e.toString(16)+f.toString(16):!1},"#HEXA":function(a,b){return b._formatColor("#rxgxbxax",a)},"#HEXA4":function(b,c){var d=a.colorpicker.writers.HEXA4(b,c);return d===!1?!1:"#"+d},HEXA:function(a,b){return b._formatColor("rxgxbxax",a)},HEXA4:function(b,c){var d=Math.round(255*b.getAlpha());return d>>>4===(d&=15)?a.colorpicker.writers.HEX3(b,c)+d.toString(16):!1},RGB:function(a,b){return a.getAlpha()>=1?b._formatColor("rgb(rd,gd,bd)",a):!1},RGBA:function(a,b){return b._formatColor("rgba(rd,gd,bd,af)",a)},"RGB%":function(a,b){return a.getAlpha()>=1?b._formatColor("rgb(rp%,gp%,bp%)",a):!1},"RGBA%":function(a,b){return b._formatColor("rgba(rp%,gp%,bp%,af)",a)},HSL:function(a,b){return a.getAlpha()>=1?b._formatColor("hsl(hd,sd,vd)",a):!1},HSLA:function(a,b){return b._formatColor("hsla(hd,sd,vd,af)",a)},"HSL%":function(a,b){return a.getAlpha()>=1?b._formatColor("hsl(hp%,sp%,vp%)",a):!1},"HSLA%":function(a,b){return b._formatColor("hsla(hp%,sp%,vp%,af)",a)},NAME:function(a,b){return b._closestName(a)},EXACT:function(a,b){return b._exactName(a)}},this.parsers={"":function(b){return""===b?new a.colorpicker.Color:void 0},NAME:function(b,c){var d=c._getSwatch(a.trim(b));return d?new a.colorpicker.Color(d.r,d.g,d.b):void 0},RGBA:function(b){var c=/^rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(b);return c?new a.colorpicker.Color(c[1]/255,c[2]/255,c[3]/255,parseFloat(c[4])):void 0},"RGBA%":function(b){var c=/^rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(b);return c?new a.colorpicker.Color(c[1]/100,c[2]/100,c[3]/100,c[4]/100):void 0},HSLA:function(b){var c=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(b);return c?(new a.colorpicker.Color).setHSL(c[1]/255,c[2]/255,c[3]/255).setAlpha(parseFloat(c[4])):void 0},"HSLA%":function(b){var c=/^hsla?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(b);return c?(new a.colorpicker.Color).setHSL(c[1]/100,c[2]/100,c[3]/100).setAlpha(c[4]/100):void 0},"#HEX":function(b){var c=/^#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/.exec(b);return c?new a.colorpicker.Color(parseInt(c[1],16)/255,parseInt(c[2],16)/255,parseInt(c[3],16)/255):void 0},"#HEX3":function(b){var c=/^#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/.exec(b);return c?new a.colorpicker.Color(parseInt(String(c[1])+c[1],16)/255,parseInt(String(c[2])+c[2],16)/255,parseInt(String(c[3])+c[3],16)/255):void 0},HEX:function(b){var c=/^([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/.exec(b);return c?new a.colorpicker.Color(parseInt(c[1],16)/255,parseInt(c[2],16)/255,parseInt(c[3],16)/255):void 0},HEX3:function(b){var c=/^([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/.exec(b);return c?new a.colorpicker.Color(parseInt(String(c[1])+c[1],16)/255,parseInt(String(c[2])+c[2],16)/255,parseInt(String(c[3])+c[3],16)/255):void 0},"#HEXA":function(b){var c=/^#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/.exec(b);return c?new a.colorpicker.Color(parseInt(c[1],16)/255,parseInt(c[2],16)/255,parseInt(c[3],16)/255,parseInt(c[4],16)/255):void 0},"#HEXA4":function(b){var c=/^#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/.exec(b);return c?new a.colorpicker.Color(parseInt(String(c[1])+c[1],16)/255,parseInt(String(c[2])+c[2],16)/255,parseInt(String(c[3])+c[3],16)/255,parseInt(String(c[4])+c[4],16)/255):void 0},HEXA:function(b){var c=/^([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/.exec(b);return c?new a.colorpicker.Color(parseInt(c[1],16)/255,parseInt(c[2],16)/255,parseInt(c[3],16)/255,parseInt(c[4],16)/255):void 0},HEXA4:function(b){var c=/^([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/.exec(b);return c?new a.colorpicker.Color(parseInt(String(c[1])+c[1],16)/255,parseInt(String(c[2])+c[2],16)/255,parseInt(String(c[3])+c[3],16)/255,parseInt(String(c[4])+c[4],16)/255):void 0}},this.partslists={full:["header","map","bar","hex","hsv","rgb","alpha","lab","cmyk","preview","swatches","footer"],popup:["map","bar","hex","hsv","rgb","alpha","preview","footer"],draggable:["header","map","bar","hex","hsv","rgb","alpha","preview","footer"],inline:["map","bar","hex","hsv","rgb","alpha","preview"]},this.limits={websafe:function(a){a.limit(6)},nibble:function(a){a.limit(16)},binary:function(a){a.limit(2)},name:function(a,b){var c=b._getSwatch(b._closestName(a));a.setRGB(c.r,c.g,c.b)}},this.parts={header:function(b){var c=null,d=function(){var a=b.options.title||b._getRegional("title"),c='<span class="ui-dialog-title">'+a+"</span>";return!b.inline&&b.options.showCloseButton&&(c+='<a href="#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a>'),'<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">'+c+"</div>"};this.init=function(){c=a(d()).prependTo(b.dialog);var e=a(".ui-dialog-titlebar-close",c);if(b._hoverable(e),b._focusable(e),e.click(function(a){a.preventDefault(),b.close(b.options.revert)}),!b.inline&&b.options.draggable){var f={handle:c};b.options.containment&&(f.containment=b.options.containment),b.dialog.draggable(f)}}},map:function(b){var c,d,e,f,g,h,i,j=this,k=null,l={};f=function(c){if(b.opened){var i=l.p.offset(),j=c.pageX-i.left,m=c.pageY-i.top;j>=0&&d>j&&m>=0&&e>m&&(c.stopImmediatePropagation(),c.preventDefault(),k.unbind("mousedown",f),a(document).bind("mouseup",g),a(document).bind("mousemove",h),h(c))}},g=function(c){c.stopImmediatePropagation(),c.preventDefault(),a(document).unbind("mouseup",g),a(document).unbind("mousemove",h),k.bind("mousedown",f),b._callback("stop")},h=function(a){if(a.stopImmediatePropagation(),a.preventDefault(),a.pageX!==j.x||a.pageY!==j.y){j.x=a.pageX,j.y=a.pageY;var c=l.p.offset(),f=a.pageX-c.left,g=a.pageY-c.top;switch(f=Math.max(0,Math.min(f/d,1)),g=Math.max(0,Math.min(g/e,1)),b.mode){case"h":b.color.setHSV(null,f,1-g);break;case"s":case"a":b.color.setHSV(f,null,1-g);break;case"v":b.color.setHSV(f,1-g,null);break;case"r":b.color.setRGB(null,1-g,f);break;case"g":b.color.setRGB(1-g,null,f);break;case"b":b.color.setRGB(f,1-g,null)}b._change(!1)}},i=function(){var a='<div class="ui-colorpicker-map ui-colorpicker-map-'+(b.options.part.map.size||256)+' ui-colorpicker-border"><span class="ui-colorpicker-map-layer-1">&nbsp;</span><span class="ui-colorpicker-map-layer-2">&nbsp;</span>'+(b.options.alpha?'<span class="ui-colorpicker-map-layer-alpha">&nbsp;</span>':"")+'<span class="ui-colorpicker-map-layer-pointer"><span class="ui-colorpicker-map-pointer"></span></span></div>';return a},this.init=function(){k=a(i()).appendTo(a(".ui-colorpicker-map-container",b.dialog)),k.bind("mousedown",f),l[1]=a(".ui-colorpicker-map-layer-1",k),l[2]=a(".ui-colorpicker-map-layer-2",k),l.a=a(".ui-colorpicker-map-layer-alpha",k),l.p=a(".ui-colorpicker-map-layer-pointer",k),d=l.p.width(),e=l.p.height(),c=a(".ui-colorpicker-map-pointer",k)},this.update=function(){var a=65*(b.options.part.map.size||256)/64;switch(b.mode){case"h":l[1].css({"background-position":"0 0",opacity:""}).show(),l[2].hide();break;case"s":case"a":l[1].css({"background-position":"0 "+-a+"px",opacity:""}).show(),l[2].css({"background-position":"0 "+2*-a+"px",opacity:""}).show();break;case"v":k.css("background-color","black"),l[1].css({"background-position":"0 "+3*-a+"px",opacity:""}).show(),l[2].hide();break;case"r":l[1].css({"background-position":"0 "+4*-a+"px",opacity:""}).show(),l[2].css({"background-position":"0 "+5*-a+"px",opacity:""}).show();break;case"g":l[1].css({"background-position":"0 "+6*-a+"px",opacity:""}).show(),l[2].css({"background-position":"0 "+7*-a+"px",opacity:""}).show();break;case"b":l[1].css({"background-position":"0 "+8*-a+"px",opacity:""}).show(),l[2].css({"background-position":"0 "+9*-a+"px",opacity:""}).show()}j.repaint()},this.repaint=function(){var a=0,e=0;switch(b.mode){case"h":var f=b.color.getHSV();a=f.s*d,e=(1-f.v)*d,k.css("background-color",b.color.copy().setHSV(null,1,1).toCSS());break;case"s":case"a":var f=b.color.getHSV();a=f.h*d,e=(1-f.v)*d,l[2].css("opacity",1-f.s);break;case"v":var f=b.color.getHSV();a=f.h*d,e=(1-f.s)*d,l[1].css("opacity",f.v);break;case"r":var g=b.color.getRGB();a=g.b*d,e=(1-g.g)*d,l[2].css("opacity",g.r);break;case"g":var g=b.color.getRGB();a=g.b*d,e=(1-g.r)*d,l[2].css("opacity",g.g);break;case"b":var g=b.color.getRGB();a=g.r*d,e=(1-g.g)*d,l[2].css("opacity",g.b)}b.options.alpha&&l.a.css("opacity",1-b.color.getAlpha()),c.css({left:a-7,top:e-7})}},bar:function(b){var c,d,e,f,g,h,i,j=this,k=null,l={};f=function(c){if(b.opened){var i=l.p.offset(),j=c.pageX-i.left,m=c.pageY-i.top;j>=0&&d>j&&m>=0&&e>m&&(c.stopImmediatePropagation(),c.preventDefault(),k.unbind("mousedown",f),a(document).bind("mouseup",g),a(document).bind("mousemove",h),h(c))}},g=function(c){c.stopImmediatePropagation(),c.preventDefault(),a(document).unbind("mouseup",g),a(document).unbind("mousemove",h),k.bind("mousedown",f),b._callback("stop")},h=function(a){if(a.stopImmediatePropagation(),a.preventDefault(),a.pageY!==j.y){j.y=a.pageY;var c=l.p.offset(),d=a.pageY-c.top;switch(d=Math.max(0,Math.min(d/e,1)),b.mode){case"h":b.color.setHSV(1-d,null,null);break;case"s":b.color.setHSV(null,1-d,null);break;case"v":b.color.setHSV(null,null,1-d);break;case"r":b.color.setRGB(1-d,null,null);break;case"g":b.color.setRGB(null,1-d,null);break;case"b":b.color.setRGB(null,null,1-d);break;case"a":b.color.setAlpha(1-d)}b._change(!1)}},i=function(){var a='<div class="ui-colorpicker-bar ui-colorpicker-bar-'+(b.options.part.bar.size||256)+'  ui-colorpicker-border"><span class="ui-colorpicker-bar-layer-1">&nbsp;</span><span class="ui-colorpicker-bar-layer-2">&nbsp;</span><span class="ui-colorpicker-bar-layer-3">&nbsp;</span><span class="ui-colorpicker-bar-layer-4">&nbsp;</span>';return b.options.alpha&&(a+='<span class="ui-colorpicker-bar-layer-alpha">&nbsp;</span><span class="ui-colorpicker-bar-layer-alphabar">&nbsp;</span>'),a+='<span class="ui-colorpicker-bar-layer-pointer"><span class="ui-colorpicker-bar-pointer"></span></span></div>'},this.init=function(){k=a(i()).appendTo(a(".ui-colorpicker-bar-container",b.dialog)),k.bind("mousedown",f),l[1]=a(".ui-colorpicker-bar-layer-1",k),l[2]=a(".ui-colorpicker-bar-layer-2",k),l[3]=a(".ui-colorpicker-bar-layer-3",k),l[4]=a(".ui-colorpicker-bar-layer-4",k),l.a=a(".ui-colorpicker-bar-layer-alpha",k),l.ab=a(".ui-colorpicker-bar-layer-alphabar",k),l.p=a(".ui-colorpicker-bar-layer-pointer",k),d=l.p.width(),e=l.p.height(),c=a(".ui-colorpicker-bar-pointer",k)},this.update=function(){var a=65*(b.options.part.bar.size||256)/64;switch(b.mode){case"h":case"s":case"v":case"r":case"g":case"b":l.a.show(),l.ab.hide();break;case"a":l.a.hide(),l.ab.show()}switch(b.mode){case"h":l[1].css({"background-position":"0 0",opacity:""}).show(),l[2].hide(),l[3].hide(),l[4].hide();break;case"s":l[1].css({"background-position":"0 "+-a+"px",opacity:""}).show(),l[2].css({"background-position":"0 "+2*-a+"px",opacity:""}).show(),l[3].hide(),l[4].hide();break;case"v":l[1].css({"background-position":"0 "+2*-a+"px",opacity:""}).show(),l[2].hide(),l[3].hide(),l[4].hide();break;case"r":l[1].css({"background-position":"0 "+6*-a+"px",opacity:""}).show(),l[2].css({"background-position":"0 "+5*-a+"px",opacity:""}).show(),l[3].css({"background-position":"0 "+3*-a+"px",opacity:""}).show(),l[4].css({"background-position":"0 "+4*-a+"px",opacity:""}).show();break;case"g":l[1].css({"background-position":"0 "+10*-a+"px",opacity:""}).show(),l[2].css({"background-position":"0 "+9*-a+"px",opacity:""}).show(),l[3].css({"background-position":"0 "+7*-a+"px",opacity:""}).show(),l[4].css({"background-position":"0 "+8*-a+"px",opacity:""}).show();break;case"b":l[1].css({"background-position":"0 "+14*-a+"px",opacity:""}).show(),l[2].css({"background-position":"0 "+13*-a+"px",opacity:""}).show(),l[3].css({"background-position":"0 "+11*-a+"px",opacity:""}).show(),l[4].css({"background-position":"0 "+12*-a+"px",opacity:""}).show();break;case"a":l[1].hide(),l[2].hide(),l[3].hide(),l[4].hide()}j.repaint()},this.repaint=function(){var a=0;switch(b.mode){case"h":a=(1-b.color.getHSV().h)*e;break;case"s":var d=b.color.getHSV();a=(1-d.s)*e,l[2].css("opacity",1-d.v),k.css("background-color",b.color.copy().setHSV(null,1,null).toCSS());break;case"v":a=(1-b.color.getHSV().v)*e,k.css("background-color",b.color.copy().setHSV(null,null,1).toCSS());break;case"r":var f=b.color.getRGB();a=(1-f.r)*e,l[2].css("opacity",Math.max(0,f.b-f.g)),l[3].css("opacity",Math.max(0,f.g-f.b)),l[4].css("opacity",Math.min(f.b,f.g));break;case"g":var f=b.color.getRGB();a=(1-f.g)*e,l[2].css("opacity",Math.max(0,f.b-f.r)),l[3].css("opacity",Math.max(0,f.r-f.b)),l[4].css("opacity",Math.min(f.r,f.b));break;case"b":var f=b.color.getRGB();a=(1-f.b)*e,l[2].css("opacity",Math.max(0,f.r-f.g)),l[3].css("opacity",Math.max(0,f.g-f.r)),l[4].css("opacity",Math.min(f.r,f.g));break;case"a":a=(1-b.color.getAlpha())*e,k.css("background-color",b.color.copy().toCSS())}"a"!==b.mode&&l.a.css("opacity",1-b.color.getAlpha()),c.css("top",a-3)}},preview:function(b){var c,d,e,f,g,h,i=null;h=function(){return'<div class="ui-colorpicker-preview ui-colorpicker-border"><div class="ui-colorpicker-preview-initial"><div class="ui-colorpicker-preview-initial-alpha"></div></div><div class="ui-colorpicker-preview-current"><div class="ui-colorpicker-preview-current-alpha"></div></div></div>'},this.init=function(){i=a(h()).appendTo(a(".ui-colorpicker-preview-container",b.dialog)),a(".ui-colorpicker-preview-initial",i).click(function(){b.color=b.currentColor.copy(),b._change()}),d=a(".ui-colorpicker-preview-initial",i),e=a(".ui-colorpicker-preview-initial-alpha",i),f=a(".ui-colorpicker-preview-current",i),g=a(".ui-colorpicker-preview-current-alpha",i),c=a(".ui-colorpicker-preview-initial-alpha, .ui-colorpicker-preview-current-alpha",i)},this.update=function(){c[b.options.alpha?"show":"hide"](),this.repaint()},this.repaint=function(){d.css("background-color",b.currentColor.set?b.currentColor.toCSS():"").attr("title",b.currentColor.set?b.currentColor.toCSS():""),e.css("opacity",1-b.currentColor.getAlpha()),f.css("background-color",b.color.set?b.color.toCSS():"").attr("title",b.color.set?b.color.toCSS():""),g.css("opacity",1-b.color.getAlpha())}},hsv:function(b){var c,d=null,e={};c=function(){var a="";return b.options.hsv&&(a+='<div class="ui-colorpicker-hsv-h"><input class="ui-colorpicker-mode" type="radio" value="h"/><label>'+b._getRegional("hsvH")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="360" size="10"/><span class="ui-colorpicker-unit">&deg;</span></div><div class="ui-colorpicker-hsv-s"><input class="ui-colorpicker-mode" type="radio" value="s"/><label>'+b._getRegional("hsvS")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100" size="10"/><span class="ui-colorpicker-unit">%</span></div><div class="ui-colorpicker-hsv-v"><input class="ui-colorpicker-mode" type="radio" value="v"/><label>'+b._getRegional("hsvV")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100" size="10"/><span class="ui-colorpicker-unit">%</span></div>'),'<div class="ui-colorpicker-hsv">'+a+"</div>"},this.init=function(){d=a(c()).appendTo(a(".ui-colorpicker-hsv-container",b.dialog)),a(".ui-colorpicker-mode",d).click(function(){b.mode=a(this).val(),b._updateAllParts()}),e.h=a(".ui-colorpicker-hsv-h .ui-colorpicker-number",d),e.s=a(".ui-colorpicker-hsv-s .ui-colorpicker-number",d),e.v=a(".ui-colorpicker-hsv-v .ui-colorpicker-number",d),a(".ui-colorpicker-number",d).bind("change keyup",function(){b.color.setHSV(e.h.val()/360,e.s.val()/100,e.v.val()/100),b._change()})},this.repaint=function(){var a=b.color.getHSV();e.h.val(Math.round(360*a.h)),e.s.val(Math.round(100*a.s)),e.v.val(Math.round(100*a.v))},this.update=function(){a(".ui-colorpicker-mode",d).each(function(){var c=a(this);c.attr("checked",c.val()===b.mode)}),this.repaint()}},rgb:function(b){var c,d=null,e={};c=function(){var a="";return b.options.rgb&&(a+='<div class="ui-colorpicker-rgb-r"><input class="ui-colorpicker-mode" type="radio" value="r"/><label>'+b._getRegional("rgbR")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="255"/></div><div class="ui-colorpicker-rgb-g"><input class="ui-colorpicker-mode" type="radio" value="g"/><label>'+b._getRegional("rgbG")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="255"/></div><div class="ui-colorpicker-rgb-b"><input class="ui-colorpicker-mode" type="radio" value="b"/><label>'+b._getRegional("rgbB")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="255"/></div>'),'<div class="ui-colorpicker-rgb">'+a+"</div>"},this.init=function(){d=a(c()).appendTo(a(".ui-colorpicker-rgb-container",b.dialog)),a(".ui-colorpicker-mode",d).click(function(){b.mode=a(this).val(),b._updateAllParts()}),e.r=a(".ui-colorpicker-rgb-r .ui-colorpicker-number",d),e.g=a(".ui-colorpicker-rgb-g .ui-colorpicker-number",d),e.b=a(".ui-colorpicker-rgb-b .ui-colorpicker-number",d),a(".ui-colorpicker-number",d).bind("change keyup",function(){a(".ui-colorpicker-rgb-r .ui-colorpicker-number",d).val();b.color.setRGB(e.r.val()/255,e.g.val()/255,e.b.val()/255),b._change()})},this.repaint=function(){var a=b.color.getRGB();e.r.val(Math.round(255*a.r)),e.g.val(Math.round(255*a.g)),e.b.val(Math.round(255*a.b))},this.update=function(){a(".ui-colorpicker-mode",d).each(function(){var c=a(this);c.attr("checked",c.val()===b.mode)}),this.repaint()}},lab:function(b){var c=null,d={},e=function(){var a="";return b.options.hsv&&(a+='<div class="ui-colorpicker-lab-l"><label>'+b._getRegional("labL")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/></div><div class="ui-colorpicker-lab-a"><label>'+b._getRegional("labA")+'</label><input class="ui-colorpicker-number" type="number" min="-128" max="127"/></div><div class="ui-colorpicker-lab-b"><label>'+b._getRegional("labB")+'</label><input class="ui-colorpicker-number" type="number" min="-128" max="127"/></div>'),'<div class="ui-colorpicker-lab">'+a+"</div>"};this.init=function(){c=a(e()).appendTo(a(".ui-colorpicker-lab-container",b.dialog)),d.l=a(".ui-colorpicker-lab-l .ui-colorpicker-number",c),d.a=a(".ui-colorpicker-lab-a .ui-colorpicker-number",c),d.b=a(".ui-colorpicker-lab-b .ui-colorpicker-number",c),a(".ui-colorpicker-number",c).bind("change keyup",function(a){b.color.setLAB(parseInt(d.l.val(),10)/100,(parseInt(d.a.val(),10)+128)/255,(parseInt(d.b.val(),10)+128)/255),b._change()})},this.repaint=function(){var a=b.color.getLAB();d.l.val(Math.round(100*a.l)),d.a.val(Math.round(255*a.a)-128),d.b.val(Math.round(255*a.b)-128)},this.update=this.repaint},cmyk:function(b){var c=null,d={},e=function(){var a="";return b.options.hsv&&(a+='<div class="ui-colorpicker-cmyk-c"><label>'+b._getRegional("cmykC")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div><div class="ui-colorpicker-cmyk-m"><label>'+b._getRegional("cmykM")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div><div class="ui-colorpicker-cmyk-y"><label>'+b._getRegional("cmykY")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div><div class="ui-colorpicker-cmyk-k"><label>'+b._getRegional("cmykK")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div>'),'<div class="ui-colorpicker-cmyk">'+a+"</div>"};this.init=function(){c=a(e()).appendTo(a(".ui-colorpicker-cmyk-container",b.dialog)),d.c=a(".ui-colorpicker-cmyk-c .ui-colorpicker-number",c),d.m=a(".ui-colorpicker-cmyk-m .ui-colorpicker-number",c),d.y=a(".ui-colorpicker-cmyk-y .ui-colorpicker-number",c),d.k=a(".ui-colorpicker-cmyk-k .ui-colorpicker-number",c),a(".ui-colorpicker-number",c).bind("change keyup",function(a){b.color.setCMYK(parseInt(d.c.val(),10)/100,parseInt(d.m.val(),10)/100,parseInt(d.y.val(),10)/100,parseInt(d.k.val(),10)/100),b._change()})},this.repaint=function(){var a=b.color.getCMYK();d.c.val(Math.round(100*a.c)),d.m.val(Math.round(100*a.m)),d.y.val(Math.round(100*a.y)),d.k.val(Math.round(100*a.k))},this.update=this.repaint;
},alpha:function(b){var c,d=null,e=function(){var a="";return b.options.alpha&&(a+='<div class="ui-colorpicker-a"><input class="ui-colorpicker-mode" name="mode" type="radio" value="a"/><label>'+b._getRegional("alphaA")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div>'),'<div class="ui-colorpicker-alpha">'+a+"</div>"};this.init=function(){d=a(e()).appendTo(a(".ui-colorpicker-alpha-container",b.dialog)),a(".ui-colorpicker-mode",d).click(function(){b.mode=a(this).val(),b._updateAllParts()}),c=a(".ui-colorpicker-a .ui-colorpicker-number",d),a(".ui-colorpicker-number",d).bind("change keyup",function(){b.color.setAlpha(c.val()/100),b._change()})},this.update=function(){a(".ui-colorpicker-mode",d).each(function(){a(this).attr("checked",a(this).val()===b.mode)}),this.repaint()},this.repaint=function(){c.val(Math.round(100*b.color.getAlpha()))}},hex:function(b){var c,d=null,e={};c=function(){var a="";return b.options.alpha&&(a+='<input class="ui-colorpicker-hex-alpha" type="text" maxlength="2" size="2"/>'),a+='<input class="ui-colorpicker-hex-input" type="text" maxlength="6" size="6"/>','<div class="ui-colorpicker-hex"><label>#</label>'+a+"</div>"},this.init=function(){d=a(c()).appendTo(a(".ui-colorpicker-hex-container",b.dialog)),e.color=a(".ui-colorpicker-hex-input",d),e.alpha=a(".ui-colorpicker-hex-alpha",d),e.color.bind("change keydown keyup",function(a,b,c){/[^a-fA-F0-9]/.test(e.color.val())&&e.color.val(e.color.val().replace(/[^a-fA-F0-9]/,""))}),e.color.bind("change keyup",function(){b.color=g(e.color.val()).setAlpha(b.color.getAlpha()),b._change()}),e.alpha.bind("change keydown keyup",function(){/[^a-fA-F0-9]/.test(e.alpha)&&e.alpha.val(e.alpha.val().replace(/[^a-fA-F0-9]/,""))}),e.alpha.bind("change keyup",function(){b.color.setAlpha(parseInt(e.alpha.val(),16)/255),b._change()})},this.repaint=function(){e.color.is(":focus")||e.color.val(b.color.toHex(!0)),e.alpha.is(":focus")||e.alpha.val(f(255*b.color.getAlpha()))},this.update=this.repaint},swatches:function(b){var c=function(){var c="";return b._eachSwatch(function(b,d){var e=new a.colorpicker.Color(d.r,d.g,d.b),f=e.toCSS();c+='<div class="ui-colorpicker-swatch" style="background-color:'+f+'" title="'+b+'"></div>'}),'<div class="ui-colorpicker-swatches ui-colorpicker-border" style="width:'+b.options.swatchesWidth+'px">'+c+"</div>"};this.init=function(){var d=a(c());a(".ui-colorpicker-swatches-container",b.dialog).html(d),a(".ui-colorpicker-swatch",d).click(function(){b.color=b._parseColor(a(this).css("background-color"))||new a.colorpicker.Color,b._change()})}},footer:function(b){var c=null,d="ui-colorpicker-special-transparent-"+b.colorpicker_index,e="ui-colorpicker-special-none-"+b.colorpicker_index,f=function(){var a="";return(b.options.alpha||!b.inline&&b.options.showNoneButton)&&(a+='<div class="ui-colorpicker-buttonset">',b.options.alpha&&(a+='<input type="radio" name="ui-colorpicker-special" id="'+d+'" class="ui-colorpicker-special-transparent"/><label for="'+d+'">'+b._getRegional("transparent")+"</label>"),!b.inline&&b.options.showNoneButton&&(a+='<input type="radio" name="ui-colorpicker-special" id="'+e+'" class="ui-colorpicker-special-none"><label for="'+e+'">'+b._getRegional("none")+"</label>"),a+="</div>"),b.inline||(a+='<div class="ui-dialog-buttonset">',b.options.showCancelButton&&(a+='<button class="ui-colorpicker-cancel">'+b._getRegional("cancel")+"</button>"),a+='<button class="ui-colorpicker-ok">'+b._getRegional("ok")+"</button>",a+="</div>"),'<div class="ui-dialog-buttonpane ui-widget-content">'+a+"</div>"};this.init=function(){c=a(f()).appendTo(b.dialog),a(".ui-colorpicker-ok",c).button().click(function(){b.close()}),a(".ui-colorpicker-cancel",c).button().click(function(){b.close(!0)}),a(".ui-colorpicker-buttonset",c).buttonset(),a(".ui-colorpicker-special-color",c).click(function(){b._change()}),a("#"+e,c).click(function(){b.color.set=!1,b._change()}),a("#"+d,c).click(function(){b.color.setAlpha(0),b._change()})},this.repaint=function(){b.color.set?0===b.color.getAlpha()?a(".ui-colorpicker-special-transparent",c).attr("checked",!0).button("refresh"):a("input",c).attr("checked",!1).button("refresh"):a(".ui-colorpicker-special-none",c).attr("checked",!0).button("refresh"),a(".ui-colorpicker-cancel",c).button(b.changed?"enable":"disable")},this.update=function(){}}},this.Color=function(){var b={rgb:{r:0,g:0,b:0},hsv:{h:0,s:0,v:0},hsl:{h:0,s:0,l:0},lab:{l:0,a:0,b:0},cmyk:{c:0,m:0,y:0,k:1}},c=1,d=[.9504285,1,1.0889],e=arguments,f=function(a){return isNaN(a)||null===a?0:("string"==typeof a&&(a=parseInt(a,10)),Math.max(0,Math.min(a,1)))},g=function(a){var a=Math.round(a),b="0123456789abcdef",c=a%16,d=(a-c)/16,e=b.charAt(d)+b.charAt(c);return e},h=function(a){var b=a.r>.04045?Math.pow((a.r+.055)/1.055,2.4):a.r/12.92,c=a.g>.04045?Math.pow((a.g+.055)/1.055,2.4):a.g/12.92,d=a.b>.04045?Math.pow((a.b+.055)/1.055,2.4):a.b/12.92;return{x:.4124*b+.3576*c+.1805*d,y:.2126*b+.7152*c+.0722*d,z:.0193*b+.1192*c+.9505*d}},i=function(a){var b={r:3.2406*a.x+-1.5372*a.y+a.z*-.4986,g:a.x*-.9689+1.8758*a.y+.0415*a.z,b:.0557*a.x+a.y*-.204+1.057*a.z};return b.r=b.r>.0031308?1.055*Math.pow(b.r,1/2.4)-.055:12.92*b.r,b.g=b.g>.0031308?1.055*Math.pow(b.g,1/2.4)-.055:12.92*b.g,b.b=b.b>.0031308?1.055*Math.pow(b.b,1/2.4)-.055:12.92*b.b,b},j=function(a){var b,c,d,e=Math.min(a.r,a.g,a.b),f=Math.max(a.r,a.g,a.b),g=f-e,h={h:0,s:0,v:f};return 0===g?(h.h=0,h.s=0):(h.s=g/f,b=((f-a.r)/6+g/2)/g,c=((f-a.g)/6+g/2)/g,d=((f-a.b)/6+g/2)/g,a.r===f?h.h=d-c:a.g===f?h.h=1/3+b-d:a.b===f&&(h.h=2/3+c-b),h.h<0?h.h+=1:h.h>1&&(h.h-=1)),h},k=function(a){var b,c,d,e,f,g={r:0,g:0,b:0};return 0===a.s?g.r=g.g=g.b=a.v:(b=1===a.h?0:6*a.h,c=Math.floor(b),d=a.v*(1-a.s),e=a.v*(1-a.s*(b-c)),f=a.v*(1-a.s*(1-(b-c))),0===c?(g.r=a.v,g.g=f,g.b=d):1===c?(g.r=e,g.g=a.v,g.b=d):2===c?(g.r=d,g.g=a.v,g.b=f):3===c?(g.r=d,g.g=e,g.b=a.v):4===c?(g.r=f,g.g=d,g.b=a.v):(g.r=a.v,g.g=d,g.b=e)),g},l=function(a){var b,c,d,e=Math.min(a.r,a.g,a.b),f=Math.max(a.r,a.g,a.b),g=f-e,h={h:0,s:0,l:(f+e)/2};return 0===g?(h.h=0,h.s=0):(h.s=h.l<.5?g/(f+e):g/(2-f-e),b=((f-a.r)/6+g/2)/g,c=((f-a.g)/6+g/2)/g,d=((f-a.b)/6+g/2)/g,a.r===f?h.h=d-c:a.g===f?h.h=1/3+b-d:a.b===f&&(h.h=2/3+c-b),h.h<0?h.h+=1:h.h>1&&(h.h-=1)),h},m=function(a){var b,c,d=function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1>6*c?a+6*(b-a)*c:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a};return 0===a.s?{r:a.l,g:a.l,b:a.l}:(c=a.l<.5?a.l*(1+a.s):a.l+a.s-a.s*a.l,b=2*a.l-c,{r:d(b,c,a.h+1/3),g:d(b,c,a.h),b:d(b,c,a.h-1/3)})},n=function(a){var b=a.x/d[0],c=a.y/d[1],e=a.z/d[2];return b=b>.008856?Math.pow(b,1/3):7.787*b+16/116,c=c>.008856?Math.pow(c,1/3):7.787*c+16/116,e=e>.008856?Math.pow(e,1/3):7.787*e+16/116,{l:(116*c-16)/100,a:(500*(b-c)+128)/255,b:(200*(c-e)+128)/255}},o=function(a){var b={l:100*a.l,a:255*a.a-128,b:255*a.b-128},c={x:0,y:(b.l+16)/116,z:0};return c.x=b.a/500+c.y,c.z=c.y-b.b/200,c.x=Math.pow(c.x,3)>.008856?Math.pow(c.x,3):(c.x-16/116)/7.787,c.y=Math.pow(c.y,3)>.008856?Math.pow(c.y,3):(c.y-16/116)/7.787,c.z=Math.pow(c.z,3)>.008856?Math.pow(c.z,3):(c.z-16/116)/7.787,c.x*=d[0],c.y*=d[1],c.z*=d[2],c},p=function(a){return{c:1-a.r,m:1-a.g,y:1-a.b}},q=function(a){return{r:1-a.c,g:1-a.m,b:1-a.y}},r=function(a){var b=1;return a.c<b&&(b=a.c),a.m<b&&(b=a.m),a.y<b&&(b=a.y),1===b?{c:0,m:0,y:0,k:1}:{c:(a.c-b)/(1-b),m:(a.m-b)/(1-b),y:(a.y-b)/(1-b),k:b}},s=function(a){return{c:a.c*(1-a.k)+a.k,m:a.m*(1-a.k)+a.k,y:a.y*(1-a.k)+a.k}};this.set=!1,this.setAlpha=function(a){return null!==a&&(c=f(a)),this.set=!0,this},this.getAlpha=function(){return c},this.setRGB=function(a,c,d){return b={rgb:this.getRGB()},null!==a&&(b.rgb.r=f(a)),null!==c&&(b.rgb.g=f(c)),null!==d&&(b.rgb.b=f(d)),this.set=!0,this},this.setHSV=function(a,c,d){return b={hsv:this.getHSV()},null!==a&&(b.hsv.h=f(a)),null!==c&&(b.hsv.s=f(c)),null!==d&&(b.hsv.v=f(d)),this.set=!0,this},this.setHSL=function(a,c,d){return b={hsl:this.getHSL()},null!==a&&(b.hsl.h=f(a)),null!==c&&(b.hsl.s=f(c)),null!==d&&(b.hsl.l=f(d)),this.set=!0,this},this.setLAB=function(a,c,d){return b={lab:this.getLAB()},null!==a&&(b.lab.l=f(a)),null!==c&&(b.lab.a=f(c)),null!==d&&(b.lab.b=f(d)),this.set=!0,this},this.setCMYK=function(a,c,d,e){return b={cmyk:this.getCMYK()},null!==a&&(b.cmyk.c=f(a)),null!==c&&(b.cmyk.m=f(c)),null!==d&&(b.cmyk.y=f(d)),null!==e&&(b.cmyk.k=f(e)),this.set=!0,this},this.getRGB=function(){return b.rgb||(b.rgb=b.lab?i(o(b.lab)):b.hsv?k(b.hsv):b.hsl?m(b.hsl):b.cmyk?q(s(b.cmyk)):{r:0,g:0,b:0},b.rgb.r=f(b.rgb.r),b.rgb.g=f(b.rgb.g),b.rgb.b=f(b.rgb.b)),a.extend({},b.rgb)},this.getHSV=function(){return b.hsv||(b.hsv=b.lab?j(this.getRGB()):b.rgb?j(b.rgb):b.hsl?j(this.getRGB()):b.cmyk?j(this.getRGB()):{h:0,s:0,v:0},b.hsv.h=f(b.hsv.h),b.hsv.s=f(b.hsv.s),b.hsv.v=f(b.hsv.v)),a.extend({},b.hsv)},this.getHSL=function(){return b.hsl||(b.hsl=b.rgb?l(b.rgb):b.hsv?l(this.getRGB()):b.cmyk?l(this.getRGB()):b.hsv?l(this.getRGB()):{h:0,s:0,l:0},b.hsl.h=f(b.hsl.h),b.hsl.s=f(b.hsl.s),b.hsl.l=f(b.hsl.l)),a.extend({},b.hsl)},this.getCMYK=function(){return b.cmyk||(b.cmyk=b.rgb?r(p(b.rgb)):b.hsv?r(p(this.getRGB())):b.hsl?r(p(this.getRGB())):b.lab?r(p(this.getRGB())):{c:0,m:0,y:0,k:1},b.cmyk.c=f(b.cmyk.c),b.cmyk.m=f(b.cmyk.m),b.cmyk.y=f(b.cmyk.y),b.cmyk.k=f(b.cmyk.k)),a.extend({},b.cmyk)},this.getLAB=function(){return b.lab||(b.lab=b.rgb?n(h(b.rgb)):b.hsv?n(h(this.getRGB())):b.hsl?n(h(this.getRGB())):b.cmyk?n(h(this.getRGB())):{l:0,a:0,b:0},b.lab.l=f(b.lab.l),b.lab.a=f(b.lab.a),b.lab.b=f(b.lab.b)),a.extend({},b.lab)},this.getChannels=function(){return{r:this.getRGB().r,g:this.getRGB().g,b:this.getRGB().b,a:this.getAlpha(),h:this.getHSV().h,s:this.getHSV().s,v:this.getHSV().v,c:this.getCMYK().c,m:this.getCMYK().m,y:this.getCMYK().y,k:this.getCMYK().k,L:this.getLAB().l,A:this.getLAB().a,B:this.getLAB().b}},this.getSpaces=function(){return a.extend(!0,{},b)},this.distance=function(a){var b,c="lab",d="get"+c.toUpperCase(),e=this[d](),f=a[d](),g=0;for(b in e)g+=Math.pow(e[b]-f[b],2);return g},this.equals=function(a){if(a){var b=this.getRGB(),c=a.getRGB();return this.set===a.set&&this.getAlpha()===a.getAlpha()&&b.r===c.r&&b.g===c.g&&b.b===c.b}return!1},this.limit=function(a){a-=1;var b=this.getRGB();this.setRGB(Math.round(b.r*a)/a,Math.round(b.g*a)/a,Math.round(b.b*a)/a)},this.toHex=function(){var a=this.getRGB();return g(255*a.r)+g(255*a.g)+g(255*a.b)},this.toCSS=function(){return"#"+this.toHex()},this.copy=function(){var b=new a.colorpicker.Color(this.getSpaces(),this.getAlpha());return b.set=this.set,b},2===e.length&&(b=e[0],this.setAlpha(0===e[1]?0:e[1]||1),this.set=!0),e.length>2&&(this.setRGB(e[0],e[1],e[2]),this.setAlpha(0===e[3]?0:e[3]||1),this.set=!0)}},a.widget("vanderlee.colorpicker",{options:{alpha:!1,altAlpha:!0,altField:"",altOnChange:!0,altProperties:"background-color",autoOpen:!1,buttonClass:null,buttonColorize:!1,buttonImage:"images/ui-colorpicker.png",buttonImageOnly:!1,buttonText:null,closeOnEscape:!0,closeOnOutside:!0,color:"#00FF00",colorFormat:"HEX",draggable:!0,containment:null,duration:"fast",hideOn:"button",hsv:!0,inline:!0,inlineFrame:!0,layout:{map:[0,0,1,5],bar:[1,0,1,5],preview:[2,0,1,1],hsv:[2,1,1,1],rgb:[2,2,1,1],alpha:[2,3,1,1],hex:[2,4,1,1],lab:[3,1,1,1],cmyk:[3,2,1,2],swatches:[4,0,1,5]},limit:"",modal:!1,mode:"h",okOnEnter:!1,parts:"",part:{map:{size:256},bar:{size:256}},position:null,regional:"",revert:!1,rgb:!0,showAnim:"fadeIn",showCancelButton:!0,showNoneButton:!1,showCloseButton:!0,showOn:"focus click alt",showOptions:{},swatches:null,swatchesWidth:84,title:null,cancel:null,close:null,init:null,ok:null,open:null,select:null,stop:null},_create:function(){var c,d=this;return d.colorpicker_index=b++,d.widgetEventPrefix="colorpicker",d.opened=!1,d.generated=!1,d.inline=!1,d.changed=!1,d.dialog=null,d.button=null,d.image=null,d.overlay=null,d.events={window_resize:null,document_keydown:null,document_click_html:null},d.mode=d.options.mode,d.element.is("input")||d.options.inline===!1?(d._setColor(d.element.is("input")?d.element.val():d.options.color),d._callback("init"),/\bfocus|all|both\b/.test(d.options.showOn)&&d.element.bind("focus",function(){d.open()}),/\bfocus|all|both\b/.test(d.options.hideOn)&&d.element.bind("focusout",function(a){d.close()}),/\bclick|all|both\b/.test(d.options.showOn)&&d.element.bind("click",function(a){d.opened&&/\bclick|all|both\b/.test(d.options.hideOn)?d.close():d.open()}),/\bbutton|all|both\b/.test(d.options.showOn)&&(""!==d.options.buttonImage&&(c=d.options.buttonText||d._getRegional("button"),d.image=a("<img/>").attr({src:d.options.buttonImage,alt:c,title:c}),d.options.buttonClass&&d.image.attr("class",d.options.buttonClass),d._setImageBackground()),d.options.buttonImageOnly&&d.image?d.button=d.image:(d.button=a('<button type="button"></button>').html(d.image||d.options.buttonText).button(),d.image=d.image?a("img",d.button).first():null),d.button.insertAfter(d.element).click(function(){d.opened&&/\bbutton|all|both\b/.test(d.options.hideOn)?d.close():d.open()})),/\balt|all|both\b/.test(d.options.showOn)&&a(d.options.altField).bind("click",function(){d.opened&&/\balt|all|both\b/.test(d.options.hideOn)?d.close():d.open()}),d.options.autoOpen&&d.open()):(d.inline=!0,d._generate(),d.opened=!0),this},_setOption:function(b,c){switch(b){case"disabled":c?this.dialog.addClass("ui-colorpicker-disabled"):this.dialog.removeClass("ui-colorpicker-disabled");break;case"swatches":this.options.swatches=c,this.parts.swatches.init()}a.Widget.prototype._setOption.apply(this,arguments)},_setImageBackground:function(){this.image&&this.options.buttonColorize&&this.image.css("background-color",this.color.set?this._formatColor("RGBA",this.color):"")},_setAltField:function(){if(this.options.altOnChange&&this.options.altField&&this.options.altProperties){var b,c,d=this.options.altProperties.split(",");for(b=0;b<=d.length;++b)switch(c=a.trim(d[b])){case"color":case"fill":case"stroke":case"background-color":case"backgroundColor":case"outline-color":case"border-color":a(this.options.altField).css(c,this.color.set?this.color.toCSS():"")}this.options.altAlpha&&a(this.options.altField).css("opacity",this.color.set?this.color.getAlpha():"")}},_setColor:function(b){this.color=this._parseColor(b)||new a.colorpicker.Color,this.currentColor=this.color.copy(),this._setImageBackground(),this._setAltField()},setColor:function(a){this._setColor(a),this._change()},getColor:function(a){return this._formatColor(a||this.options.colorFormat,this.color)},_generateInline:function(){var b=this;a(b.element).html(b.options.inlineFrame?d:e),b.dialog=a(".ui-colorpicker",b.element)},_generatePopup:function(){var b=this;b.dialog=a(c).appendTo("body"),null===b.events.document_click_html&&a(document).delegate("html","touchstart click",b.events.document_click_html=function(c){if(b.opened&&c.target!==b.element[0]&&!b.overlay){if(b.dialog.is(c.target)||b.dialog.has(c.target).length>0)return void b.element.blur();var d,e=a(c.target).parents();for(e.push(c.target),d=0;d<=e.length;++d){if(null!==b.button&&e[d]===b.button[0])return;if(/\balt|all|both\b/.test(b.options.showOn)&&a(b.options.altField).is(e[d]))return}b.options.closeOnOutside&&b.close(b.options.revert)}}),null===b.events.document_keydown&&a(document).bind("keydown",b.events.document_keydown=function(a){b.opened&&27===a.keyCode&&b.options.closeOnEscape&&b.close(b.options.revert),b.opened&&13===a.keyCode&&b.options.okOnEnter&&b.close()}),b.element.keydown(function(a){9===a.keyCode&&b.close()}).keyup(function(a){var c=b._parseColor(b.element.val());c&&!b.color.equals(c)&&(b.color=c,b._change())})},_generate:function(){var b,c,d,e,f=this;f._setColor(f.inline||!f.element.is("input")?f.options.color:f.element.val()),f[f.inline?"_generateInline":"_generatePopup"](),b="string"==typeof f.options.parts?a.colorpicker.partslists[f.options.parts]?a.colorpicker.partslists[f.options.parts]:a.colorpicker.partslists[f.inline?"inline":"popup"]:f.options.parts,f.parts={},a.each(b,function(b,c){a.colorpicker.parts[c]&&(f.parts[c]=new a.colorpicker.parts[c](f))}),f.generated||(c=[],a.each(f.options.layout,function(a,b){f.parts[a]&&c.push({part:a,pos:b})}),d=a(h(c,function(a,b,c){return e=["ui-colorpicker-"+a.part+"-container"],b>0&&e.push("ui-colorpicker-padding-left"),c>0&&e.push("ui-colorpicker-padding-top"),'<td  class="'+e.join(" ")+'"'+(a.pos[2]>1?' colspan="'+a.pos[2]+'"':"")+(a.pos[3]>1?' rowspan="'+a.pos[3]+'"':"")+' valign="top"></td>'})).appendTo(f.dialog),f.options.inlineFrame&&d.addClass("ui-dialog-content ui-widget-content"),f._initAllParts(),f._updateAllParts(),f.generated=!0)},_effectGeneric:function(b,c,d,e,f){var g=this;a.effects&&a.effects[g.options.showAnim]?b[c](g.options.showAnim,g.options.showOptions,g.options.duration,f):(b["slideDown"===g.options.showAnim?d:"fadeIn"===g.options.showAnim?e:c](g.options.showAnim?g.options.duration:null,f),g.options.showAnim&&g.options.duration||f())},_effectShow:function(a,b){this._effectGeneric(a,"show","slideDown","fadeIn",b)},_effectHide:function(a,b){this._effectGeneric(a,"hide","slideUp","fadeOut",b)},open:function(){var b,c,d,e=this;e.opened||(e._generate(),c=e.element.is(":hidden")?a("<div/>").insertBefore(e.element):e.element,e.element.is(":hidden")&&c.remove(),b=0,a(e.element[0]).parents().each(function(){var c=a(this).css("z-index");if("number"!=typeof c&&"string"!=typeof c||""===c||isNaN(c))a(this).siblings().each(function(){var c=a(this).css("z-index");"number"!=typeof c&&"string"!=typeof c||""===c||isNaN(c)||c>b&&(b=parseInt(c,10))});else if(c>b)return b=parseInt(c,10),!1}),b+=2,e.dialog.css("z-index",b),e.options.modal&&(e.overlay=a('<div class="ui-widget-overlay"></div>').appendTo("body").css("z-index",b-1),null!==e.events.window_resize&&a(window).unbind("resize",e.events.window_resize),e.events.window_resize=function(){e.overlay&&(e.overlay.width(a(document).width()),e.overlay.height(a(document).height()))},a(window).bind("resize",e.events.window_resize),e.events.window_resize()),e._effectShow(this.dialog),e.options.position?(d=a.extend({},e.options.position),"element"===d.of&&(d.of=c)):d={my:"left top",at:"left bottom",of:c,collision:"flip"},e.dialog.position(d),e.opened=!0,e._callback("open",!0),a(function(){e._repaintAllParts()}))},close:function(b){var c=this;c.opened&&(b?(c.color=c.currentColor.copy(),c._change(),c._callback("cancel",!0)):(c.currentColor=c.color.copy(),c._callback("ok",!0)),c.changed=!1,c.overlay&&(a(window).unbind("resize",c.events.window_resize),c.overlay.remove()),c._effectHide(c.dialog,function(){c.dialog.remove(),c.dialog=null,c.generated=!1,c.opened=!1,c._callback("close",!0)}))},destroy:function(){null!==that.events.document_click_html&&a(document).undelegate("html","touchstart click",that.events.document_click_html),null!==that.events.document_keydown&&a(document).unbind("keydown",that.events.document_keydown),null!==that.events.resizeOverlay&&a(window).unbind("resize",that.events.resizeOverlay),this.element.unbind(),this.overlay&&this.overlay.remove(),null!==this.dialog&&this.dialog.remove(),null!==this.image&&this.image.remove(),null!==this.button&&this.button.remove()},_callback:function(a,b){var c,d,e=this;return e.color.set?(c={formatted:e._formatColor(e.options.colorFormat,e.color),colorPicker:e},d=e.color.getLAB(),d.a=2*d.a-1,d.b=2*d.b-1,b===!0&&(c.a=e.color.getAlpha(),c.rgb=e.color.getRGB(),c.hsv=e.color.getHSV(),c.cmyk=e.color.getCMYK(),c.hsl=e.color.getHSL(),c.lab=d),e._trigger(a,null,c)):e._trigger(a,null,{formatted:"",colorPicker:e})},_initAllParts:function(){a.each(this.parts,function(a,b){b.init&&b.init()})},_updateAllParts:function(){a.each(this.parts,function(a,b){b.update&&b.update()})},_repaintAllParts:function(){a.each(this.parts,function(a,b){b.repaint&&b.repaint()})},_change:function(b){this.changed=!0,b="undefined"!=typeof b?!!b:!0,this.color.set&&this.options.limit&&a.colorpicker.limits[this.options.limit]&&a.colorpicker.limits[this.options.limit](this.color,this),this.inline||(this.color.set?this.color.equals(this._parseColor(this.element.val()))||this.element.val(this._formatColor(this.options.colorFormat,this.color)).change():""!==this.element.val()&&this.element.val("").change(),this._setImageBackground(),this._setAltField()),this.options.color=this.color.set?this.color.toCSS():"",this.opened&&this._repaintAllParts(),this._callback("select"),b&&this._callback("stop")},_hoverable:function(a){a.hover(function(){a.addClass("ui-state-hover")},function(){a.removeClass("ui-state-hover")})},_focusable:function(a){a.focus(function(){a.addClass("ui-state-focus")}).blur(function(){a.removeClass("ui-state-focus")})},_getRegional:function(b){return void 0!==a.colorpicker.regional[this.options.regional][b]?a.colorpicker.regional[this.options.regional][b]:a.colorpicker.regional[""][b]},_getSwatches:function(){return"string"==typeof this.options.swatches?a.colorpicker.swatches[this.options.swatches]:a.isPlainObject(this.options.swatches)?this.options.swatches:a.colorpicker.swatches.html},_eachSwatch:function(b){var c,d=this._getSwatches();a.each(d,function(e,f){return c=a.isArray(d)?f.name:e,b(c,f)})},_getSwatch:function(a){var b=!1;return this._eachSwatch(function(c,d){return c.toLowerCase()==a.toLowerCase()?(b=d,!1):void 0}),b},_parseFormat:function(b,c){var d,e,f={x:function(){return"([0-9a-fA-F]{2})"},d:function(){return"([12]?[0-9]{1,2})"},f:function(){return"([0-9]*\\.?[0-9]*)"},p:function(){return"([0-9]*\\.?[0-9]*)"}},g={x:function(a){return parseInt(a,16)/255},d:function(a){return a/255},f:function(a){return a},p:function(a){return.01*a}},h={r:"setRGB",g:"setRGB",b:"setRGB",h:"setHSV",s:"setHSV",v:"setHSV",c:"setCMYK",m:"setCMYK",y:"setCMYK",k:"setCMYK",L:"setLAB",A:"setLAB",B:"setLAB"},i={setRGB:["r","g","b"],setHSV:["h","s","v"],setCMYK:["c","m","y","k"],setLAB:["L","A","B"]},j=[],k=[],l=null;if(e=b.replace(/[()\\^$.|?*+[\]]/g,function(a){return"\\"+a}),e=e.replace(/\\?[argbhsvcmykLAB][xdfp]/g,function(a){if(a.match(/^\\/))return a.slice(1);var b=a.charAt(0),c=a.charAt(1);return j.push(b),k.push(g[c]),h[b]&&(l=h[b]),f[c]()}),l){var m=c.match(new RegExp(e));if(m){var n,o=[];m.shift(),a.each(i[l],function(b,c){n=a.inArray(c,j),o[b]=k[n](m[n])}),d=new a.colorpicker.Color,d[l].apply(d,o)}}return d},_parseColor:function(b){var c,d=this,e=a.isArray(d.options.colorFormat)?d.options.colorFormat:[d.options.colorFormat];return a.each(e,function(e,f){return c=a.colorpicker.parsers[f]?a.colorpicker.parsers[f](b,d):d._parseFormat(f,b),c?!1:void 0}),c||a.each(a.colorpicker.parsers,function(a,e){return c=e(b,d),c?!1:void 0}),c?c:!1},_exactName:function(b){var c=!1;return this._eachSwatch(function(d,e){return b.equals(new a.colorpicker.Color(e.r,e.g,e.b))?(c=d,!1):void 0}),c},_closestName:function(b){var c,d=(b.getRGB(),null),e=!1;return this._eachSwatch(function(f,g){if(c=b.distance(new a.colorpicker.Color(g.r,g.g,g.b)),d>c||null===d){if(e=f,1e-20>=c)return!1;d=c}}),e},_formatColor:function(b,c){var d=this,e=null,g={x:function(a){return f(255*a)},d:function(a){return Math.round(255*a)},f:function(a){return a},p:function(a){return 100*a}},h=c.getChannels();return a.isArray(b)||(b=[b]),a.each(b,function(b,f){return a.colorpicker.writers[f]?(e=a.colorpicker.writers[f](c,d),e===!1):(e=f.replace(/\\?[argbhsvcmykLAB][xdfp]/g,function(a){return a.match(/^\\/)?a.slice(1):g[a.charAt(1)](h[a.charAt(0)])}),!1)}),e}}),a.vanderlee.colorpicker});